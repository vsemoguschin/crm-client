import{_ as ie}from"./Bmr5wyhr.js";import{_ as re,a as _e,b as ue}from"./DkMjgWCi.js";import P from"./CNFJry-h.js";import{_ as se}from"./mqOaxR0N.js";import{_ as R,b as q,a as J}from"./CNLsaPwj.js";import{_ as K}from"./BCRlC5xu.js";import{_ as Q}from"./fRExJa2e.js";import{_ as E}from"./D8Osd5Ax.js";import{_ as ne,a as ce}from"./DkkQ8vn7.js";import{e as N,g as j,m as h,w as t,o as _,a as i,c as C,z as L,b as e,D as B,d as n,t as S,F,r as O,l as c,H,B as ae,A as me,u as pe,J as oe}from"./LcRD3ia0.js";import{_ as fe}from"./CP8umD4q.js";import{_ as ge}from"./D9TSNOAg.js";import{_ as W,a as X,b as Y,c as Z,d as ee}from"./B-kig6KZ.js";import{_ as te}from"./BqmAL8DW.js";import{_ as le}from"./Pvv-dh1L.js";import{_ as de}from"./C0YhWajo.js";import{_ as ve}from"./CaSHqX9y.js";import{_ as we}from"./BcuVElyA.js";import{_ as ye,a as xe,b as $e,c as Ue,d as De}from"./AeDsR3BR.js";import{_ as be}from"./CCJdEHHg.js";import{_ as Ce}from"./Dbg8U1qb.js";import"./DfRdkKc3.js";import"./D5ydJhlK.js";import"./BdQOAs7V.js";import"./BOGtf0gU.js";import"./QkXyQO2w.js";import"./D6LOIvye.js";import"./D8EW8v7U.js";import"./BgkA-2sO.js";import"./BcyKike4.js";const ke={class:"flex flex-col justify-between flex-1"},Ve=N({__name:"List",props:{deals:{},total:{}},emits:["deal-clicked","deal-loaded"],setup(T,{emit:$}){const{$useApi:x}=j(),p=$,a=async u=>{try{await x.patch(`/production/deal/${u}/status/1`)}catch(U){console.log(U.response.data.message,32422)}p("deal-loaded")},f=u=>{p("deal-clicked",u)};return(u,U)=>{const l=q,s=K,o=E,D=J,m=Q,w=R,y=ne;return _(),h(y,{class:"pr-2"},{default:t(()=>[i("div",null,[(_(!0),C(F,null,L(u.deals,(r,d)=>(_(),h(w,{key:d,class:"flex cursor-pointer mb-2",onClick:b=>f(r.id)},{default:t(()=>[e(D,{class:"flex-1"},{default:t(()=>[i("div",ke,[e(l,null,{default:t(()=>[n(S(r.title),1)]),_:2},1024),e(s,{class:"flex flex-col"},{default:t(()=>[i("div",null,"Срок: "+S(r.deadline),1)]),_:2},1024),r.status==="Создана"?(_(),h(o,{key:0,class:"self-end",onClick:()=>a(r.id)},{default:t(()=>U[0]||(U[0]=[n(" В работу ",-1)])),_:2,__:[0]},1032,["onClick"])):B("",!0)])]),_:2},1024),e(m,{class:"p-0"})]),_:2},1032,["onClick"]))),128))])]),_:1})}}}),Oe={class:""},he=N({__name:"CreateModal",props:{deal:{}},emits:["order-created"],setup(T,{emit:$}){const{$useApi:x}=j(),p=T,a=O(),f=O({}),u=O(!1),U=l=>{const s=l[0],o=l[1];console.log(s),f.value={...o},a.value={...s}};return(l,s)=>{const o=P,D=E,m=X,w=ee,y=te,r=Z,d=de,b=le,k=Y,V=W;return _(),C("div",Oe,[e(V,{open:c(u),"onUpdate:open":s[0]||(s[0]=M=>H(u)?u.value=M:null)},{default:t(()=>[e(m,{"as-child":""},{default:t(()=>[e(D,null,{default:t(()=>[e(o,{name:"akar-icons:plus",color:"white",size:"25px"})]),_:1})]),_:1}),e(k,{class:"flex flex-col max-w-min"},{default:t(()=>[e(r,null,{default:t(()=>[e(w,null,{default:t(()=>s[1]||(s[1]=[n("Создать заказ",-1)])),_:1,__:[1]}),e(y,null,{default:t(()=>s[2]||(s[2]=[n(' Заполни все поля и нажми "Сохранить" ',-1)])),_:1,__:[2]})]),_:1}),e(d,{deal:p.deal,onGetNewOrderDatas:U},null,8,["deal"]),e(b,null,{default:t(()=>s[3]||(s[3]=[i("div",{class:"flex justify-between w-full"},null,-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["open"])])}}}),Se={class:"flex gap-6"},Me={class:"flex justify-between w-full"},Te=N({__name:"EditModal",props:{order:{}},emits:["order-edited"],setup(T,{emit:$}){const{$useApi:x}=j(),p=T,a=O(),f=O(!1),u=s=>{a.value={...s[0]}},U=$,l=async()=>{try{await x.patch(`/orders/${p.order.id}`,{...a.value}),U("order-edited","data"),f.value=!1;return}catch(s){console.log(s)}};return(s,o)=>{const D=P,m=E,w=X,y=ee,r=te,d=Z,b=de,k=le,V=Y,M=W;return _(),C("div",null,[e(M,{open:c(f),"onUpdate:open":o[0]||(o[0]=I=>H(f)?f.value=I:null)},{default:t(()=>[e(w,{"as-child":""},{default:t(()=>[e(m,{class:""},{default:t(()=>[e(D,{name:"mingcute:edit-line",color:"white",size:"25px"})]),_:1})]),_:1}),e(V,{class:"flex flex-col max-w-[1200px]"},{default:t(()=>[e(d,null,{default:t(()=>[e(y,null,{default:t(()=>o[1]||(o[1]=[n("Редактировать заказ",-1)])),_:1,__:[1]}),e(r,null,{default:t(()=>o[2]||(o[2]=[n(' Заполни все поля и нажми "Сохранить" ',-1)])),_:1,__:[2]})]),_:1}),i("div",Se,[e(b,{order:p.order,onGetEditedOrderDatas:u},null,8,["order"])]),e(k,{class:"w-full"},{default:t(()=>[i("div",Me,[e(m,null,{default:t(()=>o[3]||(o[3]=[n(" Отменить ",-1)])),_:1,__:[3]}),e(m,{onClick:l},{default:t(()=>o[4]||(o[4]=[n(" Сохранить ",-1)])),_:1,__:[4]})])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Ie={class:"w-full"},Ae={class:"flex flex-col gap-5"},Be={class:"relative"},Ne={class:"flex gap-2"},Le={class:"relative w-full"},Fe={class:"relative w-full"},je={class:"relative"},ze={class:"relative"},He={class:"relative"},Ee={class:"relative"},Pe=N({__name:"NewDeliveryForm",emits:["get-new-delivery-datas"],setup(T,{emit:$}){const x=["СДЕК","ПОЧТА РОССИИ","Яндекс","Балтийский курьер","Самовывоз","ТК КИТ","ПЭТ","Боксбери","Деловые линии"],p=["Бесплатно","Платно","Досыл"],a=O({id:0,method:x[0],type:p[0],description:"",track:"",status:"",price:0,date:new Date().toISOString().slice(0,10),deliveredDate:""}),f=$,u=()=>{f("get-new-delivery-datas",a.value)};return ae(a,()=>{console.log("newDelivery",a.value.description),u()},{deep:!0}),(U,l)=>{const s=q,o=K,D=J,m=we,w=$e,y=xe,r=De,d=be,b=Ue,k=ye,V=se,M=Ce,I=Q,z=R;return _(),C("div",Ie,[e(z,null,{default:t(()=>[e(D,null,{default:t(()=>[e(s,null,{default:t(()=>l[7]||(l[7]=[n("Доставка",-1)])),_:1,__:[7]}),e(o,null,{default:t(()=>l[8]||(l[8]=[n("Заполни данные доставки",-1)])),_:1,__:[8]})]),_:1}),e(I,null,{default:t(()=>[i("div",Ae,[i("div",Be,[e(m,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[9]||(l[9]=[n("Способ доставки",-1)])),_:1,__:[9]}),e(k,{modelValue:c(a).method,"onUpdate:modelValue":l[0]||(l[0]=g=>c(a).method=g)},{default:t(()=>[e(y,null,{default:t(()=>[e(w)]),_:1}),e(b,null,{default:t(()=>[(_(),C(F,null,L(x,(g,A)=>e(d,{key:x[A]},{default:t(()=>[e(r,{value:g},{default:t(()=>[n(S(g),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),i("div",Ne,[i("div",Le,[e(m,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[10]||(l[10]=[n("Дата отправки",-1)])),_:1,__:[10]}),e(V,{modelValue:c(a).date,"onUpdate:modelValue":l[1]||(l[1]=g=>c(a).date=g),type:"date",min:new Date().toISOString().slice(0,7)+"-01",class:me(c(a).date?"":"outline outline-1 outline-rose-300")},null,8,["modelValue","min","class"])]),i("div",Fe,[e(m,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[11]||(l[11]=[n("Дата вручения",-1)])),_:1,__:[11]}),e(V,{modelValue:c(a).deliveredDate,"onUpdate:modelValue":l[2]||(l[2]=g=>c(a).deliveredDate=g),type:"date",min:new Date().toISOString().slice(0,7)+"-01"},null,8,["modelValue","min"])])]),i("div",je,[e(m,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[12]||(l[12]=[n("Оплата",-1)])),_:1,__:[12]}),e(k,{modelValue:c(a).type,"onUpdate:modelValue":l[3]||(l[3]=g=>c(a).type=g)},{default:t(()=>[e(y,null,{default:t(()=>[e(w)]),_:1}),e(b,null,{default:t(()=>[(_(),C(F,null,L(p,(g,A)=>e(d,{key:p[A]},{default:t(()=>[e(r,{value:g},{default:t(()=>[n(S(g),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),i("div",ze,[e(m,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[13]||(l[13]=[n("Стоимость доставки",-1)])),_:1,__:[13]}),e(V,{modelValue:c(a).price,"onUpdate:modelValue":l[4]||(l[4]=g=>c(a).price=g),type:"number",class:"col-span-3"},null,8,["modelValue"])]),i("div",He,[e(m,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[14]||(l[14]=[n("Трек",-1)])),_:1,__:[14]}),e(V,{modelValue:c(a).track,"onUpdate:modelValue":l[5]||(l[5]=g=>c(a).track=g),class:"col-span-3"},null,8,["modelValue"])]),i("div",Ee,[e(m,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[15]||(l[15]=[n("Доп. информация",-1)])),_:1,__:[15]}),e(M,{modelValue:c(a).description,"onUpdate:modelValue":l[6]||(l[6]=g=>c(a).description=g),placeholder:"Информация о доставке"},null,8,["modelValue"])])])]),_:1})]),_:1})])}}}),Ge={class:"flex gap-6"},Re={class:"flex justify-between w-full"},qe=N({__name:"CreateModal",props:{deal:{}},emits:["delivery-created"],setup(T,{emit:$}){const{$useApi:x}=j(),p=T,a=O({}),f=O(!1),u=s=>{a.value={...s}},U=$,l=async()=>{await x.post(`/deals/${p.deal.id}/deliveries/`,{...a.value}),U("delivery-created","data"),f.value=!1};return(s,o)=>{const D=E,m=X,w=ee,y=te,r=Z,d=Pe,b=le,k=Y,V=W;return _(),C("div",null,[e(V,{open:c(f),"onUpdate:open":o[0]||(o[0]=M=>H(f)?f.value=M:null)},{default:t(()=>[e(m,{"as-child":""},{default:t(()=>[e(D,null,{default:t(()=>o[1]||(o[1]=[n(" + ДОБАВИТЬ ПОДАРОК ",-1)])),_:1,__:[1]})]),_:1}),e(k,{class:"flex flex-col"},{default:t(()=>[e(r,null,{default:t(()=>[e(w,null,{default:t(()=>o[2]||(o[2]=[n("Добавить доставку",-1)])),_:1,__:[2]}),e(y,null,{default:t(()=>o[3]||(o[3]=[n(' Заполни все поля и нажми "Сохранить" ',-1)])),_:1,__:[3]})]),_:1}),i("div",Ge,[e(d,{onGetNewDeliveryDatas:u})]),e(b,{class:"w-full"},{default:t(()=>[i("div",Re,[e(D,null,{default:t(()=>o[4]||(o[4]=[n(" Отменить ",-1)])),_:1,__:[4]}),e(D,{onClick:l},{default:t(()=>o[5]||(o[5]=[n(" Сохранить ",-1)])),_:1,__:[5]})])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Je={class:"flex flex-col justify-start w-full"},Ke={class:"flex"},Qe={class:"w-[200px] mr-3 rounded overflow-hidden"},We=["src"],Xe={class:"flex flex-col"},Ye=["href"],Ze=["href"],et={class:"flex gap-2"},tt={class:"flex justify-between"},lt=N({__name:"Card",props:{deal:{}},emits:["deal-updated","deal-loded","order-moved"],setup(T,{emit:$}){const{$useApi:x}=j(),p=T;console.log(p.deal.files);const a=$,f=()=>{console.log("deal-updated"),a("deal-updated",p.deal.id)},u=async l=>{await x.delete(`/orders/${l}`),a("deal-updated",p.deal.id)},U=async l=>{await x.patch(`/orders/${l.id}/stage/${l.stageId+1}`),a("order-moved",p.deal)};return(l,s)=>{const o=q,D=K,m=ge,w=E,y=J,r=Q,d=R,b=he,k=Te,V=P,M=ce,I=ne,z=ve,g=qe,A=fe;return _(),h(d,{class:"flex flex-col overflow-hidden bg-slate-100"},{default:t(()=>[e(y,{class:"flex flex-row items-start bg-slate-50 pb-1"},{default:t(()=>[i("div",Je,[e(o,{class:"flex items-center gap-2 text-lg pb-2"},{default:t(()=>[n(" Информация: "+S(l.deal.title),1)]),_:1}),e(D,null,{default:t(()=>[n(" Готовность: "+S(l.deal.deadline),1)]),_:1}),e(w,{class:"h-6 mt-3 self-start"},{default:t(()=>[e(m,{to:"/orders/"+l.deal.id},{default:t(()=>s[0]||(s[0]=[n(" Полная информация ",-1)])),_:1,__:[0]},8,["to"])]),_:1})])]),_:1}),e(r,{class:"p-3 flex flex-col items-center h-full"},{default:t(()=>[l.deal.preorder?(_(),h(d,{key:0,class:"overflow-hidden w-full mb-3"},{default:t(()=>[e(y,{class:"bg-slate-50 pb-1 mb-2"},{default:t(()=>[e(o,null,{default:t(()=>s[1]||(s[1]=[n(" Карточка дизайна ",-1)])),_:1,__:[1]})]),_:1}),e(r,null,{default:t(()=>[i("div",Ke,[i("div",Qe,[i("img",{src:l.deal.preorder.preview,alt:"Preview",class:"preview-image"},null,8,We)]),i("div",Xe,[i("a",{class:"underline decoration-solid cursor-pointer text-blue-600",href:l.deal.preorder?.card_link,target:"_blank"},"Ссылка на карточку",8,Ye),i("a",{class:"underline decoration-solid cursor-pointer text-blue-600",href:l.deal.preorder.maket+"?name="+l.deal.title+".cdr&dl=true"},"Макет",8,Ze)])])]),_:1})]),_:1})):B("",!0),e(d,{class:"mb-3 w-full overflow-hidden"},{default:t(()=>[e(y,{class:"p-2 pb-2 bg-slate-50 flex"},{default:t(()=>[e(o,{class:"flex items-center"},{default:t(()=>[l.deal.status==="Создана"?(_(),h(b,{key:0,deal:l.deal,class:"mr-3 justify-between",onOrderCreated:f},null,8,["deal"])):B("",!0),s[2]||(s[2]=n(" Список заказов ",-1))]),_:1,__:[2]})]),_:1}),l.deal?.orders?.length?(_(),h(r,{key:0,class:"p-2"},{default:t(()=>[e(I,{class:"pb-2"},{default:t(()=>[i("div",et,[(_(!0),C(F,null,L(l.deal.orders,(v,G)=>(_(),C("div",{key:G,class:"mb-2 w-[300px] h-full"},[e(d,null,{default:t(()=>[e(y,{class:"p-2"},{default:t(()=>[i("div",null,[e(o,null,{default:t(()=>[n(S(v.title),1)]),_:2},1024),e(D,null,{default:t(()=>[n(" статус - "+S(v.stage?.title||"dfsds"),1)]),_:2},1024)])]),_:2},1024),e(r,{class:"p-2"},{default:t(()=>[i("div",tt,[e(k,{order:v,onOrderEdited:f},null,8,["order"]),l.deal.status==="Создана"?(_(),h(w,{key:0,onClick:()=>u(v.id)},{default:t(()=>[e(V,{name:"mi:delete",color:"white",size:"25px"})]),_:2},1032,["onClick"])):(_(),h(w,{key:1,onClick:()=>U(v)},{default:t(()=>s[3]||(s[3]=[n(" Готово ",-1)])),_:2,__:[3]},1032,["onClick"]))])]),_:2},1024)]),_:2},1024)]))),128))]),e(M,{orientation:"horizontal"})]),_:1})]),_:1})):B("",!0)]),_:1}),e(d,{class:"mb-3 w-full overflow-hidden"},{default:t(()=>[e(y,{class:"p-2 pb-2 bg-slate-50 flex"},{default:t(()=>[e(o,{class:"flex items-center"},{default:t(()=>[l.deal.status==="Создана"?(_(),h(z,{key:0,deal:l.deal,class:"mr-3",onDeliveryCreated:f},null,8,["deal"])):B("",!0),s[4]||(s[4]=n(" Список доставок ",-1))]),_:1,__:[4]})]),_:1}),l.deal?.deliveries?.length?(_(),h(r,{key:0,class:"p-2"},{default:t(()=>[(_(!0),C(F,null,L(l.deal.deliveries,(v,G)=>(_(),C("div",{key:G,class:"mb-2"},[e(d,null,{default:t(()=>[e(y,{class:"p-2"},{default:t(()=>[i("div",null,[e(o,null,{default:t(()=>[n(S(v.method),1)]),_:2},1024),e(D,null,{default:t(()=>[n(S(v.type),1)]),_:2},1024)])]),_:2},1024),e(r,{class:"p-2"},{default:t(()=>[n(" статус - "+S(v.status),1)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):B("",!0)]),_:1}),l.deal.status==="Создана"?(_(),h(g,{key:1,deal:l.deal,class:"mt-3",onDeliveryCreated:f},null,8,["deal"])):B("",!0)]),_:1}),e(A,{class:"flex items-center border-t bg-muted/50 px-6 py-3 mt-3"},{default:t(()=>s[5]||(s[5]=[n(" ФУТЕР ",-1)])),_:1,__:[5]})]),_:1})}}}),ot={class:"flex relative h-screen"},st={class:"w-[50px] fixed"},nt={class:"flex flex-col p-3 h-full w-full ml-[50px]"},at={key:0,class:"mt-2 flex gap-2 h-[95%]"},dt={class:"flex flex-col w-[50%]"},it={class:"sm:flex-initial mb-2 pr-2"},rt={class:"relative"},_t={class:"flex flex-col w-[50%]"},ut={key:1},Et=N({__name:"index",async setup(T){let $,x;const{$useApi:p}=j();pe({title:"Производство | Easy CRM"});const a={id:0,title:"Пусто",price:1e4,status:"null",deadline:"-----",clothingMethod:"string",description:"string",source:"string",adTag:"string",discont:"string",sphere:"string",city:"string",region:"string",cardLink:"string",paid:"string",totalPrice:1,dopsPrice:1,recievedPayments:1,remainder:1,firstPayment:"string",clientType:"string",recievedPay:1,createdAt:"",dealers:[],client:{id:0,fullName:"string",workSpaceId:0,groupId:0,phone:"string",type:"string",chatLink:"string",gender:"string",firstContact:"string",adLink:"string",inn:"string"},preorder:{preview:"string"}},f=O([]),u=O("1"),U=O(""),{data:l}=([$,x]=oe(()=>p.get("/stages")),$=await $,x(),$);f.value=l||[];const s=O([]),o=O(a),D=O(0),m=async()=>{const r="production/stage/"+u.value,{data:d}=await p.get(r);s.value=d.deals||[],d.deals.length?await w(d.deals[0].id):o.value=a},w=async r=>{const{data:d}=await p.get(`production/deals/${r}`);u.value!=="1"&&(d.orders=d.orders.filter(k=>k.stageId===+u.value)),o.value=d;const{data:b}=await p.get("kaiten/card/"+d.card_id);b!=="Nope"&&(o.value.preorder=b)},y=async r=>{if(console.log("deal",r.orders.length),r.orders.length>1)return await w(r.id);await m()};return[$,x]=oe(()=>m()),await $,x(),ae(u,async()=>{await m()}),(r,d)=>{const b=ie,k=ue,V=_e,M=re,I=P,z=se,g=Ve,A=lt;return _(),C("div",ot,[i("div",st,[e(b)]),i("div",nt,[e(M,{modelValue:c(u),"onUpdate:modelValue":d[0]||(d[0]=v=>H(u)?u.value=v:null),"default-value":"1",class:""},{default:t(()=>[e(V,null,{default:t(()=>[(_(!0),C(F,null,L(c(f),v=>(_(),h(k,{key:v.id,value:v.id.toString()},{default:t(()=>[n(S(v.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),c(s).length?(_(),C("div",at,[i("div",dt,[i("form",it,[i("div",rt,[e(I,{name:"mi:search",color:"black",size:"15px",class:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e(z,{modelValue:c(U),"onUpdate:modelValue":d[1]||(d[1]=v=>H(U)?U.value=v:null),class:"pl-8 w-full",type:"search",placeholder:"Искать сделки...",onInput:m},null,8,["modelValue"])])]),e(g,{class:"grow",deals:c(s),total:c(D),onDealClicked:w,onDealLoaded:m},null,8,["deals","total"])]),i("div",_t,[e(A,{class:"grow",deal:c(o),"current-stage":c(u),onDealUpdated:d[2]||(d[2]=async v=>{await w(v)}),onOrderMoved:d[3]||(d[3]=async v=>{await y(v)})},null,8,["deal","current-stage"])])])):(_(),C("div",ut,"Пусто..."))])])}}});export{Et as default};
