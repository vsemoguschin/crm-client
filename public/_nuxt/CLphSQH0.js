import{_ as te}from"./Bye7C16d.js";import{_ as oe}from"./Bh3bOtDY.js";import re from"./ROxBBV8N.js";import{_ as se}from"./CDst0A0O.js";import{_ as ne}from"./CaPtdwNj.js";import{_ as ae}from"./BWn7SjA7.js";import{_ as ie}from"./B7XstORc.js";import{u as le,a as ce,b as de,c as pe,e as me,_ as ue,d as _e}from"./CaE-P5HS.js";import{_ as fe}from"./D0d2ZlUf.js";import{_ as ge}from"./BKGnLYx3.js";import{b as ye,_ as ve,a as we}from"./DFGFWj04.js";import{e as ke,g as he,L as xe,r as g,i as $e,c as m,a as l,b as t,m as be,D as R,l as s,w as a,t as u,d as _,F as k,z as h,u as Ce,o as d}from"./BbheI0mw.js";import"./D0Fd2yXn.js";import"./B9M8ggfK.js";import"./oLxPQbNe.js";import"./D2GZmoDz.js";import"./DVdymwQ5.js";import"./KSX9JOtw.js";import"./ZTyVILcU.js";import"./s39mgViW.js";import"./CJOOd8Dx.js";import"./BR3DQNok.js";import"./odSmgr3d.js";import"./DzJc7hp_.js";import"./CCknexPU.js";import"./cStEOrWd.js";import"./BHuR11Jx.js";import"./DiZ4QL0M.js";import"./Deo3HQM0.js";import"./C30fSUvl.js";import"./CprHmdOe.js";import"./CssJESp-.js";import"./JYeLPbKT.js";import"./_14b2CUj.js";import"./DLLw9AXE.js";import"./D-8t_H8v.js";import"./QXfa84Px.js";import"./DaWZu8wl.js";import"./D0zfKHPR.js";import"./l1eRtAXP.js";import"./BhleEUCu.js";import"./BND4UK_1.js";import"./CaiudRgb.js";import"./jAsYS30d.js";import"./CHKwxJtM.js";import"./Sc4DFA1e.js";const Ae={class:"flex relative"},De={class:"w-[50px] fixed"},Ue={class:"p-3 w-full ml-[50px] flex justify-center gap-3"},Me={class:"flex flex-col max-w-[720px] w-full gap-3 p-4 bg-slate-100 rounded-md shadow"},Le={class:"flex"},Ie={class:"flex font-semibold"},Ne={class:"flex font-semibold"},Fe={class:"flex"},Oe=["onClick"],Mt=ke({__name:"[id]",setup(Te){const{$useApi:p}=he(),f=xe().params.id,x={id:0,title:"Пусто",price:1e4,status:"null",deadline:"-----",clothingMethod:"string",description:"string",source:"string",adTag:"string",discont:"string",sphere:"string",city:"string",region:"string",cardLink:"string",paid:"string",totalPrice:1,dopsPrice:1,recievedPayments:1,remainder:1,firstPayment:"string",clientType:"string",recievedPay:1,createdAt:"",dealers:[],client:{id:0,fullName:"string",workSpaceId:0,groupId:0,phone:"string",type:"string",chatLink:"string",gender:"string",firstContact:"string",adLink:"string",inn:"string"},preorder:{preview:"string"},deliveries:[{id:0,method:"string",type:"string",description:"string",track:"string",status:"string",price:0}]},r=g({...x}),$=g([...x.deliveries]),b=g([]),E=g(!0),C=g([]),A=async()=>{try{const{data:e}=await p.get(`production/deals/${f}`),{data:o}=await p.get("kaiten/card/"+e.card_id),{data:c}=await p.get("production/workers");o!=="Nope"&&(e.preorder=o),r.value=e,C.value=c,console.log(e.files),Ce({title:e.title?`${e.title} | Easy CRM`:"Easy CRM"})}catch(e){console.error("Ошибка при загрузке сделки:",e)}};async function P(){try{const e=await p.get("/stages");b.value=e.data}catch(e){console.error("Ошибка при загрузке стадий:",e)}finally{E.value=!1}}async function z(e,o){try{r.value.orders[e]=o,console.log("Стадия успешно изменена")}catch(c){console.error("Ошибка при изменении стадии:",c),console.log("Ошибка при изменении стадии")}}const v=async()=>{try{const{data:e}=await p.get(`/deals/${f}/deliveries`);console.log(e),$.value=e.deliveries||[];return}catch(e){console.log(e)}},D=async()=>{try{const{data:e}=await p.get(`/deals/${f}/files`);r.value.files=e.files||[];return}catch(e){console.log(e)}},S=async()=>{try{const{data:e}=await p.get(`/deals/${f}/orders`);r.value.orders=e.orders||[];return}catch(e){console.log(e)}},B=async()=>{try{await navigator.clipboard.writeText("https://easy-crm.pro/orders/"+f),console.log("Ссылка скопирована в буфер обмена!")}catch(e){console.error("Ошибка копирования ссылки:",e)}},j=async e=>{const o=`https://cloud-api.yandex.net/v1/disk/resources?path=${encodeURIComponent(e)}`,c={Accept:"application/json",Authorization:"OAuth y0_AgAEA7qkcvrzAADLWwAAAAD3ffQIQaf8Plw0QhqCi-7Zcz02CNT3scc"};try{const i=await fetch(o,{method:"GET",headers:c});if(!i.ok)throw new Error(`Ошибка: ${i.status} ${i.statusText}`);return await i.json()}catch(i){throw console.error("Ошибка при выполнении запроса:",i),i}},V=async(e,o)=>{try{const c=await j(e);if(c&&c.file){const i=document.createElement("a");i.href=c.file,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i)}else console.error("Ресурс не найден или ссылка отсутствует")}catch(c){console.error("Ошибка при получении ресурса:",c)}},Q=()=>{console.log("deal-updated"),A()},q=async e=>{try{await p.delete(`files/${e}`),await D()}catch(o){console.log(o)}},W=e=>{e?window.open(e,"_blank"):console.error("URL отсутствует")};return $e(()=>{A(),v(),P()}),(e,o)=>{const c=te,i=oe,w=re,U=se,M=ne,L=ae,Y=ie,I=de,G=me,N=pe,F=ce,O=ue,H=fe,Z=_e,J=ge,K=ve,X=we,ee=ye;return d(),m("div",Ae,[l("div",De,[t(c)]),l("div",Ue,[l("div",Me,[s(r).preorder.preview?(d(),be(i,{key:0,src:s(r).preorder.preview,alt:"Предпросмотр",class:"mb-2 rounded w-full cursor-pointer",onClick:o[0]||(o[0]=n=>W(s(r).preorder.preview))},null,8,["src"])):R("",!0),l("div",null,[l("div",Le,[t(U,{class:"h-6 w-6 mr-2 p-0",onClick:o[1]||(o[1]=n=>B())},{default:a(()=>[t(w,{name:"bx:copy",color:"white",size:"18px"})]),_:1}),l("strong",null,u(s(r)?.title||"Неизвестная сделка"),1)]),l("div",null,"Готовность: "+u(("useMyFormatDate"in e?e.useMyFormatDate:s(le))(s(r).deadline)),1),l("div",null,[o[2]||(o[2]=_(" Ссылка на сделку: ",-1)),t(L,null,{default:a(()=>[t(M,{to:s(r).client.chatLink,target:"_blank"},{default:a(()=>[l("span",null,u(s(r).client.chatLink.includes("amo")?"amo":"bluesaless"),1)]),_:1},8,["to"])]),_:1})]),l("div",null,[t(L,{class:"mb-2"},{default:a(()=>[t(M,{to:`${s(r).preorder.maket}?name=${encodeURIComponent(s(r).title)}.cdr&dl=true`,target:"_blank"},{default:a(()=>o[3]||(o[3]=[_(" Скачать макет ",-1)])),_:1,__:[3]},8,["to"])]),_:1})])]),l("div",null,[l("div",Ie,[t(Y,{deal:s(r),class:"mr-2 justify-between",onOrderCreated:Q},null,8,["deal"]),o[4]||(o[4]=_(" Задание: ",-1))]),(d(!0),m(k,null,h(s(r).orders,(n,y)=>(d(),m("div",{key:n.id,class:"w-full"},[t(O,{type:"single",collapsible:""},{default:a(()=>[t(F,{value:"item-1"},{default:a(()=>[t(I,{class:"p-0 pl-2 bg-slate-200/60 rounded-t-sm mb-1"},{default:a(()=>[_("Заказ "+u(`(${n.stage.title})`),1)]),_:2},1024),t(N,null,{default:a(()=>[t(G,{order:n,stages:s(b),workers:s(C),"from-page":"id",onChangeStage:T=>z(y,T.order),onUpdateOrdersList:S},null,8,["order","stages","workers","onChangeStage"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),l("div",null,[l("div",Ne,[t(H,{deal:s(r),class:"mr-2",onDeliveryCreated:v},null,8,["deal"]),o[5]||(o[5]=_(" Доставка: ",-1))]),(d(!0),m(k,null,h(s($),(n,y)=>(d(),m("div",{key:n.id,class:"w-full"},[t(O,{type:"single",collapsible:""},{default:a(()=>[t(F,{value:"item-1"},{default:a(()=>[t(I,{class:"p-0 pl-2 bg-slate-200/60 rounded-t-sm mb-1"},{default:a(()=>[_(u(n.method)+" "+u(n.track?"("+n.track+")":""),1)]),_:2},1024),t(N,null,{default:a(()=>[t(Z,{delivery:n,onDeliveryDeleted:v},null,8,["delivery"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),t(ee,null,{default:a(()=>[l("div",Fe,[t(J,{deal:s(r),onFileUploaded:D},null,8,["deal"]),t(K,{class:"font-semibold pl-2 w-full text-left bg-slate-200/60 flex items-center justify-between"},{default:a(()=>[o[6]||(o[6]=_(" Документы: ",-1)),t(w,{class:"ml-auto",name:"mingcute:arrows-down-line",size:"18px"})]),_:1,__:[6]})]),t(X,null,{default:a(()=>[(d(!0),m(k,null,h(s(r).files,(n,y)=>(d(),m("div",{key:y,class:"flex gap-2 p-2"},[t(U,{class:"w-5 h-5 p-0",variant:"destructive",onClick:()=>q(n.id)},{default:a(()=>[t(w,{name:"streamline:delete-1-solid",color:"",size:"11px"})]),_:2},1032,["onClick"]),n.type==="documents"?(d(),m("div",{key:0,class:"underline decoration-solid cursor-pointer text-blue-600",onClick:T=>V(`EasyCRM/documents/${n.ya_name}`,n.name)},u(n.name),9,Oe)):R("",!0)]))),128))]),_:1})]),_:1})])])])}}});export{Mt as default};
