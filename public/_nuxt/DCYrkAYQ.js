import{_ as je}from"./Bye7C16d.js";import{_ as Ee,a as Ye,b as qe}from"./BF3m7Vf0.js";import{_ as Je}from"./C8Hj2bae.js";import{_ as fe}from"./D0zfKHPR.js";import{_ as ve,a as he}from"./l1eRtAXP.js";import{_ as We}from"./BhleEUCu.js";import{_ as xe}from"./BND4UK_1.js";import{_ as Xe}from"./CaiudRgb.js";import{_ as we}from"./C30fSUvl.js";import{_ as ye}from"./CprHmdOe.js";import{_ as Se}from"./C5Bd_Bx3.js";import{_ as m}from"./CDst0A0O.js";import{_ as be}from"./CsZkzt_A.js";import{_ as Qe}from"./CHKwxJtM.js";import{_ as Ze}from"./BWn7SjA7.js";import{_ as ce,a as ie,b as de}from"./DAmwS8V7.js";import{_ as et,a as tt,b as at,c as lt,d as st,e as ot}from"./DAy9nm00.js";import{C as nt,_ as rt}from"./DFFUo3JN.js";import{c as _e,v as ee}from"./B9M8ggfK.js";import{C as ct}from"./_14b2CUj.js";import{e as Z,v as ae,m as M,o as n,w as l,b as a,d as y,c as T,D as O,l as s,t as q,F as A,a as c,z as j,A as W,E as it,r as C,B as X,G as t,g as ue,i as ke,H as dt,u as ut}from"./BbheI0mw.js";import{X as Ce}from"./oLxPQbNe.js";import{_ as De}from"./DImM_Wqr.js";import{b as Me,c as Te,d as $e,e as Ve,_ as Ie,a as Ue}from"./C6vK2VYI.js";import{_ as Fe,a as Re}from"./DVdymwQ5.js";import{u as Ne,g as Ke,a as Be,b as Ae,F as le}from"./lvbecDJM.js";import{C as Ge}from"./CJOOd8Dx.js";import{u as G}from"./Dt19OLxm.js";import{A as w}from"./Boz4PYjF.js";import{a as pt,b as mt,c as gt,d as _t,_ as ft}from"./cStEOrWd.js";import{_ as vt}from"./BHuR11Jx.js";import"./C_rPMSjE.js";import"./D0Fd2yXn.js";import"./CaPtdwNj.js";import"./KSX9JOtw.js";import"./ZTyVILcU.js";import"./s39mgViW.js";import"./BR3DQNok.js";import"./odSmgr3d.js";import"./DzJc7hp_.js";import"./CCknexPU.js";import"./CssJESp-.js";import"./BuyaVAog.js";import"./D2GZmoDz.js";const ht={class:"hidden space-x-1 lg:flex"},xt={key:1,class:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs"},Pe=Z({__name:"DataTableFacetedFilter",props:{column:{},title:{},options:{}},setup(e){const f=e,x=ae(()=>f.column?.getFacetedUniqueValues()),v=ae(()=>new Set(f.column?.getFilterValue()));return(u,$)=>{const V=Qe,i=Ze,p=m,R=ce,o=tt,I=lt,B=ot,E=st,z=rt,L=at,P=et,b=ie,S=de;return n(),M(S,null,{default:l(()=>[a(R,{"as-child":""},{default:l(()=>[a(p,{variant:"outline",size:"sm",class:"h-8 border-dashed"},{default:l(()=>[a(s(nt),{class:"mr-2 h-4 w-4"}),y(" "+q(u.title)+" ",1),v.value.size>0?(n(),T(A,{key:0},[a(V,{orientation:"vertical",class:"mx-2 h-4"}),a(i,{variant:"secondary",class:"rounded-sm px-1 font-normal lg:hidden"},{default:l(()=>[y(q(v.value.size),1)]),_:1}),c("div",ht,[v.value.size>1?(n(),M(i,{key:0,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:l(()=>[y(q(v.value.size),1)]),_:1})):(n(!0),T(A,{key:1},j(u.options.filter(g=>v.value.has(g.value)),g=>(n(),M(i,{key:g.value,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:l(()=>[y(q(g.label),1)]),_:2},1024))),128))])],64)):O("",!0)]),_:1})]),_:1}),a(b,{class:"w-[200px] p-0",align:"start"},{default:l(()=>[a(P,{"filter-function":(g,N)=>g.filter(h=>h.label.toLowerCase()?.includes(N))},{default:l(()=>[a(o,{placeholder:u.title},null,8,["placeholder"]),a(L,null,{default:l(()=>[a(I,null,{default:l(()=>$[1]||($[1]=[y("Нет совпадений.",-1)])),_:1,__:[1]}),a(E,null,{default:l(()=>[(n(!0),T(A,null,j(u.options,g=>(n(),M(B,{key:g.value,value:g,onSelect:N=>{v.value.has(g.value)?v.value.delete(g.value):v.value.add(g.value);const _=Array.from(v.value);u.column?.setFilterValue(_.length?_:void 0)}},{default:l(()=>[c("div",{class:W(s(_e)("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",v.value.has(g.value)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"))},[a(s(ct),{class:W(s(_e)("h-4 w-4"))},null,8,["class"])],2),g.icon?(n(),M(it(g.icon),{key:0,class:"mr-2 h-4 w-4 text-muted-foreground"})):O("",!0),c("span",null,q(g.label),1),x.value?.get(g.value)?(n(),T("span",xt,q(x.value.get(g.value)),1)):O("",!0)]),_:2},1032,["value","onSelect"]))),128))]),_:1}),v.value.size>0?(n(),T(A,{key:0},[a(z),a(E,null,{default:l(()=>[a(B,{value:{label:"Очистить"},class:"justify-center text-center",onSelect:$[0]||($[0]=g=>u.column?.setFilterValue(void 0))},{default:l(()=>$[2]||($[2]=[y(" Очистить ",-1)])),_:1,__:[2]})]),_:1})],64)):O("",!0)]),_:1})]),_:1},8,["filter-function"])]),_:1})]),_:1})}}}),wt={class:"flex items-center justify-between"},yt={class:"flex flex-1 items-center space-x-2"},St=Z({__name:"DataTableToolbar",props:{table:{},wFilters:{},managersFilter:{}},setup(e){const f=e,x=ae(()=>f.table.getState().columnFilters.length>0);return(v,u)=>{const $=Pe,V=m;return n(),T("div",wt,[c("div",yt,[v.table.getColumn("group")?(n(),M($,{key:0,column:v.table.getColumn("group"),title:"Проект",options:v.wFilters},null,8,["column","options"])):O("",!0),v.table.getColumn("manager")?(n(),M($,{key:1,column:v.table.getColumn("manager"),title:"Менеджер",options:v.managersFilter},null,8,["column","options"])):O("",!0),x.value?(n(),M(V,{key:2,variant:"secondary",class:"h-8 px-2 lg:px-3",onClick:u[0]||(u[0]=i=>v.table.resetColumnFilters())},{default:l(()=>[u[1]||(u[1]=y(" Сброс ",-1)),a(s(Ce),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})):O("",!0)])])}}}),bt={class:"flex mb-2 justify-between ml-[340px]"},kt={class:"bg-slate-100"},Ct=Z({__name:"DataTable",props:{columns:{},data:{},managers:{}},emits:["table-sorted","on-delete-item"],setup(e,{emit:f}){const x=e,v=C(0),u=C([]),$=C([]),V=C({}),i=Ne({get data(){return x.data},get columns(){return x.columns},getCoreRowModel:Ae(),getSortedRowModel:Be(),getFilteredRowModel:Ke(),onSortingChange:o=>ee(o,u),onColumnFiltersChange:o=>ee(o,$),onColumnVisibilityChange:o=>ee(o,V),state:{get sorting(){return u.value},get columnFilters(){return $.value},get columnVisibility(){return V.value}},meta:{deleteItem:o=>R(o.id)}}),p=f,R=o=>{p("on-delete-item",o)};return X(()=>i.getSortedRowModel().rows,o=>{const I=o.map(B=>B.original.id);p("table-sorted",I)},{deep:!0}),(o,I)=>{const B=St,E=m,z=ce,L=De,P=ie,b=de,S=$e,g=Ue,N=Te,h=Ie,_=Ve,r=Me,K=Re,H=Fe;return n(),T(A,null,[c("div",bt,[a(B,{table:s(i),"w-filters":[{label:"Авито Питер",value:"Авито Питер"},{label:"Авито",value:"Авито"},{label:"ВК",value:"ВК"},{label:"ИзиБук",value:"ИзиБук"}],"managers-filter":o.managers},null,8,["table","managers-filter"]),c("div",null,[a(b,null,{default:l(()=>[a(z,null,{default:l(()=>[a(E,{variant:"outline",class:"ml-auto"},{default:l(()=>[I[0]||(I[0]=y(" Колонки ",-1)),a(s(Ge),{class:"w-4 h-4 ml-2"})]),_:1,__:[0]})]),_:1}),a(P,{class:"w-[180px]"},{default:l(()=>[(n(!0),T(A,null,j(s(i).getAllColumns().filter(d=>d.getCanHide()),d=>(n(),T("div",{key:d.id},[a(L,{checked:d.getIsVisible(),"onUpdate:checked":k=>{d.toggleVisibility(!!k)}},null,8,["checked","onUpdate:checked"]),y(" "+q(d.columnDef.ruName),1)]))),128))]),_:1})]),_:1})])]),c("div",kt,[a(H,{class:"h-[calc(100vh-270px)]"},{default:l(()=>[a(r,{class:"bg-white relative"},{default:l(()=>[a(N,{class:"bg-gray-50 sticky top-0 z-50"},{default:l(()=>[(n(!0),T(A,null,j(s(i).getHeaderGroups(),d=>(n(),M(g,{key:d.id,class:""},{default:l(()=>[(n(!0),T(A,null,j(d.headers,k=>(n(),M(S,{key:k.id},{default:l(()=>[k.isPlaceholder?O("",!0):(n(),M(s(le),{key:0,render:k.column.columnDef.header,props:k.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(_,null,{default:l(()=>[s(i).getRowModel().rows?.length?(n(!0),T(A,{key:0},j(s(i).getRowModel().rows,d=>(n(),M(g,{key:d.id,class:W([s(v)===d.original.id?"bg-slate-300/70":"bg-slate-100","cursor-pointer"]),"data-state":d.getIsSelected()?"selected":void 0},{default:l(()=>[(n(!0),T(A,null,j(d.getVisibleCells(),k=>(n(),M(h,{key:k.id},{default:l(()=>[a(s(le),{render:k.column.columnDef.cell,props:k.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["class","data-state"]))),128)):(n(),M(g,{key:1},{default:l(()=>[a(h,{colspan:o.columns.length,class:"text-left"},{default:l(()=>I[1]||(I[1]=[y(" Нет результатов. ",-1)])),_:1,__:[1]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),a(K,{orientation:"horizontal"})]),_:1})])],64)}}}),Dt=[{accessorKey:"date",ruName:"Дата",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0"},()=>["Дата",t(w,{class:" h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center text-xs"},e.getValue("date"))},{accessorKey:"manager",ruName:"Менеджер",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0"},()=>["Менеджер",t(w,{class:" h-4 w-4"})]),cell:({row:e})=>t("div",{class:"flex flex-col items-center"},[t("span",{},e.getValue("manager")),t("span",{class:"text-xs text-gray-600"},e.getValue("group"))]),filterFn:(e,f,x)=>x.includes(e.getValue(f))},{accessorKey:"group",ruName:"Отдел",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0 hidden"},()=>["Отдел",t(w,{class:" h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center hidden"},e.getValue("group")),filterFn:(e,f,x)=>x.includes(e.getValue(f))},{accessorKey:"calls",ruName:"Заявки",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0"},()=>["Заявки",t(w,{class:" h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("calls"))},{accessorKey:"makets",ruName:"Макеты",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0"},()=>["Макеты",t(w,{class:" h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("makets"))},{accessorKey:"maketsDayToDay",ruName:"Макеты день в день",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full p-0 text-wrap"},()=>[t("span",{class:"text-wrap"},"Макеты день в день"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("maketsDayToDay"))},{accessorKey:"totalSales",ruName:"Общие продажи",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0 text-wrap"},()=>[t("span",{class:"text-wrap"},"Общие продажи"),t(w,{class:"h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("totalSales"))+"₽")},{accessorKey:"dealSales",ruName:"Продажи по сделкам",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0 text-wrap"},()=>[t("span",{class:"text-wrap"},"Продажи по сделкам"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("dealSales"))+"₽")},{accessorKey:"dealsAmount",ruName:"Количество сделок",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0 text-wrap"},()=>[t("span",{class:"text-wrap"},"Кол-во сделок"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("dealsAmount"))},{accessorKey:"redirectToMSG",ruName:"Переходы в мессенджер",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0 text-wrap"},()=>[t("span",{class:"text-wrap"},"Переходы в мессенджер"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("redirectToMSG"))},{accessorKey:"conversion",ruName:"Конверсия",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0"},()=>["Конверсия",t(w,{class:" h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("conversion")+"%")},{accessorKey:"drr",ruName:"ДРР",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0"},()=>["ДРР",t(w,{class:" h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("drr")+"%")},{accessorKey:"dopSales",ruName:"Доп. продажи",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0"},()=>[t("span",{class:"text-wrap"},"Доп. продажи"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("dopSales"))+"₽")},{accessorKey:"averageBill",ruName:"Средний чек",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0 text-wrap"},()=>[t("span",{class:"text-wrap"},"Средний чек"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("averageBill"))+"₽")},{accessorKey:"dealsDayToDayCount",ruName:"Сделки день в день",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-0 text-wrap"},()=>[t("span",{class:"text-wrap"},"Сделки день в день"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("dealsDayToDayCount"))},{accessorKey:"actions",ruName:"Действия",header:()=>t("div",{class:"text-center"},"Действия"),enableHiding:!1,cell:({row:e,table:f})=>{const x=e.original;return t(m,{class:"h-5 px-1",item:x,onClick:()=>f.options.meta?.deleteItem(x)},()=>"Удалить")}}],Mt={class:"flex gap-2 w-full"},Tt={class:"min-w-[250px]"},$t={class:"flex flex-col gap-5"},Vt={class:"relative"},It={class:"relative w-full"},Ut={class:"flex gap-2"},Ft={class:"relative"},Rt={class:"flex gap-2"},Nt={class:"relative"},Kt={class:"flex gap-2"},Bt={class:"relative"},At={class:"flex gap-2"},Gt={key:0,class:"relative"},Pt={class:"flex gap-2"},Ht={key:0},Ot={key:1},zt={class:"w-full overflow-hidden"},Lt={class:"flex gap-1 mb-2"},jt={class:"w-[300px]"},Et={class:"mt-[-35px]"},Yt=Z({__name:"ManagersReports",setup(e){const{$useApi:f}=ue(),x=C(null),v=_=>{x.value=_},u=C(new Date().toISOString().slice(0,7)),$=C({month:new Date().getMonth(),year:new Date().getFullYear()}),V=C([]),i=C(""),p=C({date:new Date().toISOString().slice(0,10),userId:0,calls:0,makets:0,maketsDayToDay:0,redirectToMSG:0}),R=C([{title:"Сумма продаж",value:"0"},{title:"Средний чек",value:"0"},{title:"Конверсия",value:"0"}]);function o(){return`2025-03-${(Math.floor(Math.random()*31)+1).toString().padStart(2,"0")}`}const I=["Bob","Alice","John","Emma","Mike","Sarah","Tom","Lisa","David","Anna"],B=C(Array.from({length:10},(_,r)=>({id:r+1,date:o(),userId:Math.floor(Math.random()*10)+1,calls:Math.floor(Math.random()*100),makets:Math.floor(Math.random()*50),maketsDayToDay:Math.floor(Math.random()*20),manager:I[r],managerId:r+1,totalSales:Math.floor(Math.random()*1e6),dealSales:Math.floor(Math.random()*5e5),dealsAmount:Math.floor(Math.random()*100),conversion:Number((Math.random()*100).toFixed(2)),drr:Number((Math.random()*50).toFixed(2)),dopSales:Math.floor(Math.random()*2e5),averageBill:Math.floor(Math.random()*5e4),dealsDayToDayCount:Math.floor(Math.random()*30)}))),E=C({manager:"Не выбран",dopSales:0,dealSales:0,dealsAmount:0,averageBill:0,dealsDayToDayCount:0,date:new Date().toISOString().slice(0,10)}),z=C(!0),L=C(!1),P=async()=>{try{const{data:_}=await f.get("/managers")||[];V.value=_||[]}catch(_){console.log(_)}},b=async _=>{try{const{data:r}=await f.get(`/reports/manager/${_}/data`,{params:{date:p.value.date}});E.value=r}catch(r){console.log(r)}},S=async()=>{if(!L.value){L.value=!0;try{const{data:_}=await f.post("reports/manager",p.value);console.log(_),p.value.calls=0,p.value.makets=0,p.value.maketsDayToDay=0,p.value.redirectToMSG=0,await h()}catch(_){console.log(_)}finally{L.value=!1}}},g=async _=>{try{await f.delete("reports/manager/"+_),await h();return}catch(r){console.log(r)}},N=_=>{const r=B.value.filter(J=>_.includes(J.id)),K=r.reduce((J,Q)=>J+Q.totalSales,0),H=r.reduce((J,Q)=>J+Q.dealsAmount,0),d=r.reduce((J,Q)=>J+Q.calls,0),k=H?+(K/H).toFixed():0,Y=d?H/d*100:0;R.value=[{title:"Сумма продаж",value:G(K)+"₽"},{title:"Средний чек",value:G(k)+"₽"},{title:"Конверсия",value:Y.toFixed(2)+"%"}]},h=async()=>{try{const{data:_}=await f.get("reports/managers/range",{params:x.value});B.value=_}catch(_){console.log(_)}};return ke(()=>{P()}),X(p,async()=>{/^\d{4}-\d{2}-\d{2}$/.test(p.value.date)&&p.value.userId!==0&&await b(p.value.userId);const{calls:_,userId:r,maketsDayToDay:K,makets:H}=p.value;_&&r&&K&&H?z.value=!1:z.value=!0},{deep:!0}),X(x,async()=>{await h()},{deep:!0}),X($,_=>{const{month:r,year:K}=_;u.value=new Date(K,r+1).toISOString().slice(0,7)}),(_,r)=>{const K=he,H=We,d=ve,k=we,Y=ye,J=Se,Q=m,se=xe,oe=Xe,te=fe,pe=be,ne=Ct;return n(),T("div",Mt,[c("div",Tt,[a(te,null,{default:l(()=>[a(d,null,{default:l(()=>[a(K,null,{default:l(()=>r[7]||(r[7]=[y(" Добавить отчет ",-1)])),_:1,__:[7]}),a(H)]),_:1}),a(se,null,{default:l(()=>[c("div",$t,[c("div",Vt,[s(p).date?(n(),M(k,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>r[8]||(r[8]=[y("Дата смены",-1)])),_:1,__:[8]})):O("",!0),a(Y,{modelValue:s(p).date,"onUpdate:modelValue":r[0]||(r[0]=U=>s(p).date=U),type:"date",placeholder:"Дата смены",class:W(s(p).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),c("div",It,[s(p).userId!==0?(n(),M(k,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>r[9]||(r[9]=[y("Менеджер",-1)])),_:1,__:[9]})):O("",!0),c("div",Ut,[a(J,{items:s(V).map(U=>({value:U.id,label:U.fullName})),label:"Выберите менеджера",onSelectedItem:r[1]||(r[1]=U=>{s(p).userId=U,i.value=s(V).find(re=>re.id===U)?.workSpace?.title??""})},null,8,["items"])])]),c("div",Ft,[a(k,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>r[10]||(r[10]=[y("Количество заявок",-1)])),_:1,__:[10]}),c("div",Rt,[a(Y,{modelValue:s(p).calls,"onUpdate:modelValue":r[2]||(r[2]=U=>s(p).calls=U),placeholder:"Количество заявок",type:"number",class:W(s(p).calls?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),c("div",Nt,[a(k,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>r[11]||(r[11]=[y("Макетов день в день",-1)])),_:1,__:[11]}),c("div",Kt,[a(Y,{modelValue:s(p).maketsDayToDay,"onUpdate:modelValue":r[3]||(r[3]=U=>s(p).maketsDayToDay=U),placeholder:"Макетов день в день",type:"number",class:W(s(p).maketsDayToDay?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),c("div",Bt,[a(k,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>r[12]||(r[12]=[y("Макетов всего",-1)])),_:1,__:[12]}),c("div",At,[a(Y,{modelValue:s(p).makets,"onUpdate:modelValue":r[4]||(r[4]=U=>s(p).makets=U),placeholder:"Макетов всего",type:"number",class:W(s(p).makets?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s(i)==="B2B"?(n(),T("div",Gt,[a(k,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>r[13]||(r[13]=[y("Переход в мессенджер",-1)])),_:1,__:[13]}),c("div",Pt,[a(Y,{modelValue:s(p).redirectToMSG,"onUpdate:modelValue":r[5]||(r[5]=U=>s(p).redirectToMSG=U),placeholder:"Переход в мессенджер",type:"number",class:W(s(p).redirectToMSG?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])])):O("",!0),a(Q,{disabled:s(z)||s(L),onClick:S},{default:l(()=>[s(L)?(n(),T("span",Ht,"Сохранение...")):(n(),T("span",Ot,"Создать"))]),_:1},8,["disabled"])])]),_:1}),a(oe)]),_:1})]),c("div",zt,[c("div",Lt,[(n(!0),T(A,null,j(s(R),U=>(n(),M(te,{key:U.title,class:"min-w-[150px] grow"},{default:l(()=>[a(d,{class:"p-3 pb-2"},{default:l(()=>[a(H,null,{default:l(()=>[y(q(U.title),1)]),_:2},1024),a(K,{class:"text-3xl font-semibold whitespace-nowrap"},{default:l(()=>[y(q(U.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),c("div",jt,[a(pe,{onRangeUpdated:v})]),c("div",Et,[a(ne,{data:s(B),columns:s(Dt),managers:s(V).map(U=>({label:U.fullName,value:U.fullName})),onTableSorted:r[6]||(r[6]=U=>N(U)),onOnDeleteItem:g},null,8,["data","columns","managers"])])])])}}}),qt={class:"flex flex-col gap-5"},Jt={class:"relative"},Wt={class:"relative w-full"},Xt={class:"flex gap-2 w-full"},Qt={class:"relative"},Zt={class:"flex gap-2"},ea={class:"relative"},ta={class:"flex gap-2"},aa={class:"relative"},la={class:"flex gap-2"},sa={class:"relative"},oa={class:"flex gap-2"},na=Z({__name:"CreateReport",props:{groups:{}},emits:["report-created"],setup(e,{emit:f}){const{$useApi:x}=ue(),v=f,u=C(!1),$=C("Не выбран"),V=C(!0),i=C({date:new Date().toISOString().slice(0,10),workSpaceId:0,groupId:0,calls:0,makets:0,maketsDayToDay:0,redirectToMSG:0}),p=async()=>{await x.post("reports/rop",{...i.value}),i.value.calls=0,i.value.makets=0,i.value.maketsDayToDay=0,i.value.redirectToMSG=0,u.value=!1,v("report-created")};return X(i,async()=>{const{groupId:R}=i.value;R?V.value=!1:V.value=!0},{deep:!0}),X(u,R=>{R&&(i.value={date:new Date().toISOString().slice(0,10),workSpaceId:0,groupId:0,calls:0,makets:0,maketsDayToDay:0,redirectToMSG:0},V.value=!0,$.value="Не выбран")}),(R,o)=>{const I=m,B=pt,E=_t,z=vt,L=gt,P=we,b=ye,S=Se,g=mt,N=ft;return n(),M(N,{open:s(u),"onUpdate:open":o[6]||(o[6]=h=>dt(u)?u.value=h:null)},{default:l(()=>[a(B,{"as-child":""},{default:l(()=>[a(I,null,{default:l(()=>o[7]||(o[7]=[y("Добавить отчет",-1)])),_:1,__:[7]})]),_:1}),a(g,{class:"max-w-[500px]"},{default:l(()=>[a(L,null,{default:l(()=>[a(E,null,{default:l(()=>o[8]||(o[8]=[y("Добавить отчет",-1)])),_:1,__:[8]}),a(z)]),_:1}),c("div",qt,[c("div",Jt,[s(i).date?(n(),M(P,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>o[9]||(o[9]=[y("Дата смены",-1)])),_:1,__:[9]})):O("",!0),a(b,{modelValue:s(i).date,"onUpdate:modelValue":o[0]||(o[0]=h=>s(i).date=h),type:"date",placeholder:"Дата смены",class:W(s(i).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),c("div",Wt,[s(i).groupId!==0?(n(),M(P,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>o[10]||(o[10]=[y("Группа",-1)])),_:1,__:[10]})):O("",!0),c("div",Xt,[a(S,{items:R.groups.map(h=>({value:h.id,label:h.title})),class:"w-full",label:"Выберите группу",onSelectedItem:o[1]||(o[1]=h=>{s(i).groupId=h,$.value=R.groups.find(_=>_.id===h)?.title||""})},null,8,["items"])])]),c("div",Qt,[a(P,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>o[11]||(o[11]=[y("Количество заявок",-1)])),_:1,__:[11]}),c("div",Zt,[a(b,{modelValue:s(i).calls,"onUpdate:modelValue":o[2]||(o[2]=h=>s(i).calls=h),placeholder:"Количество заявок",type:"number"},null,8,["modelValue"])])]),c("div",ea,[a(P,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>o[12]||(o[12]=[y("Макетов всего",-1)])),_:1,__:[12]}),c("div",ta,[a(b,{modelValue:s(i).makets,"onUpdate:modelValue":o[3]||(o[3]=h=>s(i).makets=h),placeholder:"Макетов всего",type:"number"},null,8,["modelValue"])])]),c("div",aa,[a(P,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>o[13]||(o[13]=[y("Макетов день в день",-1)])),_:1,__:[13]}),c("div",la,[a(b,{modelValue:s(i).maketsDayToDay,"onUpdate:modelValue":o[4]||(o[4]=h=>s(i).maketsDayToDay=h),placeholder:"Макетов день в день",type:"number"},null,8,["modelValue"])])]),c("div",sa,[a(P,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:l(()=>o[14]||(o[14]=[y("Переход в мессенджер",-1)])),_:1,__:[14]}),c("div",oa,[a(b,{modelValue:s(i).redirectToMSG,"onUpdate:modelValue":o[5]||(o[5]=h=>s(i).redirectToMSG=h),placeholder:"Переход в мессенджер",type:"number"},null,8,["modelValue"])])]),a(I,{disabled:s(V),onClick:p},{default:l(()=>o[15]||(o[15]=[y(" Создать ",-1)])),_:1,__:[15]},8,["disabled"])])]),_:1})]),_:1},8,["open"])}}}),ra={class:"flex items-center justify-between"},ca={class:"flex flex-1 items-center space-x-2"},ia=Z({__name:"RopDataTableToolbar",props:{table:{},wFilters:{}},setup(e){const f=e,x=ae(()=>f.table.getState().columnFilters.length>0);return(v,u)=>{const $=Pe,V=m;return n(),T("div",ra,[c("div",ca,[v.table.getColumn("group")?(n(),M($,{key:0,column:v.table.getColumn("group"),title:"Проект",options:v.wFilters},null,8,["column","options"])):O("",!0),x.value?(n(),M(V,{key:1,variant:"secondary",class:"h-8 px-2 lg:px-3",onClick:u[0]||(u[0]=i=>v.table.resetColumnFilters())},{default:l(()=>[u[1]||(u[1]=y(" Сброс ",-1)),a(s(Ce),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})):O("",!0)])])}}}),da={class:"flex mb-2 justify-between"},ua={class:"ml-[150px]"},pa={class:"bg-slate-100"},ma=Z({__name:"RopsDataTable",props:{columns:{},data:{},wFilters:{}},emits:["table-sorted","on-delete-item"],setup(e,{emit:f}){const x=e,v=C(0),u=C([]),$=C([]),V=C({}),i=Ne({get data(){return x.data},get columns(){return x.columns},getCoreRowModel:Ae(),getSortedRowModel:Be(),getFilteredRowModel:Ke(),onSortingChange:o=>ee(o,u),onColumnFiltersChange:o=>ee(o,$),onColumnVisibilityChange:o=>ee(o,V),state:{get sorting(){return u.value},get columnFilters(){return $.value},get columnVisibility(){return V.value}},meta:{deleteItem:o=>R(o.id)}}),p=f,R=o=>{p("on-delete-item",o)};return X(()=>i.getSortedRowModel().rows,o=>{const I=o.map(B=>B.original.id);p("table-sorted",I)},{deep:!0}),(o,I)=>{const B=ia,E=m,z=ce,L=De,P=ie,b=de,S=$e,g=Ue,N=Te,h=Ie,_=Ve,r=Me,K=Re,H=Fe;return n(),T(A,null,[c("div",da,[c("div",ua,[(n(),M(B,{key:o.wFilters.length,table:s(i),"w-filters":o.wFilters},null,8,["table","w-filters"]))]),c("div",null,[a(b,null,{default:l(()=>[a(z,null,{default:l(()=>[a(E,{variant:"outline",class:"ml-auto"},{default:l(()=>[I[0]||(I[0]=y(" Колонки ",-1)),a(s(Ge),{class:"w-4 h-4 ml-2"})]),_:1,__:[0]})]),_:1}),a(P,{class:"w-[180px]"},{default:l(()=>[(n(!0),T(A,null,j(s(i).getAllColumns().filter(d=>d.getCanHide()),d=>(n(),T("div",{key:d.id},[a(L,{checked:d.getIsVisible(),"onUpdate:checked":k=>{d.toggleVisibility(!!k)}},null,8,["checked","onUpdate:checked"]),y(" "+q(d.columnDef.ruName),1)]))),128))]),_:1})]),_:1})])]),c("div",pa,[a(H,{class:"h-[calc(100vh-180px)]"},{default:l(()=>[a(r,{class:"bg-white relative"},{default:l(()=>[a(N,{class:"bg-gray-50 sticky top-0 z-50"},{default:l(()=>[(n(!0),T(A,null,j(s(i).getHeaderGroups(),d=>(n(),M(g,{key:d.id,class:""},{default:l(()=>[(n(!0),T(A,null,j(d.headers,k=>(n(),M(S,{key:k.id},{default:l(()=>[k.isPlaceholder?O("",!0):(n(),M(s(le),{key:0,render:k.column.columnDef.header,props:k.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),a(_,null,{default:l(()=>[s(i).getRowModel().rows?.length?(n(!0),T(A,{key:0},j(s(i).getRowModel().rows,d=>(n(),M(g,{key:d.id,class:W([s(v)===d.original.id?"bg-slate-300/70":"bg-slate-100","cursor-pointer"]),"data-state":d.getIsSelected()?"selected":void 0},{default:l(()=>[(n(!0),T(A,null,j(d.getVisibleCells(),k=>(n(),M(h,{key:k.id},{default:l(()=>[a(s(le),{render:k.column.columnDef.cell,props:k.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["class","data-state"]))),128)):(n(),M(g,{key:1},{default:l(()=>[a(h,{colspan:o.columns.length,class:"text-left"},{default:l(()=>I[1]||(I[1]=[y(" Нет результатов. ",-1)])),_:1,__:[1]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),a(K,{orientation:"horizontal"})]),_:1})])],64)}}}),ga=[{accessorKey:"workSpace",ruName:"Отдел",enableHiding:!0,header:()=>t("div",{class:"hidden p-0"}),cell:()=>t("div",{class:"hidden p-0"})},{accessorKey:"group",ruName:"Проект",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Проект",t(w,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center flex flex-col"},[t("span",{class:"text-slate-800"},e.getValue("group")),t("span",{class:"text-slate-400 text-xs"},e.getValue("workSpace"))]),filterFn:(e,f,x)=>x.includes(e.getValue(f))},{accessorKey:"date",ruName:"Дата",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Дата",t(w,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center text-xs"},e.getValue("date"))},{accessorKey:"calls",ruName:"Заявки",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Заявки",t(w,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("calls"))},{accessorKey:"totalSales",ruName:"Общая сумма продаж",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Общая сумма продаж"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("totalSales"))+"₽")},{accessorKey:"dealSales",ruName:"Сумма сделок",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>[t("span",{class:"text-wrap"},"Сумма сделок"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("dealSales"))+"₽")},{accessorKey:"dealsAmount",ruName:"Количество сделок",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Кол-во сделок"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("dealsAmount"))},{accessorKey:"dopSales",ruName:"Сумма доп. продаж",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Сумма доп. продаж"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("dopSales"))+"₽")},{accessorKey:"dateDeliveriesSales",ruName:"Сумма отправленных",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Сумма отправленных"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("dateDeliveriesSales")??0)+"₽")},{accessorKey:"averageBill",ruName:"Средний чек",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Средний чек"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("averageBill"))+"₽")},{accessorKey:"makets",ruName:"Макеты",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Макеты",t(w,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("makets"))},{accessorKey:"maketsDayToDay",ruName:"Макеты день в день",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Макеты день в день"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("maketsDayToDay"))},{accessorKey:"conversionMaketDayToDay",ruName:"% макет день в день",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"% макет день в день"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("conversionMaketDayToDay")+"%")},{accessorKey:"redirectToMSG",ruName:"Переходы в мессенджер",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Переходы в мессенджер"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("redirectToMSG"))},{accessorKey:"conversion",ruName:"Конверсия",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Конверсия",t(w,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("conversion")+"%")},{accessorKey:"conversionMaket",ruName:"Конверсия в макет",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Конверсия в макет"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("conversionMaket")+"%")},{accessorKey:"conversionToSale",ruName:"Конверсия из макета в продажу",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Конверсия из макета в продажу"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("conversionToSale")+"%")},{accessorKey:"dealsDayToDayCount",ruName:"Заказы день в день",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Заказы день в день"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("dealsDayToDayCount"))},{accessorKey:"conversionDealsDayToDay",ruName:"Конверсия заказов день в день",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Конверсия заказов день в день"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("conversionDealsDayToDay")+"%")},{accessorKey:"callCost",ruName:"Стоимость заявки",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1 text-wrap"},()=>[t("span",{class:"text-wrap"},"Стоимость заявки"),t(w,{class:" h-[34px] w-[34px]"})]),cell:({row:e})=>t("div",{class:"text-center"},G(e.getValue("callCost"))+"₽")},{accessorKey:"drr",ruName:"ДРР",header:({column:e})=>t(m,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["ДРР",t(w,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>t("div",{class:"text-center"},e.getValue("drr")+"%")},{accessorKey:"actions",ruName:"Действия",header:()=>t("div",{class:"text-center"},"Действия"),enableHiding:!1,cell:({row:e,table:f})=>{const x=e.original;return t(m,{class:"h-5 px-1",item:x,onClick:()=>f.options.meta?.deleteItem(x)},()=>"Удалить")}}],_a={class:"flex gap-2 w-full"},fa={class:"min-w-[350px] flex flex-col gap-2"},va={class:"flex flex-col gap-3"},ha={class:"text-sm text-slate-500 whitespace-nowrap"},xa={class:"text-lg font-semibold text-slate-800 whitespace-nowrap"},wa={class:"w-full overflow-hidden"},ya={class:"flex items-center gap-2 mb-2"},Sa={class:"mt-[-40px]"},ba=Z({__name:"RopsReports",setup(e){const{$useApi:f}=ue(),x=C(null),v=b=>{x.value=b},u=C(new Date().toISOString().slice(0,7)),$=C({month:new Date().getMonth(),year:new Date().getFullYear()}),V=C([]),i=C([]),p=C([{title:"Сумма продаж",value:"0"},{title:"Средний чек",value:"0"},{title:"Конверсия",value:"0"},{title:"Стоимость заявки",value:"0"}]);function R(){return`2025-03-${(Math.floor(Math.random()*31)+1).toString().padStart(2,"0")}`}const o=["Офис А","Офис Б","Офис В","Склад 1","Склад 2","Центр","Юг","Север","Запад","Восток"],I=C(Array.from({length:10},(b,S)=>({id:S+1,date:R(),workSpaceId:Math.floor(Math.random()*10)+1,calls:Math.floor(Math.random()*100),dealSales:Math.floor(Math.random()*5e5),dealsAmount:Math.floor(Math.random()*100),dopSales:Math.floor(Math.random()*2e5),totalSales:Math.floor(Math.random()*1e6),averageBill:Math.floor(Math.random()*5e4),makets:Math.floor(Math.random()*50),conversion:Number((Math.random()*100).toFixed(2)),conversionMaket:Number((Math.random()*100).toFixed(2)),conversionToSale:Number((Math.random()*100).toFixed(2)),dealsDayToDayCount:Math.floor(Math.random()*30),conversionDealsDayToDay:Number((Math.random()*100).toFixed(2)),workSpace:o[S],callCost:Math.floor(Math.random()*1e4),drr:Number((Math.random()*50).toFixed(2)),dateExpensesPrice:Math.floor(Math.random()*1e5),redirectToMSG:Math.floor(Math.random()*100),maketsDayToDay:Math.floor(Math.random()*50)}))),B=async()=>{try{const{data:b}=await f.get("reports/groups-list")||[];V.value=b||[]}catch(b){console.log(b)}},E=async()=>{await z()},z=async()=>{const{data:b}=await f.get("reports/rops/range",{params:x.value});I.value=b,i.value=b.map(S=>({value:S.workSpace,label:S.workSpace}))},L=async b=>{console.log(b),await f.delete("reports/rop/"+b),await z()},P=b=>{const S=I.value.filter(D=>b.includes(D.id)),g=S.reduce((D,F)=>D+(F.totalSales??0),0),N=S.reduce((D,F)=>D+(F.dealsAmount??0),0),h=S.reduce((D,F)=>D+F.calls,0),_=N?+(g/N).toFixed():0,r=h?N/h*100:0,K=S.reduce((D,F)=>D+(F.dateExpensesPrice??0),0),H=h?K/h:0,d=S.reduce((D,F)=>D+F.calls,0),k=g?K/g*100:0,Y=S.reduce((D,F)=>D+F.makets,0),J=Y?Y/d*100:0,Q=Y?N/Y*100:0,se=N?+(K/N).toFixed():0;function oe(D,F){return new Date(D,F,0).getDate()}const te=oe(+u.value.split("-")[0],+u.value.split("-")[1]),ne=u.value.split("-")[1]===new Date().toISOString().slice(5,7)?new Date().toISOString().slice(8,10):te,U=+(g/+ne*te).toFixed(),re=S.reduce((D,F)=>D+(F.redirectToMSG??0),0),me=S.filter(D=>D.workSpace==="B2B").reduce((D,F)=>D+F.calls,0),He=me?re/me*100:0,ge=S.filter(D=>D.workSpace==="ВК").reduce((D,F)=>D+F.calls,0),Oe=S.filter(D=>D.workSpace==="ВК").reduce((D,F)=>D+(F.maketsDayToDay??0),0),ze=ge?Oe/ge*100:0,Le=S.reduce((D,F)=>D+(F.dateDeliveriesSales??0),0);p.value=[{title:"Сумма продаж",value:G(g)+"₽"},{title:"Сделок: ",value:N.toString()},{title:"Темп",value:G(U)+"₽"},{title:"Средний чек",value:G(_)+"₽"},{title:"Заявки",value:d.toFixed()},{title:"Стоимость заявки",value:H.toFixed(2)+"₽"},{title:"ДРР",value:k.toFixed(2)+"%"},{title:"Конверсия",value:r.toFixed(2)+"%"},{title:"% в макет",value:J.toFixed(2)+"%"},{title:"% из макета в продажу",value:Q.toFixed(2)+"%"},{title:"Стоимость продажи",value:G(se)+"₽"},{title:"% переход в мессенджер(Авито)",value:He.toFixed(2)+"%"},{title:"% день в день(ВК)",value:ze.toFixed(2)+"%"},{title:"Отправленно",value:G(Le)+"₽"}]};return X(x,async()=>{await z()},{deep:!0}),X($,b=>{const{month:S,year:g}=b;u.value=new Date(g,S+1).toISOString().slice(0,7)}),ke(async()=>{await B()}),(b,S)=>{const g=be,N=he,h=ve,_=xe,r=fe,K=na,H=ma;return n(),T("div",_a,[c("div",fa,[a(g,{onRangeUpdated:v}),a(r,null,{default:l(()=>[a(h,null,{default:l(()=>[a(N,null,{default:l(()=>S[1]||(S[1]=[y("Статистика",-1)])),_:1,__:[1]})]),_:1}),a(_,null,{default:l(()=>[c("div",va,[(n(!0),T(A,null,j(s(p),d=>(n(),T("div",{key:d.title,class:"flex justify-between items-center border-b"},[c("span",ha,q(d.title),1),c("span",xa,q(d.value),1)]))),128))])]),_:1})]),_:1})]),c("div",wa,[c("div",ya,[a(K,{groups:s(V),onReportCreated:E},null,8,["groups"])]),c("div",Sa,[a(H,{data:s(I),"w-filters":s(V).map(d=>({value:d.title,label:d.title})),columns:s(ga),onTableSorted:S[0]||(S[0]=d=>P(d)),onOnDeleteItem:L},null,8,["data","w-filters","columns"])])])])}}}),ka={class:"relative h-screen hidden-scrollbar"},Ca={class:"w-full fixed z-10"},Da={class:"h-full flex flex-col p-4 gap-2 mx-[auto] max-w-[2048px] pt-16 min-w-[1024px]"},Ma={class:"flex gap-2 w-full h-full"},Ta={class:""},xl=Z({__name:"index",setup(e){ut({title:"Отчеты | Easy CRM"});const f=C(new Date().toISOString().slice(0,7)),x=C({month:new Date().getMonth(),year:new Date().getFullYear()});return X(x,async v=>{const{month:u,year:$}=v;f.value=new Date($,u+1).toISOString().slice(0,7)}),(v,u)=>{const $=je,V=qe,i=Ye,p=Yt,R=Je,o=ba,I=Ee;return n(),T("div",ka,[c("div",Ca,[a($)]),c("div",Da,[c("div",Ma,[a(I,{"default-value":"Менеджер",class:"w-full"},{default:l(()=>[c("div",Ta,[a(i,null,{default:l(()=>[a(V,{value:"Менеджер"},{default:l(()=>u[0]||(u[0]=[y("Менеджер",-1)])),_:1,__:[0]}),a(V,{value:"РОП"},{default:l(()=>u[1]||(u[1]=[y("РОП",-1)])),_:1,__:[1]})]),_:1})]),a(R,{value:"Менеджер",class:""},{default:l(()=>[(n(),M(p,{key:s(f),period:s(f)},null,8,["period"]))]),_:1}),a(R,{value:"РОП"},{default:l(()=>[(n(),M(o,{key:s(f),period:s(f)},null,8,["period"]))]),_:1}),a(R,{value:"Менеджер ведения"},{default:l(()=>u[2]||(u[2]=[c("h2",null,"Отчет: Менеджер ведения",-1)])),_:1,__:[2]}),a(R,{value:"Дизайнер"},{default:l(()=>u[3]||(u[3]=[c("h2",null,"Отчет: Дизайнер",-1)])),_:1,__:[3]})]),_:1})])])])}}});export{xl as default};
