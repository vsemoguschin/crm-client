import{_ as et}from"./Bmr5wyhr.js";import{a as ne,b as de,_ as ie}from"./CNLsaPwj.js";import{_ as me}from"./BCRlC5xu.js";import{_ as Y,c as Ge,v as ze}from"./D8Osd5Ax.js";import{_ as _e,a as fe,b as ge,c as ve,d as ye}from"./B-kig6KZ.js";import{_ as Te}from"./BqmAL8DW.js";import{_ as be}from"./Pvv-dh1L.js";import{_ as Ie}from"./YaXf-8Sh.js";import{_ as ce}from"./fRExJa2e.js";import{_ as pe}from"./BcuVElyA.js";import{_ as ue}from"./mqOaxR0N.js";import{_ as ke,a as Ue,b as Ce,c as Ve,d as he}from"./AeDsR3BR.js";import{_ as De}from"./CCJdEHHg.js";import{_ as $e}from"./BgkA-2sO.js";import{e as X,g as le,r as H,B as q,m as F,o as i,w as t,b as e,d,a,c as D,D as h,l,A as R,v as Se,F as K,z as E,t as L,H as oe,E as tt,i as Me,G as V,u as lt,J as st}from"./LcRD3ia0.js";import{_ as Be}from"./ClQAoZ75.js";import{u as Ae}from"./BOGtf0gU.js";import{_ as at,a as ot,b as nt}from"./DkMjgWCi.js";import{_ as dt}from"./D_G0N3r_.js";import{_ as Re}from"./Da2JRHOT.js";import{_ as it}from"./BsJBhgTW.js";import{_ as ut,a as rt,b as ct}from"./CACSUplU.js";import{_ as pt,a as mt,b as _t,c as ft,d as gt,e as vt}from"./xEZuT4Nf.js";import{C as yt,_ as bt}from"./BUo7Dhyt.js";import{C as xt}from"./BcyKike4.js";import{X as Ke}from"./D5ydJhlK.js";import{b as Ee,c as Oe,d as Je,e as qe,_ as We,a as Xe}from"./Df1Q6CGn.js";import{_ as Qe,a as wt}from"./DkkQ8vn7.js";import{u as kt,F as je,g as Ut,a as Ct,b as Vt,A as we}from"./DSl2Rovl.js";import{_ as ht}from"./CP8umD4q.js";import xe from"./CNFJry-h.js";import{_ as Dt}from"./D9TSNOAg.js";import{_ as $t}from"./CaSHqX9y.js";import{_ as It}from"./voh6vBZz.js";import{_ as St}from"./Dbg8U1qb.js";import{u as Le}from"./BRX7moqK.js";import{_ as Tt}from"./DnQg8zF_.js";import{d as re}from"./Cxp-zkhu.js";import{u as Mt}from"./1Y235EgL.js";import{u as ae}from"./Dt19OLxm.js";import"./DfRdkKc3.js";import"./BdQOAs7V.js";import"./QkXyQO2w.js";import"./D6LOIvye.js";import"./D8EW8v7U.js";const Pt={class:"flex flex-col gap-6"},Ft={class:"relative"},Nt={class:"relative group"},Ht={class:"relative"},zt={key:0,class:"relative"},Lt={class:"relative"},Bt={key:1,class:"relative"},At={key:2,class:"relative"},Rt={key:3,class:"flex items-center space-x-2"},Gt=X({__name:"CreateClientCard",emits:["update:clientBlank"],setup(m,{emit:$}){const{$useApi:k}=le(),x={id:0,chatLink:"",fullName:"",phone:"",gender:"M",type:"ФИЗ",firstContact:"",adLink:"",inn:"",isRegular:!1},g=H(!0),w=H({...x}),f=async P=>{try{if(!P){g.value=!0,w.value=x,w.value.chatLink=P;return}const{data:s}=await k.get("/clients",{params:{chatLink:P}});if(!s.length){g.value=!1,w.value=x,w.value.chatLink=P;return}const{chatLink:U,...n}=s[0];w.value=n,w.value.chatLink=P,g.value=!0}catch(s){console.error("Ошибка при получении данных клиента:",s)}},_=$;return q(w,async P=>{_("update:clientBlank",P)},{deep:!0}),(P,s)=>{const U=de,n=me,u=ne,p=pe,o=ue,B=Ce,v=Ue,c=he,S=De,r=Ve,y=ke,I=$e,b=ce,M=ie;return i(),F(M,null,{default:t(()=>[e(u,null,{default:t(()=>[e(U,null,{default:t(()=>s[9]||(s[9]=[d("Клиент",-1)])),_:1,__:[9]}),e(n)]),_:1}),e(b,null,{default:t(()=>[a("div",Pt,[a("div",Ft,[l(w).chatLink?(i(),F(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>s[10]||(s[10]=[d("Ссылка на чат",-1)])),_:1,__:[10]})):h("",!0),e(o,{modelValue:l(w).chatLink,"onUpdate:modelValue":s[0]||(s[0]=C=>l(w).chatLink=C),placeholder:"Ссылка на чат",class:R(l(w).chatLink?"":"outline-1 outline-rose-300 rounded-md"),onInput:s[1]||(s[1]=async C=>await f(C.target.value.trim()))},null,8,["modelValue","class"])]),a("div",Nt,[l(w).fullName?(i(),F(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>s[11]||(s[11]=[d("ФИО",-1)])),_:1,__:[11]})):h("",!0),e(o,{modelValue:l(w).fullName,"onUpdate:modelValue":s[2]||(s[2]=C=>l(w).fullName=C),placeholder:"ФИО",class:R(l(w).fullName||l(g)?"":"outline-1 outline-rose-300"),disabled:l(g)},null,8,["modelValue","class","disabled"])]),a("div",Ht,[l(w).phone?(i(),F(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>s[12]||(s[12]=[d("Телефон",-1)])),_:1,__:[12]})):h("",!0),e(o,{modelValue:l(w).phone,"onUpdate:modelValue":s[3]||(s[3]=C=>l(w).phone=C),placeholder:"Телефон",disabled:l(g)},null,8,["modelValue","disabled"])]),l(g)?h("",!0):(i(),D("div",zt,[e(p,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>s[13]||(s[13]=[d("Дата первого контакта",-1)])),_:1,__:[13]}),e(o,{modelValue:l(w).firstContact,"onUpdate:modelValue":s[4]||(s[4]=C=>l(w).firstContact=C),type:"date",class:R(l(w).firstContact||l(g)?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])),a("div",Lt,[l(w).adLink?(i(),F(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>s[14]||(s[14]=[d("Ссылка на объявление",-1)])),_:1,__:[14]})):h("",!0),e(o,{modelValue:l(w).adLink,"onUpdate:modelValue":s[5]||(s[5]=C=>l(w).adLink=C),placeholder:"Ссылка на объявление",class:"col-span-3",disabled:l(g)},null,8,["modelValue","disabled"])]),l(g)?h("",!0):(i(),D("div",Bt,[l(w).type?(i(),F(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>s[15]||(s[15]=[d("Тип клиента",-1)])),_:1,__:[15]})):h("",!0),a("div",null,[e(y,{modelValue:l(w).type,"onUpdate:modelValue":s[6]||(s[6]=C=>l(w).type=C)},{default:t(()=>[e(v,null,{default:t(()=>[e(B,{placeholder:"Тип клиента"})]),_:1}),e(r,null,{default:t(()=>[e(S,null,{default:t(()=>[e(c,{value:"ФИЗ"},{default:t(()=>s[16]||(s[16]=[d(" ФИЗ ",-1)])),_:1,__:[16]}),e(c,{value:"ИП"},{default:t(()=>s[17]||(s[17]=[d(" ИП ",-1)])),_:1,__:[17]}),e(c,{value:"ООО"},{default:t(()=>s[18]||(s[18]=[d(" ООО ",-1)])),_:1,__:[18]}),e(c,{value:"НКО"},{default:t(()=>s[19]||(s[19]=[d(" НКО ",-1)])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])),l(g)?h("",!0):(i(),D("div",At,[l(w).gender?(i(),F(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>s[20]||(s[20]=[d("Пол клиента",-1)])),_:1,__:[20]})):h("",!0),a("div",null,[e(y,{modelValue:l(w).gender,"onUpdate:modelValue":s[7]||(s[7]=C=>l(w).gender=C)},{default:t(()=>[e(v,null,{default:t(()=>[e(B,{placeholder:"Пол клиента"})]),_:1}),e(r,null,{default:t(()=>[e(S,null,{default:t(()=>[e(c,{value:"M"},{default:t(()=>s[21]||(s[21]=[d(" Мужской ",-1)])),_:1,__:[21]}),e(c,{value:"F"},{default:t(()=>s[22]||(s[22]=[d(" Женский ",-1)])),_:1,__:[22]}),e(c,{value:"IT"},{default:t(()=>s[23]||(s[23]=[d(" ХЗ ",-1)])),_:1,__:[23]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])),l(g)?h("",!0):(i(),D("div",Rt,[e(I,{id:"reservation",checked:l(w).isRegular,"onUpdate:checked":s[8]||(s[8]=C=>l(w).isRegular=C)},null,8,["checked"]),e(p,{for:"reservation"},{default:t(()=>s[24]||(s[24]=[d("Постоянный",-1)])),_:1,__:[24]})]))])]),_:1})]),_:1})}}}),jt={class:"flex items-center justify-between"},Kt={class:"relative flex items-center space-x-2"},Et={class:"flex w-full gap-4"},Ot={class:"flex flex-col gap-6 w-full"},Jt={class:"relative"},qt={class:"relative"},Wt={class:"relative"},Xt={key:0,class:"relative"},Qt={key:1,class:"relative"},Yt={key:2,class:"relative"},Zt={key:3,class:"relative"},el={class:"relative"},tl={key:4,class:"relative"},ll={key:5,class:"relative"},sl={key:6,class:"relative"},al={key:7,class:"relative"},ol={class:"flex flex-col gap-6 w-full"},nl={class:"relative"},dl={class:"relative"},il={class:"relative"},ul={class:"relative"},rl={class:"relative"},cl={key:0,class:"relative"},pl=X({__name:"CreateDealCard",props:{dealSubDatas:{},clientData:{},curGroupId:{}},emits:["update:dealBlank"],setup(m,{emit:$}){const k=Ae();Se(()=>k.user);const x=["Предложения услуг","Оборудование для бизнеса","Мебель и интерьер"],g=["20х20","20х30","25х25","30х30"],w=["Журнал","Пластик"],f=["Дизайнерский","Заготовка из базы","Рекламный","Визуализатор","Из рассылки"],_=["Без скидки","Желтая","ОПТ","Рассылка","Красная"],P=["Старт","Старт + Профильный","Доп. Профильный","Частный"],s={saleDate:"",card_id:"",title:"",price:0,clothingMethod:"",source:"",adTag:"Нет тега",discont:"",maketType:"",maketPresentation:"",city:"",region:"",category:"",reservation:!1,courseType:"",discontAmount:0,bookSize:"",pages:0,pagesType:""},U=m,n=H({...s}),u=$;return q(n,p=>{u("update:dealBlank",p)},{deep:!0}),q(()=>U.curGroupId,p=>{console.log("curGroup изменился:",p)}),(p,o)=>{const B=$e,v=pe,c=de,S=me,r=ne,y=ue,I=Ce,b=Ue,M=he,C=De,z=Ve,j=ke,T=Be,O=ce,te=ie;return i(),F(te,null,{default:t(()=>[e(r,null,{default:t(()=>[e(c,null,{default:t(()=>[a("div",jt,[o[20]||(o[20]=d(" Сделка ",-1)),a("div",Kt,[e(B,{id:"reservation",checked:l(n).reservation,"onUpdate:checked":o[0]||(o[0]=N=>l(n).reservation=N)},null,8,["checked"]),e(v,{for:"reservation"},{default:t(()=>o[19]||(o[19]=[d("Бронь",-1)])),_:1,__:[19]})])])]),_:1}),e(S)]),_:1}),e(O,null,{default:t(()=>[a("div",Et,[a("div",Ot,[a("div",Jt,[l(n).title?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[21]||(o[21]=[d("Название",-1)])),_:1,__:[21]})):h("",!0),e(y,{modelValue:l(n).title,"onUpdate:modelValue":o[1]||(o[1]=N=>l(n).title=N),placeholder:"Название",class:R(l(n).title?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",qt,[e(v,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[22]||(o[22]=[d("Дата продажи",-1)])),_:1,__:[22]}),e(y,{modelValue:l(n).saleDate,"onUpdate:modelValue":o[2]||(o[2]=N=>l(n).saleDate=N),type:"date",placeholder:"dsad",class:R(l(n).saleDate?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",Wt,[e(v,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[23]||(o[23]=[d("Стоимость",-1)])),_:1,__:[23]}),e(y,{modelValue:l(n).price,"onUpdate:modelValue":o[3]||(o[3]=N=>l(n).price=N),type:"number",placeholder:"Стоимость",class:R(l(n).price?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),p.curGroupId===16?(i(),D("div",Xt,[e(v,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[24]||(o[24]=[d("Скидка",-1)])),_:1,__:[24]}),e(y,{modelValue:l(n).discontAmount,"onUpdate:modelValue":o[4]||(o[4]=N=>l(n).discontAmount=N),type:"number",placeholder:"Скидка"},null,8,["modelValue"])])):h("",!0),p.curGroupId!==19?(i(),D("div",Qt,[e(v,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[25]||(o[25]=[d("Дата презентации макета",-1)])),_:1,__:[25]}),e(y,{modelValue:l(n).maketPresentation,"onUpdate:modelValue":o[5]||(o[5]=N=>l(n).maketPresentation=N),type:"date",placeholder:"dsad",class:R(l(n).maketPresentation?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):h("",!0),p.curGroupId!==16&&p.curGroupId!==19?(i(),D("div",Yt,[l(n).maketType?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[26]||(o[26]=[d("Тип макета",-1)])),_:1,__:[26]})):h("",!0),a("div",{class:R(l(n).maketType?"":"outline-1 outline-rose-300 rounded-md")},[e(j,{modelValue:l(n).maketType,"onUpdate:modelValue":o[6]||(o[6]=N=>l(n).maketType=N)},{default:t(()=>[e(b,null,{default:t(()=>[e(I,{placeholder:"Тип макета"})]),_:1}),e(z,null,{default:t(()=>[(i(),D(K,null,E(f,(N,J)=>e(C,{key:J},{default:t(()=>[e(M,{value:N},{default:t(()=>[d(L(N),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),p.curGroupId===16?(i(),D("div",Zt,[l(n).courseType?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[27]||(o[27]=[d("Тип курса",-1)])),_:1,__:[27]})):h("",!0),a("div",{class:R(l(n).courseType?"":"outline-1 outline-rose-300 rounded-md")},[e(j,{modelValue:l(n).courseType,"onUpdate:modelValue":o[7]||(o[7]=N=>l(n).courseType=N)},{default:t(()=>[e(b,null,{default:t(()=>[e(I,{placeholder:"Тип курса"})]),_:1}),e(z,null,{default:t(()=>[(i(),D(K,null,E(P,(N,J)=>e(C,{key:J},{default:t(()=>[e(M,{value:N},{default:t(()=>[d(L(N),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),a("div",el,[l(n).card_id?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[28]||(o[28]=[d("id карточки",-1)])),_:1,__:[28]})):h("",!0),e(y,{modelValue:l(n).card_id,"onUpdate:modelValue":o[8]||(o[8]=N=>l(n).card_id=N),placeholder:"id карточки производства"},null,8,["modelValue"])]),p.curGroupId!==16&&p.curGroupId!==19?(i(),D("div",tl,[l(n).discont?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[29]||(o[29]=[d("Скидка",-1)])),_:1,__:[29]})):h("",!0),a("div",{class:R(l(n).discont?"":"outline-1 outline-rose-300 rounded-md ")},[e(j,{modelValue:l(n).discont,"onUpdate:modelValue":o[9]||(o[9]=N=>l(n).discont=N)},{default:t(()=>[e(b,null,{default:t(()=>[e(I,{placeholder:"Скидка"})]),_:1}),e(z,null,{default:t(()=>[(i(),D(K,null,E(_,(N,J)=>e(C,{key:J},{default:t(()=>[e(M,{value:N},{default:t(()=>[d(L(N),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),p.curGroupId===19?(i(),D("div",ll,[l(n).bookSize?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[30]||(o[30]=[d("Размер фотокниги",-1)])),_:1,__:[30]})):h("",!0),a("div",{class:R(l(n).bookSize?"":"outline-1 outline-rose-300 rounded-md ")},[e(j,{modelValue:l(n).bookSize,"onUpdate:modelValue":o[10]||(o[10]=N=>l(n).bookSize=N)},{default:t(()=>[e(b,null,{default:t(()=>[e(I,{placeholder:"Размер"})]),_:1}),e(z,null,{default:t(()=>[(i(),D(K,null,E(g,(N,J)=>e(C,{key:J},{default:t(()=>[e(M,{value:N},{default:t(()=>[d(L(N),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),p.curGroupId===19?(i(),D("div",sl,[l(n).pagesType?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[31]||(o[31]=[d("Страницы",-1)])),_:1,__:[31]})):h("",!0),a("div",{class:R(l(n).pagesType?"":"outline-1 outline-rose-300 rounded-md ")},[e(j,{modelValue:l(n).pagesType,"onUpdate:modelValue":o[11]||(o[11]=N=>l(n).pagesType=N)},{default:t(()=>[e(b,null,{default:t(()=>[e(I,{placeholder:"Страницы"})]),_:1}),e(z,null,{default:t(()=>[(i(),D(K,null,E(w,(N,J)=>e(C,{key:J},{default:t(()=>[e(M,{value:N},{default:t(()=>[d(L(N),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),p.curGroupId===19?(i(),D("div",al,[e(v,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[32]||(o[32]=[d("Развороты",-1)])),_:1,__:[32]}),e(y,{modelValue:l(n).pages,"onUpdate:modelValue":o[12]||(o[12]=N=>l(n).pages=N),type:"number",placeholder:"Развороты",class:R(l(n).pages?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):h("",!0)]),a("div",ol,[a("div",nl,[l(n).clothingMethod?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[33]||(o[33]=[d("Способ закрытия",-1)])),_:1,__:[33]})):h("",!0),e(T,{items:p.dealSubDatas.methods,label:"Способ закрытия",class:R(l(n).clothingMethod?"":"outline-1 outline-rose-300 rounded-md"),onSelectedItem:o[13]||(o[13]=N=>l(n).clothingMethod=N)},null,8,["items","class"])]),a("div",dl,[l(n).source?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[34]||(o[34]=[d("Источник сделки",-1)])),_:1,__:[34]})):h("",!0),e(T,{items:p.dealSubDatas.sources,label:"Источник сделки",class:R(l(n).source?"":"outline-1 outline-rose-300 rounded-md"),onSelectedItem:o[14]||(o[14]=N=>l(n).source=N)},null,8,["items","class"])]),a("div",il,[l(n).adTag?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[35]||(o[35]=[d("ТЭГ",-1)])),_:1,__:[35]})):h("",!0),e(T,{items:p.dealSubDatas.adTags,label:"Нет тега",class:R(l(n).adTag?"":"outline-1 outline-rose-300 rounded-md"),onSelectedItem:o[15]||(o[15]=N=>l(n).adTag=N)},null,8,["items","class"])]),a("div",ul,[l(n).city?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[36]||(o[36]=[d("Город",-1)])),_:1,__:[36]})):h("",!0),e(y,{modelValue:l(n).city,"onUpdate:modelValue":o[16]||(o[16]=N=>l(n).city=N),placeholder:"Город"},null,8,["modelValue"])]),a("div",rl,[l(n).region?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[37]||(o[37]=[d("Регион/область",-1)])),_:1,__:[37]})):h("",!0),e(y,{modelValue:l(n).region,"onUpdate:modelValue":o[17]||(o[17]=N=>l(n).region=N),placeholder:"Регион/область"},null,8,["modelValue"])]),p.clientData.chatLink.includes("easyneon.amocrm.ru")?(i(),D("div",cl,[l(n).category?(i(),F(v,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[38]||(o[38]=[d("Категория",-1)])),_:1,__:[38]})):h("",!0),a("div",null,[e(j,{modelValue:l(n).category,"onUpdate:modelValue":o[18]||(o[18]=N=>l(n).category=N)},{default:t(()=>[e(b,null,{default:t(()=>[e(I,{placeholder:"Категория"})]),_:1}),e(z,null,{default:t(()=>[(i(),D(K,null,E(x,(N,J)=>e(C,{key:J},{default:t(()=>[e(M,{value:N},{default:t(()=>[d(L(N),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])])])):h("",!0)])])]),_:1})]),_:1})}}}),ml={class:"flex flex-col gap-6"},_l={class:"relative"},fl={class:"relative"},gl={class:"relative"},vl={class:"relative flex items-center space-x-2"},yl=X({__name:"CreatePaymentCard",emits:["update:paymentBlank"],setup(m,{emit:$}){const{$useApi:k}=le(),x=H("Статус"),g=["Наличные","Перевод","Договор","Наложка","Ссылка","Долями","Рассрочка","Счет"],f=H({...{title:"1",price:0,date:"",method:"Ссылка",reservation:!1,isConfirmed:!1}}),_=$;return q(f,P=>{_("update:paymentBlank",P)},{deep:!0}),q(()=>[f.value.paymentId],async([P])=>{if(P&&P.length>5){const{data:s}=await k.get("payments/checkPaymentLink",{params:{link:P}});x.value=s.message,f.value.price=s.price,f.value.isConfirmed=s.isConfirmed}}),(P,s)=>{const U=de,n=me,u=ne,p=pe,o=ue,B=Ce,v=Ue,c=he,S=De,r=Ve,y=ke,I=$e,b=ce,M=ie;return i(),F(M,{class:"w-full"},{default:t(()=>[e(u,null,{default:t(()=>[e(U,null,{default:t(()=>s[4]||(s[4]=[d("Платеж",-1)])),_:1,__:[4]}),e(n)]),_:1}),e(b,null,{default:t(()=>[a("div",ml,[a("div",_l,[e(p,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>s[5]||(s[5]=[d("Сумма",-1)])),_:1,__:[5]}),e(o,{modelValue:l(f).price,"onUpdate:modelValue":s[0]||(s[0]=C=>l(f).price=C),type:"number",placeholder:"Сумма",class:R(l(f).price?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",fl,[e(p,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>s[6]||(s[6]=[d("Способ оплаты",-1)])),_:1,__:[6]}),e(y,{modelValue:l(f).method,"onUpdate:modelValue":s[1]||(s[1]=C=>l(f).method=C)},{default:t(()=>[e(v,null,{default:t(()=>[e(B,{placeholder:l(f).method},null,8,["placeholder"])]),_:1}),e(r,null,{default:t(()=>[(i(),D(K,null,E(g,(C,z)=>e(S,{key:z},{default:t(()=>[e(c,{value:C},{default:t(()=>[d(L(C),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),a("div",gl,[l(f).paymentId?(i(),F(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>s[7]||(s[7]=[d("Ссылка на оплату",-1)])),_:1,__:[7]})):h("",!0),e(o,{modelValue:l(f).paymentId,"onUpdate:modelValue":s[2]||(s[2]=C=>l(f).paymentId=C),placeholder:"Ссылка на оплату"},null,8,["modelValue"])]),a("div",vl,[e(I,{id:"isConfirmed",checked:l(f).isConfirmed,"onUpdate:checked":s[3]||(s[3]=C=>l(f).isConfirmed=C)},null,8,["checked"]),e(p,{for:"isConfirmed"},{default:t(()=>s[8]||(s[8]=[d("Подтвержден",-1)])),_:1,__:[8]})])])]),_:1})]),_:1})}}}),bl={key:0,class:"flex items-center gap-3"},xl={class:"w-[200px]"},wl={class:"flex gap-4"},kl={class:"flex flex-col gap-5 w-[300px]"},Ul=X({__name:"DealCreateModal",emits:["isDealCreated"],setup(m,{emit:$}){const{$useApi:k}=le(),x={id:0,chatLink:"",fullName:"",phone:"",gender:"M",type:"ФИЗ",firstContact:"",adLink:"",inn:"",isRegular:!1},g={saleDate:"",card_id:"",title:"",price:0,clothingMethod:"",source:"",adTag:"",discont:"",maketType:"",maketPresentation:"",city:"",region:"",category:"",reservation:!1,discontAmount:0,bookSize:"",pages:0},w={title:"",price:0,date:"",method:"Перевод",reservation:!1,isConfirmed:!1},f=["СДЕК","ПОЧТА РОССИИ","Яндекс","Балтийский курьер","Самовывоз","ТК КИТ","ПЭТ","Боксбери","Деловые линии"];H({type:["Бесплатно","Платно","Досыл"][0],method:f[0]});const P=H({...x}),s=H({...g}),U=H({...w}),n=H({adTags:[],methods:[],sources:[],spheres:[]}),u=H([]),p=H(),o=H(0),B=async()=>{const{data:I}=await k.get("/deals/datas")||[];n.value=I,u.value=I.userGroups,p.value=I.userGroups[0],o.value=I.userGroups[0].id},v=H(!1),c=H(!1),S=()=>(console.log(P.value),P.value.chatLink===""||P.value.fullName===""||P.value.gender===""||P.value.type===""||P.value.firstContact===""?console.log("wrong client"):s.value.title===""||s.value.saleDate===""||+s.value.price==0||s.value.clothingMethod===""||s.value.source===""||s.value.adTag===""||s.value.maketType===""&&s.value.courseType===""&&s.value.bookSize===""&&s.value.category===""?(console.log(s.value),console.log("wrong deal")):U.value.title===""||+U.value.price==0||U.value.method===""?console.log("wrong payment"):(console.log("success!!"),!0)),r=$,y=async()=>{try{if(!S())return console.log("nope");c.value=!0;let b=P.value;if(P.value.id===0){const{id:C,...z}=P.value;z.phone=z.phone.toString();const{data:j}=await k.post("/clients",{...z,groupId:o.value});b=j}const{data:M}=await k.post("deals/",{...s.value,clientId:b.id,groupId:o.value});return U.value.date=s.value.saleDate,await k.post("/payments/",{...U.value,dealId:M.id,groupId:o.value,userId:M.userId}),r("isDealCreated",M.id),v.value=!1}catch(I){console.log(I)}};return q(v,()=>{v.value||(P.value=x,s.value=g,U.value=w,c.value=!1)}),(I,b)=>{const M=Y,C=fe,z=ye,j=Te,T=Ie,O=ve,te=Gt,N=pl,J=yl,A=be,se=ge,Z=_e;return i(),D("div",null,[e(Z,{open:l(v),"onUpdate:open":b[4]||(b[4]=Q=>oe(v)?v.value=Q:null)},{default:t(()=>[e(C,{"as-child":""},{default:t(()=>[e(M,{size:"icon",class:"w-full px-2",onClick:B},{default:t(()=>b[5]||(b[5]=[d(" Создать ",-1)])),_:1,__:[5]})]),_:1}),e(se,{class:"max-w-[1200px] min-w-[1000px] flex flex-col"},{default:t(()=>[e(O,null,{default:t(()=>[e(z,null,{default:t(()=>b[6]||(b[6]=[d("Создание сделки",-1)])),_:1,__:[6]}),e(j,null,{default:t(()=>b[7]||(b[7]=[d(" Заполни все поля и нажми Создать ",-1)])),_:1,__:[7]}),l(u).length>1?(i(),D("div",bl,[b[8]||(b[8]=a("span",{class:"whitespace-nowrap"},"Выбрать проект -> ",-1)),a("div",xl,[e(T,{items:l(u).map(Q=>({value:Q.id,label:Q.title})),class:"w-full",label:l(p)?.title||"Выберите проект",onSelectedItem:b[0]||(b[0]=Q=>{o.value=Q})},null,8,["items","label"])])])):h("",!0)]),_:1}),a("div",wl,[e(te,{class:"w-[300px]","onUpdate:clientBlank":b[1]||(b[1]=Q=>P.value=Q)}),l(o)?(i(),F(N,{key:0,class:"w-[600px]","deal-sub-datas":l(n),"client-data":l(P),"cur-group-id":l(o),"onUpdate:dealBlank":b[2]||(b[2]=Q=>s.value=Q)},null,8,["deal-sub-datas","client-data","cur-group-id"])):h("",!0),a("div",kl,[e(J,{class:"h-full","new-payment-data":l(U),"onUpdate:paymentBlank":b[3]||(b[3]=Q=>U.value=Q)},null,8,["new-payment-data"])])]),e(A,null,{default:t(()=>[e(M,{disabled:l(c),onClick:y},{default:t(()=>b[9]||(b[9]=[d(" Создать ",-1)])),_:1,__:[9]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Cl={class:"hidden space-x-1 lg:flex"},Vl={key:1,class:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs"},hl=X({__name:"DataTableFacetedFilter",props:{column:{},title:{},options:{}},setup(m){const $=m,k=Se(()=>$.column?.getFacetedUniqueValues()),x=Se(()=>new Set($.column?.getFilterValue()));return(g,w)=>{const f=Re,_=it,P=Y,s=ut,U=mt,n=ft,u=vt,p=gt,o=bt,B=_t,v=pt,c=rt,S=ct;return i(),F(S,null,{default:t(()=>[e(s,{"as-child":""},{default:t(()=>[e(P,{variant:"outline",size:"sm",class:"h-8 border-dashed"},{default:t(()=>[e(l(yt),{class:"mr-2 h-4 w-4"}),d(" "+L(g.title)+" ",1),x.value.size>0?(i(),D(K,{key:0},[e(f,{orientation:"vertical",class:"mx-2 h-4"}),e(_,{variant:"secondary",class:"rounded-sm px-1 font-normal lg:hidden"},{default:t(()=>[d(L(x.value.size),1)]),_:1}),a("div",Cl,[x.value.size>0?(i(),F(_,{key:0,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:t(()=>[d(L(x.value.size),1)]),_:1})):(i(!0),D(K,{key:1},E(g.options.filter(r=>x.value.has(r.value)),r=>(i(),F(_,{key:r.value,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:t(()=>[d(L(r.label),1)]),_:2},1024))),128))])],64)):h("",!0)]),_:1})]),_:1}),e(c,{class:"w-[200px] p-0",align:"start"},{default:t(()=>[e(v,{"filter-function":(r,y)=>r.filter(I=>I.label.toLowerCase()?.includes(y))},{default:t(()=>[e(U,{placeholder:g.title},null,8,["placeholder"]),e(B,null,{default:t(()=>[e(n,null,{default:t(()=>w[1]||(w[1]=[d("Нет совпадений.",-1)])),_:1,__:[1]}),e(p,null,{default:t(()=>[(i(!0),D(K,null,E(g.options,r=>(i(),F(u,{key:r.value,value:r,onSelect:y=>{x.value.has(r.value)?x.value.delete(r.value):x.value.add(r.value);const b=Array.from(x.value);g.column?.setFilterValue(b.length?b:void 0)}},{default:t(()=>[a("div",{class:R(l(Ge)("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",x.value.has(r.value)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"))},[e(l(xt),{class:R(l(Ge)("h-4 w-4"))},null,8,["class"])],2),r.icon?(i(),F(tt(r.icon),{key:0,class:"mr-2 h-4 w-4 text-muted-foreground"})):h("",!0),a("span",null,L(r.label),1),k.value?.get(r.value)?(i(),D("span",Vl,L(k.value.get(r.value)),1)):h("",!0)]),_:2},1032,["value","onSelect"]))),128))]),_:1}),x.value.size>0?(i(),D(K,{key:0},[e(o),e(p,null,{default:t(()=>[e(u,{value:{label:"Очистить"},class:"justify-center text-center",onSelect:w[0]||(w[0]=r=>g.column?.setFilterValue(void 0))},{default:t(()=>w[2]||(w[2]=[d(" Очистить ",-1)])),_:1,__:[2]})]),_:1})],64)):h("",!0)]),_:1})]),_:1},8,["filter-function"])]),_:1})]),_:1})}}}),Dl={class:"flex items-center justify-between"},$l={class:"flex flex-1 items-center gap-2 flex-wrap"},Il=X({__name:"DataTableToolbar",props:{table:{},filters:{},sources:{},adTags:{}},setup(m){const $=[{label:"Создана",value:"Создана"},{label:"Сборка",value:"Сборка"},{label:"Упаковка",value:"Упаковка"},{label:"Отправлена",value:"Отправлена"},{label:"Вручена",value:"Вручена"},{label:"Возврат",value:"Возврат"}],k=[{value:"Дизайнерский",label:"Дизайнерский"},{value:"Заготовка из базы",label:"Заготовка из базы"},{value:"Рекламный",label:"Рекламный"},{value:"Визуализатор",label:"Визуализатор"},{value:"Из рассылки",label:"Из рассылки"}],x=[{label:"Больше 31",value:"Больше 31"},{label:"8-31",value:"8-31"},{label:"3-7",value:"3-7"},{label:"1-2",value:"1-2"},{label:"0",value:"0"}],g=[{label:"20х20",value:"20х20"},{label:"20х30",value:"20х30"},{label:"25х25",value:"25х25"},{label:"30х30",value:"30х30"}],w=m;w.filters.workspaces.map(s=>({value:s.id,label:s.title}));const f=w.filters.groups.map(s=>({value:s.id,label:s.title})),_=w.filters.managers.map(s=>({value:s.id,label:s.fullName})),P=Se(()=>w.table.getState().columnFilters.length>0);return(s,U)=>{const n=hl,u=Y;return i(),D("div",Dl,[a("div",$l,[s.table.getColumn("status")?(i(),F(n,{key:0,column:s.table.getColumn("status"),title:"Статус",options:$},null,8,["column"])):h("",!0),s.table.getColumn("maketType")?(i(),F(n,{key:1,column:s.table.getColumn("maketType"),title:"Макет",options:k},null,8,["column"])):h("",!0),s.table.getColumn("source")?(i(),F(n,{key:2,column:s.table.getColumn("source"),title:"Источник",options:s.sources},null,8,["column","options"])):h("",!0),s.table.getColumn("adTag")?(i(),F(n,{key:3,column:s.table.getColumn("adTag"),title:"Тег",options:s.adTags},null,8,["column","options"])):h("",!0),s.table.getColumn("daysGone")?(i(),F(n,{key:4,column:s.table.getColumn("daysGone"),title:"Прошло дней",options:x},null,8,["column"])):h("",!0),s.table.getColumn("groupId")&&l(f).length?(i(),F(n,{key:5,column:s.table.getColumn("groupId"),title:"Проект",options:l(f)},null,8,["column","options"])):h("",!0),s.table.getColumn("dealers")&&l(_).length>1?(i(),F(n,{key:6,column:s.table.getColumn("dealers"),title:"Менеджеры",options:l(_)},null,8,["column","options"])):h("",!0),s.table.getColumn("haveReviews")?(i(),F(n,{key:7,column:s.table.getColumn("haveReviews"),title:"Отзыв",options:[{label:"Есть",value:"Есть"},{label:"Нет",value:"Нет"}]},null,8,["column"])):h("",!0),s.table.getColumn("isRegular")?(i(),F(n,{key:8,column:s.table.getColumn("isRegular"),title:"Клиент",options:[{label:"Новый клиент",value:"Новый клиент"},{label:"Постоянный клиент",value:"Постоянный клиент"}]},null,8,["column"])):h("",!0),s.table.getColumn("boxsize")?(i(),F(n,{key:9,column:s.table.getColumn("boxsize"),title:"Размер",options:g},null,8,["column"])):h("",!0),P.value?(i(),F(u,{key:10,variant:"secondary",class:"h-8 px-2 lg:px-3",onClick:U[0]||(U[0]=p=>s.table.resetColumnFilters())},{default:t(()=>[U[1]||(U[1]=d(" Сброс ",-1)),e(l(Ke),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})):h("",!0)])])}}}),Sl={class:"flex mb-2 justify-between"},Tl={class:"bg-slate-100"},Ml=X({__name:"DataTable",props:{columns:{},data:{},filters:{}},emits:["deal-clicked","table-sorted"],setup(m,{emit:$}){const k=m,x=H(0),g=H([]),w=H([]),f=H({}),_=H([]),P=H([]);function s(p){return Array.from(p.reduce((o,B)=>o.set(B.value,B),new Map)).map(([,o])=>o)}_.value=s(k.data.map(p=>({value:p.source,label:p.source}))),P.value=s(k.data.map(p=>({value:p.adTag,label:p.adTag})));const U=kt({get data(){return k.data},get columns(){return k.columns},getCoreRowModel:Vt(),getSortedRowModel:Ct(),getFilteredRowModel:Ut(),onSortingChange:p=>ze(p,g),onColumnFiltersChange:p=>ze(p,w),onColumnVisibilityChange:p=>ze(p,f),state:{get sorting(){return g.value},get columnFilters(){return w.value},get columnVisibility(){return f.value}}}),n=$,u=p=>{x.value=p,n("deal-clicked",p)};return q(()=>U.getSortedRowModel().rows,p=>{const o=p.map(B=>B.original.id);n("table-sorted",o)},{deep:!0}),(p,o)=>{const B=Il,v=Je,c=Xe,S=Oe,r=We,y=qe,I=Ee,b=wt,M=Qe;return i(),D(K,null,[a("div",Sl,[e(B,{table:l(U),filters:p.filters,sources:l(_),"ad-tags":l(P)},null,8,["table","filters","sources","ad-tags"])]),a("div",Tl,[e(M,{class:"h-[calc(100vh-280px)]"},{default:t(()=>[e(I,{class:"bg-white relative"},{default:t(()=>[e(S,{class:"bg-gray-50 sticky top-0 z-50"},{default:t(()=>[(i(!0),D(K,null,E(l(U).getHeaderGroups(),C=>(i(),F(c,{key:C.id,class:""},{default:t(()=>[(i(!0),D(K,null,E(C.headers,z=>(i(),F(v,{key:z.id},{default:t(()=>[z.isPlaceholder?h("",!0):(i(),F(l(je),{key:0,render:z.column.columnDef.header,props:z.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),e(y,null,{default:t(()=>[l(U).getRowModel().rows?.length?(i(!0),D(K,{key:0},E(l(U).getRowModel().rows,C=>(i(),F(c,{key:C.id,class:R(["cursor-pointer hover:bg-slate-300/50",l(x)===C.original.id?"bg-slate-400/70 hover:bg-slate-400/50":"",C.original.reservation===!0?"bg-yellow-500/30 hover:bg-yellow-500/20":"",["Отправлена","Вручена"].includes(C.original.status)?"bg-green-500/30 hover:bg-green-500/20":"",C.original.price!==C.original.dealers.reduce((z,j)=>z+j.price,0)?"bg-red-400/60 hover:bg-red-400/50":""]),"data-state":C.getIsSelected()?"selected":void 0,onClick:z=>u(C.original.id)},{default:t(()=>[(i(!0),D(K,null,E(C.getVisibleCells(),z=>(i(),F(r,{key:z.id},{default:t(()=>[e(l(je),{render:z.column.columnDef.cell,props:z.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["class","data-state","onClick"]))),128)):(i(),F(c,{key:1},{default:t(()=>[e(r,{colspan:p.columns.length,class:"text-left"},{default:t(()=>o[0]||(o[0]=[d(" Нет результатов. ",-1)])),_:1,__:[0]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),e(b,{orientation:"horizontal"})]),_:1})])],64)}}}),Pl={class:"flex gap-4 max-h-[500px] overflow-y-scroll"},Fl=X({__name:"DealHistory",props:{dealId:{}},setup(m){const{$useApi:$}=le(),k=m,x=H([]),g=async()=>{try{const{data:w}=await $.get(`deals/${k.dealId}/deal-history`);x.value=w,console.log("История изменений:",w)}catch(w){console.error("Ошибка при загрузке истории:",w)}};return(w,f)=>{const _=xe,P=Y,s=fe,U=ye,n=Te,u=ve,p=Je,o=Xe,B=Oe,v=We,c=qe,S=Ee,r=be,y=ge,I=_e;return i(),D("div",null,[e(I,null,{default:t(()=>[e(s,{"as-child":""},{default:t(()=>[e(P,{class:"h-7 w-7 gap-1",size:"icon",onClick:g},{default:t(()=>[e(_,{name:"material-symbols:history-rounded",color:"white",size:"25px"})]),_:1})]),_:1}),e(y,{class:"max-w-[1200px] flex flex-col"},{default:t(()=>[e(u,null,{default:t(()=>[e(U,null,{default:t(()=>f[0]||(f[0]=[d("История изменений",-1)])),_:1,__:[0]}),e(n)]),_:1}),a("div",Pl,[e(S,null,{default:t(()=>[e(B,null,{default:t(()=>[e(o,null,{default:t(()=>[e(p,{class:"text-left"},{default:t(()=>f[1]||(f[1]=[d("Дата",-1)])),_:1,__:[1]}),e(p,{class:"text-center"},{default:t(()=>f[2]||(f[2]=[d("Пользователь",-1)])),_:1,__:[2]}),e(p,{class:"text-left"},{default:t(()=>f[3]||(f[3]=[d("Комментарий",-1)])),_:1,__:[3]})]),_:1})]),_:1}),e(c,null,{default:t(()=>[(i(!0),D(K,null,E(l(x),b=>(i(),F(o,{key:b.id},{default:t(()=>[e(v,{class:"whitespace-nowrap"},{default:t(()=>[d(L(new Date(b.createdAt).toLocaleString("ru-RU")),1)]),_:2},1024),e(v,{class:"whitespace-nowrap text-center"},{default:t(()=>[d(L(b.user.fullName),1)]),_:2},1024),e(v,{class:"whitespace-nowrap"},{default:t(()=>[d(L(b.comment),1)]),_:2},1024)]),_:2},1024))),128)),l(x).length===0?(i(),F(o,{key:0},{default:t(()=>[e(v,{colspan:"4",class:"text-center"},{default:t(()=>f[4]||(f[4]=[d("Нет данных для отображения",-1)])),_:1,__:[4]})]),_:1})):h("",!0)]),_:1})]),_:1})]),e(r)]),_:1})]),_:1})])}}}),Nl={class:"flex items-center justify-between"},Hl={class:"relative flex items-center space-x-2"},zl={class:"flex gap-4 w-full"},Ll={class:"flex flex-col gap-5 w-full"},Bl={class:"relative"},Al={class:"relative"},Rl={class:"relative"},Gl={key:0,class:"relative"},jl={key:1,class:"relative"},Kl={key:2,class:"relative"},El={key:3,class:"relative"},Ol={key:4,class:"relative"},Jl={class:"relative"},ql={key:5,class:"relative"},Wl={key:6,class:"relative"},Xl={key:7,class:"relative"},Ql={class:"flex flex-col gap-5 w-full"},Yl={class:"relative"},Zl={class:"relative"},es={class:"relative"},ts={class:"relative"},ls={class:"relative"},ss={class:"relative"},as={key:0,class:"relative"},os=X({__name:"EditDealForm",props:{dealSubDatas:{},deal:{}},emits:["dealDataChanged"],setup(m,{emit:$}){const k=m,x=["Предложения услуг","Оборудование для бизнеса","Мебель и интерьер"],g=["Старт","Старт + Профильный","Доп. Профильный","Частный"],w=["Дизайнерский","Заготовка из базы","Рекламный","Визуализатор","Из рассылки"],f=["Без скидки","Желтая","ОПТ","Рассылка","Красная"],_=["20х20","20х30","25х25","30х30"],P=["Журнал","Пластик"],s=H({...k.deal}),U=$;return q(s,()=>{U("dealDataChanged",s.value)},{deep:!0}),(n,u)=>{const p=$e,o=pe,B=de,v=ne,c=ue,S=Ce,r=Ue,y=he,I=De,b=Ve,M=ke,C=Be,z=ce,j=ie;return i(),F(j,{class:"w-full"},{default:t(()=>[e(v,null,{default:t(()=>[e(B,null,{default:t(()=>[a("div",Nl,[u[21]||(u[21]=d(" Сделка ",-1)),a("div",Hl,[e(p,{id:"reservation",checked:l(s).reservation,"onUpdate:checked":u[0]||(u[0]=T=>l(s).reservation=T)},null,8,["checked"]),e(o,{for:"reservation"},{default:t(()=>u[20]||(u[20]=[d("Бронь",-1)])),_:1,__:[20]})])])]),_:1})]),_:1}),e(z,null,{default:t(()=>[a("div",zl,[a("div",Ll,[a("div",Bl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[22]||(u[22]=[d("Название",-1)])),_:1,__:[22]}),e(c,{modelValue:l(s).title,"onUpdate:modelValue":u[1]||(u[1]=T=>l(s).title=T),placeholder:"Название",class:"col-span-3"},null,8,["modelValue"])]),a("div",Al,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[23]||(u[23]=[d("Дата продажи",-1)])),_:1,__:[23]}),e(c,{modelValue:l(s).saleDate,"onUpdate:modelValue":u[2]||(u[2]=T=>l(s).saleDate=T),type:"date",min:new Date().toISOString().slice(0,7)+"-01",class:R(l(s).saleDate?"":"outline-1 outline-rose-300")},null,8,["modelValue","min","class"])]),a("div",Rl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[24]||(u[24]=[d("Стоимость",-1)])),_:1,__:[24]}),e(c,{modelValue:l(s).price,"onUpdate:modelValue":u[3]||(u[3]=T=>l(s).price=T),type:"number",placeholder:"Стоимость",class:"col-span-3"},null,8,["modelValue"])]),l(s).groupId!==16&&l(s).groupId!==19?(i(),D("div",Gl,[l(s).discont?(i(),F(o,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[25]||(u[25]=[d("Скидка",-1)])),_:1,__:[25]})):h("",!0),a("div",{class:R(l(s).discont?"":"outline-1 outline-rose-300 rounded-md")},[e(M,{modelValue:l(s).discont,"onUpdate:modelValue":u[4]||(u[4]=T=>l(s).discont=T)},{default:t(()=>[e(r,null,{default:t(()=>[e(S,{placeholder:"Скидка"})]),_:1}),e(b,null,{default:t(()=>[(i(),D(K,null,E(f,(T,O)=>e(I,{key:O},{default:t(()=>[e(y,{value:T},{default:t(()=>[d(L(T),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),l(s).groupId===16?(i(),D("div",jl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[26]||(u[26]=[d("Скидка",-1)])),_:1,__:[26]}),e(c,{modelValue:l(s).discontAmount,"onUpdate:modelValue":u[5]||(u[5]=T=>l(s).discontAmount=T),type:"number",placeholder:"Скидка",class:R(l(s).discontAmount?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):h("",!0),l(s).groupId!==19?(i(),D("div",Kl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>u[27]||(u[27]=[d("Дата презентации макета",-1)])),_:1,__:[27]}),e(c,{modelValue:l(s).maketPresentation,"onUpdate:modelValue":u[6]||(u[6]=T=>l(s).maketPresentation=T),type:"date",placeholder:"dsad",class:R(l(s).maketPresentation?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):h("",!0),l(s).groupId!==16&&l(s).groupId!==19?(i(),D("div",El,[l(s).maketType?(i(),F(o,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[28]||(u[28]=[d("Тип макета",-1)])),_:1,__:[28]})):h("",!0),a("div",{class:R(l(s).maketType?"":"outline-1 outline-rose-300 rounded-md")},[e(M,{modelValue:l(s).maketType,"onUpdate:modelValue":u[7]||(u[7]=T=>l(s).maketType=T)},{default:t(()=>[e(r,null,{default:t(()=>[e(S,{placeholder:"Тип макета"})]),_:1}),e(b,null,{default:t(()=>[(i(),D(K,null,E(w,(T,O)=>e(I,{key:O},{default:t(()=>[e(y,{value:T},{default:t(()=>[d(L(T),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),l(s).groupId===16?(i(),D("div",Ol,[l(s).courseType?(i(),F(o,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[29]||(u[29]=[d("Тип курса",-1)])),_:1,__:[29]})):h("",!0),a("div",{class:R(l(s).courseType?"":"outline-1 outline-rose-300 rounded-md")},[e(M,{modelValue:l(s).courseType,"onUpdate:modelValue":u[8]||(u[8]=T=>l(s).courseType=T)},{default:t(()=>[e(r,null,{default:t(()=>[e(S,{placeholder:"Тип курса"})]),_:1}),e(b,null,{default:t(()=>[(i(),D(K,null,E(g,(T,O)=>e(I,{key:O},{default:t(()=>[e(y,{value:T},{default:t(()=>[d(L(T),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),a("div",Jl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[30]||(u[30]=[d("id карточки производства",-1)])),_:1,__:[30]}),e(c,{modelValue:l(s).card_id,"onUpdate:modelValue":u[9]||(u[9]=T=>l(s).card_id=T),placeholder:"id карточки производства",class:"col-span-3"},null,8,["modelValue"])]),l(s).groupId===19?(i(),D("div",ql,[l(s).bookSize?(i(),F(o,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[31]||(u[31]=[d("Размер фотокниги",-1)])),_:1,__:[31]})):h("",!0),a("div",{class:R(l(s).bookSize?"":"outline-1 outline-rose-300 rounded-md ")},[e(M,{modelValue:l(s).bookSize,"onUpdate:modelValue":u[10]||(u[10]=T=>l(s).bookSize=T)},{default:t(()=>[e(r,null,{default:t(()=>[e(S,{placeholder:"Размер"})]),_:1}),e(b,null,{default:t(()=>[(i(),D(K,null,E(_,(T,O)=>e(I,{key:O},{default:t(()=>[e(y,{value:T},{default:t(()=>[d(L(T),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),l(s).groupId===19?(i(),D("div",Wl,[l(s).pageType?(i(),F(o,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[32]||(u[32]=[d("Размер фотокниги",-1)])),_:1,__:[32]})):h("",!0),a("div",{class:R(l(s).pageType?"":"outline-1 outline-rose-300 rounded-md ")},[e(M,{modelValue:l(s).pageType,"onUpdate:modelValue":u[11]||(u[11]=T=>l(s).pageType=T)},{default:t(()=>[e(r,null,{default:t(()=>[e(S,{placeholder:"Размер"})]),_:1}),e(b,null,{default:t(()=>[(i(),D(K,null,E(P,(T,O)=>e(I,{key:O},{default:t(()=>[e(y,{value:T},{default:t(()=>[d(L(T),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):h("",!0),l(s).groupId===19?(i(),D("div",Xl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>u[33]||(u[33]=[d("Развороты",-1)])),_:1,__:[33]}),e(c,{modelValue:l(s).pages,"onUpdate:modelValue":u[12]||(u[12]=T=>l(s).pages=T),type:"number",placeholder:"Развороты",class:R(l(s).pages?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):h("",!0)]),a("div",Ql,[a("div",Yl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[34]||(u[34]=[d("Способ закрытия",-1)])),_:1,__:[34]}),e(C,{items:n.dealSubDatas.methods,label:l(s).clothingMethod,onSelectedItem:u[13]||(u[13]=T=>l(s).clothingMethod=T)},null,8,["items","label"])]),a("div",Zl,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[35]||(u[35]=[d("Источник сделки",-1)])),_:1,__:[35]}),e(C,{items:n.dealSubDatas.sources,label:l(s).source,onSelectedItem:u[14]||(u[14]=T=>l(s).source=T)},null,8,["items","label"])]),a("div",es,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[36]||(u[36]=[d("ТЕГ",-1)])),_:1,__:[36]}),e(C,{items:n.dealSubDatas.adTags,label:l(s).adTag,onSelectedItem:u[15]||(u[15]=T=>l(s).adTag=T)},null,8,["items","label"])]),a("div",ts,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[37]||(u[37]=[d("Сфера",-1)])),_:1,__:[37]}),e(C,{items:n.dealSubDatas.spheres,label:l(s).sphere,onSelectedItem:u[16]||(u[16]=T=>l(s).sphere=T)},null,8,["items","label"])]),a("div",ls,[l(s).city!==""?(i(),F(o,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[38]||(u[38]=[d("Город",-1)])),_:1,__:[38]})):h("",!0),e(c,{modelValue:l(s).city,"onUpdate:modelValue":u[17]||(u[17]=T=>l(s).city=T),placeholder:"Город",class:"col-span-3"},null,8,["modelValue"])]),a("div",ss,[l(s).region!==""?(i(),F(o,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[39]||(u[39]=[d("Регион/Область",-1)])),_:1,__:[39]})):h("",!0),e(c,{modelValue:l(s).region,"onUpdate:modelValue":u[18]||(u[18]=T=>l(s).region=T),placeholder:"Регион/Область",class:"col-span-3"},null,8,["modelValue"])]),n.deal.client.chatLink.includes("easyneon.amocrm.ru")?(i(),D("div",as,[e(o,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>u[40]||(u[40]=[d("Категория",-1)])),_:1,__:[40]}),a("div",null,[e(M,{modelValue:l(s).category,"onUpdate:modelValue":u[19]||(u[19]=T=>l(s).category=T)},{default:t(()=>[e(r,null,{default:t(()=>[e(S,{placeholder:"Категория"})]),_:1}),e(b,null,{default:t(()=>[(i(),D(K,null,E(x,(T,O)=>e(I,{key:O},{default:t(()=>[e(y,{value:T},{default:t(()=>[d(L(T),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])])])):h("",!0)])])]),_:1})]),_:1})}}}),ns={class:"flex gap-4"},ds={class:"flex justify-between w-full"},is=X({__name:"EditDealModal",props:{deal:{}},emits:["isDealEdited","isDealDeleted"],setup(m,{emit:$}){const{$useApi:k}=le(),x=m,g={adTags:[],methods:[],sources:[],spheres:[]},w=H({...x.deal}),f=H(g),_=H(!1),P=async()=>{const{data:p}=await k.get("/deals/datas")||[];f.value=p},s=$,U=async()=>{try{return await k.patch(`/deals/${x.deal.id}`,{...w.value}),console.log(w.value),console.log("success!!"),s("isDealEdited"),_.value=!1}catch(p){console.log(p)}},n=async()=>{try{return await k.delete(`/deals/${x.deal.id}`,{}),console.log("success!!"),s("isDealDeleted"),_.value=!1}catch(p){console.log(p)}},u=p=>{w.value={...p}};return(p,o)=>{const B=xe,v=Y,c=fe,S=ye,r=Te,y=ve,I=os,b=be,M=ge,C=_e;return i(),D("div",null,[e(C,{open:l(_),"onUpdate:open":o[0]||(o[0]=z=>oe(_)?_.value=z:null)},{default:t(()=>[e(c,{"as-child":""},{default:t(()=>[e(v,{class:"h-7 w-7 gap-1",size:"icon",onClick:P},{default:t(()=>[e(B,{name:"mingcute:edit-line",color:"white",size:"25px"})]),_:1})]),_:1}),e(M,{class:"max-w-[700px] flex flex-col"},{default:t(()=>[e(y,null,{default:t(()=>[e(S,null,{default:t(()=>o[1]||(o[1]=[d("Редактирование сделки",-1)])),_:1,__:[1]}),e(r,null,{default:t(()=>o[2]||(o[2]=[d(' Заполни все поля и нажми "Сохранить" ',-1)])),_:1,__:[2]})]),_:1}),a("div",ns,[e(I,{deal:p.deal,"deal-sub-datas":l(f),onDealDataChanged:u},null,8,["deal","deal-sub-datas"])]),e(b,{class:"w-full"},{default:t(()=>[a("div",ds,[e(v,{onClick:n},{default:t(()=>o[3]||(o[3]=[d(" Удалить ",-1)])),_:1,__:[3]}),e(v,{onClick:U},{default:t(()=>o[4]||(o[4]=[d(" Сохранить ",-1)])),_:1,__:[4]})])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),us={class:"w-full h-full"},rs={class:"flex flex-col gap-4"},cs={class:"relative"},ps={class:"relative"},ms={class:"relative"},_s={class:"relative"},fs={class:"relative"},gs={class:"flex items-center justify-center gap-1 justify-left relative"},vs={class:"relative"},ys={class:"relative"},bs={class:"flex items-center space-x-2"},xs=X({__name:"Client",props:{client:{}},emits:["clientDataChanged"],setup(m,{emit:$}){const k=m;H(!0);const x={...k.client},g=H(x),w=$;return q(g,()=>{w("clientDataChanged",g.value)},{deep:!0}),(f,_)=>{const P=de,s=ne,U=pe,n=ue,u=Ce,p=Ue,o=he,B=De,v=Ve,c=ke,S=$e,r=ce,y=ie;return i(),D("div",us,[e(y,null,{default:t(()=>[e(s,null,{default:t(()=>[e(P,null,{default:t(()=>_[9]||(_[9]=[d("Клиент",-1)])),_:1,__:[9]})]),_:1}),e(r,null,{default:t(()=>[a("div",rs,[a("div",cs,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[10]||(_[10]=[d("Ссылка на чат",-1)])),_:1,__:[10]}),e(n,{modelValue:l(g).chatLink,"onUpdate:modelValue":_[0]||(_[0]=I=>l(g).chatLink=I),placeholder:"Ссылка на чат",class:"col-span-3"},null,8,["modelValue"])]),a("div",ps,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[11]||(_[11]=[d("ФИО",-1)])),_:1,__:[11]}),e(n,{modelValue:l(g).fullName,"onUpdate:modelValue":_[1]||(_[1]=I=>l(g).fullName=I),class:"col-span-3"},null,8,["modelValue"])]),a("div",ms,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[12]||(_[12]=[d("Телефон",-1)])),_:1,__:[12]}),e(n,{modelValue:l(g).phone,"onUpdate:modelValue":_[2]||(_[2]=I=>l(g).phone=I),placeholder:"Телефон",class:"col-span-3"},null,8,["modelValue"])]),a("div",_s,[l(g).adLink!==""?(i(),F(U,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[13]||(_[13]=[d("Ссылка на объявление",-1)])),_:1,__:[13]})):h("",!0),e(n,{modelValue:l(g).adLink,"onUpdate:modelValue":_[3]||(_[3]=I=>l(g).adLink=I),placeholder:"Ссылка на объявление",class:"col-span-3"},null,8,["modelValue"])]),a("div",fs,[l(g).inn!==""?(i(),F(U,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[14]||(_[14]=[d("ИНН",-1)])),_:1,__:[14]})):h("",!0),e(n,{modelValue:l(g).inn,"onUpdate:modelValue":_[4]||(_[4]=I=>l(g).inn=I),placeholder:"ИНН",class:"col-span-3"},null,8,["modelValue"])]),a("div",gs,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[15]||(_[15]=[d("Дата первого контакта",-1)])),_:1,__:[15]}),e(n,{modelValue:l(g).firstContact,"onUpdate:modelValue":_[5]||(_[5]=I=>l(g).firstContact=I),type:"date",class:R(l(g).firstContact?"":"outline outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",vs,[l(g).type?(i(),F(U,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[16]||(_[16]=[d("Тип клиента",-1)])),_:1,__:[16]})):h("",!0),a("div",null,[e(c,{modelValue:l(g).type,"onUpdate:modelValue":_[6]||(_[6]=I=>l(g).type=I)},{default:t(()=>[e(p,null,{default:t(()=>[e(u,{placeholder:"Тип клиента"})]),_:1}),e(v,null,{default:t(()=>[e(B,null,{default:t(()=>[e(o,{value:"ФИЗ"},{default:t(()=>_[17]||(_[17]=[d(" ФИЗ ",-1)])),_:1,__:[17]}),e(o,{value:"ИП"},{default:t(()=>_[18]||(_[18]=[d(" ИП ",-1)])),_:1,__:[18]}),e(o,{value:"ООО"},{default:t(()=>_[19]||(_[19]=[d(" ООО ",-1)])),_:1,__:[19]}),e(o,{value:"НКО"},{default:t(()=>_[20]||(_[20]=[d(" НКО ",-1)])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),a("div",ys,[l(g).gender?(i(),F(U,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>_[21]||(_[21]=[d("Пол клиента",-1)])),_:1,__:[21]})):h("",!0),a("div",null,[e(c,{modelValue:l(g).gender,"onUpdate:modelValue":_[7]||(_[7]=I=>l(g).gender=I)},{default:t(()=>[e(p,null,{default:t(()=>[e(u,{placeholder:"Пол клиента"})]),_:1}),e(v,null,{default:t(()=>[e(B,null,{default:t(()=>[e(o,{value:"M"},{default:t(()=>_[22]||(_[22]=[d(" Мужской ",-1)])),_:1,__:[22]}),e(o,{value:"F"},{default:t(()=>_[23]||(_[23]=[d(" Женский ",-1)])),_:1,__:[23]}),e(o,{value:"IT"},{default:t(()=>_[24]||(_[24]=[d(" ХЗ ",-1)])),_:1,__:[24]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),a("div",bs,[e(S,{id:"reservation",checked:l(g).isRegular,"onUpdate:checked":_[8]||(_[8]=I=>l(g).isRegular=I)},null,8,["checked"]),e(U,{for:"reservation"},{default:t(()=>_[25]||(_[25]=[d("Постоянный",-1)])),_:1,__:[25]})])])]),_:1})]),_:1})])}}}),ws={class:"flex gap-4"},ks=X({__name:"EditClient",props:{client:{}},emits:["isClientEdited"],setup(m,{emit:$}){const{$useApi:k}=le(),x=m,g=H({...x.client}),w=H(!1),f=s=>{g.value={...s}},_=$,P=async()=>{try{return await k.patch(`/clients/${x.client.id}`,g.value),console.log(g.value),console.log("success!!"),_("isClientEdited"),w.value=!1}catch(s){console.log(s)}};return(s,U)=>{const n=xe,u=Y,p=fe,o=ye,B=Te,v=ve,c=xs,S=be,r=ge,y=_e;return i(),D("div",null,[e(y,{open:l(w),"onUpdate:open":U[0]||(U[0]=I=>oe(w)?w.value=I:null)},{default:t(()=>[e(p,{"as-child":""},{default:t(()=>[e(u,{size:"icon",class:"h-5 w-5 gap-1"},{default:t(()=>[e(n,{name:"mingcute:edit-line",color:"white",size:"15px"})]),_:1})]),_:1}),e(r,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(v,null,{default:t(()=>[e(o,null,{default:t(()=>U[1]||(U[1]=[d("Редактирование клиента",-1)])),_:1,__:[1]}),e(B,null,{default:t(()=>U[2]||(U[2]=[d(' Заполни все поля и нажми "Сохранить" ',-1)])),_:1,__:[2]})]),_:1}),a("div",ws,[e(c,{client:s.client,onClientDataChanged:f},null,8,["client"])]),e(S,null,{default:t(()=>[e(u,{onClick:P},{default:t(()=>U[3]||(U[3]=[d(" Сохранить ",-1)])),_:1,__:[3]})]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Us={class:"flex gap-4"},Cs={class:"relative"},Vs={class:"flex gap-2"},hs={class:"relative"},Ds={key:0,class:"text-red-500 text-sm mb-2"},$s=X({__name:"AddDealerModal",props:{deal:{}},emits:["isDealerAdded"],setup(m,{emit:$}){const{$useApi:k}=le(),x=m,g=H(!1),w=H([]),f=H(x.deal.dealers?.length?[...x.deal.dealers]:[]),_=H(null),P=$,s=async()=>{const{data:p}=await k.get("/managers")||[];w.value=p||[]},U=()=>{f.value.push({id:0,dealId:x.deal.id,userId:0,price:0})},n=p=>{f.value.splice(p,1),_.value=null},u=async()=>{console.log(f.value);try{if(f.value.some(I=>I.price<=0)){_.value="Стоимость не может быть меньше или равна нулю.";return}if(f.value.some(I=>I.userId===0)){_.value="Не выбран менеджер.";return}const B=f.value.map(I=>I.userId);if(new Set(B).size!==B.length){_.value="Не должно быть одинаковых менеджеров.";return}const c=f.value.reduce((I,b)=>I+(b.price||0),0),S=x.deal.price||0;if(c!==S){_.value=`Сумма (${c}) не равна стоимости сделки (${S}).`;return}const r=f.value.map((I,b)=>({id:I.id,userId:I.userId,price:I.price,dealId:x.deal.id,idx:b})),{data:y}=await k.patch(`/deals/${x.deal.id}/dealers`,{dealers:r});console.log("Dealers updated:",y),f.value=y.dealers,P("isDealerAdded"),g.value=!1,_.value=null}catch(p){console.error("Error updating dealers:",p),_.value="Ошибка при сохранении дилеров."}};return q(f,()=>{f.value.length===1&&(f.value[0].price=x.deal.price),console.log(f.value)},{deep:!0}),(p,o)=>{const B=xe,v=Y,c=fe,S=ye,r=ve,y=de,I=me,b=ne,M=pe,C=Ie,z=ue,j=Re,T=ce,O=ie,te=be,N=ge,J=_e;return i(),F(J,{open:l(g),"onUpdate:open":o[1]||(o[1]=A=>oe(g)?g.value=A:null)},{default:t(()=>[e(c,{"as-child":""},{default:t(()=>[e(v,{class:"h-5 w-5 px-0 py-2",onClick:s},{default:t(()=>[e(B,{name:"mingcute:edit-line",color:"white",size:"15px"})]),_:1})]),_:1}),e(N,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(r,null,{default:t(()=>[e(S,null,{default:t(()=>o[2]||(o[2]=[d("Редактировать участников",-1)])),_:1,__:[2]})]),_:1}),a("div",Us,[e(O,{class:"w-full"},{default:t(()=>[e(b,null,{default:t(()=>[e(y,null,{default:t(()=>o[3]||(o[3]=[d("Участники",-1)])),_:1,__:[3]}),e(I,null,{default:t(()=>o[4]||(o[4]=[d("Управляйте списком дилеров",-1)])),_:1,__:[4]})]),_:1}),e(T,{class:"flex flex-col gap-4"},{default:t(()=>[(i(!0),D(K,null,E(l(f),(A,se)=>(i(),D("div",{key:A.id||`new-${se}`,class:"flex flex-col gap-4"},[a("div",Cs,[e(M,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[5]||(o[5]=[d("Менеджер",-1)])),_:1,__:[5]}),a("div",Vs,[e(C,{items:l(w).map(Z=>({value:Z.id,label:Z.fullName})),class:"w-full",label:A.user?.fullName||"Выберите менеджера",onSelectedItem:Z=>{A.userId=Z,_.value=null}},null,8,["items","label","onSelectedItem"]),l(f).length>1?(i(),F(v,{key:0,variant:"destructive",onClick:Z=>n(se)},{default:t(()=>[e(l(Ke))]),_:2},1032,["onClick"])):h("",!0)])]),a("div",hs,[e(M,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[6]||(o[6]=[d("Стоимость",-1)])),_:1,__:[6]}),e(z,{modelValue:A.price,"onUpdate:modelValue":Z=>A.price=Z,modelModifiers:{number:!0},type:"number",placeholder:"Часть от 10 до 90",class:R(A.price?"":"outline outline-1 outline-rose-300 rounded-md"),onInput:o[0]||(o[0]=Z=>_.value=null)},null,8,["modelValue","onUpdate:modelValue","class"])]),l(f).length?(i(),F(j,{key:0})):h("",!0)]))),128)),l(f).length<3?(i(),F(v,{key:0,onClick:U},{default:t(()=>o[7]||(o[7]=[d(" Добавить менеджера ",-1)])),_:1,__:[7]})):h("",!0)]),_:1})]),_:1})]),e(te,null,{default:t(()=>[l(_)?(i(),D("p",Ds,L(l(_)),1)):h("",!0),e(v,{onClick:u},{default:t(()=>o[8]||(o[8]=[d("Сохранить",-1)])),_:1,__:[8]})]),_:1})]),_:1})]),_:1},8,["open"])}}});function Ye(){const{$useApi:m}=le(),$=Le("managers:list",()=>[]),k=Le("managers:loading",()=>!1),x=Le("managers:error",()=>null);return{managers:$,fetchManagers:async(w=!1)=>{if(!w&&$.value.length)return $.value;k.value=!0,x.value=null;try{const{data:f}=await m.get("/managers");return $.value=f||[],$.value}catch(f){throw console.error("Failed to load managers",f),$.value=[],x.value="Не удалось загрузить список менеджеров",f}finally{k.value=!1}},isManagersLoading:k,managersError:x}}const Is={class:"flex gap-4"},Ss={class:"flex flex-col gap-6"},Ts={class:"relative"},Ms={class:"relative"},Ps={class:"relative"},Fs={class:"relative"},Ns={key:0,class:"relative"},Hs={class:"relative"},zs={class:"relative flex items-center space-x-2"},Ls=X({__name:"CreatePaymentModal",props:{dealId:{}},emits:["isPayCreated"],setup(m,{emit:$}){const{$useApi:k}=le(),x=Ae(),{managers:g,fetchManagers:w,managersError:f}=Ye(),_=m,P=H(!1),s=["Наличные","Перевод","Договор","Наложка","Ссылка","Долями","Рассрочка","Счет","Возврат"],U={title:"1",price:0,date:"",method:"Ссылка",reservation:!1,paymentId:"",terminal:"",isConfirmed:!1,userId:0},n=H({...U}),u=H("Статус"),p=$,o=()=>{const v=x.user?.id;!v||n.value.userId||g.value.some(c=>c.id===v)&&(n.value.userId=v)};Me(async()=>{try{await w(),o()}catch(v){console.error("Ошибка загрузки менеджеров:",v)}}),q(f,v=>{v&&console.error(v)}),q(g,()=>{o()});const B=async()=>{try{n.value.paymentId||(n.value.terminal=""),await k.post("/payments/",{...n.value,dealId:_.dealId,userId:n.value.userId||void 0}),console.log("payment created"),p("isPayCreated"),P.value=!1;return}catch(v){console.log(v)}};return q(P,()=>{P.value?o():n.value={...U}}),q(()=>[n.value.paymentId],async([v])=>{if(v&&v.length>5){const{data:c}=await k.get("payments/checkPaymentLink",{params:{link:v}});u.value=c.message,n.value.price=c.price,n.value.isConfirmed=c.isConfirmed}}),(v,c)=>{const S=xe,r=Y,y=fe,I=ye,b=ve,M=de,C=me,z=ne,j=Ce,T=Ue,O=he,te=De,N=Ve,J=ke,A=pe,se=ue,Z=Ie,Q=St,ee=$e,Pe=ce,Fe=ie,Ne=be,He=ge,G=_e;return i(),F(G,{open:l(P),"onUpdate:open":c[7]||(c[7]=W=>oe(P)?P.value=W:null)},{default:t(()=>[e(y,{"as-child":""},{default:t(()=>[e(r,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(S,{name:"akar-icons:plus",color:"white",size:"15px"})]),_:1})]),_:1}),e(He,{class:"flex flex-col max-w-[450px]"},{default:t(()=>[e(b,null,{default:t(()=>[e(I,null,{default:t(()=>c[8]||(c[8]=[d("Создать платеж",-1)])),_:1,__:[8]})]),_:1}),a("div",Is,[e(Fe,{class:"w-full"},{default:t(()=>[e(z,null,{default:t(()=>[e(M),e(C,null,{default:t(()=>[d(L(l(u)),1)]),_:1})]),_:1}),e(Pe,null,{default:t(()=>[a("div",Ss,[a("div",Ts,[e(J,{modelValue:l(n).method,"onUpdate:modelValue":c[0]||(c[0]=W=>l(n).method=W)},{default:t(()=>[e(T,null,{default:t(()=>[e(j,{placeholder:l(n).method},null,8,["placeholder"])]),_:1}),e(N,null,{default:t(()=>[(i(),D(K,null,E(s,(W,Ze)=>e(te,{key:Ze},{default:t(()=>[e(O,{value:W},{default:t(()=>[d(L(W),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),a("div",Ms,[e(A,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>c[9]||(c[9]=[d("Сумма",-1)])),_:1,__:[9]}),e(se,{modelValue:l(n).price,"onUpdate:modelValue":c[1]||(c[1]=W=>l(n).price=W),type:"number",placeholder:"Сумма",class:R(l(n).price?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",Ps,[e(A,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>c[10]||(c[10]=[d("Дата оплаты",-1)])),_:1,__:[10]}),e(se,{modelValue:l(n).date,"onUpdate:modelValue":c[2]||(c[2]=W=>l(n).date=W),type:"date",placeholder:"Дата оплаты",class:R(l(n).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",Fs,[e(A,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>c[11]||(c[11]=[d("Менеджер",-1)])),_:1,__:[11]}),e(Z,{class:R(l(n).userId?"":"outline-1 outline-rose-300 rounded-md"),items:l(g).map(W=>({value:W.id,label:W.fullName})),label:l(g).find(W=>W.id===l(n).userId)?.fullName||"Выбрать менеджера",onSelectedItem:c[3]||(c[3]=W=>l(n).userId=W)},null,8,["class","items","label"])]),l(n).method==="Возврат"?(i(),D("div",Ns,[e(A,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>c[12]||(c[12]=[d("Причина",-1)])),_:1,__:[12]}),e(Q,{modelValue:l(n).description,"onUpdate:modelValue":c[4]||(c[4]=W=>l(n).description=W),placeholder:"Информация о возврате"},null,8,["modelValue"])])):h("",!0),a("div",Hs,[l(n).paymentId?(i(),F(A,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>c[13]||(c[13]=[d("Ссылка на оплату",-1)])),_:1,__:[13]})):h("",!0),e(se,{modelValue:l(n).paymentId,"onUpdate:modelValue":c[5]||(c[5]=W=>l(n).paymentId=W),placeholder:"Ссылка на оплату"},null,8,["modelValue"])]),a("div",zs,[e(ee,{id:"isConfirmed",checked:l(n).isConfirmed,"onUpdate:checked":c[6]||(c[6]=W=>l(n).isConfirmed=W)},null,8,["checked"]),e(A,{for:"isConfirmed"},{default:t(()=>c[14]||(c[14]=[d("Подтвержден",-1)])),_:1,__:[14]})])])]),_:1})]),_:1})]),e(Ne,null,{default:t(()=>[e(r,{onClick:B},{default:t(()=>c[15]||(c[15]=[d(" Создать ",-1)])),_:1,__:[15]})]),_:1})]),_:1})]),_:1},8,["open"])}}}),Bs={class:"w-full"},As={class:"flex flex-col gap-6"},Rs={class:"relative"},Gs={class:"relative"},js={class:"relative"},Ks={class:"relative"},Es=X({__name:"CreateDopCard",props:{managers:{},doptypes:{}},emits:["update:dopBlank"],setup(m,{emit:$}){const x=H({...{id:0,dealId:0,saleDate:"",type:"",price:0,userId:0}}),g=$;return q(x,()=>{g("update:dopBlank",x.value)},{deep:!0}),(w,f)=>{const _=de,P=me,s=ne,U=pe,n=ue,u=Ie,p=Be,o=ce,B=ie;return i(),D("div",Bs,[e(B,null,{default:t(()=>[e(s,null,{default:t(()=>[e(_,null,{default:t(()=>f[4]||(f[4]=[d("Доп. продажа",-1)])),_:1,__:[4]}),e(P,null,{default:t(()=>f[5]||(f[5]=[d("Заполни данные",-1)])),_:1,__:[5]})]),_:1}),e(o,null,{default:t(()=>[a("div",As,[a("div",Rs,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[6]||(f[6]=[d("Дата продажи",-1)])),_:1,__:[6]}),e(n,{modelValue:l(x).saleDate,"onUpdate:modelValue":f[0]||(f[0]=v=>l(x).saleDate=v),type:"date",placeholder:"Дата продажи",class:R(l(x).saleDate?"":"outline outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",Gs,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[7]||(f[7]=[d("Менеджер",-1)])),_:1,__:[7]}),e(u,{class:R(l(x).userId?"":"outline-1 outline-rose-300 rounded-md"),items:w.managers.map(v=>({value:v.id,label:v.fullName})),label:"Выбрать менеджера",onSelectedItem:f[1]||(f[1]=v=>l(x).userId=v)},null,8,["class","items"])]),a("div",js,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[8]||(f[8]=[d("Стоимость",-1)])),_:1,__:[8]}),e(n,{modelValue:l(x).price,"onUpdate:modelValue":f[2]||(f[2]=v=>l(x).price=v),type:"number",placeholder:"Стоимость",class:R(l(x).price?"":"outline outline-1 outline-rose-300 rounded-md")},null,8,["modelValue","class"])]),a("div",Ks,[e(U,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>f[9]||(f[9]=[d("Тип",-1)])),_:1,__:[9]}),e(p,{class:R(l(x).type?"":"outline outline-1 outline-rose-300 rounded-md"),items:w.doptypes,label:l(x).type,onSelectedItem:f[3]||(f[3]=v=>l(x).type=v)},null,8,["class","items","label"])])])]),_:1})]),_:1})])}}}),Os={class:"flex gap-4"},Js=X({__name:"CreateDopModal",props:{dealId:{}},emits:["isDopCreated"],setup(m,{emit:$}){const{$useApi:k}=le(),x=m,g=H(!1),w=H([]),f=H([]),_=async()=>{try{const{data:u}=await k.get("/managers")||[];w.value=u,console.log(w.value);const{data:p}=await k.get("/dops/types")||[];f.value=p,console.log(p)}catch(u){console.log(u)}},P={id:0,dealId:0,saleDate:"",type:"",price:0,userId:0},s=H(P),U=$,n=async()=>{try{await k.post("/dops",{...s.value,dealId:x.dealId}),console.log("dop created"),U("isDopCreated"),g.value=!1;return}catch(u){console.log(u)}};return q(g,()=>{g.value||(s.value=P)}),(u,p)=>{const o=xe,B=Y,v=fe,c=ye,S=ve,r=Es,y=be,I=ge,b=_e;return i(),F(b,{open:l(g),"onUpdate:open":p[1]||(p[1]=M=>oe(g)?g.value=M:null)},{default:t(()=>[e(v,{"as-child":""},{default:t(()=>[e(B,{class:"h-5 w-5 px-0 py-2",onClick:_},{default:t(()=>[e(o,{name:"akar-icons:plus",color:"white",size:"15px"})]),_:1})]),_:1}),e(I,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(S,null,{default:t(()=>[e(c,null,{default:t(()=>p[2]||(p[2]=[d("Создать",-1)])),_:1,__:[2]})]),_:1}),a("div",Os,[e(r,{managers:l(w),doptypes:l(f),"onUpdate:dopBlank":p[0]||(p[0]=M=>s.value=M)},null,8,["managers","doptypes"])]),e(y,null,{default:t(()=>[e(B,{onClick:n},{default:t(()=>p[3]||(p[3]=[d(" Создать ",-1)])),_:1,__:[3]})]),_:1})]),_:1})]),_:1},8,["open"])}}}),qs={class:"flex flex-col gap-6"},Ws={key:0,class:"text-red-500 text-sm"},Xs={class:"relative"},Qs={class:"relative"},Ys={class:"relative"},Zs={key:1,class:"mt-2"},ea={key:0},ta={key:1},la=X({__name:"CreateModal",props:{dealId:{}},emits:["isReviewCreated","error"],setup(m,{emit:$}){const{$useApi:k}=le(),x=Ae(),g=m,w=$,{managers:f,fetchManagers:_,managersError:P}=Ye(),s=H(!1),U=H(null),n=H(null),u=H(null),p=H(!1),o=H(!0),B={id:0,dealId:0,date:"",userId:0},v=H({...B}),c=()=>{const b=x.user?.id;!b||v.value.userId||f.value.some(M=>M.id===b)&&(v.value.userId=b)};Me(async()=>{try{await _(),c()}catch(b){console.error("Ошибка загрузки менеджеров:",b)}}),q(P,b=>{b&&w("error",b)}),q(f,()=>{c()});const S=b=>{const C=b.target.files?.[0];if(!C){n.value="Пожалуйста, выберите файл",U.value=null,u.value=null;return}I(C)},r=async()=>{if(!U.value){n.value="Файл обязателен для загрузки";return}p.value=!0,n.value=null;try{const b=new FormData;b.append("file",U.value),b.append("date",v.value.date),b.append("userId",String(v.value.userId)),b.append("dealId",String(g.dealId)),await k.post("/reviews",b,{headers:{"Content-Type":"multipart/form-data"}}),w("isReviewCreated"),s.value=!1}catch(b){const M=b.response?.data?.message||"Ошибка при создании отзыва";n.value=M,w("error",M)}finally{p.value=!1}},y=b=>{const M=b.clipboardData?.items;if(!M){n.value="Невозможно получить данные из буфера обмена";return}for(const C of M)if(C.type.startsWith("image/")){const z=C.getAsFile();if(z){I(z);return}}n.value="В буфере обмена нет изображения"},I=b=>{if(!["image/jpeg","image/png"].includes(b.type)){n.value="Допустимы только изображения (JPEG, PNG)",U.value=null,u.value=null;return}if(b.size>5242880){n.value="Размер файла не должен превышать 5MB",U.value=null,u.value=null;return}n.value=null,U.value=b;const z=new FileReader;z.onload=j=>{u.value=j.target?.result},z.readAsDataURL(b)};return q([v,U],()=>{const{date:b,userId:M}=v.value;o.value=!(b&&M&&U.value)},{deep:!0}),q(s,b=>{if(b)c();else{v.value={...B},U.value=null,u.value=null,n.value=null;const M=document.getElementById("file-input");console.log(M)}}),(b,M)=>{const C=xe,z=Y,j=fe,T=ye,O=ve,te=pe,N=ue,J=Ie,A=Tt,se=be,Z=ge,Q=_e;return i(),F(Q,{open:l(s),"onUpdate:open":M[3]||(M[3]=ee=>oe(s)?s.value=ee:null)},{default:t(()=>[e(j,{"as-child":""},{default:t(()=>[e(z,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(C,{name:"akar-icons:plus",color:"white",size:"15px"})]),_:1})]),_:1}),e(Z,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(O,null,{default:t(()=>[e(T,null,{default:t(()=>M[4]||(M[4]=[d("Создать отзыв",-1)])),_:1,__:[4]})]),_:1}),a("div",qs,[l(n)?(i(),D("div",Ws,L(l(n)),1)):h("",!0),a("div",Xs,[e(te,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>M[5]||(M[5]=[d("Скриншот(Ctrl+v)",-1)])),_:1,__:[5]}),e(N,{id:"file-input",type:"file",accept:"image/jpeg,image/png",class:R([l(U)?"":"outline-1 outline-rose-300 rounded-md","cursor-pointer"]),onChange:M[0]||(M[0]=ee=>S(ee)),onPaste:y},null,8,["class"])]),a("div",Qs,[e(te,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>M[6]||(M[6]=[d("Дата",-1)])),_:1,__:[6]}),e(N,{modelValue:l(v).date,"onUpdate:modelValue":M[1]||(M[1]=ee=>l(v).date=ee),type:"date",placeholder:"Дата продажи",class:R(l(v).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),a("div",Ys,[e(te,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>M[7]||(M[7]=[d("Менеджер",-1)])),_:1,__:[7]}),e(J,{class:R(l(v).userId?"":"outline-1 outline-rose-300 rounded-md"),items:l(f).map(ee=>({value:ee.id,label:ee.fullName})),label:l(f).find(ee=>ee.id===l(v).userId)?.fullName||"Выбрать менеджера",onSelectedItem:M[2]||(M[2]=ee=>l(v).userId=ee)},null,8,["class","items","label"])]),l(u)?(i(),D("div",Zs,[e(A,{src:l(u),alt:"Превью изображения",class:"w-full h-auto rounded-md"},null,8,["src"])])):h("",!0)]),e(se,null,{default:t(()=>[e(z,{disabled:l(o)||l(p),onClick:r},{default:t(()=>[l(p)?(i(),D("span",ea,"Сохранение...")):(i(),D("span",ta,"Создать"))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])}}}),sa={key:0,class:"h-full"},aa={class:"flex-1 min-w-0"},oa={class:"flex flex-col"},na={key:0},da={class:"flex gap-2 mb-2 items-center"},ia={class:"ml-auto flex items-center gap-2"},ua={class:"gap-3"},ra={class:"gap-1 text-gray-600"},ca={class:"flex items-center justify-between font-semibold"},pa={class:"flex items-center justify-between"},ma={class:"flex items-center justify-between"},_a={class:"flex items-center justify-between"},fa={class:"flex items-center justify-between font-semibold"},ga={class:"gap-1"},va={class:"font-semibold pb-2 flex justify-between"},ya={class:"text-gray-600 flex justify-between"},ba={class:"font-semibold pb-2 flex justify-between"},xa={class:""},wa={class:"flex gap-2"},ka={class:"flex flex-col"},Ua={class:"text-gray-600"},Ca={class:"flex gap-1"},Va={class:"text-gray-900 font-bold"},ha={class:"ml-[auto]"},Da={class:"flex flex-col"},$a={class:"flex justify-between font-semibold pb-2"},Ia={class:"flex flex-col text-gray-600"},Sa={class:"flex"},Ta={class:"flex justify-between grow mr-1"},Ma={class:""},Pa={class:"flex items-center justify-between"},Fa={class:""},Na={class:""},Ha={class:""},za={class:"gap-1"},La={class:"flex items-center justify-between"},Ba={class:"flex"},Aa={class:"flex flex-col justify-between grow mr-1 mb-1"},Ra={class:"text-muted-foreground"},Ga={class:"text-muted-foreground"},ja={class:"w-full flex flex-col items-center"},Ka={class:"gap-1 mt-3"},Ea={class:"flex flex-col justify-between grow mr-1 mb-1"},Oa={class:"text-muted-foreground"},Ja={class:"flex flex-col justify-between grow mr-1 mb-1"},qa={class:"text-muted-foreground"},Wa={class:"gap-1"},Xa={class:"flex items-center justify-between"},Qa={class:"flex"},Ya={class:"flex flex-col justify-between grow mr-1 mb-1"},Za={class:"text-muted-foreground"},eo={class:"w-full flex flex-col items-center"},to=X({__name:"DealCard",props:{deal:{}},emits:["deal-updated","deal-deleted","update-deal"],setup(m,{emit:$}){const{$useApi:k}=le(),x=m,g=H(x.deal.status||"Не установлен"),w=H(0),f=H(0),_=H(0),P=H(0),s=H(0),U=$,n=()=>{console.log("dealUpdated"),U("deal-updated",x.deal.id)},u=()=>{console.log("dealDeleted"),U("deal-deleted")},p=async r=>{try{await k.delete(`/payments/${r.id}`),console.log("payment deleted"),U("deal-updated",x.deal.id);return}catch(y){console.log(y)}},o=async r=>{try{await k.delete(`/dops/${r.id}`),console.log("dop deleted"),U("deal-updated",x.deal.id);return}catch(y){console.log(y)}},B=async r=>{try{await k.delete(`/reviews/${r.id}`),console.log("review deleted"),U("deal-updated",x.deal.id);return}catch(y){console.log(y)}},v=async()=>{try{await k.patch(`/deals/${x.deal.id}`,{status:g.value}),U("deal-updated",x.deal.id)}catch(r){console.log(r)}},c=async r=>{try{await k.delete("deliveries/"+r),U("deal-updated",x.deal.id)}catch(y){console.log(y)}},S=()=>{w.value=x.deal.dops?.reduce((r,y)=>r+y.price,0)||0,f.value=x.deal.payments?.reduce((r,y)=>r+y.price,0)||0,_.value=x.deal.price+w.value,P.value=_.value-f.value,s.value=Mt(x.deal.client.firstContact,x.deal.saleDate)};return q(g,()=>{console.log(g.value),v()}),Me(()=>{S()}),q(()=>x.deal,()=>{S()},{deep:!0}),(r,y)=>{const I=de,b=me,M=Fl,C=is,z=ne,j=Re,T=ks,O=Dt,te=$t,N=It,J=xe,A=Y,se=$s,Z=Ls,Q=Js,ee=la,Pe=ce,Fe=Qe,Ne=ht,He=ie;return r.deal.id!==0?(i(),D("div",sa,[e(He,{class:"flex flex-col overflow-hidden h-full"},{default:t(()=>[e(z,{class:"flex flex-row items-start bg-slate-50 pb-1"},{default:t(()=>[a("div",aa,[e(I,{class:"flex items-center gap-2 text-lg pb-2 break-all leading-tight"},{default:t(()=>[d(L(r.deal.title),1)]),_:1}),e(b,null,{default:t(()=>[a("div",oa,[a("span",null," Первый контакт: "+L(("dateFormat"in r?r.dateFormat:l(re))(r.deal.client.firstContact)),1),a("span",null," Дата продажи: "+L(("dateFormat"in r?r.dateFormat:l(re))(r.deal.saleDate)),1),a("span",null," Прошло дней: "+L(l(s)),1),r.deal.maketPresentation?(i(),D("span",na,"Презентация макета: "+L(("dateFormat"in r?r.dateFormat:l(re))(r.deal.maketPresentation)),1)):h("",!0)]),a("div",da,[a("span",null,"Статус: "+L(r.deal.status),1)])]),_:1})]),a("div",ia,[e(M,{"deal-id":r.deal.id,onIsDealEdited:n,onIsDealDeleted:u},null,8,["deal-id"]),e(C,{deal:r.deal,onIsDealEdited:n,onIsDealDeleted:u},null,8,["deal"])])]),_:1}),e(Fe,null,{default:t(()=>[e(Pe,{class:"p-6 text-sm h-full"},{default:t(()=>[a("div",ua,[y[5]||(y[5]=a("div",{class:"font-semibold pb-2"},"Детали оплаты",-1)),a("ul",ra,[a("li",ca,[y[0]||(y[0]=a("span",{class:"text-muted-foreground"}," Сумма заказа ",-1)),a("span",null,L(l(_))+"₽ ",1)]),a("li",pa,[y[1]||(y[1]=a("span",{class:"text-muted-foreground"}," Стоимость вывески ",-1)),a("span",null,L(r.deal.price)+"₽ ",1)]),a("li",ma,[y[2]||(y[2]=a("span",{class:"text-muted-foreground"}," Стоимость доп. услуг ",-1)),a("span",null,L(l(w))+"₽ ",1)]),a("li",_a,[y[3]||(y[3]=a("span",{class:"text-muted-foreground"}," Оплачено ",-1)),a("span",null,L(l(f))+"₽ ",1)]),a("li",fa,[y[4]||(y[4]=a("span",{class:"text-muted-foreground"}," Остаток ",-1)),a("span",{class:R(l(P)>0?"text-red-600":"text-green-600")},L(l(P))+"₽ ",3)])])]),e(j,{class:"my-2"}),a("div",ga,[a("div",va,[y[6]||(y[6]=a("span",null,"Клиент",-1)),e(T,{client:r.deal.client,onIsClientEdited:n},null,8,["client"])]),a("div",ya,[a("div",null,L(r.deal.client?.fullName),1),e(O,{class:"underlin whitespace-nowrap",to:r.deal.client.chatLink,target:"_blank"},{default:t(()=>y[7]||(y[7]=[d(" Ссылка на чат ",-1)])),_:1,__:[7]},8,["to"])])]),e(j,{class:"my-2"}),a("div",null,[a("div",ba,[y[8]||(y[8]=a("span",null,"Доставка",-1)),e(te,{deal:r.deal,onDeliveryCreated:n},null,8,["deal"])]),a("ul",xa,[(i(!0),D(K,null,E(r.deal.deliveries,G=>(i(),D("li",{key:G.id},[a("div",wa,[e(N,{delivery:G,onDeliveryEdited:n},null,8,["delivery"]),a("div",ka,[a("span",Ua,L(G.method),1),a("div",Ca,[y[9]||(y[9]=a("span",null,"Трек-номер:",-1)),a("span",Va,L(G.track),1)])]),a("div",ha,[e(A,{class:"ml-[auto] w-5 h-5 p-0",onClick:()=>c(G.id)},{default:t(()=>[e(J,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])])])]))),128))])]),e(j,{class:"my-2"}),a("div",Da,[a("div",$a,[d(L(r.deal.dealers.length>1?"Менеджеры":"Менеджер")+" ",1),(i(),F(se,{key:r.deal.id,deal:r.deal,onIsDealerAdded:n},null,8,["deal"]))]),a("div",Ia,[(i(!0),D(K,null,E(r.deal.dealers,G=>(i(),D("ul",{key:G.id,class:"w-full flex-cols items-center mb-2"},[a("li",Sa,[a("div",Ta,[a("span",null,L(G.user?.fullName||"Nope"),1),a("span",null,L(G.price+"p"),1)])])]))),128))])]),e(j,{class:"my-2"}),a("div",Ma,[a("div",Pa,[y[10]||(y[10]=a("div",{class:"font-semibold pb-2"},"Платежи",-1)),e(Z,{"deal-id":r.deal.id,onIsPayCreated:n},null,8,["deal-id"])]),(i(!0),D(K,null,E(r.deal.payments,G=>(i(),D("ul",{key:G.id,class:"text-gray-600 flex"},[a("li",{class:R(["flex items-center justify-between grow mr-1 mb-1",G.isConfirmed?"text-green-600":"text-red-500"])},[a("span",Fa,L(G.method),1),a("span",Na,L(("dateFormat"in r?r.dateFormat:l(re))(G.date)),1),a("span",Ha,L(G.price)+"₽ ",1)],2),e(A,{class:"h-5 w-5 px-0 py-2",onClick:()=>p(G)},{default:t(()=>[e(J,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])]))),128))]),e(j,{class:"my-2"}),a("div",za,[a("div",La,[y[11]||(y[11]=a("div",{class:"font-semibold pb-2"},"Доп. услуги",-1)),e(A,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(Q,{"deal-id":r.deal.id,onIsDopCreated:n},null,8,["deal-id"])]),_:1})]),(i(!0),D(K,null,E(r.deal.dops,G=>(i(),D("ul",{key:G.id,class:"text-gray-600 flex flex-col"},[a("div",Ba,[a("li",Aa,[a("span",Ra,L(("dateFormat"in r?r.dateFormat:l(re))(G.saleDate)+" - "+G.type),1),a("span",Ga,L(G.user.fullName+" - "+G.price+"₽"||""),1)]),e(A,{class:"h-5 w-5 px-0 py-2",onClick:()=>o(G)},{default:t(()=>[e(J,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])]),a("div",ja,[e(j,{class:"my-1"})])]))),128))]),a("div",Ka,[y[15]||(y[15]=a("div",{class:"flex items-center justify-between"},[a("div",{class:"font-semibold pb-2"},"Изготовление")],-1)),e(O,{class:"underline text-gray-600",to:"https://easyneonwork.kaiten.ru/"+r.deal.card_id.toString(),target:"_blank"},{default:t(()=>y[12]||(y[12]=[d(" Дизайн ",-1)])),_:1,__:[12]},8,["to"]),(i(!0),D(K,null,E(r.deal.masterReports,G=>(i(),D("ul",{key:G.id,class:"text-gray-600 flex flex-col"},[a("li",null,[e(O,{class:"underline",to:G.name,target:"_blank"},{default:t(()=>y[13]||(y[13]=[d(" Производство ",-1)])),_:2,__:[13]},1032,["to"])]),a("li",Ea,[a("span",Oa," ("+L(G.type)+") Собрана "+L(("dateFormat"in r?r.dateFormat:l(re))(G.date)),1)])]))),128)),(i(!0),D(K,null,E(r.deal.packerReports,G=>(i(),D("ul",{key:G.id,class:"text-gray-600 flex flex-col"},[a("li",null,[e(O,{class:"underline",to:G.name,target:"_blank"},{default:t(()=>y[14]||(y[14]=[d(" Упаковка ",-1)])),_:2,__:[14]},1032,["to"])]),a("li",Ja,[a("span",qa," ("+L(G.items)+"-шт.) Упакована "+L(("dateFormat"in r?r.dateFormat:l(re))(G.date)),1)])]))),128))]),e(j,{class:"my-1"}),a("div",Wa,[a("div",Xa,[y[16]||(y[16]=a("div",{class:"font-semibold pb-2"},"Отзыв",-1)),e(A,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(ee,{"deal-id":r.deal.id,onIsReviewCreated:n},null,8,["deal-id"])]),_:1})]),(i(!0),D(K,null,E(r.deal.reviews,G=>(i(),D("ul",{key:G.id,class:"text-gray-600 flex flex-col"},[a("div",Qa,[a("li",Ya,[a("span",Za,L(("dateFormat"in r?r.dateFormat:l(re))(G.date)),1)]),e(O,{class:"underline",to:G.file[0]?.preview??"",target:"_blank"},{default:t(()=>y[17]||(y[17]=[d(" Скриншот ",-1)])),_:2,__:[17]},1032,["to"]),e(A,{class:"h-5 w-5 px-0 py-2 ml-2",onClick:()=>B(G)},{default:t(()=>[e(J,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])]),a("div",eo,[e(j,{class:"my-1"})])]))),128))])]),_:1})]),_:1}),e(Ne)]),_:1})])):h("",!0)}}}),lo=[{accessorKey:"title",ruName:"Название",enableHiding:!1,header:()=>V("span",{class:"text-xl w-full"},"Название"),cell:({row:m})=>{const $=m.getValue("boxsize"),k=m.getValue("pages"),x=m.getValue("pageType"),g=k+" разворотов/"+$+"/"+x;return V("div",{class:"flex flex-col pl-2 items-start gap-0.5"},[V("span",{class:"font-semibold text-slate-800"},m.getValue("title")),V("div",{class:"flex gap-1 itens-center"},[V("span",{class:"text-xs text-gray-600 py-0.2 px-1 rounded-sm bg-indigo-300/30"},m.getValue("group")),V("span",{class:"text-xs text-gray-600 py-0.2 px-1 rounded-sm bg-amber-300/30"},m.getValue("courseType")||m.getValue("maketType")||g)]),V("div",{class:"text-xs text-gray-500 flex gap-1"},[V("span",{class:"bg-gray-300/50 text-slate-700 py-0.2 px-1 rounded-sm"},m.getValue("isRegular")),V("span",{class:""}," - "+m.getValue("clientType")),V("span",{class:"ml-1"},m.getValue("sphere"))]),V("span",{class:"text-xs text-gray-500"},m.getValue("city"))])}},{accessorKey:"saleDate",ruName:"Дата продажи",header:({column:m})=>V(Y,{variant:"ghost",onClick:()=>m.toggleSorting(m.getIsSorted()==="asc"),class:"p-1"},()=>[V("span",{class:"text-wrap"},"Дата продажи"),V(we,{class:" h-[24px] w-[24px]"})]),cell:({row:m})=>{const $=m.getValue("status"),k=m.original.reservation;return V("div",{class:"flex flex-col items-center whitespace-nowrap text-center"},[V("span",{class:""},re(m.getValue("saleDate"))),V("span",{class:"text-xs text-gray-500"},"Статус: "+(k?"Бронь":$))])}},{accessorKey:"totalPrice",ruName:"Общее",header:({column:m})=>V(Y,{variant:"ghost",onClick:()=>m.toggleSorting(m.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Общее",V(we,{class:"ml-2 h-4 w-4"})]),cell:({row:m})=>V("div",{class:"flex flex-col items-center"},[V("span",{class:"lowercase whitespace-nowrap text-center text-slate-800 font-semibold"},ae(m.getValue("totalPrice"))+"₽"),V("span",{class:"text-xs text-gray-500"},m.getValue("discont")||"Скидка - "+m.getValue("discontAmount")+"%")])},{accessorKey:"price",ruName:"Вывески",header:({column:m})=>V(Y,{variant:"ghost",onClick:()=>m.toggleSorting(m.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Вывески",V(we,{class:"ml-2 h-4 w-4"})]),cell:({row:m})=>V("div",{class:"lowercase whitespace-nowrap text-center text-slate-700 font-semibold"},ae(m.getValue("price"))+"₽")},{accessorKey:"dopsPrice",ruName:"Допы",header:({column:m})=>V(Y,{variant:"ghost",onClick:()=>m.toggleSorting(m.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Допы",V(we,{class:"ml-2 h-4 w-4"})]),cell:({row:m})=>V("div",{class:"lowercase whitespace-nowrap text-center text-slate-600 font-semibold"},ae(m.getValue("dopsPrice"))+"₽")},{accessorKey:"recievedPayments",ruName:"Оплачено",header:({column:m})=>V(Y,{variant:"ghost",onClick:()=>m.toggleSorting(m.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Оплачено",V(we,{class:"ml-2 h-4 w-4"})]),cell:({row:m})=>V("div",{class:"flex flex-col items-center"},[V("span",{class:"lowercase whitespace-nowrap text-center text-green-700"},"+"+ae(m.getValue("recievedPayments"))+"₽"),V("span",{class:"text-xs text-gray-500"},m.getValue("firstPayment"))])},{accessorKey:"remainder",ruName:"Остаток",header:({column:m})=>V(Y,{variant:"ghost",onClick:()=>m.toggleSorting(m.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Остаток",V(we,{class:"ml-2 h-4 w-4"})]),cell:({row:m})=>V("div",{class:"lowercase whitespace-nowrap text-center text-red-700"},ae(m.getValue("remainder"))+"₽")},{accessorKey:"info",ruName:"Инфо",enableHiding:!1,header:()=>V("span",{class:"text-xl w-full pl-3"},"Инфо"),cell:({row:m})=>V("div",{class:"flex flex-col pl-2"},[V("span",{class:"text-xs text-gray-600"},"Источник - "+m.getValue("source")),V("span",{class:"text-xs text-gray-600"},"Тег - "+m.getValue("adTag")),V("span",{class:"text-xs text-gray-600"},"Закрытие - "+m.getValue("clothingMethod"))])},{accessorKey:"source",ruName:"Источник",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"adTag",ruName:"Тег",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"firstPayment",ruName:"Платеж",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"})},{accessorKey:"city",ruName:"Город",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"})},{accessorKey:"clothingMethod",ruName:"Закрытие",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"})},{accessorKey:"clientType",ruName:"Клиент",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"})},{accessorKey:"sphere",ruName:"Сфера",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"})},{accessorKey:"discont",ruName:"Скидка",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"})},{accessorKey:"status",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),ruName:"Статус",filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"maketType",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),ruName:"Тип макета",filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"courseType",enableHiding:!0,header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),ruName:"Тип курса",filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"workSpaceId",enableHiding:!1,ruName:"Отдел",header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"dealers",enableHiding:!1,ruName:"Менеджеры",header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),filterFn:(m,$,k)=>m.getValue("dealers").some(g=>Object.values(k).includes(g.userId))},{accessorKey:"daysGone",enableHiding:!1,ruName:"Прошло дней",header:()=>V("div",{class:"hidden p-0"}),cell:()=>V("div",{class:"hidden p-0"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"haveReviews",enableHiding:!1,ruName:"Отзывы",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"isRegular",enableHiding:!1,ruName:"тип клиента",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"group",enableHiding:!1,ruName:"Группа",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"groupId",enableHiding:!1,ruName:"Группа id",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"discontAmount",enableHiding:!1,ruName:"discontAmount",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"boxsize",enableHiding:!1,ruName:"boxsize",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"pages",enableHiding:!1,ruName:"pages",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))},{accessorKey:"pageType",enableHiding:!1,ruName:"pageType",header:()=>V("div",{class:"hidden p-10"}),cell:()=>V("div",{class:"hidden p-10"}),filterFn:(m,$,k)=>k.includes(m.getValue($))}],so={class:"relative h-screen hidden-scrollbar"},ao={class:"w-full fixed z-10"},oo={class:"h-[full] flex p-4 gap-4 mx-[auto] max-w-[2048px] pt-16"},no={class:"flex flex-col gap-4 min-w-[1050px] w-full"},io={class:"flex gap-4"},uo={class:"flex gap-2 items-center"},ro={class:"flex items-center justify-between"},co={class:"flex items-center"},po={class:"ml-2"},mo={key:0,class:"ml-2"},_o={key:1,class:"ml-2"},fo={class:"ml-[auto]"},go={class:"mt-[-8px]"},vo={key:0,class:"min-w-[350px] w-[350px] h-[calc(100vh-85px)]"},rn=X({__name:"index",async setup(m){let $,k;const{$useApi:x}=le();lt({title:"Сделки | Easy CRM"});const g=H(new Date().toISOString().slice(0,7)),w={id:0,title:"Название",price:1e4,status:"Создана",clothingMethod:"string",description:"string",source:"string",adTag:"string",discont:"string",sphere:"string",city:"string",region:"string",paid:!1,totalPrice:1,dopsPrice:1,recievedPayments:1,remainder:1,firstPayment:"string",clientType:"string",recievedPay:1,createdAt:"",saleDate:"string",card_id:"0",dealers:[],client:{id:0,fullName:"string",workSpaceId:0,groupId:0,phone:"string",type:"string",chatLink:"string",gender:"string",firstContact:"string",adLink:"string",inn:"string",isRegular:!1}},f=H(""),_=H([]),P=H(w),s=H([{title:"Общая сумма заказов(₽)",value:"0"},{title:"Стоимость вывесок (₽)",value:"0"},{title:"Допы(%)",value:"0"},{title:"Оплачено(%)",value:"0"},{title:"Остаток(%)",value:"0"}]),U=H({workspaces:[],groups:[],managers:[]}),n=H("this_month"),{data:u}=([$,k]=st(()=>x.get("/dashboards/deals")),$=await $,k(),$);U.value={workspaces:u?.workSpaces||[],groups:u?.groups||[],managers:u?.managers||[]};const p=async()=>{const{data:c}=await x.get("/deals",{params:{period:g.value}});_.value=c.deals||[],c.deals.length&&o(c.totalInfo,c.deals.length)},o=(c,S)=>{s.value=[{title:"Общая сумма заказов(₽)",value:ae(c.totalPrice)+"₽"},{title:`Стоимость вывесок (заказов: ${S})`,value:ae(c.price)+"₽"},{title:`Допы(${c.totalPrice?(c.dopsPrice/c.totalPrice*100).toFixed():0}%)`,value:ae(c.dopsPrice)+"₽"},{title:`Оплачено(${c.totalPrice?(c.recievedPayments/c.totalPrice*100).toFixed():0}%)`,value:ae(c.recievedPayments)+"₽"},{title:`Остаток(${c.totalPrice?(c.remainder/c.totalPrice*100).toFixed():0}%)`,value:ae(c.remainder)+"₽"},{title:`Отправлены(${_.value.filter(r=>["Отправлена","Вручена"].includes(r.status||"")).length})`,value:ae(_.value.filter(r=>["Отправлена","Вручена"].includes(r.status||"")).reduce((r,y)=>r+y.price,0))+"₽"}]},B=c=>{const S=_.value.filter(C=>c.includes(C.id)&&!C.reservation),r=S.reduce((C,z)=>C+z.totalPrice,0),y=S.reduce((C,z)=>C+z.price,0),I=S.reduce((C,z)=>C+z.dopsPrice,0),b=S.reduce((C,z)=>C+z.recievedPayments,0),M=S.reduce((C,z)=>C+z.remainder,0);o({totalPrice:r,price:y,dopsPrice:I,recievedPayments:b,remainder:M},c.length)},v=async c=>{const{data:S}=await x.get(`/deals/${c}`);P.value=S};return q(n,()=>{n.value==="this_month"&&(g.value=new Date().toISOString().slice(0,7)),n.value==="today"&&(g.value=new Date().toISOString().slice(0,10))}),q(g,async()=>{await p()},{deep:!0}),q(f,async()=>{if(f.value.length>2){const{data:c}=await x.get("/deals/search",{params:{name:f.value}});if(_.value=c.deals||[],!c.deals.length)return;o(c.totalInfo,c.deals.length)}else await p()}),Me(async()=>{await p(),_.value.length&&await v(_.value[0].id)}),(c,S)=>{const r=et,y=me,I=de,b=ne,M=ie,C=Ul,z=nt,j=ot,T=ue,O=at,te=dt,N=Ml,J=to;return i(),D("div",so,[a("div",ao,[e(r)]),a("div",oo,[a("div",no,[a("div",io,[(i(!0),D(K,null,E(l(s),A=>(i(),F(M,{key:A.title,class:"min-w-[150px] grow"},{default:t(()=>[e(b,{class:"p-3 pb-2"},{default:t(()=>[e(y,null,{default:t(()=>[d(L(A.title),1)]),_:2},1024),e(I,{class:"text-3xl font-semibold whitespace-nowrap"},{default:t(()=>[d(L(A.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),a("div",uo,[e(C,{groups:l(U).groups,onIsDealCreated:S[0]||(S[0]=async A=>{await p(),await v(A)})},null,8,["groups"]),e(O,{modelValue:l(n),"onUpdate:modelValue":S[4]||(S[4]=A=>oe(n)?n.value=A:null),"default-value":"month"},{default:t(()=>[a("div",ro,[a("div",co,[e(j,null,{default:t(()=>[e(z,{value:"this_month"},{default:t(()=>S[9]||(S[9]=[d(" Этот месяц ",-1)])),_:1,__:[9]}),e(z,{value:"today"},{default:t(()=>S[10]||(S[10]=[d(" Сегодня ",-1)])),_:1,__:[10]}),e(z,{value:"month"},{default:t(()=>S[11]||(S[11]=[d(" Выбрать месяц ",-1)])),_:1,__:[11]}),e(z,{value:"day"},{default:t(()=>S[12]||(S[12]=[d(" Выбрать день ",-1)])),_:1,__:[12]})]),_:1}),a("div",po,[e(T,{modelValue:l(f),"onUpdate:modelValue":S[1]||(S[1]=A=>oe(f)?f.value=A:null),placeholder:"Глобальный поиск..."},null,8,["modelValue"])]),l(n)==="month"?(i(),D("div",mo,[e(T,{modelValue:l(g),"onUpdate:modelValue":S[2]||(S[2]=A=>oe(g)?g.value=A:null),type:"month"},null,8,["modelValue"])])):h("",!0),l(n)==="day"?(i(),D("div",_o,[e(T,{modelValue:l(g),"onUpdate:modelValue":S[3]||(S[3]=A=>oe(g)?g.value=A:null),type:"date"},null,8,["modelValue"])])):h("",!0)])])]),_:1},8,["modelValue"]),a("div",fo,[e(te)])]),a("div",go,[(i(),F(N,{key:l(_).length,columns:l(lo),data:l(_),filters:l(U),onDealClicked:S[5]||(S[5]=A=>v(A)),onTableSorted:S[6]||(S[6]=A=>B(A))},null,8,["columns","data","filters"]))])]),l(P)?(i(),D("div",vo,[(i(),F(J,{key:l(P).id,deal:l(P),onDealUpdated:S[7]||(S[7]=async A=>{await v(A),await p()}),onDealDeleted:S[8]||(S[8]=async()=>{await p()})},null,8,["deal"]))])):h("",!0)])])}}});export{rn as default};
