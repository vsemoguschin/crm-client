import{_ as T}from"./BcuVElyA.js";import{_ as R}from"./mqOaxR0N.js";import{_ as S}from"./D8Osd5Ax.js";import{e as N,u as k,r as w,g as E,h as b,i as y,s as _,j as A,c as I,a as t,k as P,b as i,w as c,l as g,o as V,d as m,t as L}from"./LcRD3ia0.js";import{u as M}from"./BOGtf0gU.js";import{u as U}from"./QkXyQO2w.js";import"./D6LOIvye.js";import"./D8EW8v7U.js";const C={class:"flex items-center h-screen justify-center min-h-screen"},D={class:"w-full max-w-sm mx-auto"},B={class:"mb-4 w-full"},K={class:"mb-10 w-full"},$={class:"w-full"},J=N({__name:"login",setup(O){k({title:"Login | Easy CRM"});const a=w(""),l=w(""),r=U(),f=M(),s=A(),{$useApi:u}=E(),{toast:p}=b(),v=async()=>{if(r.set(!0),!a.value||!l.value){p({variant:"destructive",title:"Ошибка",description:"Необходимо заполнить поля логина и пароля."}),r.set(!1);return}try{const{data:o}=await u.post("/login",{email:a.value.trim(),password:l.value.trim()});localStorage.setItem("accessToken",o.accessToken),localStorage.setItem("refreshToken",o.refreshToken),await new Promise(n=>setTimeout(n,0));const{data:e}=await u.get("/profile");f.setUser(e),a.value="",l.value="",_("default"),e.role.shortName==="DIZ"?await s.push("/diz"):["MASTER","PACKER","DP","FRZ","RP"].includes(e.role.shortName)?await s.push("/production"):["MARKETER"].includes(e.role.shortName)?await s.push("/ad"):["ROD"].includes(e.role.shortName)?await s.push("/workspaces"):["GUEST"].includes(e.role.shortName)?await s.push("/boards"):await s.push("/deals")}catch(o){console.error("Login error:",o),p({variant:"destructive",title:"Ошибка входа",description:o.response?.data?.message||"Не удалось войти. Проверьте логин и пароль."})}finally{r.set(!1)}};return y(async()=>{if(localStorage.getItem("accessToken"))try{const{data:e}=await u.get("/profile");f.setUser(e),_("default"),e.role.shortName==="DIZ"?await s.push("/diz"):["MASTER","PACKER"].includes(e.role.shortName)?await s.push("/production"):["ROD","MARKETER"].includes(e.role.shortName)?await s.push("/deals"):await s.push("/deals")}catch(e){console.error("Profile fetch failed:",e),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}}),(o,e)=>{const n=T,h=R,x=S;return V(),I("div",C,[t("div",D,[e[4]||(e[4]=t("div",{class:"text-center mb-8"},[t("h3",{class:"text-3xl font-bold"},"EASY NEON CRM"),t("p",{class:"text-slate-500 font-light"}," Введите логин и пароль для входа в систему ")],-1)),t("form",{class:"flex flex-col items-center text-left font-semibold",onSubmit:P(v,["prevent"])},[t("div",B,[i(n,{for:"login"},{default:c(()=>e[2]||(e[2]=[m("Логин",-1)])),_:1,__:[2]}),i(h,{id:"login",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=d=>a.value=d),placeholder:"Введите логин",required:""},null,8,["modelValue"])]),t("div",K,[i(n,{for:"password"},{default:c(()=>e[3]||(e[3]=[m("Пароль",-1)])),_:1,__:[3]}),i(h,{id:"password",modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=d=>l.value=d),placeholder:"Введите пароль",type:"password",required:"",autocomplete:"current-password"},null,8,["modelValue"])]),t("div",$,[i(x,{class:"w-full h-10 text-xl",type:"submit",disabled:g(r).isLoading},{default:c(()=>[m(L(g(r).isLoading?"Вход...":"Войти"),1)]),_:1},8,["disabled"])])],32)])])}}});export{J as default};
