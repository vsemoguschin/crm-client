import{_ as x}from"./C30fSUvl.js";import{_ as S}from"./CprHmdOe.js";import{_ as N}from"./CDst0A0O.js";import{e as R,u as k,r as w,g as E,h as b,i as y,s as _,j as A,c as I,a as t,k as L,b as i,w as d,l as g,o as P,d as m,t as U}from"./BbheI0mw.js";import{u as V}from"./DzJc7hp_.js";import{u as M}from"./CCknexPU.js";import"./B9M8ggfK.js";import"./CssJESp-.js";import"./s39mgViW.js";const C={class:"flex items-center h-screen justify-center min-h-screen"},D={class:"w-full max-w-sm mx-auto"},B={class:"mb-4 w-full"},K={class:"mb-10 w-full"},O={class:"w-full"},Q=R({__name:"login",setup($){k({title:"Login | Easy CRM"});const a=w(""),l=w(""),r=M(),f=V(),s=A(),{$useApi:u}=E(),{toast:p}=b(),v=async()=>{if(r.set(!0),!a.value||!l.value){p({variant:"destructive",title:"Ошибка",description:"Необходимо заполнить поля логина и пароля."}),r.set(!1);return}try{const{data:o}=await u.post("/login",{email:a.value.trim(),password:l.value.trim()});localStorage.setItem("accessToken",o.accessToken),localStorage.setItem("refreshToken",o.refreshToken),await new Promise(n=>setTimeout(n,0));const{data:e}=await u.get("/profile");f.setUser(e),a.value="",l.value="",_("default"),e.role.shortName==="DIZ"?await s.push("/diz"):["MASTER","PACKER","DP","FRZ","RP"].includes(e.role.shortName)?await s.push("/production"):["MARKETER"].includes(e.role.shortName)?await s.push("/ad"):["ROD"].includes(e.role.shortName)?await s.push("/workspaces"):["GUEST","LOGIST"].includes(e.role.shortName)?await s.push("/boards"):["BUKH"].includes(e.role.shortName)?await s.push("/planfact/operations"):await s.push("/deals")}catch(o){console.error("Login error:",o),p({variant:"destructive",title:"Ошибка входа",description:o.response?.data?.message||"Не удалось войти. Проверьте логин и пароль."})}finally{r.set(!1)}};return y(async()=>{if(localStorage.getItem("accessToken"))try{const{data:e}=await u.get("/profile");f.setUser(e),_("default"),e.role.shortName==="DIZ"?await s.push("/diz"):["MASTER","PACKER"].includes(e.role.shortName)?await s.push("/production"):["ROD","MARKETER"].includes(e.role.shortName)?await s.push("/deals"):await s.push("/deals")}catch(e){console.error("Profile fetch failed:",e),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}}),(o,e)=>{const n=x,h=S,T=N;return P(),I("div",C,[t("div",D,[e[4]||(e[4]=t("div",{class:"text-center mb-8"},[t("h3",{class:"text-3xl font-bold"},"EASY NEON CRM"),t("p",{class:"text-slate-500 font-light"}," Введите логин и пароль для входа в систему ")],-1)),t("form",{class:"flex flex-col items-center text-left font-semibold",onSubmit:L(v,["prevent"])},[t("div",B,[i(n,{for:"login"},{default:d(()=>e[2]||(e[2]=[m("Логин",-1)])),_:1,__:[2]}),i(h,{id:"login",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=c=>a.value=c),placeholder:"Введите логин",required:""},null,8,["modelValue"])]),t("div",K,[i(n,{for:"password"},{default:d(()=>e[3]||(e[3]=[m("Пароль",-1)])),_:1,__:[3]}),i(h,{id:"password",modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=c=>l.value=c),placeholder:"Введите пароль",type:"password",required:"",autocomplete:"current-password"},null,8,["modelValue"])]),t("div",O,[i(T,{class:"w-full h-10 text-xl",type:"submit",disabled:g(r).isLoading},{default:d(()=>[m(U(g(r).isLoading?"Вход...":"Войти"),1)]),_:1},8,["disabled"])])],32)])])}}});export{Q as default};
