import{_ as Z}from"./Bmr5wyhr.js";import{_ as ee}from"./mqOaxR0N.js";import{_ as te,a as le,b as se}from"./DkMjgWCi.js";import{_ as ae}from"./CY7rJOej.js";import{_ as oe,a as ie,b as re}from"./CNLsaPwj.js";import{_ as ne}from"./BCRlC5xu.js";import{_ as de}from"./fRExJa2e.js";import{_ as ue}from"./CP8umD4q.js";import{_ as ce}from"./BcuVElyA.js";import{_ as me}from"./YaXf-8Sh.js";import{v as B,_ as N}from"./D8Osd5Ax.js";import{b as pe,c as fe,d as _e,e as ge,_ as ye,a as ve}from"./Df1Q6CGn.js";import{u as xe,g as Ne,a as we,b as he,F as L,A as k}from"./DSl2Rovl.js";import{e as E,r as b,c as _,o as i,b as l,w as s,F as $,z as U,m as h,D as j,l as n,d as w,G as r,g as be,u as Ie,B as P,i as Ce,a as c,H as z,t as H,A as $e}from"./LcRD3ia0.js";import{u as G}from"./Dt19OLxm.js";import"./DfRdkKc3.js";import"./D5ydJhlK.js";import"./D9TSNOAg.js";import"./DkkQ8vn7.js";import"./D8EW8v7U.js";import"./BdQOAs7V.js";import"./BOGtf0gU.js";import"./QkXyQO2w.js";import"./D6LOIvye.js";import"./CACSUplU.js";import"./xEZuT4Nf.js";const Ue={class:"bg-slate-100"},Ve=E({__name:"DataTable",props:{columns:{},data:{}},emits:["pay","delete-item"],setup(e,{emit:m}){const a=e,d=b([]),I=b([]),C=b({}),y=xe({get data(){return a.data},get columns(){return a.columns},getCoreRowModel:he(),getSortedRowModel:we(),getFilteredRowModel:Ne(),onSortingChange:o=>B(o,d),onColumnFiltersChange:o=>B(o,I),onColumnVisibilityChange:o=>B(o,C),state:{get sorting(){return d.value},get columnFilters(){return I.value}},meta:{pay:o=>S(o),delete:o=>R(o)}}),v=m,S=async o=>{console.log(o),v("pay",o)},R=o=>{console.log(o),v("delete-item",o)};return(o,u)=>{const t=_e,V=ve,M=fe,T=ye,D=ge,F=pe;return i(),_("div",Ue,[l(F,null,{default:s(()=>[l(M,{class:"bg-white"},{default:s(()=>[(i(!0),_($,null,U(n(y).getHeaderGroups(),x=>(i(),h(V,{key:x.id},{default:s(()=>[(i(!0),_($,null,U(x.headers,f=>(i(),h(t,{key:f.id},{default:s(()=>[f.isPlaceholder?j("",!0):(i(),h(n(L),{key:0,render:f.column.columnDef.header,props:f.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),l(D,null,{default:s(()=>[n(y).getRowModel().rows?.length?(i(!0),_($,{key:0},U(n(y).getRowModel().rows,x=>(i(),h(V,{key:x.id},{default:s(()=>[(i(!0),_($,null,U(x.getVisibleCells(),f=>(i(),h(T,{key:f.id},{default:s(()=>[l(n(L),{render:f.column.columnDef.cell,props:f.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1024))),128)):(i(),h(V,{key:1},{default:s(()=>[l(T,{colspan:o.columns.length,class:"text-left"},{default:s(()=>u[0]||(u[0]=[w("Нет результатов.",-1)])),_:1,__:[0]},8,["colspan"])]),_:1}))]),_:1})]),_:1})])}}}),ke=[{accessorKey:"fullName",ruName:"Пользователь",header:({column:e})=>r(N,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full"},()=>["Пользователь",r(k,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>r("div",{class:"text-left"},e.getValue("fullName")),filterFn:(e,m,a)=>a.includes(e.getValue(m))},{accessorKey:"role",ruName:"Должность",header:({column:e})=>r(N,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full"},()=>["Должность",r(k,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>r("div",{class:"text-center whitespace-nowrap"},e.getValue("role")),filterFn:(e,m,a)=>a.includes(e.getValue(m))},{accessorKey:"date",ruName:"Дата выплаты",header:({column:e})=>r(N,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full"},()=>["Дата выплаты",r(k,{class:"ml-2 h-4 w-4"})]),cell:({row:e,table:m})=>{const a=e.original.date,d=e.original;return a?r("div",{class:"text-center"},a):r("div",{class:"text-center"},r(N,{class:"h-5 px-1 mx-auto",item:d,onClick:()=>m.options.meta?.pay(d)},()=>"Выплатить"))}},{accessorKey:"price",ruName:"Сумма",header:({column:e})=>r(N,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full"},()=>["Сумма",r(k,{class:"ml-2 h-4 w-4"})]),cell:({row:e})=>r("div",{class:"text-center"},`${G(e.getValue("price"))} ₽`)},{accessorKey:"action",ruName:"Действия",header:({column:e})=>r(N,{variant:"ghost",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc"),class:"text-center h-full w-full"},()=>["Действия",r(k,{class:"ml-2 h-4 w-4"})]),cell:({row:e,table:m})=>{const a=e.original;return r("div",{class:"text-center"},r(N,{class:"h-5 px-1 mx-auto",item:a,onClick:()=>m.options.meta?.delete(a)},()=>"Отменить"))}}],Me={class:"relative h-screen hidden-scrollbar"},Te={class:"w-full fixed z-10"},Fe={class:"h-full flex flex-col p-4 gap-2 mx-[auto] max-w-[2048px] pt-16 min-w-[1024px]"},Se={class:"flex flex-col gap-2"},Re={class:"flex gap-2"},De={class:"flex gap-2 w-full h-full"},Be={class:"flex gap-2 w-full"},Pe={class:"min-w-[250px]"},He={class:"flex flex-col gap-1 mb-2"},Ae={class:"flex flex-col gap-5"},Ke={class:"relative w-full"},Le={class:"flex gap-2"},ze={class:"relative"},Ee={class:"flex gap-2"},je={class:"w-full"},yt=E({__name:"index",setup(e){const{$useApi:m}=be();Ie({title:"Выплаты | Easy CRM"});const a=b(new Date().toISOString().slice(0,7)),d=b({userId:0,price:0}),I=b(!0),C=b([{id:1,title:"ВК",pays:[{id:1,fullName:"Иван Иванов",userId:101,price:12e3,date:"",status:"Выплачено",period:"2023-10"},{id:2,fullName:"Петр Петров",userId:102,price:15e3,date:"2023-10-02",status:"Создано",period:"2023-10"},{id:3,fullName:"Анна Смирнова",userId:103,price:14e3,date:"",status:"Выплачено",period:"2023-10"},{id:4,fullName:"Ольга Кузнецова",userId:104,price:13e3,date:"2023-10-04",status:"Создано",period:"2023-10"},{id:5,fullName:"Василий Васильев",userId:105,price:11e3,date:"",status:"Создано",period:"2023-10"},{id:6,fullName:"Екатерина Федорова",userId:106,price:12500,date:"2023-10-06",status:"Выплачено",period:"2023-10"},{id:7,fullName:"Николай Николаев",userId:107,price:13500,date:"",status:"Создано",period:"2023-10"},{id:8,fullName:"Марина Морозова",userId:108,price:14500,date:"2023-10-08",status:"Выплачено",period:"2023-10"},{id:9,fullName:"Александр Александров",userId:109,price:15500,date:"",status:"Создано",period:"2023-10"},{id:10,fullName:"Юлия Юрьева",userId:110,price:16500,date:"2023-10-10",status:"Выплачено",period:"2023-10"}],users:[{id:101,fullName:"Иван Иванов"},{id:102,fullName:"Петр Петров"},{id:103,fullName:"Анна Смирнова"},{id:104,fullName:"Ольга Кузнецова"},{id:105,fullName:"Василий Васильев"},{id:106,fullName:"Екатерина Федорова"},{id:107,fullName:"Николай Николаев"},{id:108,fullName:"Марина Морозова"},{id:109,fullName:"Александр Александров"},{id:110,fullName:"Юлия Юрьева"}],totals:[{title:"Выплачено",value:1e5},{title:"Остаток",value:5e4}]},{id:2,title:"B2B",pays:[{id:11,fullName:"Сергей Сергеев",userId:201,price:18e3,date:"2023-10-05",status:"Выплачено",period:"2023-10"},{id:12,fullName:"Алексей Алексеев",userId:202,price:2e4,date:"2023-10-06",status:"Создано",period:"2023-10"},{id:13,fullName:"Мария Иванова",userId:203,price:17e3,date:"",status:"Выплачено",period:"2023-10"},{id:14,fullName:"Дмитрий Соколов",userId:204,price:16e3,date:"2023-10-08",status:"Создано",period:"2023-10"},{id:15,fullName:"Оксана Оксанова",userId:205,price:19e3,date:"",status:"Создано",period:"2023-10"},{id:16,fullName:"Григорий Григорьев",userId:206,price:21e3,date:"2023-10-10",status:"Выплачено",period:"2023-10"},{id:17,fullName:"Елена Еленова",userId:207,price:22e3,date:"",status:"Создано",period:"2023-10"},{id:18,fullName:"Максим Максимов",userId:208,price:23e3,date:"2023-10-12",status:"Выплачено",period:"2023-10"},{id:19,fullName:"Татьяна Татьянова",userId:209,price:24e3,date:"",status:"Создано",period:"2023-10"},{id:20,fullName:"Игорь Игорев",userId:210,price:25e3,date:"2023-10-14",status:"Выплачено",period:"2023-10"}],users:[{id:201,fullName:"Сергей Сергеев"},{id:202,fullName:"Алексей Алексеев"},{id:203,fullName:"Мария Иванова"},{id:204,fullName:"Дмитрий Соколов"},{id:205,fullName:"Оксана Оксанова"},{id:206,fullName:"Григорий Григорьев"},{id:207,fullName:"Елена Еленова"},{id:208,fullName:"Максим Максимов"},{id:209,fullName:"Татьяна Татьянова"},{id:210,fullName:"Игорь Игорев"}],totals:[{title:"Выплачено",value:15e4},{title:"Остаток",value:75e3}]}]),y=b(C.value[0].id),v=async()=>{const{data:u}=await m.get("dashboards/pays",{params:{period:a.value}});C.value=u},S=async()=>{try{await m.post("/salary-pay/",{period:a.value,...d.value}),console.log("pay set"),v()}catch(u){console.log(u)}},R=async u=>{try{await m.delete("/salary-pay/"+u.id),console.log("pay deleted"),v()}catch(t){console.log(t)}},o=async u=>{try{await m.patch(`/salary-pay/${u.id}/status`,{status:"Выплачена"}),console.log("pay set"),v()}catch(t){console.log(t)}};return P(d,async()=>{const{price:u,userId:t}=d.value;u&&t?I.value=!1:I.value=!0},{deep:!0}),P(y,()=>{d.value.userId=0,d.value.price=0,I.value=!0}),P(a,()=>{v()}),Ce(async()=>{await v(),y.value=C.value[0].id}),(u,t)=>{const V=Z,M=ee,T=se,D=le,F=ne,x=re,f=ie,A=oe,K=ce,O=me,W=N,q=de,J=ue,Q=Ve,X=ae,Y=te;return i(),_("div",Me,[c("div",Te,[l(V)]),c("div",Fe,[c("div",Se,[c("div",Re,[l(M,{modelValue:n(a),"onUpdate:modelValue":t[0]||(t[0]=p=>z(a)?a.value=p:null),type:"month",class:"w-[180px]"},null,8,["modelValue"]),t[4]||(t[4]=c("h1",{class:"text-3xl font-semibold"},"Выплаты",-1))])]),c("div",De,[l(Y,{modelValue:n(y),"onUpdate:modelValue":t[3]||(t[3]=p=>z(y)?y.value=p:null),class:"w-full"},{default:s(()=>[l(D,null,{default:s(()=>[(i(!0),_($,null,U(n(C),p=>(i(),_("div",{key:p.id},[l(T,{value:p.id},{default:s(()=>[w(H(p.title),1)]),_:2},1032,["value"])]))),128))]),_:1}),(i(!0),_($,null,U(n(C),p=>(i(),_("div",{key:p.id,class:"w-full"},[l(X,{value:p.id},{default:s(()=>[c("div",Be,[c("div",Pe,[c("div",He,[(i(!0),_($,null,U(p.totals,g=>(i(),h(A,{key:g.title,class:"min-w-[150px] grow"},{default:s(()=>[l(f,{class:"p-3 pb-2"},{default:s(()=>[l(F,null,{default:s(()=>[w(H(g.title),1)]),_:2},1024),l(x,{class:"text-3xl font-semibold whitespace-nowrap"},{default:s(()=>[w(H(("useMyFormatPrice"in u?u.useMyFormatPrice:n(G))(g.value)+"₽"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),l(A,null,{default:s(()=>[l(f,null,{default:s(()=>[l(x,null,{default:s(()=>t[5]||(t[5]=[w(" Создать выплату ",-1)])),_:1,__:[5]}),l(F)]),_:1}),l(q,null,{default:s(()=>[c("div",Ae,[c("div",Ke,[n(d).userId!==0?(i(),h(K,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:s(()=>t[6]||(t[6]=[w("Сотрудник",-1)])),_:1,__:[6]})):j("",!0),c("div",Le,[l(O,{items:p.users.map(g=>({value:g.id,label:g.fullName})),class:"w-full",label:"Выберите сотрудника",onSelectedItem:t[1]||(t[1]=g=>{n(d).userId=g})},null,8,["items"])])]),c("div",ze,[l(K,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:s(()=>t[7]||(t[7]=[w("Сумма",-1)])),_:1,__:[7]}),c("div",Ee,[l(M,{modelValue:n(d).price,"onUpdate:modelValue":t[2]||(t[2]=g=>n(d).price=g),placeholder:"Сумма",type:"number",class:$e(n(d).price?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),l(W,{disabled:n(I),onClick:S},{default:s(()=>t[8]||(t[8]=[w(" Создать ",-1)])),_:1,__:[8]},8,["disabled"])])]),_:2},1024),l(J)]),_:2},1024)]),c("div",je,[l(Q,{columns:n(ke),data:p.pays,onDeleteItem:R,onPay:o},null,8,["columns","data"])])])]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue"])])])])}}});export{yt as default};
