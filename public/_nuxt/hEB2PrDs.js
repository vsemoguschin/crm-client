import{_ as xt}from"./Bye7C16d.js";import{_ as xe}from"./D0zfKHPR.js";import{a as we,_ as ke}from"./l1eRtAXP.js";import{_ as Ce}from"./BhleEUCu.js";import{e as ne,c as T,F as H,z as W,o as u,m as C,w as t,b as e,d as w,t as X,g as ve,r as q,B as le,a as N,D as V,l as i,A as ee,v as Q,H as vt,E as wt,i as ye,C as Me,G as m,y as kt,J as Ct,h as Mt,u as It,K as Dt}from"./BbheI0mw.js";import{_ as Ie,a as De,b as Te,c as Ue,d as Ve}from"./JYeLPbKT.js";import{_ as Pe}from"./DLLw9AXE.js";import{_ as ce}from"./CDst0A0O.js";import{a as Tt,b as Ut,c as Vt,d as Pt,_ as $t}from"./cStEOrWd.js";import{_ as St}from"./BHuR11Jx.js";import{_ as Lt}from"./DiZ4QL0M.js";import{_ as Ft}from"./C5Bd_Bx3.js";import{_ as Xe}from"./BND4UK_1.js";import{_ as Je}from"./C30fSUvl.js";import{_ as $e}from"./CprHmdOe.js";import{_ as We}from"./D-8t_H8v.js";import{_ as At}from"./C-JUEUN9.js";import{u as Rt}from"./DzJc7hp_.js";import{u as he,a as _t,_ as Kt}from"./CXijBUpz.js";import{_ as Bt}from"./CsZkzt_A.js";import{_ as Nt}from"./CYqmhYCX.js";import{u as Gt}from"./s39mgViW.js";import{_ as zt,a as Ht,b as Ot}from"./BF3m7Vf0.js";import{_ as Et}from"./C8Hj2bae.js";import{_ as Se}from"./BWn7SjA7.js";import{_ as Le,a as Fe,b as Ae}from"./DAmwS8V7.js";import{_ as Ye}from"./CHKwxJtM.js";import{_ as et,a as tt,b as at,c as lt,d as st,e as nt}from"./DAy9nm00.js";import{C as ot,_ as rt}from"./DFFUo3JN.js";import{c as ct,v as mt,s as pt}from"./B9M8ggfK.js";import{C as it}from"./_14b2CUj.js";import{F as jt}from"./_OgZ04LM.js";import{X as ut}from"./oLxPQbNe.js";import{b as Re,c as Ke,d as Be,e as Ne,_ as Ge,a as ze}from"./C6vK2VYI.js";import{_ as He,a as Oe}from"./DVdymwQ5.js";import{u as Ee,g as qt,b as je,F as fe}from"./lvbecDJM.js";import{d as ge}from"./Cxp-zkhu.js";import{u as se}from"./Dt19OLxm.js";import{A as _e}from"./Boz4PYjF.js";import{_ as dt}from"./BlOpxHKb.js";import{u as J}from"./Bay1Kywl.js";import"./D0Fd2yXn.js";import"./CaPtdwNj.js";import"./KSX9JOtw.js";import"./ZTyVILcU.js";import"./CJOOd8Dx.js";import"./D2GZmoDz.js";import"./BR3DQNok.js";import"./odSmgr3d.js";import"./CCknexPU.js";import"./CssJESp-.js";import"./CaiudRgb.js";import"./ROxBBV8N.js";import"./D0d2ZlUf.js";import"./QXfa84Px.js";import"./Sc4DFA1e.js";import"./Bh3bOtDY.js";import"./1Y235EgL.js";import"./BuyaVAog.js";import"./C_rPMSjE.js";const Qt={class:"flex gap-1"},Zt=ne({__name:"DealsTotals",props:{totalsInfo:{}},setup(a){return(o,s)=>{const h=Ce,_=we,p=ke,g=xe;return u(),T("div",Qt,[(u(!0),T(H,null,W(o.totalsInfo,D=>(u(),C(g,{key:D.title,class:"min-w-[150px] grow"},{default:t(()=>[e(p,{class:"p-3 pb-2"},{default:t(()=>[e(h,{class:"text-xs"},{default:t(()=>[w(X(D.title),1)]),_:2},1024),e(_,{class:"font-semibold whitespace-nowrap text-2xl"},{default:t(()=>[w(X(D.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])}}}),Xt={class:"flex flex-col gap-6"},Jt={class:"relative"},Wt={class:"relative group"},Yt={class:"relative"},ea={key:0,class:"relative"},ta={class:"relative"},aa={key:1,class:"relative"},la={key:2,class:"relative"},sa={key:3,class:"flex items-center space-x-2"},na=ne({__name:"CreateClientCard",emits:["update:clientBlank"],setup(a,{emit:o}){const{$useApi:s}=ve(),h={id:0,chatLink:"",fullName:"",phone:"",gender:"M",type:"ФИЗ",firstContact:"",adLink:"",inn:"",isRegular:!1},_=q(!0),p=q({...h}),g=async k=>{try{if(!k){_.value=!0,p.value=h,p.value.chatLink=k;return}const{data:r}=await s.get("/clients",{params:{chatLink:k}});if(!r.length){_.value=!1,p.value=h,p.value.chatLink=k;return}const{chatLink:f,...l}=r[0];p.value=l,p.value.chatLink=k,_.value=!0}catch(r){console.error("Ошибка при получении данных клиента:",r)}},D=o;return le(p,async k=>{D("update:clientBlank",k)},{deep:!0}),(k,r)=>{const f=we,l=Ce,U=ke,d=Je,n=$e,y=Te,c=De,v=Ve,x=Pe,I=Ue,R=Ie,F=We,M=Xe,G=xe;return u(),C(G,null,{default:t(()=>[e(U,null,{default:t(()=>[e(f,null,{default:t(()=>r[9]||(r[9]=[w("Клиент",-1)])),_:1,__:[9]}),e(l)]),_:1}),e(M,null,{default:t(()=>[N("div",Xt,[N("div",Jt,[i(p).chatLink?(u(),C(d,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[10]||(r[10]=[w("Ссылка на чат",-1)])),_:1,__:[10]})):V("",!0),e(n,{modelValue:i(p).chatLink,"onUpdate:modelValue":r[0]||(r[0]=A=>i(p).chatLink=A),placeholder:"Ссылка на чат",class:ee(i(p).chatLink?"":"outline-1 outline-rose-300 rounded-md"),onInput:r[1]||(r[1]=async A=>await g(A.target.value.trim()))},null,8,["modelValue","class"])]),N("div",Wt,[i(p).fullName?(u(),C(d,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[11]||(r[11]=[w("ФИО",-1)])),_:1,__:[11]})):V("",!0),e(n,{modelValue:i(p).fullName,"onUpdate:modelValue":r[2]||(r[2]=A=>i(p).fullName=A),placeholder:"ФИО",class:ee(i(p).fullName||i(_)?"":"outline-1 outline-rose-300"),disabled:i(_)},null,8,["modelValue","class","disabled"])]),N("div",Yt,[i(p).phone?(u(),C(d,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[12]||(r[12]=[w("Телефон",-1)])),_:1,__:[12]})):V("",!0),e(n,{modelValue:i(p).phone,"onUpdate:modelValue":r[3]||(r[3]=A=>i(p).phone=A),placeholder:"Телефон",disabled:i(_)},null,8,["modelValue","disabled"])]),i(_)?V("",!0):(u(),T("div",ea,[e(d,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>r[13]||(r[13]=[w("Дата первого контакта",-1)])),_:1,__:[13]}),e(n,{modelValue:i(p).firstContact,"onUpdate:modelValue":r[4]||(r[4]=A=>i(p).firstContact=A),type:"date",class:ee(i(p).firstContact||i(_)?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])),N("div",ta,[i(p).adLink?(u(),C(d,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[14]||(r[14]=[w("Ссылка на объявление",-1)])),_:1,__:[14]})):V("",!0),e(n,{modelValue:i(p).adLink,"onUpdate:modelValue":r[5]||(r[5]=A=>i(p).adLink=A),placeholder:"Ссылка на объявление",class:"col-span-3",disabled:i(_)},null,8,["modelValue","disabled"])]),i(_)?V("",!0):(u(),T("div",aa,[i(p).type?(u(),C(d,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>r[15]||(r[15]=[w("Тип клиента",-1)])),_:1,__:[15]})):V("",!0),N("div",null,[e(R,{modelValue:i(p).type,"onUpdate:modelValue":r[6]||(r[6]=A=>i(p).type=A)},{default:t(()=>[e(c,null,{default:t(()=>[e(y,{placeholder:"Тип клиента"})]),_:1}),e(I,null,{default:t(()=>[e(x,null,{default:t(()=>[e(v,{value:"ФИЗ"},{default:t(()=>r[16]||(r[16]=[w(" ФИЗ ",-1)])),_:1,__:[16]}),e(v,{value:"ИП"},{default:t(()=>r[17]||(r[17]=[w(" ИП ",-1)])),_:1,__:[17]}),e(v,{value:"ООО"},{default:t(()=>r[18]||(r[18]=[w(" ООО ",-1)])),_:1,__:[18]}),e(v,{value:"НКО"},{default:t(()=>r[19]||(r[19]=[w(" НКО ",-1)])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])),i(_)?V("",!0):(u(),T("div",la,[i(p).gender?(u(),C(d,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>r[20]||(r[20]=[w("Пол клиента",-1)])),_:1,__:[20]})):V("",!0),N("div",null,[e(R,{modelValue:i(p).gender,"onUpdate:modelValue":r[7]||(r[7]=A=>i(p).gender=A)},{default:t(()=>[e(c,null,{default:t(()=>[e(y,{placeholder:"Пол клиента"})]),_:1}),e(I,null,{default:t(()=>[e(x,null,{default:t(()=>[e(v,{value:"M"},{default:t(()=>r[21]||(r[21]=[w(" Мужской ",-1)])),_:1,__:[21]}),e(v,{value:"F"},{default:t(()=>r[22]||(r[22]=[w(" Женский ",-1)])),_:1,__:[22]}),e(v,{value:"IT"},{default:t(()=>r[23]||(r[23]=[w(" ХЗ ",-1)])),_:1,__:[23]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])),i(_)?V("",!0):(u(),T("div",sa,[e(F,{id:"reservation",checked:i(p).isRegular,"onUpdate:checked":r[8]||(r[8]=A=>i(p).isRegular=A)},null,8,["checked"]),e(d,{for:"reservation"},{default:t(()=>r[24]||(r[24]=[w("Постоянный",-1)])),_:1,__:[24]})]))])]),_:1})]),_:1})}}}),oa={class:"flex items-center justify-between"},ra={class:"relative flex items-center space-x-2"},ia={class:"flex w-full gap-4"},ua={class:"flex flex-col gap-6 w-full"},da={class:"relative"},ca={class:"relative"},ma={class:"relative"},pa={key:0,class:"relative"},fa={key:1,class:"relative"},ga={key:2,class:"relative"},va={key:3,class:"relative"},_a={key:4,class:"relative"},ya={key:5,class:"relative"},ha={key:6,class:"relative"},ba={key:7,class:"relative"},xa={class:"flex flex-col gap-6 w-full"},wa={class:"relative"},ka={class:"relative"},Ca={class:"relative"},Ma={class:"relative"},Ia={class:"relative"},Da={key:0,class:"relative"},Ta=ne({__name:"CreateDealCard",props:{dealSubDatas:{},clientData:{},curGroupId:{}},emits:["update:dealBlank"],setup(a,{emit:o}){const s=Rt();Q(()=>s.user);const h=["Предложения услуг","Оборудование для бизнеса","Мебель и интерьер"],_=["20х20","20х30","25х25","30х30"],p=["Журнал","Пластик"],g=["Дизайнерский","Заготовка из базы","Рекламный","Визуализатор","Из рассылки"],D=["Без скидки","Желтая","ОПТ","Рассылка","Красная"],k=["Старт","Старт + Профильный","Доп. Профильный","Частный"],r={saleDate:new Date().toISOString().slice(0,10),card_id:"",title:"",price:0,clothingMethod:"",source:"",adTag:"Нет тега",discont:"",maketType:"",maketPresentation:"",city:"",region:"",category:"",reservation:!1,courseType:"",discontAmount:0,bookSize:"",pages:0,pageType:""},f=a,l=q({...r}),U=o;return le(l,d=>{U("update:dealBlank",d)},{deep:!0}),le(()=>f.curGroupId,d=>{console.log("curGroup изменился:",d)}),(d,n)=>{const y=We,c=Je,v=we,x=Ce,I=ke,R=$e,F=Te,M=De,G=Ve,A=Pe,P=Ue,$=Ie,E=At,oe=Xe,z=xe;return u(),C(z,null,{default:t(()=>[e(I,null,{default:t(()=>[e(v,null,{default:t(()=>[N("div",oa,[n[19]||(n[19]=w(" Сделка ",-1)),N("div",ra,[e(y,{id:"reservation",checked:i(l).reservation,"onUpdate:checked":n[0]||(n[0]=b=>i(l).reservation=b)},null,8,["checked"]),e(c,{for:"reservation"},{default:t(()=>n[18]||(n[18]=[w("Бронь",-1)])),_:1,__:[18]})])])]),_:1}),e(x)]),_:1}),e(oe,null,{default:t(()=>[N("div",ia,[N("div",ua,[N("div",da,[i(l).title?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[20]||(n[20]=[w("Название",-1)])),_:1,__:[20]})):V("",!0),e(R,{modelValue:i(l).title,"onUpdate:modelValue":n[1]||(n[1]=b=>i(l).title=b),placeholder:"Название",class:ee(i(l).title?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),N("div",ca,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[21]||(n[21]=[w("Дата продажи",-1)])),_:1,__:[21]}),e(R,{modelValue:i(l).saleDate,"onUpdate:modelValue":n[2]||(n[2]=b=>i(l).saleDate=b),type:"date",placeholder:"dsad",class:ee(i(l).saleDate?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),N("div",ma,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[22]||(n[22]=[w("Стоимость",-1)])),_:1,__:[22]}),e(R,{modelValue:i(l).price,"onUpdate:modelValue":n[3]||(n[3]=b=>i(l).price=b),type:"number",placeholder:"Стоимость",class:ee(i(l).price?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),d.curGroupId===16?(u(),T("div",pa,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[23]||(n[23]=[w("Скидка",-1)])),_:1,__:[23]}),e(R,{modelValue:i(l).discontAmount,"onUpdate:modelValue":n[4]||(n[4]=b=>i(l).discontAmount=b),type:"number",placeholder:"Скидка"},null,8,["modelValue"])])):V("",!0),d.curGroupId!==19?(u(),T("div",fa,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>n[24]||(n[24]=[w("Дата презентации макета",-1)])),_:1,__:[24]}),e(R,{modelValue:i(l).maketPresentation,"onUpdate:modelValue":n[5]||(n[5]=b=>i(l).maketPresentation=b),type:"date",placeholder:"dsad",class:ee(i(l).maketPresentation?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):V("",!0),d.curGroupId!==16&&d.curGroupId!==19?(u(),T("div",ga,[i(l).maketType?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[25]||(n[25]=[w("Тип макета",-1)])),_:1,__:[25]})):V("",!0),N("div",{class:ee(i(l).maketType?"":"outline-1 outline-rose-300 rounded-md")},[e($,{modelValue:i(l).maketType,"onUpdate:modelValue":n[6]||(n[6]=b=>i(l).maketType=b)},{default:t(()=>[e(M,null,{default:t(()=>[e(F,{placeholder:"Тип макета"})]),_:1}),e(P,null,{default:t(()=>[(u(),T(H,null,W(g,(b,O)=>e(A,{key:O},{default:t(()=>[e(G,{value:b},{default:t(()=>[w(X(b),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):V("",!0),d.curGroupId===16?(u(),T("div",va,[i(l).courseType?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[26]||(n[26]=[w("Тип курса",-1)])),_:1,__:[26]})):V("",!0),N("div",{class:ee(i(l).courseType?"":"outline-1 outline-rose-300 rounded-md")},[e($,{modelValue:i(l).courseType,"onUpdate:modelValue":n[7]||(n[7]=b=>i(l).courseType=b)},{default:t(()=>[e(M,null,{default:t(()=>[e(F,{placeholder:"Тип курса"})]),_:1}),e(P,null,{default:t(()=>[(u(),T(H,null,W(k,(b,O)=>e(A,{key:O},{default:t(()=>[e(G,{value:b},{default:t(()=>[w(X(b),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):V("",!0),d.curGroupId!==16&&d.curGroupId!==19?(u(),T("div",_a,[i(l).discont?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[27]||(n[27]=[w("Скидка",-1)])),_:1,__:[27]})):V("",!0),N("div",{class:ee(i(l).discont?"":"outline-1 outline-rose-300 rounded-md ")},[e($,{modelValue:i(l).discont,"onUpdate:modelValue":n[8]||(n[8]=b=>i(l).discont=b)},{default:t(()=>[e(M,null,{default:t(()=>[e(F,{placeholder:"Скидка"})]),_:1}),e(P,null,{default:t(()=>[(u(),T(H,null,W(D,(b,O)=>e(A,{key:O},{default:t(()=>[e(G,{value:b},{default:t(()=>[w(X(b),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):V("",!0),d.curGroupId===19?(u(),T("div",ya,[i(l).bookSize?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[28]||(n[28]=[w("Размер фотокниги",-1)])),_:1,__:[28]})):V("",!0),N("div",{class:ee(i(l).bookSize?"":"outline-1 outline-rose-300 rounded-md ")},[e($,{modelValue:i(l).bookSize,"onUpdate:modelValue":n[9]||(n[9]=b=>i(l).bookSize=b)},{default:t(()=>[e(M,null,{default:t(()=>[e(F,{placeholder:"Размер"})]),_:1}),e(P,null,{default:t(()=>[(u(),T(H,null,W(_,(b,O)=>e(A,{key:O},{default:t(()=>[e(G,{value:b},{default:t(()=>[w(X(b),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):V("",!0),d.curGroupId===19?(u(),T("div",ha,[i(l).pageType?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[29]||(n[29]=[w("Страницы",-1)])),_:1,__:[29]})):V("",!0),N("div",{class:ee(i(l).pageType?"":"outline-1 outline-rose-300 rounded-md ")},[e($,{modelValue:i(l).pageType,"onUpdate:modelValue":n[10]||(n[10]=b=>i(l).pageType=b)},{default:t(()=>[e(M,null,{default:t(()=>[e(F,{placeholder:"Страницы"})]),_:1}),e(P,null,{default:t(()=>[(u(),T(H,null,W(p,(b,O)=>e(A,{key:O},{default:t(()=>[e(G,{value:b},{default:t(()=>[w(X(b),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):V("",!0),d.curGroupId===19?(u(),T("div",ba,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>n[30]||(n[30]=[w("Развороты",-1)])),_:1,__:[30]}),e(R,{modelValue:i(l).pages,"onUpdate:modelValue":n[11]||(n[11]=b=>i(l).pages=b),type:"number",placeholder:"Развороты",class:ee(i(l).pages?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):V("",!0)]),N("div",xa,[N("div",wa,[i(l).clothingMethod?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[31]||(n[31]=[w("Способ закрытия",-1)])),_:1,__:[31]})):V("",!0),e(E,{items:d.dealSubDatas.methods,label:"Способ закрытия",class:ee(i(l).clothingMethod?"":"outline-1 outline-rose-300 rounded-md"),onSelectedItem:n[12]||(n[12]=b=>i(l).clothingMethod=b)},null,8,["items","class"])]),N("div",ka,[i(l).source?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[32]||(n[32]=[w("Источник сделки",-1)])),_:1,__:[32]})):V("",!0),e(E,{items:d.dealSubDatas.sources,label:"Источник сделки",class:ee(i(l).source?"":"outline-1 outline-rose-300 rounded-md"),onSelectedItem:n[13]||(n[13]=b=>i(l).source=b)},null,8,["items","class"])]),N("div",Ca,[i(l).adTag?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[33]||(n[33]=[w("ТЭГ",-1)])),_:1,__:[33]})):V("",!0),e(E,{items:d.dealSubDatas.adTags,label:"Нет тега",class:ee(i(l).adTag?"":"outline-1 outline-rose-300 rounded-md"),onSelectedItem:n[14]||(n[14]=b=>i(l).adTag=b)},null,8,["items","class"])]),N("div",Ma,[i(l).city?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[34]||(n[34]=[w("Город",-1)])),_:1,__:[34]})):V("",!0),e(R,{modelValue:i(l).city,"onUpdate:modelValue":n[15]||(n[15]=b=>i(l).city=b),placeholder:"Город"},null,8,["modelValue"])]),N("div",Ia,[i(l).region?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[35]||(n[35]=[w("Регион/область",-1)])),_:1,__:[35]})):V("",!0),e(R,{modelValue:i(l).region,"onUpdate:modelValue":n[16]||(n[16]=b=>i(l).region=b),placeholder:"Регион/область"},null,8,["modelValue"])]),d.clientData.chatLink.includes("easyneon.amocrm.ru")?(u(),T("div",Da,[i(l).category?(u(),C(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>n[36]||(n[36]=[w("Категория",-1)])),_:1,__:[36]})):V("",!0),N("div",null,[e($,{modelValue:i(l).category,"onUpdate:modelValue":n[17]||(n[17]=b=>i(l).category=b)},{default:t(()=>[e(M,null,{default:t(()=>[e(F,{placeholder:"Категория"})]),_:1}),e(P,null,{default:t(()=>[(u(),T(H,null,W(h,(b,O)=>e(A,{key:O},{default:t(()=>[e(G,{value:b},{default:t(()=>[w(X(b),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])])])):V("",!0)])])]),_:1})]),_:1})}}}),Ua={class:"flex flex-col gap-6"},Va={class:"relative"},Pa={class:"relative"},$a={class:"relative"},Sa={class:"relative flex items-center space-x-2"},La=ne({__name:"CreatePaymentCard",emits:["update:paymentBlank"],setup(a,{emit:o}){const{$useApi:s}=ve(),h=q("Статус"),_=["Наличные","Перевод","Договор","Наложка","Ссылка","Долями","Рассрочка","Счет"],g=q({...{title:"1",price:0,date:"",method:"Ссылка",reservation:!1,isConfirmed:!1}}),D=o;return le(g,k=>{D("update:paymentBlank",k)},{deep:!0}),le(()=>[g.value.paymentId],async([k])=>{if(k&&k.length>5){const{data:r}=await s.get("payments/checkPaymentLink",{params:{link:k}});h.value=r.message,g.value.price=r.price,g.value.isConfirmed=r.isConfirmed}}),(k,r)=>{const f=we,l=Ce,U=ke,d=Je,n=$e,y=Te,c=De,v=Ve,x=Pe,I=Ue,R=Ie,F=We,M=Xe,G=xe;return u(),C(G,{class:"w-full"},{default:t(()=>[e(U,null,{default:t(()=>[e(f,null,{default:t(()=>r[4]||(r[4]=[w("Платеж",-1)])),_:1,__:[4]}),e(l)]),_:1}),e(M,null,{default:t(()=>[N("div",Ua,[N("div",Va,[e(d,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[5]||(r[5]=[w("Сумма",-1)])),_:1,__:[5]}),e(n,{modelValue:i(g).price,"onUpdate:modelValue":r[0]||(r[0]=A=>i(g).price=A),type:"number",placeholder:"Сумма",class:ee(i(g).price?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),N("div",Pa,[e(d,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>r[6]||(r[6]=[w("Способ оплаты",-1)])),_:1,__:[6]}),e(R,{modelValue:i(g).method,"onUpdate:modelValue":r[1]||(r[1]=A=>i(g).method=A)},{default:t(()=>[e(c,null,{default:t(()=>[e(y,{placeholder:i(g).method},null,8,["placeholder"])]),_:1}),e(I,null,{default:t(()=>[(u(),T(H,null,W(_,(A,P)=>e(x,{key:P},{default:t(()=>[e(v,{value:A},{default:t(()=>[w(X(A),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),N("div",$a,[i(g).paymentId?(u(),C(d,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[7]||(r[7]=[w("Ссылка на оплату",-1)])),_:1,__:[7]})):V("",!0),e(n,{modelValue:i(g).paymentId,"onUpdate:modelValue":r[2]||(r[2]=A=>i(g).paymentId=A),placeholder:"Ссылка на оплату"},null,8,["modelValue"])]),N("div",Sa,[e(F,{id:"isConfirmed",checked:i(g).isConfirmed,"onUpdate:checked":r[3]||(r[3]=A=>i(g).isConfirmed=A)},null,8,["checked"]),e(d,{for:"isConfirmed"},{default:t(()=>r[8]||(r[8]=[w("Подтвержден",-1)])),_:1,__:[8]})])])]),_:1})]),_:1})}}}),Fa={key:0,class:"flex items-center gap-3"},Aa={class:"w-[200px]"},Ra={class:"flex gap-4"},Ka={class:"flex flex-col gap-5 w-[300px]"},Ba=ne({__name:"DealCreateModal",emits:["isDealCreated"],setup(a,{emit:o}){const{$useApi:s}=ve(),h={id:0,chatLink:"",fullName:"",phone:"",gender:"M",type:"ФИЗ",firstContact:"",adLink:"",inn:"",isRegular:!1},_={saleDate:"",card_id:"",title:"",price:0,clothingMethod:"",source:"",adTag:"",discont:"",maketType:"",maketPresentation:"",city:"",region:"",category:"",reservation:!1,discontAmount:0,bookSize:"",pages:0,pageType:""},p={title:"",price:0,date:"",method:"Перевод",reservation:!1,isConfirmed:!1},g=["СДЕК","ПОЧТА РОССИИ","Яндекс","Балтийский курьер","Самовывоз","ТК КИТ","ПЭТ","Боксбери","Деловые линии"];q({type:["Бесплатно","Платно","Досыл"][0],method:g[0]});const k=q({...h}),r=q({..._}),f=q({...p}),{filters:l,loadDealsDatas:U,isLoaded:d}=he(),n=Q(()=>({adTags:l.value.adTags??[],methods:l.value.methods??[],sources:l.value.sources??[],spheres:l.value.spheres??[]})),{groups:y,fetchGroups:c,selectedGroupId:v}=_t(),x=Q(()=>y.value??[]),I=q(0),R=Q(()=>x.value.find(z=>z.id===I.value)),F=z=>{if(z==null)return;if(typeof z=="number")return Number.isFinite(z)?z:void 0;if(z==="all"||z==="")return;const b=Number(z);return Number.isFinite(b)?b:void 0},M=async()=>{await Promise.all([d.value?Promise.resolve():U(),y.value.length?Promise.resolve():c()]);const z=F(v.value),b=I.value||z;if(b&&x.value.some(S=>S.id===b)){I.value=b;return}const[O]=x.value;O&&(I.value=O.id)},G=z=>{I.value=Number(z)};le(()=>x.value,z=>{if(!z?.length){I.value=0;return}const b=(()=>{if(I.value&&z.some(S=>S.id===I.value))return I.value;const O=F(v.value);return O&&z.some(S=>S.id===O)?O:z[0].id})();I.value=b},{immediate:!0,deep:!0});const A=q(!1),P=q(!1),$=()=>k.value.chatLink===""||k.value.fullName===""||k.value.gender===""||k.value.type===""||k.value.firstContact===""?console.log("wrong client"):r.value.title===""||r.value.saleDate===""||+r.value.price==0||r.value.clothingMethod===""||r.value.source===""||r.value.adTag===""||r.value.maketType===""&&r.value.courseType===""&&r.value.bookSize===""&&r.value.category===""?console.log("wrong deal"):f.value.title===""||+f.value.price==0||f.value.method===""?console.log("wrong payment"):(console.log("success!!"),!0),E=o,oe=async()=>{try{if(!$())return console.log("nope");P.value=!0;let b=k.value;if(k.value.id===0){const{id:S,...B}=k.value;B.phone=B.phone.toString();const{data:Z}=await s.post("/clients",{...B,groupId:I.value});b=Z}const{data:O}=await s.post("deals/",{...r.value,clientId:b.id,groupId:I.value});return f.value.date=r.value.saleDate,await s.post("/payments/",{...f.value,dealId:O.id,groupId:I.value,userId:O.userId}),E("isDealCreated",O.id),A.value=!1}catch(z){console.log(z)}};return le(A,async z=>{if(z){await M();return}k.value=h,r.value=_,f.value=p,P.value=!1}),(z,b)=>{const O=ce,S=Tt,B=Pt,Z=St,L=Ft,K=Vt,j=na,Y=Ta,re=La,te=Lt,ue=Ut,me=$t;return u(),T("div",null,[e(me,{open:A.value,"onUpdate:open":b[3]||(b[3]=ie=>A.value=ie)},{default:t(()=>[e(S,{"as-child":""},{default:t(()=>[e(O,{size:"icon",class:"w-full px-2",onClick:M},{default:t(()=>b[4]||(b[4]=[w(" Создать ",-1)])),_:1,__:[4]})]),_:1}),e(ue,{class:"max-w-[1200px] min-w-[1000px] flex flex-col"},{default:t(()=>[e(K,null,{default:t(()=>[e(B,null,{default:t(()=>b[5]||(b[5]=[w("Создание сделки",-1)])),_:1,__:[5]}),e(Z,null,{default:t(()=>b[6]||(b[6]=[w(" Заполни все поля и нажми Создать ",-1)])),_:1,__:[6]}),x.value.length>1?(u(),T("div",Fa,[b[7]||(b[7]=N("span",{class:"whitespace-nowrap"},"Выбрать проект -> ",-1)),N("div",Aa,[e(L,{items:x.value.map(ie=>({value:ie.id,label:ie.title})),class:"w-full",label:R.value?.title||"Выберите проект",onSelectedItem:G},null,8,["items","label"])])])):V("",!0)]),_:1}),N("div",Ra,[e(j,{class:"w-[300px]","onUpdate:clientBlank":b[0]||(b[0]=ie=>k.value=ie)}),I.value?(u(),C(Y,{key:0,class:"w-[600px]","deal-sub-datas":n.value,"client-data":k.value,"cur-group-id":I.value,"onUpdate:dealBlank":b[1]||(b[1]=ie=>r.value=ie)},null,8,["deal-sub-datas","client-data","cur-group-id"])):V("",!0),N("div",Ka,[e(re,{class:"h-full","new-payment-data":f.value,"onUpdate:paymentBlank":b[2]||(b[2]=ie=>f.value=ie)},null,8,["new-payment-data"])])]),e(te,null,{default:t(()=>[e(O,{disabled:P.value,onClick:oe},{default:t(()=>b[8]||(b[8]=[w(" Создать ",-1)])),_:1,__:[8]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Na={class:"flex gap-2 items-center"},Ga={key:0,class:"flex items-center"},za={class:"w-full"},Ha={class:"ml-[auto]"},Oa=ne({__name:"DealsFilters",props:{dealGroups:{},selectedGroupId:{},filters:{},search:{}},emits:["update:selectedGroupId","update:search","range-change","deal-created"],setup(a,{emit:o}){const s=a,h=o,_=q(s.search),p=Gt(f=>{h("update:search",f)},300),g=()=>{p(_.value)},D=f=>{h("range-change",f)},k=f=>{h("deal-created",f)},r=f=>{h("update:selectedGroupId",f)};return le(()=>s.search,f=>{_.value=f}),(f,l)=>{const U=Te,d=De,n=Ve,y=Pe,c=Ue,v=Ie,x=Ba,I=Bt,R=$e,F=Nt;return u(),T("div",Na,[f.dealGroups.length>1?(u(),T("div",Ga,[e(v,{value:f.selectedGroupId,"onUpdate:modelValue":r},{default:t(()=>[e(d,{class:"w-[220px]"},{default:t(()=>[e(U,{placeholder:f.selectedGroupId==="all"?"Все проекты":f.dealGroups.find(M=>M.id===+f.selectedGroupId)?.title||"Выберите проект"},null,8,["placeholder"])]),_:1}),e(c,null,{default:t(()=>[e(y,null,{default:t(()=>[(u(),C(n,{key:0,value:"all"},{default:t(()=>l[1]||(l[1]=[w(" Все ",-1)])),_:1,__:[1]})),(u(!0),T(H,null,W(f.dealGroups,M=>(u(),C(n,{key:M.id,value:String(M.id)},{default:t(()=>[w(X(M.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["value"])])):V("",!0),e(x,{groups:f.filters.groups,onIsDealCreated:k},null,8,["groups"]),e(I,{"today-btn":!0,onRangeUpdated:D}),N("div",za,[e(R,{modelValue:i(_),"onUpdate:modelValue":l[0]||(l[0]=M=>vt(_)?_.value=M:null),placeholder:"Глобальный поиск...",onInput:g},null,8,["modelValue"])]),N("div",Ha,[e(F)])])}}}),Ea={class:"hidden space-x-1 lg:flex"},ja={key:1,class:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs"},qa=ne({__name:"DataTableFacetedFilter",props:{column:{},title:{},options:{}},setup(a){const o=a,{filters:s,getColumnFilterValues:h,setColumnFilterValues:_,clearColumnFilter:p,resolveSelectedKey:g}=he(),D=Q(()=>o.column?.id??null),k=Q(()=>g(D.value)),r=Q(()=>!!k.value),f=F=>F.filter(M=>typeof M=="string"&&M.trim().length>0).map(M=>({value:M,label:M})),l=Q(()=>{const F=D.value;return F?F==="source"?f(s.value.sources):F==="adTag"?f(s.value.adTags):F==="sphere"?f(s.value.spheres):F==="method"?f(s.value.methods):F==="dealers"?s.value.managers.map(M=>({value:M&&typeof M.id=="number"?M.id.toString():"",label:M?.fullName??""})).filter(M=>M.value&&M.label):[]:[]}),U=Q(()=>o.options?.length?o.options:l.value),d=(F=[],M)=>{const G=F,A=(M??"").toLowerCase();return G.filter(P=>P.label.toLowerCase().includes(A))},n=Q(()=>o.column?.getFacetedUniqueValues()),y=Q(()=>{if(r.value){const M=h(D.value);return Array.isArray(M)?[...M]:[]}const F=o.column?.getFilterValue();return Array.isArray(F)?F:[]}),c=Q(()=>new Set(y.value)),v=F=>{if(r.value&&D.value){_(D.value,F);return}o.column?.setFilterValue(F.length?F:void 0)},x=F=>{const M=new Set(y.value);M.has(F)?M.delete(F):M.add(F),v(Array.from(M))},I=()=>{if(r.value){p(D.value??void 0);return}o.column?.setFilterValue(void 0)},R=Q(()=>y.value.length);return(F,M)=>{const G=Ye,A=Se,P=ce,$=Le,E=tt,oe=lt,z=nt,b=st,O=rt,S=at,B=et,Z=Fe,L=Ae;return u(),C(L,null,{default:t(()=>[e($,{"as-child":""},{default:t(()=>[e(P,{variant:"outline",size:"sm",class:"h-8 border-dashed"},{default:t(()=>[e(i(ot),{class:"mr-2 h-4 w-4"}),w(" "+X(F.title)+" ",1),R.value>0?(u(),T(H,{key:0},[e(G,{orientation:"vertical",class:"mx-2 h-4"}),e(A,{variant:"secondary",class:"rounded-sm px-1 font-normal lg:hidden"},{default:t(()=>[w(X(R.value),1)]),_:1}),N("div",Ea,[R.value>0?(u(),C(A,{key:0,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:t(()=>[w(X(R.value),1)]),_:1})):(u(!0),T(H,{key:1},W(U.value.filter(K=>c.value.has(K.value)),K=>(u(),C(A,{key:K.value,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:t(()=>[w(X(K.label),1)]),_:2},1024))),128))])],64)):V("",!0)]),_:1})]),_:1}),e(Z,{class:"w-[200px] p-0",align:"start"},{default:t(()=>[e(B,{"filter-function":d},{default:t(()=>[e(E,{placeholder:F.title},null,8,["placeholder"]),e(S,null,{default:t(()=>[e(oe,null,{default:t(()=>M[0]||(M[0]=[w("Нет совпадений.",-1)])),_:1,__:[0]}),e(b,null,{default:t(()=>[(u(!0),T(H,null,W(U.value,K=>(u(),C(z,{key:K.value,value:K,onSelect:()=>x(K.value)},{default:t(()=>[N("div",{class:ee(i(ct)("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",c.value.has(K.value)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"))},[e(i(it),{class:ee(i(ct)("h-4 w-4"))},null,8,["class"])],2),K.icon?(u(),C(wt(K.icon),{key:0,class:"mr-2 h-4 w-4 text-muted-foreground"})):V("",!0),N("span",null,X(K.label),1),n.value?.get(K.value)?(u(),T("span",ja,X(n.value.get(K.value)),1)):V("",!0)]),_:2},1032,["value","onSelect"]))),128))]),_:1}),R.value>0?(u(),T(H,{key:0},[e(O),e(b,null,{default:t(()=>[e(z,{value:{label:"Очистить"},class:"justify-center text-center",onSelect:I},{default:t(()=>M[1]||(M[1]=[w(" Очистить ",-1)])),_:1,__:[1]})]),_:1})],64)):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}}),Qa={class:"flex w-full items-center justify-between"},Za={class:"flex flex-wrap gap-2"},Xa=ne({__name:"DataTableToolbar",props:{table:{}},setup(a){const o=[{label:"Создана",value:"Создана"},{label:"Сборка",value:"Сборка"},{label:"Упаковка",value:"Упаковка"},{label:"Отправлена",value:"Отправлена"},{label:"Вручена",value:"Вручена"},{label:"Возврат",value:"Возврат"},{label:"Бронь",value:"Бронь"}],s=[{value:"Дизайнерский",label:"Дизайнерский"},{value:"Заготовка из базы",label:"Заготовка из базы"},{value:"Рекламный",label:"Рекламный"},{value:"Визуализатор",label:"Визуализатор"},{value:"Из рассылки",label:"Из рассылки"}],h=[{label:"Больше 31",value:"Больше 31"},{label:"8-31",value:"8-31"},{label:"3-7",value:"3-7"},{label:"1-2",value:"1-2"},{label:"0",value:"0"}],_=[{label:"20х20",value:"20х20"},{label:"20х30",value:"20х30"},{label:"25х25",value:"25х25"},{label:"30х30",value:"30х30"}],p=a,{filters:g,selectedFilters:D,clearAllFilters:k}=he(),r=Q(()=>g.value.managers.length),f=Q(()=>Object.values(D.value).reduce((d,n)=>d+(Array.isArray(n)?n.length:0),0)),l=Q(()=>f.value>0),U=()=>{k(),p.table.resetColumnFilters()};return(d,n)=>{const y=Se,c=ce,v=Le,x=qa,I=Fe,R=Ae;return u(),T("div",Qa,[e(R,null,{default:t(()=>[e(v,{"as-child":""},{default:t(()=>[e(c,{variant:"outline",class:"h-9 gap-2"},{default:t(()=>[e(i(jt),{class:"h-4 w-4"}),n[0]||(n[0]=w(" Фильтры ",-1)),l.value?(u(),C(y,{key:0,variant:"secondary",class:"ml-1 px-2"},{default:t(()=>[w(X(f.value),1)]),_:1})):V("",!0)]),_:1,__:[0]})]),_:1}),e(I,{class:"w-[340px] p-4",align:"start"},{default:t(()=>[N("div",Za,[d.table.getColumn("status")?(u(),C(x,{key:0,column:d.table.getColumn("status"),title:"Статус",options:o},null,8,["column"])):V("",!0),d.table.getColumn("maketType")?(u(),C(x,{key:1,column:d.table.getColumn("maketType"),title:"Макет",options:s},null,8,["column"])):V("",!0),d.table.getColumn("source")?(u(),C(x,{key:2,column:d.table.getColumn("source"),title:"Источник"},null,8,["column"])):V("",!0),d.table.getColumn("adTag")?(u(),C(x,{key:3,column:d.table.getColumn("adTag"),title:"Тег"},null,8,["column"])):V("",!0),d.table.getColumn("daysGone")?(u(),C(x,{key:4,column:d.table.getColumn("daysGone"),title:"Прошло дней",options:h},null,8,["column"])):V("",!0),d.table.getColumn("dealers")&&r.value>1?(u(),C(x,{key:5,column:d.table.getColumn("dealers"),title:"Менеджеры"},null,8,["column"])):V("",!0),d.table.getColumn("haveReviews")?(u(),C(x,{key:6,column:d.table.getColumn("haveReviews"),title:"Отзыв",options:[{label:"Есть",value:"Есть"},{label:"Нет",value:"Нет"}]},null,8,["column"])):V("",!0),d.table.getColumn("isRegular")?(u(),C(x,{key:7,column:d.table.getColumn("isRegular"),title:"Клиент",options:[{label:"Новый клиент",value:"Новый клиент"},{label:"Постоянный клиент",value:"Постоянный клиент"}]},null,8,["column"])):V("",!0),d.table.getColumn("boxsize")?(u(),C(x,{key:8,column:d.table.getColumn("boxsize"),title:"Размер",options:_},null,8,["column"])):V("",!0)]),l.value?(u(),C(c,{key:0,variant:"secondary",class:"mt-3 h-8 w-full",onClick:U},{default:t(()=>[n[1]||(n[1]=w(" Сброс фильтров ",-1)),e(i(ut),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})):V("",!0)]),_:1})]),_:1})])}}}),Ja={class:"flex mb-2 justify-between"},Wa={class:"ml-auto"},Ya={class:"bg-slate-100 rounded-sm overflow-hidden"},el=ne({__name:"DataTable",props:{columns:{},data:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},sorting:{}},emits:["deal-clicked","load-more","sort-change"],setup(a,{emit:o}){const s=a,h=q(0),_=Q(()=>s.sorting??[]),p=q([]),g=q({}),D=o,k=n=>typeof n=="function"?n([..._.value]):n??[],r=Ee({get data(){return s.data},get columns(){return s.columns},getCoreRowModel:je(),getFilteredRowModel:qt(),onSortingChange:n=>{const y=k(n);D("sort-change",y)},onColumnFiltersChange:n=>mt(n,p),onColumnVisibilityChange:n=>mt(n,g),state:{get sorting(){return _.value},get columnFilters(){return p.value},get columnVisibility(){return g.value}}}),f=n=>{h.value=n,D("deal-clicked",n)},l=q(null);let U=null;const d=()=>{s.isLoadingMore||s.isLoading||!s.hasMore||D("load-more")};return ye(()=>{U=new IntersectionObserver(n=>{if(s.hasMore){for(const y of n)if(y.isIntersecting){d();break}}},{rootMargin:"128px 0px"})}),le(()=>l.value,n=>{U?.disconnect(),n&&s.hasMore&&U?.observe(n)},{immediate:!0}),le(()=>s.hasMore,n=>{U&&(U.disconnect(),n&&l.value&&U.observe(l.value))}),Me(()=>{U?.disconnect(),U=null}),(n,y)=>{const c=Xa,v=Be,x=ze,I=Ke,R=Ge,F=Ne,M=Re,G=Oe,A=He;return u(),T(H,null,[N("div",Ja,[N("div",Wa,[e(c,{table:i(r)},null,8,["table"])])]),N("div",Ya,[e(A,{class:"h-[calc(100vh-262px)]"},{default:t(()=>[e(M,{class:"bg-white relative"},{default:t(()=>[e(I,{class:"bg-gray-50 sticky top-0 z-50"},{default:t(()=>[(u(!0),T(H,null,W(i(r).getHeaderGroups(),P=>(u(),C(x,{key:P.id},{default:t(()=>[(u(!0),T(H,null,W(P.headers,$=>(u(),C(v,{key:$.id,class:ee($.column.columnDef.meta?.headerClass)},{default:t(()=>[$.isPlaceholder?V("",!0):(u(),C(i(fe),{key:0,render:$.column.columnDef.header,props:$.getContext()},null,8,["render","props"]))]),_:2},1032,["class"]))),128))]),_:2},1024))),128))]),_:1}),e(F,null,{default:t(()=>[s.isLoading&&!s.data.length?(u(),C(x,{key:0},{default:t(()=>[e(R,{colspan:s.columns.length,class:"text-left"},{default:t(()=>y[0]||(y[0]=[w(" Загрузка... ",-1)])),_:1,__:[0]},8,["colspan"])]),_:1})):i(r).getRowModel().rows?.length?(u(),T(H,{key:1},[(u(!0),T(H,null,W(i(r).getRowModel().rows,P=>(u(),C(x,{key:P.id,class:ee(["cursor-pointer hover:bg-slate-300/50",["Отправлена","Вручена"].includes(P.original.status)?"bg-green-500/30 hover:bg-green-500/20":"",h.value===P.original.id?"bg-slate-400/70 hover:bg-slate-400/50":"",P.original.reservation===!0?"bg-yellow-500/30 hover:bg-yellow-500/20":"",P.original.price!==P.original.dealers.reduce(($,E)=>$+E.price,0)?"bg-red-400/60 hover:bg-red-400/50":""]),"data-state":P.getIsSelected()?"selected":void 0,onClick:$=>f(P.original.id)},{default:t(()=>[(u(!0),T(H,null,W(P.getVisibleCells(),$=>(u(),C(R,{key:$.id,class:ee($.column.columnDef.meta?.cellClass)},{default:t(()=>[e(i(fe),{render:$.column.columnDef.cell,props:$.getContext()},null,8,["render","props"])]),_:2},1032,["class"]))),128))]),_:2},1032,["class","data-state","onClick"]))),128)),s.isLoadingMore?(u(),C(x,{key:0},{default:t(()=>[e(R,{colspan:s.columns.length,class:"text-center"},{default:t(()=>y[1]||(y[1]=[w(" Догружаем... ",-1)])),_:1,__:[1]},8,["colspan"])]),_:1})):s.hasMore?(u(),C(x,{key:1},{default:t(()=>[e(R,{colspan:s.columns.length,class:"p-0"},{default:t(()=>[N("div",{ref_key:"loadMoreRef",ref:l,class:"h-6","aria-hidden":"true"},null,512)]),_:1},8,["colspan"])]),_:1})):V("",!0)],64)):(u(),C(x,{key:2},{default:t(()=>[e(R,{colspan:n.columns.length,class:"text-left"},{default:t(()=>y[2]||(y[2]=[w(" Нет результатов. ",-1)])),_:1,__:[2]},8,["colspan"])]),_:1}))]),_:1})]),_:1}),e(G,{orientation:"horizontal"})]),_:1})])],64)}}}),ae={headerClass:"hidden p-0 m-0 w-0 min-w-0 max-w-0 overflow-hidden border-0",cellClass:"hidden p-0 m-0 w-0 min-w-0 max-w-0 overflow-hidden border-0"},tl=[{accessorKey:"title",ruName:"Название",enableHiding:!1,meta:{headerClass:"min-w-[220px] max-w-[220px] overflow-hidden",cellClass:"min-w-[220px] max-w-[220px] min-w-0 overflow-hidden"},header:()=>m("span",{class:"text-xl w-full"},"Название"),cell:({row:a})=>{const o=a.getValue("boxsize"),s=a.getValue("pages"),h=a.getValue("pageType"),_=s+" разворотов/"+o+"/"+h;return m("div",{class:"flex flex-col pl-2 items-start gap-0.5 min-w-0 w-full"},[m("span",{class:"block w-full font-semibold text-slate-800 leading-tight truncate",title:String(a.getValue("title")||"")},a.getValue("title")),m("div",{class:"flex flex-wrap gap-1 itens-center"},[m("span",{class:"text-xs text-gray-600 py-0.2 px-1 rounded-sm bg-indigo-300/30"},a.getValue("group")),m("span",{class:"text-xs text-gray-600 py-0.2 px-1 rounded-sm bg-amber-300/30"},a.getValue("courseType")||a.getValue("maketType")||_)]),m("div",{class:"text-xs text-gray-500 flex gap-1"},[m("span",{class:"bg-gray-300/50 text-slate-700 py-0.2 px-1 rounded-sm"},a.getValue("isRegular")),m("span",{class:""}," - "+a.getValue("clientType")),m("span",{class:"ml-1"},a.getValue("sphere"))]),m("span",{class:"text-xs text-gray-500"},a.getValue("city"))])}},{accessorKey:"saleDate",ruName:"Дата продажи",header:({column:a})=>m(ce,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"p-1"},()=>[m("span",{class:"text-wrap"},"Дата продажи"),m(_e,{class:" h-[24px] w-[24px]"})]),cell:({row:a})=>{const o=a.getValue("status"),s=a.original.reservation;return m("div",{class:"flex flex-col items-center whitespace-nowrap text-center"},[m("span",{class:""},ge(a.getValue("saleDate"))),m("span",{class:"text-xs text-gray-500"},"Статус: "+(s?"Бронь":o))])}},{accessorKey:"totalPrice",ruName:"Общее",header:({column:a})=>m(ce,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Общее",m(_e,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"flex flex-col items-center"},[m("span",{class:"lowercase whitespace-nowrap text-center text-slate-800 font-semibold"},se(a.getValue("totalPrice"))+"₽"),m("span",{class:"text-xs text-gray-500"},a.getValue("discont")||"Скидка - "+a.getValue("discontAmount")+"%")])},{accessorKey:"price",ruName:"Заказы",header:({column:a})=>m(ce,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Заказы",m(_e,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"lowercase whitespace-nowrap text-center text-slate-700 font-semibold"},se(a.getValue("price"))+"₽")},{accessorKey:"dopsPrice",ruName:"Допы",header:({column:a})=>m(ce,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Допы",m(_e,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"lowercase whitespace-nowrap text-center text-slate-600 font-semibold"},se(a.getValue("dopsPrice"))+"₽")},{accessorKey:"recievedPayments",ruName:"Оплачено",header:({column:a})=>m(ce,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Оплачено",m(_e,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"flex flex-col items-center"},[m("span",{class:"lowercase whitespace-nowrap text-center text-green-700"},"+"+se(a.getValue("recievedPayments"))+"₽"),m("span",{class:"text-xs text-gray-500"},a.getValue("firstPayment"))])},{accessorKey:"remainder",ruName:"Остаток",header:({column:a})=>m(ce,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Остаток",m(_e,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"lowercase whitespace-nowrap text-center text-red-700"},se(a.getValue("remainder"))+"₽")},{accessorKey:"info",ruName:"Инфо",enableHiding:!1,header:()=>m("span",{class:"text-xl w-full pl-3"},"Инфо"),cell:({row:a})=>m("div",{class:"flex flex-col pl-2"},[m("span",{class:"text-xs text-gray-600"},"Источник - "+a.getValue("source")),m("span",{class:"text-xs text-gray-600"},"Тег - "+a.getValue("adTag")),m("span",{class:"text-xs text-gray-600"},"Закрытие - "+a.getValue("clothingMethod"))])},{accessorKey:"source",ruName:"Источник",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"adTag",ruName:"Тег",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"firstPayment",ruName:"Платеж",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"})},{accessorKey:"city",ruName:"Город",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"})},{accessorKey:"clothingMethod",ruName:"Закрытие",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"})},{accessorKey:"clientType",ruName:"Клиент",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"})},{accessorKey:"sphere",ruName:"Сфера",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"})},{accessorKey:"discont",ruName:"Скидка",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"})},{accessorKey:"status",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),ruName:"Статус",filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"maketType",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),ruName:"Тип макета",filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"courseType",enableHiding:!0,meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),ruName:"Тип курса",filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"workSpaceId",enableHiding:!1,ruName:"Отдел",meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"dealers",enableHiding:!1,ruName:"Менеджеры",meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),filterFn:(a,o,s)=>a.getValue("dealers").some(_=>Object.values(s).includes(_.userId))},{accessorKey:"daysGone",enableHiding:!1,ruName:"Прошло дней",meta:ae,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"haveReviews",enableHiding:!1,ruName:"Отзывы",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"isRegular",enableHiding:!1,ruName:"тип клиента",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"group",enableHiding:!1,ruName:"Группа",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"groupId",enableHiding:!1,ruName:"Группа id",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"discontAmount",enableHiding:!1,ruName:"discontAmount",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"boxsize",enableHiding:!1,ruName:"boxsize",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"pages",enableHiding:!1,ruName:"pages",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))},{accessorKey:"pageType",enableHiding:!1,ruName:"pageType",meta:ae,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))}],al={class:""},ll=ne({__name:"DealsTable",props:{deals:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},sorting:{}},emits:["deal-clicked","load-more","sort-change"],setup(a,{emit:o}){const s=a,h=o,_=D=>{h("deal-clicked",D)},p=()=>{s.isLoadingMore||s.isLoading||h("load-more")},g=D=>{h("sort-change",D)};return(D,k)=>{const r=el;return u(),T("div",al,[e(r,{columns:i(tl),data:D.deals,"is-loading":D.isLoading,"is-loading-more":D.isLoadingMore,"has-more":D.hasMore,sorting:s.sorting,onDealClicked:_,onLoadMore:p,onSortChange:g},null,8,["columns","data","is-loading","is-loading-more","has-more","sorting"])])}}}),sl={class:"truncate"},nl=ne({__name:"DataTableFacetedFilter",props:{title:{},options:{},modelValue:{}},emits:["update:modelValue"],setup(a,{emit:o}){const s=a,h=o,_=Q(()=>s.options??[]),p=Q(()=>new Set(s.modelValue??[])),g=Q(()=>{const f=new Map;for(const l of _.value)f.set(l.value,l);return f}),D=(f,l)=>{const U=l.toLowerCase();if(!U)return f;const d=g.value;return f.filter(y=>{const c=d.get(y);return c?c.label.toLowerCase().includes(U):!0})},k=f=>{const l=new Set(p.value);l.has(f)?l.delete(f):l.add(f),h("update:modelValue",Array.from(l))},r=()=>h("update:modelValue",[]);return(f,l)=>{const U=Ye,d=Se,n=ce,y=Le,c=tt,v=lt,x=nt,I=st,R=rt,F=at,M=et,G=Fe,A=Ae;return u(),C(A,null,{default:t(()=>[e(y,{"as-child":""},{default:t(()=>[e(n,{variant:"outline",size:"sm",class:"h-8 gap-2 border-dashed"},{default:t(()=>[e(i(ot),{class:"h-4 w-4"}),w(" "+X(f.title)+" ",1),p.value.size?(u(),T(H,{key:0},[e(U,{orientation:"vertical",class:"mx-1 h-4"}),e(d,{variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:t(()=>[w(X(p.value.size),1)]),_:1})],64)):V("",!0)]),_:1})]),_:1}),e(G,{class:"w-[220px] p-0",align:"start"},{default:t(()=>[e(M,{"filter-function":D},{default:t(()=>[e(c,{placeholder:f.title},null,8,["placeholder"]),e(F,null,{default:t(()=>[e(v,null,{default:t(()=>l[0]||(l[0]=[w("Нет совпадений.",-1)])),_:1,__:[0]}),e(I,null,{default:t(()=>[(u(!0),T(H,null,W(_.value,P=>(u(),C(x,{key:P.value,value:P.value,onSelect:()=>k(P.value)},{default:t(()=>[N("div",{class:ee(["mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",p.value.has(P.value)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"])},[e(i(it),{class:"h-4 w-4"})],2),N("span",sl,X(P.label),1)]),_:2},1032,["value","onSelect"]))),128))]),_:1}),p.value.size?(u(),C(R,{key:0})):V("",!0),p.value.size?(u(),C(I,{key:1},{default:t(()=>[e(x,{value:"__clear__",class:"justify-center",onSelect:r},{default:t(()=>[l[1]||(l[1]=w(" Очистить ",-1)),e(i(ut),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}}),ol={class:""},rl={key:0,class:"flex items-center justify-end mb-2"},il=ne({__name:"DataTable",props:{columns:{},data:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},emptyText:{},footerTotal:{},selectedDopId:{},managerOptions:{},selectedManagerIds:{}},emits:["load-more","dop-clicked","manager-filter-change"],setup(a,{emit:o}){const s=a,h=o,_=Ee({get data(){return s.data},get columns(){return s.columns},getCoreRowModel:je()});Q(()=>s.columns.length>1?s.columns.length-1:1);const p=Q(()=>{if(s.footerTotal===void 0||s.footerTotal===null)return"";const d=Number.isFinite(s.footerTotal)?Number(s.footerTotal):0;return typeof se=="function"?`${se(d)}₽`:`${d.toLocaleString("ru-RU")}₽`}),g=Q(()=>s.managerOptions??[]),D=Q(()=>s.selectedManagerIds??[]),k=d=>{h("dop-clicked",d.original)},r=d=>{h("manager-filter-change",d)},f=q(null);let l=null;const U=()=>{s.isLoadingMore||s.isLoading||!s.hasMore||h("load-more")};return ye(()=>{l=new IntersectionObserver(d=>{if(s.hasMore){for(const n of d)if(n.isIntersecting){U();break}}},{rootMargin:"128px 0px"}),le(()=>f.value,d=>{l?.disconnect(),d&&s.hasMore&&l?.observe(d)},{immediate:!0})}),le(()=>s.hasMore,d=>{l&&(l.disconnect(),d&&f.value&&l.observe(f.value))}),Me(()=>{l?.disconnect(),l=null}),(d,n)=>{const y=nl,c=Be,v=ze,x=Ke,I=Ge,R=Ne,F=dt,M=Re,G=Oe,A=He;return u(),T("div",ol,[g.value.length?(u(),T("div",rl,[e(y,{title:"Менеджеры",options:g.value,"model-value":D.value,"onUpdate:modelValue":r},null,8,["options","model-value"])])):V("",!0),e(A,{class:"h-[calc(100vh-265px)]"},{default:t(()=>[e(M,{class:"bg-white"},{default:t(()=>[e(x,{class:"bg-gray-50 sticky top-0 z-50"},{default:t(()=>[(u(!0),T(H,null,W(i(_).getHeaderGroups(),P=>(u(),C(v,{key:P.id},{default:t(()=>[(u(!0),T(H,null,W(P.headers,$=>(u(),C(c,{key:$.id},{default:t(()=>[$.isPlaceholder?V("",!0):(u(),C(i(fe),{key:0,render:$.column.columnDef.header,props:$.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),e(R,null,{default:t(()=>[s.isLoading&&!s.data.length?(u(),C(v,{key:0},{default:t(()=>[e(I,{colspan:s.columns.length,class:"text-left"},{default:t(()=>n[0]||(n[0]=[w(" Загрузка... ",-1)])),_:1,__:[0]},8,["colspan"])]),_:1})):i(_).getRowModel().rows?.length?(u(),T(H,{key:1},[(u(!0),T(H,null,W(i(_).getRowModel().rows,P=>(u(),C(v,{key:P.id,class:ee(["cursor-pointer hover:bg-slate-300/50",P.original.reservation===!0?"bg-yellow-500/30 hover:bg-yellow-500/20":"","cursor-pointer hover:bg-slate-300/50 transition-colors",s.selectedDopId===P.original?.id?"bg-slate-400/70 hover:bg-slate-400/60":""]),onClick:$=>k(P)},{default:t(()=>[(u(!0),T(H,null,W(P.getVisibleCells(),$=>(u(),C(I,{key:$.id},{default:t(()=>[e(i(fe),{render:$.column.columnDef.cell,props:$.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["class","onClick"]))),128)),s.isLoadingMore?(u(),C(v,{key:0},{default:t(()=>[e(I,{colspan:s.columns.length,class:"text-center"},{default:t(()=>n[1]||(n[1]=[w(" Догружаем... ",-1)])),_:1,__:[1]},8,["colspan"])]),_:1})):s.hasMore?(u(),C(v,{key:1},{default:t(()=>[e(I,{colspan:s.columns.length,class:"p-0"},{default:t(()=>[N("div",{ref_key:"loadMoreRef",ref:f,class:"h-6","aria-hidden":"true"},null,512)]),_:1},8,["colspan"])]),_:1})):V("",!0)],64)):(u(),C(v,{key:2},{default:t(()=>[e(I,{colspan:s.columns.length,class:"text-left"},{default:t(()=>[w(X(s.emptyText||"Нет допов за выбранный период."),1)]),_:1},8,["colspan"])]),_:1}))]),_:1}),s.footerTotal!==void 0&&s.footerTotal!==null?(u(),C(F,{key:0,class:"bg-gray-100 sticky bottom-0 z-40"},{default:t(()=>[e(v,null,{default:t(()=>[e(I,{colspan:3,class:"text-left font-semibold text-slate-700"},{default:t(()=>[s.columns.length>1?(u(),T(H,{key:0},[w("Итого(без брони)")],64)):(u(),T(H,{key:1},[w("Итого: "+X(p.value),1)],64))]),_:1}),s.columns.length>1?(u(),C(I,{key:0,colspan:2,class:"text-center font-bold text-green-600 text-xl whitespace-nowrap"},{default:t(()=>[w(X(p.value),1)]),_:1})):V("",!0)]),_:1})]),_:1})):V("",!0)]),_:1}),e(G,{orientation:"horizontal"})]),_:1})])}}}),ul={headerClass:"hidden p-0 m-0 w-0 min-w-0 max-w-0 overflow-hidden border-0",cellClass:"hidden p-0 m-0 w-0 min-w-0 max-w-0 overflow-hidden border-0"},dl=[{accessorKey:"dealTitle",header:()=>m("span",{class:"w-full text-center"},"Название"),cell:({row:a})=>{const o=a.getValue("dealTitle"),s=a.original.dealSaleDate||a.original.saleDate,h=a.getValue("type");return m("div",{class:"flex flex-col pl-2 items-start gap-1 min-w-0"},[m("span",{class:"flex flex-col w-full font-semibold text-slate-800 leading-tight truncate",title:o},[o,s?m("span",{class:"text-xs text-gray-500 ml-1 whitespace-nowrap"},`от ${ge(s)}`):null]),h?m("span",{class:"text-xs text-gray-600 py-0.5 px-1 rounded-sm bg-indigo-300/30 max-w-full truncate",title:h},h):null])}},{accessorKey:"saleDate",header:()=>m("div",{class:"w-full text-center"},"Дата продажи"),cell:({row:a})=>m("div",{class:"whitespace-nowrap text-center text-sm text-slate-700"},[m("span",null,ge(a.getValue("saleDate")))])},{accessorKey:"userFullName",header:()=>m("div",{class:"w-full text-center"},"Менеджер"),cell:({row:a})=>m("div",{class:"whitespace-nowrap text-center text-sm text-slate-700"},[m("span",null,a.getValue("userFullName"))])},{accessorKey:"price",header:()=>m("div",{class:"w-full text-center"},"Стоимость"),cell:({row:a})=>m("div",{class:"lowercase whitespace-nowrap text-center text-slate-700 font-semibold"},`${se(a.getValue("price"))}₽`)},{accessorKey:"type",enableHiding:!1,meta:ul,header:()=>m("div",{class:"hidden p-10"}),cell:()=>m("div",{class:"hidden p-10"}),filterFn:(a,o,s)=>s.includes(a.getValue(o))}],cl={class:"mt-4 space-y-2"},ml={key:0,class:"text-sm text-red-500"},pl=ne({__name:"DopsTable",props:{dops:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},totalPrice:{},selectedDopId:{},managerOptions:{},selectedManagerIds:{},error:{}},emits:["load-more","dop-clicked","manager-filter-change"],setup(a,{emit:o}){const s=o,h=()=>{s("load-more")},_=g=>{s("dop-clicked",g)},p=g=>{s("manager-filter-change",g)};return(g,D)=>{const k=il;return u(),T("div",cl,[g.error?(u(),T("p",ml,X(g.error),1)):V("",!0),e(k,{columns:i(dl),data:g.dops,"is-loading":g.isLoading,"is-loading-more":g.isLoadingMore,"has-more":g.hasMore,"footer-total":g.totalPrice,"selected-dop-id":g.selectedDopId,"manager-options":g.managerOptions,"selected-manager-ids":g.selectedManagerIds,"empty-text":"Нет допов за выбранный период.",onLoadMore:h,onDopClicked:_,onManagerFilterChange:p},null,8,["columns","data","is-loading","is-loading-more","has-more","footer-total","selected-dop-id","manager-options","selected-manager-ids"])])}}}),fl={class:"truncate"},gl=ne({__name:"DataTableFacetedFilter",props:{title:{},options:{},modelValue:{}},emits:["update:modelValue"],setup(a,{emit:o}){const s=a,h=o,_=Q(()=>s.options??[]),p=Q(()=>new Set(s.modelValue??[])),g=Q(()=>{const f=new Map;for(const l of _.value)f.set(l.value,l);return f}),D=(f,l)=>{const U=l.toLowerCase();if(!U)return f;const d=g.value;return f.filter(y=>{const c=d.get(y);return c?c.label.toLowerCase().includes(U):!0})},k=f=>{const l=new Set(p.value);l.has(f)?l.delete(f):l.add(f),h("update:modelValue",Array.from(l))},r=()=>h("update:modelValue",[]);return(f,l)=>{const U=Ye,d=Se,n=ce,y=Le,c=tt,v=lt,x=nt,I=st,R=rt,F=at,M=et,G=Fe,A=Ae;return u(),C(A,null,{default:t(()=>[e(y,{"as-child":""},{default:t(()=>[e(n,{variant:"outline",size:"sm",class:"h-8 gap-2 border-dashed"},{default:t(()=>[e(i(ot),{class:"h-4 w-4"}),w(" "+X(f.title)+" ",1),p.value.size?(u(),T(H,{key:0},[e(U,{orientation:"vertical",class:"mx-1 h-4"}),e(d,{variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:t(()=>[w(X(p.value.size),1)]),_:1})],64)):V("",!0)]),_:1})]),_:1}),e(G,{class:"w-[220px] p-0",align:"start"},{default:t(()=>[e(M,{"filter-function":D},{default:t(()=>[e(c,{placeholder:f.title},null,8,["placeholder"]),e(F,null,{default:t(()=>[e(v,null,{default:t(()=>l[0]||(l[0]=[w("Нет совпадений.",-1)])),_:1,__:[0]}),e(I,null,{default:t(()=>[(u(!0),T(H,null,W(_.value,P=>(u(),C(x,{key:P.value,value:P.value,onSelect:()=>k(P.value)},{default:t(()=>[N("div",{class:ee(["mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",p.value.has(P.value)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"])},[e(i(it),{class:"h-4 w-4"})],2),N("span",fl,X(P.label),1)]),_:2},1032,["value","onSelect"]))),128))]),_:1}),p.value.size?(u(),C(R,{key:0})):V("",!0),p.value.size?(u(),C(I,{key:1},{default:t(()=>[e(x,{value:"__clear__",class:"justify-center",onSelect:r},{default:t(()=>[l[1]||(l[1]=w(" Очистить ",-1)),e(i(ut),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}}),vl={key:0,class:"flex items-center justify-end mb-2"},_l=ne({__name:"DataTable",props:{columns:{},data:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},emptyText:{},footerTotal:{},selectedPaymentId:{},managerOptions:{},selectedManagerIds:{}},emits:["load-more","payment-clicked","manager-filter-change"],setup(a,{emit:o}){const s=a,h=o,_=Ee({get data(){return s.data},get columns(){return s.columns},getCoreRowModel:je()});Q(()=>s.columns.length>1?s.columns.length-1:1);const p=Q(()=>{if(s.footerTotal===void 0||s.footerTotal===null)return"";const d=Number.isFinite(s.footerTotal)?Number(s.footerTotal):0;return typeof se=="function"?`${se(d)}₽`:`${d.toLocaleString("ru-RU")}₽`}),g=Q(()=>s.managerOptions??[]),D=Q(()=>s.selectedManagerIds??[]),k=d=>{h("payment-clicked",d.original)},r=d=>{h("manager-filter-change",d)},f=q(null);let l=null;const U=()=>{s.isLoadingMore||s.isLoading||!s.hasMore||h("load-more")};return ye(()=>{l=new IntersectionObserver(d=>{if(s.hasMore){for(const n of d)if(n.isIntersecting){U();break}}},{rootMargin:"128px 0px"}),le(()=>f.value,d=>{l?.disconnect(),d&&s.hasMore&&l?.observe(d)},{immediate:!0})}),le(()=>s.hasMore,d=>{l&&(l.disconnect(),d&&f.value&&l.observe(f.value))}),Me(()=>{l?.disconnect(),l=null}),(d,n)=>{const y=gl,c=Be,v=ze,x=Ke,I=Ge,R=Ne,F=dt,M=Re,G=Oe,A=He;return u(),T("div",null,[g.value.length?(u(),T("div",vl,[e(y,{title:"Менеджеры",options:g.value,"model-value":D.value,"onUpdate:modelValue":r},null,8,["options","model-value"])])):V("",!0),e(A,{class:"h-[calc(100vh-265px)]"},{default:t(()=>[e(M,{class:"bg-white"},{default:t(()=>[e(x,{class:"bg-gray-50 sticky top-0 z-50"},{default:t(()=>[(u(!0),T(H,null,W(i(_).getHeaderGroups(),P=>(u(),C(v,{key:P.id},{default:t(()=>[(u(!0),T(H,null,W(P.headers,$=>(u(),C(c,{key:$.id},{default:t(()=>[$.isPlaceholder?V("",!0):(u(),C(i(fe),{key:0,render:$.column.columnDef.header,props:$.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),e(R,null,{default:t(()=>[s.isLoading&&!s.data.length?(u(),C(v,{key:0},{default:t(()=>[e(I,{colspan:s.columns.length,class:"text-left"},{default:t(()=>n[0]||(n[0]=[w(" Загрузка... ",-1)])),_:1,__:[0]},8,["colspan"])]),_:1})):i(_).getRowModel().rows?.length?(u(),T(H,{key:1},[(u(!0),T(H,null,W(i(_).getRowModel().rows,P=>(u(),C(v,{key:P.id,class:ee(["cursor-pointer hover:bg-slate-300/50 transition-colors",s.selectedPaymentId===P.original?.id?"bg-slate-400/70 hover:bg-slate-400/60":""]),onClick:$=>k(P)},{default:t(()=>[(u(!0),T(H,null,W(P.getVisibleCells(),$=>(u(),C(I,{key:$.id},{default:t(()=>[e(i(fe),{render:$.column.columnDef.cell,props:$.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["class","onClick"]))),128)),s.isLoadingMore?(u(),C(v,{key:0},{default:t(()=>[e(I,{colspan:s.columns.length,class:"text-center"},{default:t(()=>n[1]||(n[1]=[w(" Догружаем... ",-1)])),_:1,__:[1]},8,["colspan"])]),_:1})):s.hasMore?(u(),C(v,{key:1},{default:t(()=>[e(I,{colspan:s.columns.length,class:"p-0"},{default:t(()=>[N("div",{ref_key:"loadMoreRef",ref:f,class:"h-6","aria-hidden":"true"},null,512)]),_:1},8,["colspan"])]),_:1})):V("",!0)],64)):(u(),C(v,{key:2},{default:t(()=>[e(I,{colspan:s.columns.length,class:"text-left"},{default:t(()=>[w(X(s.emptyText||"Нет платежей за выбранный период."),1)]),_:1},8,["colspan"])]),_:1}))]),_:1}),s.footerTotal!==void 0&&s.footerTotal!==null?(u(),C(F,{key:0,class:"bg-gray-100 sticky bottom-0 z-40"},{default:t(()=>[e(v,null,{default:t(()=>[e(I,{colspan:4,class:"text-left font-semibold text-slate-700"},{default:t(()=>[s.columns.length>1?(u(),T(H,{key:0},[w("Итого")],64)):(u(),T(H,{key:1},[w("Итого: "+X(p.value),1)],64))]),_:1}),s.columns.length>1?(u(),C(I,{key:0,colspan:2,class:"text-center font-bold text-green-600 text-xl whitespace-nowrap"},{default:t(()=>[w(X(p.value),1)]),_:1})):V("",!0)]),_:1})]),_:1})):V("",!0)]),_:1}),e(G,{orientation:"horizontal"})]),_:1})])}}}),yl="inline-flex items-center justify-center px-2 py-0.5 rounded-sm bg-indigo-300/30 text-xs text-slate-700 whitespace-nowrap max-w-full truncate",hl=[{accessorKey:"dealTitle",header:()=>m("span",{class:"w-full text-center"},"Сделка"),cell:({row:a})=>{const o=a.getValue("dealTitle"),s=a.original.dealSaleDate;return m("div",{class:"flex flex-col pl-2 items-start gap-1 min-w-0"},[m("span",{class:"flex flex-col w-full font-semibold text-slate-800 leading-tight truncate",title:o},[o,s?m("span",{class:"text-xs text-gray-500 ml-1 whitespace-nowrap"},`от ${ge(s)}`):null])])}},{accessorKey:"date",header:()=>m("div",{class:"w-full text-center"},"Дата оплаты"),cell:({row:a})=>m("div",{class:"whitespace-nowrap text-center text-sm text-slate-700"},[m("span",null,ge(a.getValue("date")))])},{accessorKey:"method",header:()=>m("div",{class:"w-full text-center"},"Способ оплаты"),cell:({row:a})=>m("div",{class:"flex items-center justify-center"},[m("span",{class:yl,title:a.getValue("method")},a.getValue("method"))])},{accessorKey:"userFullName",header:()=>m("div",{class:"w-full text-center"},"Менеджер"),cell:({row:a})=>m("div",{class:"whitespace-nowrap text-center text-sm text-slate-700"},[m("span",null,a.getValue("userFullName"))])},{accessorKey:"price",header:()=>m("div",{class:"w-full text-center"},"Сумма"),cell:({row:a})=>m("div",{class:"lowercase whitespace-nowrap text-center text-slate-700 font-semibold"},`${se(a.getValue("price"))}₽`)}],bl={class:"mt-4 space-y-2"},xl={key:0,class:"text-sm text-red-500"},wl=ne({__name:"PaymentsTable",props:{payments:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},totalPrice:{},selectedPaymentId:{},managerOptions:{},selectedManagerIds:{},error:{}},emits:["load-more","payment-clicked","manager-filter-change"],setup(a,{emit:o}){const s=o,h=()=>{s("load-more")},_=g=>{s("payment-clicked",g)},p=g=>{s("manager-filter-change",g)};return(g,D)=>{const k=_l;return u(),T("div",bl,[g.error?(u(),T("p",xl,X(g.error),1)):V("",!0),e(k,{columns:i(hl),data:g.payments,"is-loading":g.isLoading,"is-loading-more":g.isLoadingMore,"has-more":g.hasMore,"footer-total":g.totalPrice,"selected-payment-id":g.selectedPaymentId,"manager-options":g.managerOptions,"selected-manager-ids":g.selectedManagerIds,"empty-text":"Нет платежей за выбранный период.",onLoadMore:h,onPaymentClicked:_,onManagerFilterChange:p},null,8,["columns","data","is-loading","is-loading-more","has-more","footer-total","selected-payment-id","manager-options","selected-manager-ids"])])}}}),kl=ne({__name:"DataTable",props:{columns:{},data:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},emptyText:{},footerTotal:{},selectedDeliveryId:{}},emits:["load-more","delivery-clicked"],setup(a,{emit:o}){const s=a,h=o,_=Ee({get data(){return s.data},get columns(){return s.columns},getCoreRowModel:je()}),p=Q(()=>s.columns.length>1?s.columns.length-1:1),g=Q(()=>{if(s.footerTotal===void 0||s.footerTotal===null)return"";const l=Number.isFinite(s.footerTotal)?Number(s.footerTotal):0;return typeof se=="function"?`${se(l)}₽`:`${l.toLocaleString("ru-RU")}₽`}),D=l=>{h("delivery-clicked",l.original)},k=q(null);let r=null;const f=()=>{s.isLoadingMore||s.isLoading||!s.hasMore||h("load-more")};return ye(()=>{r=new IntersectionObserver(l=>{if(s.hasMore){for(const U of l)if(U.isIntersecting){f();break}}},{rootMargin:"128px 0px"}),le(()=>k.value,l=>{r?.disconnect(),l&&s.hasMore&&r?.observe(l)},{immediate:!0})}),le(()=>s.hasMore,l=>{r&&(r.disconnect(),l&&k.value&&r.observe(k.value))}),Me(()=>{r?.disconnect(),r=null}),(l,U)=>{const d=Be,n=ze,y=Ke,c=Ge,v=Ne,x=dt,I=Re,R=Oe,F=He;return u(),T("div",null,[e(F,{class:"h-[calc(100vh-265px)]"},{default:t(()=>[e(I,{class:"bg-white"},{default:t(()=>[e(y,{class:"bg-gray-50 sticky top-0 z-50"},{default:t(()=>[(u(!0),T(H,null,W(i(_).getHeaderGroups(),M=>(u(),C(n,{key:M.id},{default:t(()=>[(u(!0),T(H,null,W(M.headers,G=>(u(),C(d,{key:G.id},{default:t(()=>[G.isPlaceholder?V("",!0):(u(),C(i(fe),{key:0,render:G.column.columnDef.header,props:G.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),e(v,null,{default:t(()=>[s.isLoading&&!s.data.length?(u(),C(n,{key:0},{default:t(()=>[e(c,{colspan:s.columns.length,class:"text-left"},{default:t(()=>U[0]||(U[0]=[w(" Загрузка... ",-1)])),_:1,__:[0]},8,["colspan"])]),_:1})):i(_).getRowModel().rows?.length?(u(),T(H,{key:1},[(u(!0),T(H,null,W(i(_).getRowModel().rows,M=>(u(),C(n,{key:M.id,class:ee(["cursor-pointer hover:bg-slate-300/50 transition-colors",s.selectedDeliveryId===M.original?.id?"bg-slate-400/70 hover:bg-slate-400/60":""]),onClick:G=>D(M)},{default:t(()=>[(u(!0),T(H,null,W(M.getVisibleCells(),G=>(u(),C(c,{key:G.id},{default:t(()=>[e(i(fe),{render:G.column.columnDef.cell,props:G.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["class","onClick"]))),128)),s.isLoadingMore?(u(),C(n,{key:0},{default:t(()=>[e(c,{colspan:s.columns.length,class:"text-center"},{default:t(()=>U[1]||(U[1]=[w(" Догружаем... ",-1)])),_:1,__:[1]},8,["colspan"])]),_:1})):s.hasMore?(u(),C(n,{key:1},{default:t(()=>[e(c,{colspan:s.columns.length,class:"p-0"},{default:t(()=>[N("div",{ref_key:"loadMoreRef",ref:k,class:"h-6","aria-hidden":"true"},null,512)]),_:1},8,["colspan"])]),_:1})):V("",!0)],64)):(u(),C(n,{key:2},{default:t(()=>[e(c,{colspan:s.columns.length,class:"text-left"},{default:t(()=>[w(X(s.emptyText||"Нет доставок за выбранный период."),1)]),_:1},8,["colspan"])]),_:1}))]),_:1}),s.footerTotal!==void 0&&s.footerTotal!==null?(u(),C(x,{key:0,class:"bg-gray-100 sticky bottom-0 z-40"},{default:t(()=>[e(n,null,{default:t(()=>[e(c,{colspan:p.value,class:"text-left font-semibold text-slate-700"},{default:t(()=>[s.columns.length>1?(u(),T(H,{key:0},[w("Итого")],64)):(u(),T(H,{key:1},[w("Итого: "+X(g.value),1)],64))]),_:1},8,["colspan"]),s.columns.length>1?(u(),C(c,{key:0,colspan:s.columns.length-p.value,class:"text-center font-bold text-green-600 text-xl whitespace-nowrap"},{default:t(()=>[w(X(g.value),1)]),_:1},8,["colspan"])):V("",!0)]),_:1})]),_:1})):V("",!0)]),_:1}),e(R,{orientation:"horizontal"})]),_:1})])}}}),ft="inline-flex items-center justify-center px-2 py-0.5 rounded-sm bg-indigo-300/30 text-xs text-slate-700 whitespace-nowrap max-w-full truncate",Cl=[{accessorKey:"dealTitle",header:()=>m("span",{class:"w-full text-center"},"Сделка"),cell:({row:a})=>{const o=a.getValue("dealTitle"),s=a.original.dealSaleDate;return m("div",{class:"flex flex-col pl-2 items-start gap-1 min-w-0"},[m("span",{class:"flex flex-col w-full font-semibold text-slate-800 leading-tight truncate",title:o},[o,s?m("span",{class:"text-xs text-gray-500 ml-1 whitespace-nowrap"},`от ${ge(s)}`):null])])}},{accessorKey:"date",header:()=>m("div",{class:"w-full text-center"},"Дата отправки"),cell:({row:a})=>m("div",{class:"whitespace-nowrap text-center text-sm text-slate-700"},[m("span",null,ge(a.getValue("date")))])},{accessorKey:"method",header:()=>m("div",{class:"w-full text-center"},"Способ доставки"),cell:({row:a})=>m("div",{class:"flex items-center justify-center"},[m("span",{class:ft,title:a.getValue("method")},a.getValue("method"))])},{accessorKey:"status",header:()=>m("div",{class:"w-full text-center"},"Статус"),cell:({row:a})=>m("div",{class:"flex items-center justify-center"},[m("span",{class:ft,title:a.getValue("status")},a.getValue("status"))])},{accessorKey:"price",header:()=>m("div",{class:"w-full text-center"},"Сумма"),cell:({row:a})=>m("div",{class:"lowercase whitespace-nowrap text-center text-slate-700 font-semibold"},`${se(a.getValue("price"))}₽`)}],Ml={class:"mt-4 space-y-2"},Il={key:0,class:"text-sm text-red-500"},Dl=ne({__name:"DeliveriesTable",props:{deliveries:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},totalPrice:{},selectedDeliveryId:{},error:{}},emits:["load-more","delivery-clicked"],setup(a,{emit:o}){const s=o,h=()=>{s("load-more")},_=p=>{s("delivery-clicked",p)};return(p,g)=>{const D=kl;return u(),T("div",Ml,[p.error?(u(),T("p",Il,X(p.error),1)):V("",!0),e(D,{columns:i(Cl),data:p.deliveries,"is-loading":p.isLoading,"is-loading-more":p.isLoadingMore,"has-more":p.hasMore,"footer-total":p.totalPrice,"selected-delivery-id":p.selectedDeliveryId,"empty-text":"Нет доставок за выбранный период.",onLoadMore:h,onDeliveryClicked:_},null,8,["columns","data","is-loading","is-loading-more","has-more","footer-total","selected-delivery-id"])])}}}),Tl=50,Ul=100,Vl="saleDate",Pl="desc",$l=new Set(["saleDate","totalPrice","price","dopsPrice","recievedPayments","remainder"]),Sl=a=>a&&$l.has(a)?a:null,be=a=>typeof a!="number"||!Number.isFinite(a)||a<1?1:Math.floor(a),pe=a=>{if(typeof a!="number"||!Number.isFinite(a))return Tl;const o=Math.max(1,Math.floor(a));return Math.min(o,Ul)},gt=a=>Array.isArray(a)?a.filter(o=>!!(o&&typeof o.id=="number")):[];function Ll(){const{$useApi:a}=ve(),{groups:o,fetchGroups:s,selectedGroupId:h,deals:_,getDeals:p,getDeal:g,isDealsLoading:D,isDealsLoadingMore:k,dealsMeta:r}=_t(),{filtersQuery:f}=he(),l=q(null),U=q([{title:"Общая сумма заказов(₽)",value:"0"},{title:"Стоимость вывесок (₽)",value:"0"},{title:"Допы(%)",value:"0"},{title:"Оплачено(%)",value:"0"},{title:"Остаток(%)",value:"0"}]),d=q("group"),n=q(""),y=q(!1),c=q(!1),v=q(null),x=q(Vl),I=q(Pl),R=Q(()=>[{id:x.value,desc:I.value==="desc"}]),F=L=>{const K={...L??{}};return Object.entries(f.value).forEach(([j,Y])=>{K[j]=Y}),Object.keys(K).length?K:void 0},M=Q(()=>{const L=be(r.value.page),K=pe(r.value.limit),j=Math.max(0,r.value.totalCount||0);return L*K<j}),G=Q(()=>d.value==="group"?D.value:y.value),A=Q(()=>d.value==="group"?k.value:c.value),P=(L,K)=>L.meta&&typeof L.meta.totalCount=="number"?Math.max(0,L.meta.totalCount):typeof L.total=="number"?Math.max(0,L.total):K,$=()=>{U.value=[{title:"Общая сумма заказов(₽)",value:"0"},{title:"Стоимость вывесок (₽)",value:"0"},{title:"Допы(%)",value:"0"},{title:"Оплачено(%)",value:"0"},{title:"Остаток(%)",value:"0"}]},E=(L,K)=>{r.value={page:be(L?.page??K.page),limit:pe(L?.limit??K.limit),totalCount:Math.max(0,L?.totalCount??K.totalCount)}},oe=async(L=!0,K)=>{if(!h.value)return _.value=[],l.value=null,E(void 0,{page:1,limit:pe(r.value.limit),totalCount:0}),$(),null;d.value="group",n.value="",K!==void 0&&(v.value=K??null);try{const j=await p({params:F(v.value?{...v.value}:void 0),page:1,limit:pe(r.value.limit),append:!1,sortBy:x.value,sortOrder:I.value}),Y=j?.deals||[],re=P(j??{},Y.length);if(Y.length){j?.totalInfo&&Z(j.totalInfo,re);const[te]=Y,ue=Y.some(me=>me.id===l.value?.id);L&&!ue?(l.value=te,te?.id&&await z(te.id)):!l.value&&te&&(l.value=te,te?.id&&await z(te.id))}else l.value=null,$();return j??null}catch(j){return console.error("Failed to refresh deals",j),l.value=null,$(),null}},z=async L=>{if(!L){l.value=null;return}try{const K=await g(L);K?l.value=K:l.value=null}catch(K){console.error("Failed to load deal",K),l.value=null}},b=async L=>{const K=L.trim();if(n.value=K,K.length<=2){if(d.value==="search"){const Y=await oe(!0,v.value);Y?.deals?.length&&await z(Y.deals[0].id)}return}d.value="search";const j=pe(r.value.limit);E(void 0,{page:1,limit:j,totalCount:r.value.totalCount||0}),y.value=!0;try{const{data:Y}=await a.get("/deals/search",{params:{name:K,page:1,limit:j,sortBy:x.value,sortOrder:I.value,...f.value},paramsSerializer:{serialize:pt}}),re=Y??{},te=gt(re.deals);if(_.value=te,E(re.meta,{page:1,limit:j,totalCount:P(re,te.length)}),te.length){re.totalInfo&&Z(re.totalInfo,r.value.totalCount);const ue=te[0]?.id;typeof ue=="number"&&ue!==l.value?.id?(l.value=te[0],await z(ue)):l.value||(l.value=te[0]??null)}else l.value=null,$();return re}catch(Y){return console.error("Failed to search deals",Y),_.value=[],l.value=null,E(void 0,{page:1,limit:j,totalCount:0}),$(),null}finally{y.value=!1}},O=async()=>{if(n.value.length<=2||!M.value)return null;const L=be(r.value.page)+1,K=pe(r.value.limit);c.value=!0;try{const{data:j}=await a.get("/deals/search",{params:{name:n.value,page:L,limit:K,sortBy:x.value,sortOrder:I.value,...f.value},paramsSerializer:{serialize:pt}}),Y=j??{},re=gt(Y.deals);if(re.length){const te=new Set(_.value.map(me=>me.id)),ue=re.filter(me=>!te.has(me.id));_.value=[..._.value,...ue]}return E(Y.meta,{page:L,limit:K,totalCount:Math.max(r.value.totalCount,P(Y,_.value.length))}),Y.totalInfo&&Z(Y.totalInfo,r.value.totalCount),Y}catch(j){return console.error("Failed to load more search deals",j),null}finally{c.value=!1}},S=async()=>{if(!M.value)return null;if(d.value==="search")return await O();if(!h.value)return null;const L=be(r.value.page)+1,K=pe(r.value.limit);try{const j=await p({params:F(v.value?{...v.value}:void 0),page:L,limit:K,append:!0,sortBy:x.value,sortOrder:I.value});return j?.totalInfo&&Z(j.totalInfo,j.meta?.totalCount??r.value.totalCount),j??null}catch(j){return console.error("Failed to load more deals",j),null}};le(()=>f.value,async()=>{if(d.value==="search"&&n.value.length>2){await b(n.value);return}await oe(!0,v.value)},{deep:!0});const B=async(L,K)=>{const j=Sl(L);if(!j)return;const Y=K?"desc":"asc",re=j!==x.value||Y!==I.value;if(x.value=j,I.value=Y,!!re){if(r.value={page:1,limit:pe(r.value.limit),totalCount:r.value.totalCount},d.value==="search"&&n.value.length>2){await b(n.value);return}await oe(!0,v.value)}},Z=(L,K)=>{U.value=[{title:"Общая сумма заказов(₽)",value:se(L.totalPrice)+"₽"},{title:`Стоимость заказов (${K})`,value:se(L.price)+"₽"},{title:`Допы(${L.totalPrice?(L.dopsPrice/L.totalPrice*100).toFixed():0}%)`,value:se(L.dopsPrice)+"₽"},{title:`Оплачено(${L.totalPrice?(L.recievedPayments/L.totalPrice*100).toFixed():0}%)`,value:se(L.recievedPayments)+"₽"},{title:`Остаток(${L.totalPrice?(L.remainder/L.totalPrice*100).toFixed():0}%)`,value:se(L.remainder)+"₽"},{title:`Отправлены(${L.deliveredAmount})`,value:se(L.deliveredPrice)+"₽"}]};return{dealGroups:o,fetchGroups:s,selectedGroupId:h,deals:_,currentDeal:l,totalsInfo:U,dealsMeta:r,mode:d,sortBy:x,sortOrder:I,sortingState:R,isLoading:G,isLoadingMore:A,hasMore:M,refreshDeals:oe,selectDeal:z,performSearch:b,loadMore:S,applySorting:B,updateTotals:Z}}function yt(a){const o=kt({data:[],managers:[],totalPrice:0,isLoading:!1,isLoadingMore:!1,hasMore:!1,error:null,syncStatus:"idle",needsSync:!0,selectedId:null,selectedManagerIds:[]}),s=Q(()=>(o.managers||[]).map(k=>({value:k.id,label:k.fullName}))),h=async(k,r,f)=>{if(k===null)return a.resetFunction(),o.data=[],o.managers=[],o.totalPrice=0,o.selectedId=null,o.selectedManagerIds=[],o.needsSync=!1,o.syncStatus="idle",null;o.isLoading=!0,o.syncStatus="loading",o.error=null;try{const l={groupId:k,range:r?{...r}:void 0,page:1,append:!1,managerIds:f?.length?[...f]:void 0},U=await a.fetchFunction(l);if(U&&(o.data=U[a.dataKey]||[],o.managers=U[a.managersKey]||[],o.totalPrice=U[a.totalPriceKey]||0,o.hasMore=U.hasMore||!1,o.syncStatus="success",Array.isArray(U[a.managersKey])&&U[a.managersKey].length)){const d=new Set(U[a.managersKey].map(y=>y.id)),n=o.selectedManagerIds.filter(y=>d.has(y));n.length!==o.selectedManagerIds.length&&(o.selectedManagerIds=n)}return o.selectedId=null,U}catch(l){return console.error(`Failed to refresh ${a.type}`,l),o.error=`Ошибка загрузки ${a.type}`,o.syncStatus="error",null}finally{o.isLoading=!1}},_=async(k,r,f)=>{if(!(k===null||!a.loadMoreFunction)){o.isLoadingMore=!0;try{const l={groupId:k,range:r?{...r}:void 0,managerIds:f?.length?[...f]:void 0};await a.loadMoreFunction(l)}catch(l){console.error(`Failed to load more ${a.type}`,l),o.error=`Ошибка загрузки дополнительных ${a.type}`}finally{o.isLoadingMore=!1}}},p=async(k,r,f,l=!1)=>{o.selectedManagerIds=[...k],o.selectedId=null,l?(await h(r,f,k),o.needsSync=!1):o.needsSync=!0},g=async(k,r,f=!1)=>{if(k===null){a.resetFunction(),o.data=[],o.managers=[],o.totalPrice=0,o.selectedId=null,o.selectedManagerIds=[],o.needsSync=!1,o.syncStatus="idle";return}f?await h(k,r,o.selectedManagerIds)!==null&&(o.needsSync=!1):(o.needsSync=!0,o.selectedId=null)},D=()=>{a.resetFunction(),o.data=[],o.managers=[],o.totalPrice=0,o.selectedId=null,o.selectedManagerIds=[],o.needsSync=!1,o.syncStatus="idle",o.error=null};return{...Ct(o),managerOptions:s,refresh:h,loadMore:_,handleManagerFilterChange:p,ensureActual:g,reset:D}}const qe=50;function Fl(a){return!a||!a.from||!a.to?null:`${a.from}::${a.to}`}function Al(a){return a?Array.isArray(a.items)?a.items.filter(o=>!!(o&&typeof o.id=="number")):[]:[]}function Rl(){const{$useApi:a}=ve(),o=J("my-dops:list",()=>[]),s=J("my-dops:total",()=>0),h=J("my-dops:total-price",()=>0),_=J("my-dops:managers",()=>[]),p=J("my-dops:page",()=>1),g=J("my-dops:per-page",()=>qe),D=J("my-dops:has-more",()=>!0),k=J("my-dops:initial-loading",()=>!1),r=J("my-dops:loading-more",()=>!1),f=J("my-dops:error",()=>null),l=J("my-dops:last-request",()=>({groupId:null,rangeKey:null,range:null,managerIds:[]})),U=()=>{o.value=[],s.value=0,h.value=0,_.value=[],p.value=1,g.value=qe,D.value=!0,f.value=null,l.value={groupId:null,rangeKey:null,range:null,managerIds:[]}},d=async(y={})=>{const{groupId:c,range:v,page:x=1,perPage:I=g.value||qe,append:R=x>1,managerIds:F}=y,M=Array.isArray(F)?F.filter($=>typeof $=="number"):R?[...l.value.managerIds]:[],G=Fl(v),A=!R||l.value.groupId!==c||l.value.rangeKey!==G||x===1;if(A&&(o.value=[],s.value=0,p.value=1,D.value=!0),R||x>1){if(!D.value)return null;r.value=!0}else k.value=!0;if(f.value=null,!v||!v.from||!v.to)return f.value="Необходимо указать диапазон дат (from и to)",k.value=!1,r.value=!1,null;const P={page:x,take:I,from:v.from,to:v.to};c!==void 0&&(P.groupId=c),M.length&&(P.managersIds=M.join(",")),console.log(P);try{const{data:$}=await a.get("/dops/group",{params:P});let E;if(Array.isArray($)){const Z=$.filter(L=>!!(L&&typeof L.id=="number"));E={totalDopPrice:Z.reduce((L,K)=>L+(K.price||0),0),items:Z,managers:_.value.length?[..._.value]:[]}}else E=$??{totalDopPrice:0,items:[],managers:[]};Array.isArray(E.managers)&&(_.value=E.managers);const oe=Al(E),z=new Set,b=oe.filter(Z=>z.has(Z.id)?!1:(z.add(Z.id),!0));if(A||x===1)o.value=b;else if(b.length){const Z=new Set(o.value.map(K=>K.id)),L=b.filter(K=>!Z.has(K.id));L.length&&(o.value=[...o.value,...L])}s.value=o.value.length;const S=typeof E.totalDopPrice=="number"&&Number.isFinite(E.totalDopPrice)?Number(E.totalDopPrice):null;return h.value=S!==null?S:o.value.reduce((Z,L)=>Z+(L.price||0),0),D.value=b.length>=I,p.value=x,g.value=I,l.value={groupId:c,rangeKey:G,range:v&&v.from&&v.to?{from:v.from,to:v.to}:null,managerIds:[...M]},{totalDopPrice:h.value,items:o.value,managers:_.value}}catch($){throw console.error("Failed to load dops",$),R||(o.value=[]),f.value="Не удалось загрузить допы",$}finally{k.value=!1,r.value=!1}};return{dops:o,total:s,page:p,perPage:g,hasMore:D,isInitialLoading:k,isLoadingMore:r,error:f,totalPrice:h,managers:_,reset:U,fetchDops:d,loadMore:async(y={})=>{const{groupId:c,range:v,managerIds:x}=y;if(!D.value)return null;const I=c!==void 0?c:l.value.groupId,R=p.value+1,F=v??l.value.range??void 0,M=Array.isArray(x)?x:l.value.managerIds;return d({groupId:I,range:F,page:R,perPage:g.value,append:!0,managerIds:M})}}}function Kl(){const{dops:a,fetchDops:o,loadMore:s,isInitialLoading:h,isLoadingMore:_,hasMore:p,reset:g,error:D,totalPrice:k,managers:r}=Rl(),l=yt({type:"dops",fetchFunction:async y=>{const c=await o(y);return{dops:c?.dops||[],managers:c?.managers||[],totalPrice:c?.totalPrice||0,hasMore:c?.hasMore||!1}},loadMoreFunction:async y=>{await s(y)},resetFunction:g,dataKey:"dops",managersKey:"managers",totalPriceKey:"totalPrice"}),U=async(y,c)=>{y?.dealId&&(l.selectedId.value=y.id,await c(y.dealId))},d=async(y,c,v,x=!1)=>{await l.handleManagerFilterChange(y,c,v,x)},n=async(y,c,v=!1)=>{await l.ensureActual(y,c,v)};return{dops:a,isDopsLoading:h,isDopsLoadingMore:_,hasMoreDops:p,dopsError:D,dopsTotalPrice:k,dopsManagers:r,selectedDopId:l.selectedId,selectedDopManagerIds:l.selectedManagerIds,managerOptions:l.managerOptions,needsSync:l.needsSync,refresh:l.refresh,loadMore:l.loadMore,handleDopClick:U,handleManagerFilterChange:d,ensureActual:n,reset:l.reset}}const Qe=50;function Bl(a){return!a||!a.from||!a.to?null:`${a.from}::${a.to}`}function Nl(a){return a?Array.isArray(a.items)?a.items.filter(o=>!!(o&&typeof o.id=="number")):[]:[]}function Gl(a){const o=["totalPaymentPrice","totalPaymentsPrice","totalPrice"];for(const s of o){const h=a[s];if(typeof h=="number"&&Number.isFinite(h))return Number(h)}return null}function zl(){const{$useApi:a}=ve(),o=J("my-payments:list",()=>[]),s=J("my-payments:total",()=>0),h=J("my-payments:total-price",()=>0),_=J("my-payments:managers",()=>[]),p=J("my-payments:page",()=>1),g=J("my-payments:per-page",()=>Qe),D=J("my-payments:has-more",()=>!0),k=J("my-payments:initial-loading",()=>!1),r=J("my-payments:loading-more",()=>!1),f=J("my-payments:error",()=>null),l=J("my-payments:last-request",()=>({groupId:null,rangeKey:null,range:null,managerIds:[]})),U=()=>{o.value=[],s.value=0,h.value=0,_.value=[],p.value=1,g.value=Qe,D.value=!0,f.value=null,l.value={groupId:null,rangeKey:null,range:null,managerIds:[]}},d=async(y={})=>{const{groupId:c,range:v,page:x=1,perPage:I=g.value||Qe,append:R=x>1,managerIds:F}=y,M=Array.isArray(F)?F.filter($=>typeof $=="number"):R?[...l.value.managerIds]:[],G=Bl(v),A=!R||l.value.groupId!==c||l.value.rangeKey!==G||x===1;if(A&&(o.value=[],s.value=0,p.value=1,D.value=!0),R||x>1){if(!D.value)return null;r.value=!0}else k.value=!0;if(f.value=null,!v||!v.from||!v.to)return f.value="Необходимо указать диапазон дат (from и to)",k.value=!1,r.value=!1,null;const P={page:x,take:I,from:v.from,to:v.to};c!==void 0&&(P.groupId=c),M.length&&(P.managersIds=M.join(","));try{const{data:$}=await a.get("/payments/group",{params:P});let E;if(Array.isArray($)){const Z=$.filter(L=>!!(L&&typeof L.id=="number"));E={totalPaymentPrice:Z.reduce((L,K)=>L+(K.price||0),0),items:Z,managers:_.value.length?[..._.value]:[]}}else E=$??{totalPaymentPrice:0,items:[],managers:[]};Array.isArray(E.managers)&&(_.value=E.managers);const oe=Nl(E),z=new Set,b=oe.filter(Z=>z.has(Z.id)?!1:(z.add(Z.id),!0));if(A||x===1)o.value=b;else if(b.length){const Z=new Set(o.value.map(K=>K.id)),L=b.filter(K=>!Z.has(K.id));L.length&&(o.value=[...o.value,...L])}s.value=o.value.length;const S=Gl(E);return h.value=S!==null?S:o.value.reduce((Z,L)=>Z+(L.price||0),0),D.value=b.length>=I,p.value=x,g.value=I,l.value={groupId:c,rangeKey:G,range:v&&v.from&&v.to?{from:v.from,to:v.to}:null,managerIds:[...M]},{totalPaymentPrice:h.value,items:o.value,managers:_.value}}catch($){throw console.error("Failed to load payments",$),R||(o.value=[]),f.value="Не удалось загрузить платежи",$}finally{k.value=!1,r.value=!1}};return{payments:o,total:s,page:p,perPage:g,hasMore:D,isInitialLoading:k,isLoadingMore:r,error:f,totalPrice:h,managers:_,reset:U,fetchPayments:d,loadMore:async(y={})=>{const{groupId:c,range:v,managerIds:x}=y;if(!D.value)return null;const I=c!==void 0?c:l.value.groupId,R=p.value+1,F=v??l.value.range??void 0,M=Array.isArray(x)?x:l.value.managerIds;return d({groupId:I,range:F,page:R,perPage:g.value,append:!0,managerIds:M})}}}function Hl(){const{payments:a,fetchPayments:o,loadMore:s,isInitialLoading:h,isLoadingMore:_,hasMore:p,reset:g,error:D,totalPrice:k,managers:r}=zl(),l=yt({type:"payments",fetchFunction:async y=>{const c=await o(y);return{payments:c?.payments||[],managers:c?.managers||[],totalPrice:c?.totalPrice||0,hasMore:c?.hasMore||!1}},loadMoreFunction:async y=>{await s(y)},resetFunction:g,dataKey:"payments",managersKey:"managers",totalPriceKey:"totalPrice"}),U=async(y,c)=>{y?.dealId&&(l.selectedId.value=y.id,await c(y.dealId))},d=async(y,c,v,x=!1)=>{await l.handleManagerFilterChange(y,c,v,x)},n=async(y,c,v=!1)=>{await l.ensureActual(y,c,v)};return{payments:a,isPaymentsLoading:h,isPaymentsLoadingMore:_,hasMorePayments:p,paymentsError:D,paymentsTotalPrice:k,paymentsManagers:r,selectedPaymentId:l.selectedId,selectedPaymentManagerIds:l.selectedManagerIds,managerOptions:l.managerOptions,needsSync:l.needsSync,refresh:l.refresh,loadMore:l.loadMore,handlePaymentClick:U,handleManagerFilterChange:d,ensureActual:n,reset:l.reset}}const Ze=50;function Ol(a){return!a||!a.from||!a.to?null:`${a.from}::${a.to}`}function El(a){return a?Array.isArray(a.items)?a.items.filter(o=>!!(o&&typeof o.id=="number")):[]:[]}function jl(a){const o=["totalDeliveryPrice","totalPrice"];for(const s of o){const h=a[s];if(typeof h=="number"&&Number.isFinite(h))return Number(h)}return null}function ql(){const{$useApi:a}=ve(),o=J("my-deliveries:list",()=>[]),s=J("my-deliveries:total",()=>0),h=J("my-deliveries:total-price",()=>0),_=J("my-deliveries:page",()=>1),p=J("my-deliveries:per-page",()=>Ze),g=J("my-deliveries:has-more",()=>!0),D=J("my-deliveries:initial-loading",()=>!1),k=J("my-deliveries:loading-more",()=>!1),r=J("my-deliveries:error",()=>null),f=J("my-deliveries:last-request",()=>({groupId:null,rangeKey:null,range:null})),l=()=>{o.value=[],s.value=0,h.value=0,_.value=1,p.value=Ze,g.value=!0,r.value=null,f.value={groupId:null,rangeKey:null,range:null}},U=async(n={})=>{const{groupId:y,range:c,page:v=1,perPage:x=p.value||Ze,append:I=v>1}=n,R=Ol(c),F=!I||f.value.groupId!==y||f.value.rangeKey!==R||v===1;if(F&&(o.value=[],s.value=0,_.value=1,g.value=!0),I||v>1){if(!g.value)return null;k.value=!0}else D.value=!0;if(r.value=null,!c||!c.from||!c.to)return r.value="Необходимо указать диапазон дат (from и to)",D.value=!1,k.value=!1,null;const M={page:v,take:x,from:c.from,to:c.to};y!==void 0&&(M.groupId=y);try{const{data:G}=await a.get("/deliveries",{params:M});let A;if(Array.isArray(G)){const O=G.filter(S=>!!(S&&typeof S.id=="number"));A={totalDeliveryPrice:O.reduce((S,B)=>S+(B.price||0),0),items:O}}else A=G??{totalDeliveryPrice:0,items:[]};const P=El(A),$=new Set,E=P.filter(O=>$.has(O.id)?!1:($.add(O.id),!0));if(F||v===1)o.value=E;else if(E.length){const O=new Set(o.value.map(B=>B.id)),S=E.filter(B=>!O.has(B.id));S.length&&(o.value=[...o.value,...S])}s.value=o.value.length;const z=jl(A);return h.value=z!==null?z:o.value.reduce((O,S)=>O+(S.price||0),0),g.value=E.length>=x,_.value=v,p.value=x,f.value={groupId:y,rangeKey:R,range:c&&c.from&&c.to?{from:c.from,to:c.to}:null},{totalDeliveryPrice:h.value,items:o.value}}catch(G){throw console.error("Failed to load deliveries",G),I||(o.value=[]),r.value="Не удалось загрузить доставки",G}finally{D.value=!1,k.value=!1}};return{deliveries:o,total:s,page:_,perPage:p,hasMore:g,isInitialLoading:D,isLoadingMore:k,error:r,totalPrice:h,reset:l,fetchDeliveries:U,loadMore:async(n={})=>{const{groupId:y,range:c}=n;if(!g.value)return null;const v=y!==void 0?y:f.value.groupId,x=_.value+1,I=c??f.value.range??void 0;return U({groupId:v,range:I,page:x,perPage:p.value,append:!0})}}}function Ql(){const{deliveries:a,fetchDeliveries:o,loadMore:s,isInitialLoading:h,isLoadingMore:_,hasMore:p,reset:g,error:D,totalPrice:k}=ql(),r=q(null),f=q(void 0),l=q(null),U=q(!0);return{deliveries:a,isDeliveriesLoading:h,isDeliveriesLoadingMore:_,hasMoreDeliveries:p,deliveriesError:D,deliveriesTotalPrice:k,selectedDeliveryId:r,needsSync:U,loadMore:async(v,x)=>{!x||!x.from||!x.to||await s({groupId:v,range:x})},handleDeliveryClick:async(v,x)=>{v?.dealId&&(r.value=v.id,await x(v.dealId))},ensureActual:async(v,x,I=!1)=>{if(!I){U.value=!0;return}const R=f.value!==v,F=!l.value||!x||l.value.from!==x.from||l.value.to!==x.to;if(R||F||U.value){if(U.value=!1,f.value=v,l.value=x??null,!x||!x.from||!x.to)return;await o({groupId:v,range:x,page:1,append:!1})}},reset:()=>{g(),r.value=null,f.value=void 0,l.value=null,U.value=!0}}}function Zl(){const{toast:a}=Mt(),o=(h,_)=>{console.error(`${_}:`,h);const p=h?.response?.data?.message||h?.message||"Произошла неизвестная ошибка";a.error(`${_}: ${p}`)};return{handleError:o,handleAsyncError:async(h,_,p)=>{try{return await h()}catch(g){return o(g,_),p||null}}}}const Xl={class:"relative h-screen hidden-scrollbar"},Jl={class:"w-full fixed z-10"},Wl={class:"h-[full] flex p-4 gap-4 mx-[auto] max-w-[2048px] pt-16"},Yl={class:"flex flex-col gap-2 min-w-[1050px] w-full"},es={class:"mt-[-45px]"},ts={key:0,class:"min-w-[350px] w-[350px] h-[calc(100vh-85px)]"},un=ne({__name:"index",async setup(a){let o,s;const{handleAsyncError:h}=Zl();It({title:"Сделки | Easy CRM"});const _=q("deals"),p=q(""),g=q(null),{filters:D,loadDealsDatas:k}=he(),r=q(!1),f=q(null),l=S=>{if(!S||S==="all")return;const B=Number(S);return Number.isFinite(B)?B:void 0},U=(S,B)=>`${S??"all"}:${B?.from??""}:${B?.to??""}`,d=async(S={})=>{const B=l(n.selectedGroupId.value),Z=U(B,g.value);if(!S.force&&f.value===Z)return null;const L=await n.refreshDeals(S.selectFirstDeal??!0,g.value);return f.value=Z,r.value&&(await y.ensureActual(B,g.value,_.value==="dops"),await c.ensureActual(B,g.value,_.value==="payments"),await v.ensureActual(B,g.value,_.value==="deliveries")),L},n=Ll(),y=Kl(),c=Hl(),v=Ql();[o,s]=Dt(()=>k()),await o,s();const x=S=>{g.value=S},I=async S=>{await h(async()=>{await d({force:!0}),n.currentDeal.value?.id!==S&&await n.selectDeal(S)},"Создание сделки")},R=async S=>{await h(async()=>{await n.selectDeal(S),p.value.trim()||await d({force:!0,selectFirstDeal:!1})},"Обновление сделки")},F=async()=>{await h(async()=>{p.value.trim()||await d({force:!0})},"Удаление сделки")},M=async S=>{await y.handleDopClick(S,n.selectDeal)},G=async S=>{await c.handlePaymentClick(S,n.selectDeal)},A=async S=>{await v.handleDeliveryClick(S,n.selectDeal)},P=async S=>{const B=l(n.selectedGroupId.value);await y.handleManagerFilterChange(S,B,g.value,_.value==="dops")},$=async S=>{const B=l(n.selectedGroupId.value);await c.handleManagerFilterChange(S,B,g.value,_.value==="payments")},E=async()=>{const S=l(n.selectedGroupId.value);await y.loadMore(S,g.value,y.selectedDopManagerIds.value)},oe=async()=>{const S=l(n.selectedGroupId.value);await c.loadMore(S,g.value,c.selectedPaymentManagerIds.value)},z=async()=>{const S=l(n.selectedGroupId.value);await v.loadMore(S,g.value)},b=async()=>{await n.loadMore()},O=async S=>{const[B]=Array.isArray(S)?S:[];await n.applySorting(B?.id,B?.desc??!1)};return le(g,async()=>{r.value&&await d()}),le(_,async S=>{if(!r.value)return;const B=l(n.selectedGroupId.value);S==="dops"?await y.ensureActual(B,g.value,!0):S==="payments"?await c.ensureActual(B,g.value,!0):S==="deliveries"&&await v.ensureActual(B,g.value,!0)}),le(p,async S=>{_.value="deals",f.value=null,await n.performSearch(S)}),le(n.selectedGroupId,async(S,B)=>{if(!r.value)return;if(!S){n.deals.value=[],n.currentDeal.value=null,y.reset(),c.reset(),v.reset(),f.value=null;return}if(S===B)return;(await d({force:!0}))?.deals?.length||(n.currentDeal.value=null)}),ye(async()=>{await h(async()=>{await n.fetchGroups(),r.value=!0,g.value&&f.value===null&&await d({force:!0})},"Загрузка сделок")}),(S,B)=>{const Z=xt,L=Zt,K=Oa,j=Ot,Y=Ht,re=ll,te=Et,ue=pl,me=wl,ie=Dl,ht=zt,bt=Kt;return u(),T("div",Xl,[N("div",Jl,[e(Z)]),N("div",Wl,[N("div",Yl,[e(L,{"totals-info":i(n).totalsInfo.value},null,8,["totals-info"]),e(K,{"deal-groups":i(n).dealGroups.value,"selected-group-id":i(n).selectedGroupId.value,filters:i(D),search:i(p),"onUpdate:selectedGroupId":B[0]||(B[0]=de=>i(n).selectedGroupId.value=de),"onUpdate:search":B[1]||(B[1]=de=>p.value=de),onRangeChange:x,onDealCreated:I},null,8,["deal-groups","selected-group-id","filters","search"]),e(ht,{modelValue:i(_),"onUpdate:modelValue":B[2]||(B[2]=de=>vt(_)?_.value=de:null),"default-value":"deals"},{default:t(()=>[e(Y,{class:"h-9 cursor-pointer"},{default:t(()=>[e(j,{value:"deals",class:"cursor-pointer py-1 px-2"},{default:t(()=>B[3]||(B[3]=[w(" Заказы ",-1)])),_:1,__:[3]}),e(j,{value:"dops",class:"cursor-pointer py-1 px-2"},{default:t(()=>B[4]||(B[4]=[w(" Допы ",-1)])),_:1,__:[4]}),e(j,{value:"payments",class:"cursor-pointer py-1 px-2"},{default:t(()=>B[5]||(B[5]=[w(" Платежи ",-1)])),_:1,__:[5]}),e(j,{value:"deliveries",class:"cursor-pointer py-1 px-2"},{default:t(()=>B[6]||(B[6]=[w(" Доставки ",-1)])),_:1,__:[6]})]),_:1}),N("div",es,[e(te,{value:"deals"},{default:t(()=>[e(re,{deals:i(n).deals.value,"is-loading":i(n).isLoading.value,"is-loading-more":i(n).isLoadingMore.value,"has-more":i(n).hasMore.value,sorting:i(n).sortingState.value,onDealClicked:i(n).selectDeal,onLoadMore:b,onSortChange:O},null,8,["deals","is-loading","is-loading-more","has-more","sorting","onDealClicked"])]),_:1}),e(te,{value:"dops"},{default:t(()=>[e(ue,{dops:i(y).dops.value,"is-loading":i(y).isDopsLoading.value,"is-loading-more":i(y).isDopsLoadingMore.value,"has-more":i(y).hasMoreDops.value,"total-price":i(y).dopsTotalPrice.value,"selected-dop-id":i(y).selectedDopId.value,"manager-options":i(D).managers.map(de=>({value:de.id,label:de.fullName})),"selected-manager-ids":i(y).selectedDopManagerIds.value,error:i(y).dopsError.value,onLoadMore:E,onDopClicked:M,onManagerFilterChange:P},null,8,["dops","is-loading","is-loading-more","has-more","total-price","selected-dop-id","manager-options","selected-manager-ids","error"])]),_:1}),e(te,{value:"payments"},{default:t(()=>[e(me,{payments:i(c).payments.value,"is-loading":i(c).isPaymentsLoading.value,"is-loading-more":i(c).isPaymentsLoadingMore.value,"has-more":i(c).hasMorePayments.value,"total-price":i(c).paymentsTotalPrice.value,"selected-payment-id":i(c).selectedPaymentId.value,"manager-options":i(D).managers.map(de=>({value:de.id,label:de.fullName})),"selected-manager-ids":i(c).selectedPaymentManagerIds.value,error:i(c).paymentsError.value,onLoadMore:oe,onPaymentClicked:G,onManagerFilterChange:$},null,8,["payments","is-loading","is-loading-more","has-more","total-price","selected-payment-id","manager-options","selected-manager-ids","error"])]),_:1}),e(te,{value:"deliveries",class:"mt-[55px]"},{default:t(()=>[e(ie,{deliveries:i(v).deliveries.value,"is-loading":i(v).isDeliveriesLoading.value,"is-loading-more":i(v).isDeliveriesLoadingMore.value,"has-more":i(v).hasMoreDeliveries.value,"total-price":i(v).deliveriesTotalPrice.value,"selected-delivery-id":i(v).selectedDeliveryId.value,error:i(v).deliveriesError.value,onLoadMore:z,onDeliveryClicked:A},null,8,["deliveries","is-loading","is-loading-more","has-more","total-price","selected-delivery-id","error"])]),_:1})])]),_:1},8,["modelValue"])]),i(n).currentDeal.value?(u(),T("div",ts,[(u(),C(bt,{key:i(n).currentDeal.value.id,deal:i(n).currentDeal.value,onDealUpdated:R,onDealDeleted:F},null,8,["deal"]))])):V("",!0)])])}}});export{un as default};
