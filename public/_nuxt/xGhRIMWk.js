import{_ as ae}from"./Bye7C16d.js";import{_ as ne,a as le,b as re,c as ie,d as _e}from"./JYeLPbKT.js";import{_ as de}from"./DLLw9AXE.js";import{_ as ce}from"./BFj2DODp.js";import{_ as me,a as ue,b as pe}from"./BF3m7Vf0.js";import{_ as fe}from"./Bh3bOtDY.js";import{_ as ve}from"./D0zfKHPR.js";import{_ as ge,a as he}from"./l1eRtAXP.js";import{_ as xe}from"./BhleEUCu.js";import{_ as ye}from"./BND4UK_1.js";import{_ as we}from"./CaiudRgb.js";import{_ as be}from"./DVdymwQ5.js";import{_ as Ce}from"./QXfa84Px.js";import{_ as ke}from"./CDst0A0O.js";import{_ as Ue}from"./CYqmhYCX.js";import{e as Se,r as i,i as $e,B as Z,c,a as s,b as o,w as a,H as S,l,o as _,d as h,t as m,F as $,z as N,m as Ne,A as V,D as R}from"./BbheI0mw.js";import"./D0Fd2yXn.js";import"./B9M8ggfK.js";import"./oLxPQbNe.js";import"./D2GZmoDz.js";import"./CaPtdwNj.js";import"./KSX9JOtw.js";import"./ZTyVILcU.js";import"./s39mgViW.js";import"./CJOOd8Dx.js";import"./BR3DQNok.js";import"./odSmgr3d.js";import"./DzJc7hp_.js";import"./CCknexPU.js";import"./_14b2CUj.js";import"./CssJESp-.js";import"./cStEOrWd.js";import"./DiZ4QL0M.js";import"./C30fSUvl.js";import"./CprHmdOe.js";import"./D-8t_H8v.js";const Ve={class:"relative h-screen hidden-scrollbar"},Me={class:"w-full fixed z-10"},Te={class:"h-full flex flex-col py-4 gap-2 mx-[auto] max-w-[2048px] pt-16 min-w-[1024px]"},Ee={class:"flex h-screen bg-gray-100 rounded-sm overflow-hidden"},De={class:"w-1/3 p-4"},Be={class:"w-4/12 border-r bg-white shadow-sm"},je={key:0,class:"p-4 text-center text-gray-500"},Ie={class:"flex items-center"},Ze={class:"w-full"},Re={class:"font-semibold text-gray-900"},ze={class:"flex justify-between items-center"},Fe={class:V(["text-xs text-gray-500 mr-1"])},Ge={class:"w-2/3"},He={key:0,class:"flex-1 flex items-center justify-center text-gray-500"},Ke={ref:"messagesContainer",class:"h-[calc(100vh-310px)] px-2 overflow-y-scroll"},Oe={class:"flex flex-col-reverse gap-4 mb-6"},We={class:"font-semibold text-gray-900"},Ae={class:"text-xs mt-1"},Je={key:0},Qe=["href"],qe={class:"w-1/3 bg-white p-4"},z="vk1.a.gPMgWt-2HYbeo_F8uEkzQvpB0mRD_qSgZ4veFtUQbxR4yNj8CBT_EIqCV1BZ3ZsjSsqod_WYh-18Zz3xHAgrpacaeg5rV5Cfs_oMBpn3uNAzcD5JGGNREwe_0WlCuYVPfDuCjOBrwEff-WM6y7mObRaJPjlfvggNmTSm_oxlh0Dsy9ZMIGKq0E06UxLjiI_alqsoIWqli-SzoYi31_V09g",Le="vk1.a.Oylj4WwtIpER8ynH05r2TsbvzpOQC1sFtZNGSTxGdAbmm8WZtYkGDvN6RmXuYu2IFnCZSJ4SYjJJM5voy7goB2ZHIF8MeZ4fJ99AabZilEQk7V33QsZrTRXz474xPueqXdKEKVWEChHH7cqKDJm3ZFmWw_MO1BvdVVQpGHAXQ2G5QlKDMR3hh69I4UkDjijBk1NWmf_MPlAoNMh3cI-u2Q",Bt=Se({__name:"index",setup(Ye){const M=useAuthStore();i("EasyKover");const u=i(z),F={peer_id:0,last_message_text:"string",unread_count:0,profile_photo_50:"string",full_name:"string",last_message_date:1740750524,unanswered:!1},G={id:0,text:"string",date:1740750524,peer_id:0,from_id:0,attachments:[],payload:{userId:0,userName:""}},x=i([F]),y=i("all"),T=i(0),b=i([G]),C=i(!1),k=i(!1),p=i(0),w=i(""),H=n=>{p.value=n,E(n)},U=async()=>{C.value=!0;try{const{response:n}=await $fetch("/api/vk/method/messages.getConversations",{params:{access_token:u.value,v:"5.199",extended:1,count:40,fields:"id,photo_50",filter:y.value}});if(n){const{items:e,profiles:f,unread_count:r}=n;T.value=r,x.value=e.map(d=>({peer_id:d.conversation.peer.id,last_message_text:d.last_message.text||"",last_message_date:d.last_message.date,unanswered:d.conversation.unanswered,profile_photo_50:f.find(v=>v.id===d.conversation.peer.id)?.photo_50||"",full_name:f.find(v=>v.id===d.conversation.peer.id)?.first_name+" "+f.find(v=>v.id===d.conversation.peer.id)?.last_name||""})),console.log("Диалоги:",x.value)}}catch(n){console.error("Ошибка при загрузке диалогов:",n)}finally{C.value=!1}},E=async n=>{k.value=!0;try{const{response:e}=await $fetch("/api/vk/method/messages.getHistory",{params:{access_token:u.value,v:"5.199",peer_id:n}});if(e){const{items:f}=e;b.value=f.map(r=>({id:r.id,text:r.text||"",date:r.date,peer_id:r.peer_id,from_id:r.from_id,attachments:r.attachments,payload:r.payload?JSON.parse(typeof r.payload=="string"?r.payload:"{}"):{userId:0,userName:""}})),console.log("Сообщения:",b.value)}}catch(e){console.error("Ошибка при загрузке переписки:",e)}finally{k.value=!1}},K=async()=>{try{const{response:n}=await $fetch("/api/vk/method/messages.send",{method:"POST",params:{access_token:u.value,v:"5.199",peer_id:p.value,message:w.value,random_id:Math.floor(Math.random()*1e6),payload:JSON.stringify({userId:M.user?.id||0,userName:M.user?.fullName||""})}});console.log("Сообщение отправлено:",n)}catch(n){console.error("Ошибка при отправке сообщения:",n)}finally{w.value="",E(p.value)}};return $e(()=>{U()}),Z(y,()=>{U()}),Z(u,()=>{U()}),(n,e)=>{const f=ae,r=re,d=le,v=ce,D=_e,O=de,W=ie,A=ne,B=pe,J=ue,Q=me,j=fe,I=ve,q=be,L=he,Y=xe,P=ge,X=ye,ee=Ce,te=ke,oe=we,se=Ue;return _(),c("div",Ve,[s("div",Me,[o(f)]),s("div",Te,[s("div",Ee,[s("div",De,[o(A,{modelValue:l(u),"onUpdate:modelValue":e[0]||(e[0]=t=>S(u)?u.value=t:null)},{default:a(()=>[o(d,null,{default:a(()=>[o(r,{placeholder:"UiSelect a fruit"})]),_:1}),o(W,null,{default:a(()=>[o(O,null,{default:a(()=>[o(v,null,{default:a(()=>e[3]||(e[3]=[h("Группы",-1)])),_:1,__:[3]}),o(D,{value:z},{default:a(()=>e[4]||(e[4]=[h(" EasyKover ",-1)])),_:1,__:[4]}),o(D,{value:Le},{default:a(()=>e[5]||(e[5]=[h(" EasyNeon ",-1)])),_:1,__:[5]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[6]||(e[6]=s("h2",null,"Окно скриптов",-1))]),s("div",Be,[e[8]||(e[8]=s("h2",{class:"p-4 text-lg font-bold text-gray-800"},"Диалоги",-1)),o(Q,{modelValue:l(y),"onUpdate:modelValue":e[1]||(e[1]=t=>S(y)?y.value=t:null),class:"px-1"},{default:a(()=>[o(J,null,{default:a(()=>[o(B,{value:"all"},{default:a(()=>e[7]||(e[7]=[h(" Все ",-1)])),_:1,__:[7]}),o(B,{value:"unread"},{default:a(()=>[h(" Непрочитанные ("+m(l(T))+")",1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(q,{class:"h-[calc(100vh-145px)] px-2"},{default:a(()=>[l(C)?(_(),c("div",je," Загрузка... ")):(_(!0),c($,{key:1},N(l(x),t=>(_(),Ne(I,{key:t.peer_id,class:"m-2 cursor-pointer hover:bg-gray-50 transition",onClick:g=>H(t.peer_id)},{default:a(()=>[s("div",Ie,[o(j,{src:t.profile_photo_50,class:"w-10 h-10 rounded-full mr-3",alt:"Chat avatar"},null,8,["src"]),s("div",Ze,[s("p",Re,m(t.full_name),1),s("div",ze,[s("p",{class:V([t.unanswered?"font-semibold text-sky-900/80":" ","text-sm text-gray-500 truncate"])},m(t.last_message_text.slice(0,15))+"... ",3),s("p",Fe,m(new Date(t.last_message_date*1e3).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})),1)])])])]),_:2},1032,["onClick"]))),128))]),_:1})]),s("div",Ge,[o(I,{class:"rounded-none border-none bg-gray-100 shadow-none"},{default:a(()=>[o(P,null,{default:a(()=>[o(L,null,{default:a(()=>[h(m(l(x).find(t=>t.peer_id===l(p))?.full_name||"Переписка"),1)]),_:1}),o(Y)]),_:1}),o(X,null,{default:a(()=>[l(k)?(_(),c("div",He," Загрузка сообщений... ")):R("",!0),s("div",Ke,[s("div",Oe,[(_(!0),c($,null,N(l(b),t=>(_(),c("div",{key:t.id,class:V([t.from_id!==l(p)?"ml-auto bg-amber-400/70":"bg-slate-400/80","p-3 rounded-lg max-w-xs bg-gray-200"])},[s("p",We,m(t.from_id!==l(p)?t.payload.userName?`Вы(${t.payload.userName})`:"Вы":l(x).find(g=>g.peer_id===l(p))?.full_name),1),s("p",null,m(t.text),1),s("p",Ae,m(new Date(t.date*1e3).toLocaleDateString("ru-RU"))+" "+m(new Date(t.date*1e3).toLocaleTimeString("ru-RU")),1),t.attachments.length?(_(),c("div",Je,[(_(!0),c($,null,N(t.attachments,g=>(_(),c("div",{key:g.id,class:"mt-2"},[s("a",{href:g.photo.orig_photo.url,target:"_blank",rel:"noopener noreferrer"},[o(j,{src:g.photo.orig_photo.url,alt:g.type,class:"w-32 h-32 object-cover rounded-lg"},null,8,["src","alt"])],8,Qe)]))),128))])):R("",!0)],2))),128))])],512)]),_:1}),o(oe,{class:"h-full items-end"},{default:a(()=>[o(ee,{modelValue:l(w),"onUpdate:modelValue":e[2]||(e[2]=t=>S(w)?w.value=t:null),placeholder:"Введите сообщение...",class:"w-full mr-2 resize-none"},null,8,["modelValue"]),o(te,{onClick:K},{default:a(()=>e[9]||(e[9]=[h(" Send ",-1)])),_:1,__:[9]})]),_:1})]),_:1})]),s("div",qe,[e[10]||(e[10]=s("h2",null,"Информация клиента",-1)),o(se)])])])])}}});export{Bt as default};
