import{_ as Et}from"./Bmr5wyhr.js";import{_ as Nt}from"./B34G8dwx.js";import{_ as Ee,a as Ne,b as Ge}from"./DkMjgWCi.js";import{_ as st,a as at,b as ot,c as nt,d as ut}from"./AeDsR3BR.js";import{_ as it}from"./CCJdEHHg.js";import{_ as Gt}from"./QdoKPtJ3.js";import{_ as ge}from"./mqOaxR0N.js";import{b as be,c as ye,a as xe,d as we,_ as ke,e as $e}from"./Df1Q6CGn.js";import{_ as he}from"./C7WYXAp2.js";import{_ as Be,a as wt}from"./DkkQ8vn7.js";import{b as Ue,c as Ve,d as Ce,_ as Se,a as rt}from"./B-kig6KZ.js";import{_ as Me}from"./BqmAL8DW.js";import{_ as Re}from"./Pvv-dh1L.js";import{_ as Ie}from"./BcuVElyA.js";import{_ as Le}from"./Dbg8U1qb.js";import{_ as Oe}from"./D8Osd5Ax.js";import{e as ne,g as ue,h as ce,r as m,B as J,c as v,o as a,b as e,w as t,a as s,d as n,D as M,m as O,A as K,F as se,z as ae,t as _,i as fe,l as u,k as Je,u as mt,H as Pe,v as Qe}from"./LcRD3ia0.js";import{_ as kt}from"./BgkA-2sO.js";import{_ as dt,a as $t,b as ht}from"./CNLsaPwj.js";import{_ as Ut}from"./BCRlC5xu.js";import{_ as Vt}from"./fRExJa2e.js";import{_ as Bt}from"./CP8umD4q.js";import{_ as Ct}from"./Da2JRHOT.js";import{u as ve}from"./Dt19OLxm.js";import{u as ze}from"./BOGtf0gU.js";import{c as St}from"./D5ydJhlK.js";import{_ as ct}from"./YaXf-8Sh.js";import{_ as vt}from"./CY7rJOej.js";import{n as Lt,s as bt,Q as Fe,b as pt,a as Ke,c as Xe,d as zt,f as et}from"./DVXwaM75.js";import{_ as At,a as Wt,s as Ht,b as jt}from"./CzdNxZn3.js";import{_ as Mt,a as Rt,b as Dt}from"./DfRdkKc3.js";import{_ as Tt,a as Pt}from"./iXxKrSbb.js";import{_ as It}from"./COO4Wojn.js";import{d as qt}from"./Cxp-zkhu.js";import"./D9TSNOAg.js";import"./BdQOAs7V.js";import"./QkXyQO2w.js";import"./Dxrh8xS6.js";import"./BcyKike4.js";import"./D6LOIvye.js";import"./D8EW8v7U.js";import"./CACSUplU.js";import"./xEZuT4Nf.js";import"./ClQAoZ75.js";import"./BsJBhgTW.js";import"./BUo7Dhyt.js";import"./BXoTK-I8.js";import"./DSl2Rovl.js";/**
 * @license lucide-vue-next v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=St("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=St("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);function yt(B,L,G){const[F,R]=Lt(G?.in,B,L);return+bt(F,G)==+bt(R,G)}const Kt={class:"flex flex-col gap-5"},Xt={class:"relative"},Zt={key:0,class:"relative"},Qt={key:1,class:"relative"},Jt={class:"relative"},el={class:"flex gap-2"},tl={class:"relative"},ll={class:"flex gap-2"},sl={class:"relative"},al={class:"flex gap-2"},ol={key:2,class:"relative"},nl={class:"relative"},ul={class:"flex justify-between w-full gap-2"},_t=ne({__name:"EditMasterReport",props:{report:{},curUser:{}},emits:["report-updated","close"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!0),w=m(!0),d=["Стандартная","Уличная","РГБ","Смарт","Контражур","РГБ Контражур","ВБ","ОЗОН","Подарок"],g=["Стандартная","Контражур","Подарок","Уличная","Уличный контражур","РГБ Контражур","РГБ","Смарт"],r=m({...y.report}),j=()=>{const{metrs:f,els:b,type:p}=r.value;let l=0;if(y.curUser?.workSpaceId===8)switch(p){case"Стандартная":case"ВБ":case"ОЗОН":case"Подарок":l=f*60+b*30;break;case"Уличная":l=f*90+b*45;break;case"Уличный контражур":l=f*54+b*37;break;case"РГБ Контражур":l=f*80+b*67;break;case"РГБ":case"Смарт":l=f*84+b*42;break;case"Контражур":l=f*36+b*18;break;default:l=0}else switch(p){case"Стандартная":case"ВБ":case"ОЗОН":case"Подарок":l=f*100+b*50;break;case"Уличная":case"РГБ Контражур":l=f*130+b*70;break;case"РГБ":case"Смарт":l=f*140+b*150;break;case"Контражур":l=f*60+b*30;break;default:l=0}r.value.cost=l},c=async()=>{try{w.value=!0,await G.patch(`production/master-report/${r.value.id}`,r.value),S.value=!1,R("report-updated"),w.value=!1,F({title:"Успех",description:"Отчет успешно обновлен"})}catch(f){console.log(f)}},i=async()=>{try{await G.delete(`production/master-report/${r.value.id}`),S.value=!1,R("report-updated"),F({title:"Успех",description:"Отчет успешно удален"})}catch(f){console.log(f)}};return J(r,()=>{const{date:f,name:b,metrs:p,els:l,type:$}=r.value;j(),w.value=!(f&&b&&p>0&&l>0&&$)},{deep:!0}),J(S,f=>{f||R("close")}),(f,b)=>{const p=Ce,l=Me,$=Ve,T=Ie,E=ge,A=ot,q=at,P=ut,o=it,h=nt,V=st,k=Le,C=Oe,H=Re,D=Ue,z=Se;return a(),v("div",null,[e(z,{open:S.value,"onUpdate:open":b[8]||(b[8]=W=>S.value=W)},{default:t(()=>[e(D,{class:"max-w-[400px] flex flex-col top-0 translate-y-[0px]"},{default:t(()=>[e($,null,{default:t(()=>[e(p,null,{default:t(()=>b[9]||(b[9]=[n("Редактировать запись",-1)])),_:1,__:[9]}),e(l)]),_:1}),s("div",Kt,[s("div",Xt,[r.value.date?(a(),O(T,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>b[10]||(b[10]=[n("Дата смены",-1)])),_:1,__:[10]})):M("",!0),e(E,{modelValue:r.value.date,"onUpdate:modelValue":b[0]||(b[0]=W=>r.value.date=W),type:"date",placeholder:"Дата смены",class:K(r.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),y.curUser.workSpaceId!==8?(a(),v("div",Zt,[r.value.type?(a(),O(T,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>b[11]||(b[11]=[n("Тип",-1)])),_:1,__:[11]})):M("",!0),s("div",{class:K(r.value.type?"":"outline-1 outline-rose-300 rounded-md")},[e(V,{modelValue:r.value.type,"onUpdate:modelValue":b[1]||(b[1]=W=>r.value.type=W)},{default:t(()=>[e(q,null,{default:t(()=>[e(A,{placeholder:"Тип"})]),_:1}),e(h,null,{default:t(()=>[(a(),v(se,null,ae(d,(W,I)=>e(o,{key:I},{default:t(()=>[e(P,{value:W},{default:t(()=>[n(_(W),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):(a(),v("div",Qt,[r.value.type?(a(),O(T,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>b[12]||(b[12]=[n("Тип",-1)])),_:1,__:[12]})):M("",!0),s("div",{class:K(r.value.type?"":"outline-1 outline-rose-300 rounded-md")},[e(V,{modelValue:r.value.type,"onUpdate:modelValue":b[2]||(b[2]=W=>r.value.type=W)},{default:t(()=>[e(q,null,{default:t(()=>[e(A,{placeholder:"Тип"})]),_:1}),e(h,null,{default:t(()=>[(a(),v(se,null,ae(g,(W,I)=>e(o,{key:I},{default:t(()=>[e(P,{value:W},{default:t(()=>[n(_(W),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])),s("div",Jt,[r.value.name?(a(),O(T,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>b[13]||(b[13]=[n("Название или ссылка",-1)])),_:1,__:[13]})):M("",!0),e(E,{modelValue:r.value.name,"onUpdate:modelValue":b[3]||(b[3]=W=>r.value.name=W),placeholder:"Название или ссылка",class:K(r.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",el,[s("div",tl,[e(T,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>b[14]||(b[14]=[n("Элементы",-1)])),_:1,__:[14]}),s("div",ll,[e(E,{modelValue:r.value.els,"onUpdate:modelValue":b[4]||(b[4]=W=>r.value.els=W),modelModifiers:{number:!0},placeholder:"Элементы",type:"number",min:"0",class:K(r.value.els>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",sl,[e(T,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>b[15]||(b[15]=[n("Метры",-1)])),_:1,__:[15]}),s("div",al,[e(E,{modelValue:r.value.metrs,"onUpdate:modelValue":b[5]||(b[5]=W=>r.value.metrs=W),modelModifiers:{number:!0},placeholder:"Метры",type:"number",min:"0",class:K(r.value.metrs>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])])]),["PACKER","MASTER"].includes(f.curUser?.role.shortName||"")?M("",!0):(a(),v("div",ol,[e(T,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>b[16]||(b[16]=[n("Штраф",-1)])),_:1,__:[16]}),e(E,{modelValue:r.value.penaltyCost,"onUpdate:modelValue":b[6]||(b[6]=W=>r.value.penaltyCost=W),placeholder:"Штраф",type:"number"},null,8,["modelValue"])])),s("div",nl,[e(k,{modelValue:r.value.comment,"onUpdate:modelValue":b[7]||(b[7]=W=>r.value.comment=W),placeholder:"Комментарий"},null,8,["modelValue"]),r.value.comment?(a(),O(T,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>b[17]||(b[17]=[n(" Комментарий ",-1)])),_:1,__:[17]})):M("",!0)]),s("span",null," Стоимость: "+_(r.value.cost)+"р. ",1)]),e(H,{class:"w-full"},{default:t(()=>[s("div",ul,[e(C,{variant:"destructive",onClick:i},{default:t(()=>b[18]||(b[18]=[n(" Удалить ",-1)])),_:1,__:[18]}),e(C,{disabled:w.value,onClick:c},{default:t(()=>b[19]||(b[19]=[n(" Сохранить ",-1)])),_:1,__:[19]},8,["disabled"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),il={class:"flex flex-col gap-5"},rl={class:"relative"},dl={class:"relative"},cl={class:"relative"},pl={class:"flex gap-2"},ml={class:"relative"},vl={class:"relative"},_l={class:"relative"},fl={class:"flex gap-2"},gl={class:"relative"},bl={class:"relative"},yl={class:"flex gap-2"},xl={class:"relative"},wl={class:"relative"},kl={class:"flex justify-between w-full gap-2"},ft=ne({__name:"EditMasterRepairReport",props:{report:{},curUser:{}},emits:["report-updated","close"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!0),w=m(!1),d=["Стандартная","Уличная","РГБ","Смарт"],g=m({...y.report}),r=()=>{const{metrs:i,els:f,type:b,grinding:p,unpackage:l,unpackageBig:$,acoustics:T,smartContr:E}=g.value;let A=0;if(y.curUser.workSpaceId!==8){switch(b){case"Стандартная":A=i*130+f*70;break;case"Уличная":A=i*140+f*80;break;case"РГБ":A=i*150+f*200;break;case"Смарт":A=i*160+f*180;break;default:A=0}A+=l*50,A+=p*350,A+=$*100,A+=T*150,A+=E*200}else{switch(b){case"Стандартная":A=i*80+f*40;break;case"Уличная":A=i*90+f*45;break;case"РГБ":A=i*100+f*90;break;case"Смарт":A=i*75+f*80;break;default:A=0}A+=p*200,A+=l*50,A+=$*100,A+=T*50,A+=E*200}g.value.cost=A},j=async()=>{try{await G.patch(`production/master-repair/${g.value.id}`,g.value),S.value=!1,R("report-updated"),F({title:"Успех",description:"Ремонтный отчет успешно обновлен"})}catch(i){console.log(i)}},c=async()=>{try{await G.delete(`production/master-repair/${g.value.id}`),S.value=!1,R("report-updated"),F({title:"Успех",description:"Ремонтный отчет успешно удален"})}catch(i){console.log(i)}};return J(g,()=>{const{date:i,name:f,metrs:b,els:p,type:l}=g.value;r(),w.value=!(i&&f&&b>=0&&p>=0&&l)},{deep:!0}),J(S,i=>{i||R("close")}),(i,f)=>{const b=Ce,p=Me,l=Ve,$=Ie,T=ge,E=ot,A=at,q=ut,P=it,o=nt,h=st,V=Oe,k=Re,C=Ue,H=Se;return a(),v("div",null,[e(H,{open:S.value,"onUpdate:open":f[10]||(f[10]=D=>S.value=D)},{default:t(()=>[e(C,{class:"max-w-[400px] flex flex-col top-0 translate-y-[0px]"},{default:t(()=>[e(l,null,{default:t(()=>[e(b,null,{default:t(()=>f[11]||(f[11]=[n("Редактировать ремонтный отчет",-1)])),_:1,__:[11]}),e(p)]),_:1}),s("div",il,[s("div",rl,[g.value.date?(a(),O($,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[12]||(f[12]=[n("Дата смены",-1)])),_:1,__:[12]})):M("",!0),e(T,{modelValue:g.value.date,"onUpdate:modelValue":f[0]||(f[0]=D=>g.value.date=D),type:"date",placeholder:"Дата смены",class:K(g.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",dl,[g.value.type?(a(),O($,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>f[13]||(f[13]=[n("Тип",-1)])),_:1,__:[13]})):M("",!0),s("div",{class:K(g.value.type?"":"outline-1 outline-rose-300 rounded-md")},[e(h,{modelValue:g.value.type,"onUpdate:modelValue":f[1]||(f[1]=D=>g.value.type=D)},{default:t(()=>[e(A,null,{default:t(()=>[e(E,{placeholder:"Тип"})]),_:1}),e(o,null,{default:t(()=>[(a(),v(se,null,ae(d,(D,z)=>e(P,{key:z},{default:t(()=>[e(q,{value:D},{default:t(()=>[n(_(D),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)]),s("div",cl,[g.value.name?(a(),O($,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>f[14]||(f[14]=[n("Название или ссылка",-1)])),_:1,__:[14]})):M("",!0),e(T,{modelValue:g.value.name,"onUpdate:modelValue":f[2]||(f[2]=D=>g.value.name=D),placeholder:"Название или ссылка",class:K(g.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",pl,[s("div",ml,[e($,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[15]||(f[15]=[n("Метры(неон)",-1)])),_:1,__:[15]}),e(T,{modelValue:g.value.metrs,"onUpdate:modelValue":f[3]||(f[3]=D=>g.value.metrs=D),modelModifiers:{number:!0},placeholder:"Метры(неон)",type:"number",min:"0"},null,8,["modelValue"])]),s("div",vl,[e($,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[16]||(f[16]=[n("Эл-ты(неон)",-1)])),_:1,__:[16]}),e(T,{modelValue:g.value.els,"onUpdate:modelValue":f[4]||(f[4]=D=>g.value.els=D),modelModifiers:{number:!0},placeholder:"Эл-ты(неон)",type:"number",min:"0"},null,8,["modelValue"])]),s("div",_l,[e($,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[17]||(f[17]=[n("Акустика",-1)])),_:1,__:[17]}),e(T,{modelValue:g.value.acoustics,"onUpdate:modelValue":f[5]||(f[5]=D=>g.value.acoustics=D),modelModifiers:{number:!0},placeholder:"Акустика",type:"number",min:"0"},null,8,["modelValue"])])]),s("div",fl,[s("div",gl,[e($,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[18]||(f[18]=[n("Распаковка стандарт",-1)])),_:1,__:[18]}),e(T,{modelValue:g.value.unpackage,"onUpdate:modelValue":f[6]||(f[6]=D=>g.value.unpackage=D),modelModifiers:{number:!0},placeholder:"Распаковка стандарт",type:"number",min:"0"},null,8,["modelValue"])]),s("div",bl,[e($,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[19]||(f[19]=[n("Распаковка большая",-1)])),_:1,__:[19]}),e(T,{modelValue:g.value.unpackageBig,"onUpdate:modelValue":f[7]||(f[7]=D=>g.value.unpackageBig=D),modelModifiers:{number:!0},placeholder:"Распаковка большая",type:"number",min:"0"},null,8,["modelValue"])])]),s("div",yl,[s("div",xl,[e($,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[20]||(f[20]=[n("Шлифовка",-1)])),_:1,__:[20]}),e(T,{modelValue:g.value.grinding,"onUpdate:modelValue":f[8]||(f[8]=D=>g.value.grinding=D),modelModifiers:{number:!0},placeholder:"Шлифовка",type:"number",min:"0"},null,8,["modelValue"])]),s("div",wl,[e($,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>f[21]||(f[21]=[n("Смарт контроллер",-1)])),_:1,__:[21]}),e(T,{modelValue:g.value.smartContr,"onUpdate:modelValue":f[9]||(f[9]=D=>g.value.smartContr=D),modelModifiers:{number:!0},placeholder:"Смарт контроллер",type:"number",min:"0"},null,8,["modelValue"])])]),s("span",null," Стоимость: "+_(g.value.cost)+"р. ",1)]),e(k,{class:"w-full"},{default:t(()=>[s("div",kl,[e(V,{variant:"destructive",onClick:c},{default:t(()=>f[22]||(f[22]=[n(" Удалить ",-1)])),_:1,__:[22]}),e(V,{disabled:w.value,onClick:j},{default:t(()=>f[23]||(f[23]=[n(" Сохранить ",-1)])),_:1,__:[23]},8,["disabled"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),$l={class:"flex flex-col gap-5"},hl={class:"relative"},Ul={class:"relative"},Vl={class:"relative"},Cl={class:"relative"},Sl={class:"flex justify-between w-full gap-2"},We=ne({__name:"EditOtherReport",props:{report:{}},emits:["report-updated","close"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!0),w=m(!0),d=m({...y.report}),g=async()=>{try{await G.patch(`production/other-report/${d.value.id}`,d.value),S.value=!1,R("report-updated"),F({title:"Успех",description:"Отчет успешно обновлен"})}catch{F({title:"Ошибка",description:"Не удалось обновить отчет",variant:"destructive"})}},r=async()=>{try{await G.delete(`production/other-report/${d.value.id}`),S.value=!1,R("report-updated"),F({title:"Успех",description:"Отчет успешно удален"})}catch{F({title:"Ошибка",description:"Не удалось удалить отчет",variant:"destructive"})}};return J(d,()=>{const{date:j,name:c,cost:i}=d.value;w.value=!(j&&c&&i)},{deep:!0}),J(S,j=>{j||R("close")}),(j,c)=>{const i=Ce,f=Me,b=Ve,p=Ie,l=ge,$=Le,T=Oe,E=Re,A=Ue,q=Se;return a(),v("div",null,[e(q,{open:S.value,"onUpdate:open":c[4]||(c[4]=P=>S.value=P)},{default:t(()=>[e(A,{class:"max-w-[300px] flex flex-col"},{default:t(()=>[e(b,null,{default:t(()=>[e(i,null,{default:t(()=>c[5]||(c[5]=[n("Редактировать отчет",-1)])),_:1,__:[5]}),e(f)]),_:1}),s("div",$l,[s("div",hl,[d.value.date?(a(),O(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>c[6]||(c[6]=[n("Дата",-1)])),_:1,__:[6]})):M("",!0),e(l,{modelValue:d.value.date,"onUpdate:modelValue":c[0]||(c[0]=P=>d.value.date=P),type:"date",placeholder:"Дата",class:K(d.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Ul,[d.value.name?(a(),O(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>c[7]||(c[7]=[n("Описание",-1)])),_:1,__:[7]})):M("",!0),e(l,{modelValue:d.value.name,"onUpdate:modelValue":c[1]||(c[1]=P=>d.value.name=P),placeholder:"Описание",class:K(d.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Vl,[d.value.cost?(a(),O(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>c[8]||(c[8]=[n("Стоимость",-1)])),_:1,__:[8]})):M("",!0),e(l,{modelValue:d.value.cost,"onUpdate:modelValue":c[2]||(c[2]=P=>d.value.cost=P),type:"number",placeholder:"Стоимость",class:K(d.value.cost?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Cl,[e($,{modelValue:d.value.comment,"onUpdate:modelValue":c[3]||(c[3]=P=>d.value.comment=P),placeholder:"Комментарий"},null,8,["modelValue"]),d.value.comment?(a(),O(p,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>c[9]||(c[9]=[n(" Комментарий ",-1)])),_:1,__:[9]})):M("",!0)]),s("span",null," Стоимость: "+_(d.value.cost)+"р. ",1)]),e(E,{class:"w-full"},{default:t(()=>[s("div",Sl,[e(T,{variant:"destructive",onClick:r},{default:t(()=>c[10]||(c[10]=[n(" Удалить ",-1)])),_:1,__:[10]}),e(T,{disabled:w.value,onClick:g},{default:t(()=>c[11]||(c[11]=[n(" Сохранить ",-1)])),_:1,__:[11]},8,["disabled"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Ml={class:"flex flex-col gap-5"},Rl={class:"relative"},Dl={class:"relative"},Tl={class:"flex justify-between"},Pl={class:"relative flex items-center gap-2"},Il={class:"relative flex items-center gap-4"},Ol={class:"flex gap-2"},Fl={class:"relative"},El={class:"relative"},Nl={class:"relative"},Gl={class:"relative"},Bl={class:"relative"},Ll={class:"relative"},zl={key:0,class:"relative"},Al={class:"relative"},Wl={class:"flex justify-between w-full gap-2"},tt=ne({__name:"EditPackerReport",props:{report:{},curUser:{}},emits:["report-updated","close"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!0),w=m(!0),d=m({...y.report}),g=()=>{const{items:c,dimmers:i,overSize:f,isGift:b,dops:p,adapters:l,lam:$}=d.value;let T=0;console.log(y.curUser?.workSpaceId),y.curUser?.workSpaceId===8?T=c*100+l*60+$*20+i*60+(f?200:0)+(b?120:0)+p:T=c*100+l*60+$*20+i*60+(f?100:0)+(b?120:0)+p,d.value.cost=T},r=async()=>{try{w.value=!0,await G.patch(`production/packer-report/${d.value.id}`,d.value),S.value=!1,R("report-updated"),w.value=!1,F({title:"Успех",description:"Отчет успешно обновлен"})}catch(c){console.log(c)}},j=async()=>{try{await G.delete(`production/packer-report/${d.value.id}`),S.value=!1,R("report-updated"),F({title:"Успех",description:"Отчет успешно удален"})}catch(c){console.log(c)}};return J(d,()=>{const{date:c,name:i,items:f}=d.value;g(),w.value=!(c&&i&&f>0)},{deep:!0}),J(S,c=>{c||R("close")}),(c,i)=>{const f=Ce,b=Me,p=Ve,l=Ie,$=ge,T=kt,E=Le,A=Oe,q=Re,P=Ue,o=Se;return a(),v("div",null,[e(o,{open:S.value,"onUpdate:open":i[12]||(i[12]=h=>S.value=h)},{default:t(()=>[e(P,{class:"max-w-[400px] flex flex-col top-0 translate-y-[0px]"},{default:t(()=>[e(p,null,{default:t(()=>[e(f,null,{default:t(()=>i[13]||(i[13]=[n("Редактировать запись",-1)])),_:1,__:[13]}),e(b)]),_:1}),s("div",Ml,[s("div",Rl,[d.value.date?(a(),O(l,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[14]||(i[14]=[n("Дата смены",-1)])),_:1,__:[14]})):M("",!0),e($,{modelValue:d.value.date,"onUpdate:modelValue":i[0]||(i[0]=h=>d.value.date=h),type:"date",placeholder:"Дата смены",class:K(d.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Dl,[d.value.name?(a(),O(l,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[15]||(i[15]=[n("Название или ссылка",-1)])),_:1,__:[15]})):M("",!0),e($,{modelValue:d.value.name,"onUpdate:modelValue":i[1]||(i[1]=h=>d.value.name=h),placeholder:"Название или ссылка",class:K(d.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Tl,[s("div",Pl,[e(T,{checked:d.value.overSize,"onUpdate:checked":i[2]||(i[2]=h=>d.value.overSize=h)},null,8,["checked"]),e(l,{class:""},{default:t(()=>i[16]||(i[16]=[n("Негабарит",-1)])),_:1,__:[16]})]),i[18]||(i[18]=s("div",null,"|",-1)),s("div",Il,[e(T,{checked:d.value.isGift,"onUpdate:checked":i[3]||(i[3]=h=>d.value.isGift=h)},null,8,["checked"]),e(l,{class:""},{default:t(()=>i[17]||(i[17]=[n("Подарок",-1)])),_:1,__:[17]})])]),s("div",Ol,[s("div",Fl,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[19]||(i[19]=[n("Уп-ка",-1)])),_:1,__:[19]}),e($,{modelValue:d.value.items,"onUpdate:modelValue":i[4]||(i[4]=h=>d.value.items=h),modelModifiers:{number:!0},placeholder:"Уп-ка",type:"number",min:"0"},null,8,["modelValue"])]),s("div",El,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[20]||(i[20]=[n("Блоки",-1)])),_:1,__:[20]}),e($,{modelValue:d.value.adapters,"onUpdate:modelValue":i[5]||(i[5]=h=>d.value.adapters=h),modelModifiers:{number:!0},placeholder:"Блоки",type:"number",min:"0"},null,8,["modelValue"])]),s("div",Nl,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[21]||(i[21]=[n("Пленка",-1)])),_:1,__:[21]}),e($,{modelValue:d.value.lam,"onUpdate:modelValue":i[6]||(i[6]=h=>d.value.lam=h),modelModifiers:{number:!0},placeholder:"Пленка",type:"number",min:"0"},null,8,["modelValue"])]),s("div",Gl,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[22]||(i[22]=[n("Дим",-1)])),_:1,__:[22]}),e($,{modelValue:d.value.dimmers,"onUpdate:modelValue":i[7]||(i[7]=h=>d.value.dimmers=h),modelModifiers:{number:!0},placeholder:"Дим",type:"number",min:"0"},null,8,["modelValue"])])]),s("div",Bl,[d.value.dopsComment?(a(),O(l,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[23]||(i[23]=[n("Доп работы",-1)])),_:1,__:[23]})):M("",!0),e($,{modelValue:d.value.dopsComment,"onUpdate:modelValue":i[8]||(i[8]=h=>d.value.dopsComment=h),placeholder:"Доп работы"},null,8,["modelValue"])]),s("div",Ll,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[24]||(i[24]=[n("Стоимость за доп. работы",-1)])),_:1,__:[24]}),e($,{modelValue:d.value.dops,"onUpdate:modelValue":i[9]||(i[9]=h=>d.value.dops=h),placeholder:"Стоимость за доп. работы",type:"number"},null,8,["modelValue"])]),["PACKER","LOGIST"].includes(c.curUser?.role.shortName||"")?M("",!0):(a(),v("div",zl,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[25]||(i[25]=[n("Штраф",-1)])),_:1,__:[25]}),e($,{modelValue:d.value.penaltyCost,"onUpdate:modelValue":i[10]||(i[10]=h=>d.value.penaltyCost=h),placeholder:"Штраф",type:"number"},null,8,["modelValue"])])),s("div",Al,[e(E,{modelValue:d.value.comment,"onUpdate:modelValue":i[11]||(i[11]=h=>d.value.comment=h),placeholder:"Комментарий"},null,8,["modelValue"]),d.value.comment?(a(),O(l,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[26]||(i[26]=[n(" Комментарий ",-1)])),_:1,__:[26]})):M("",!0)]),s("span",null," Стоимость: "+_(d.value.cost)+"р. ",1)]),e(q,{class:"w-full"},{default:t(()=>[s("div",Wl,[e(A,{variant:"destructive",onClick:j},{default:t(()=>i[27]||(i[27]=[n(" Удалить ",-1)])),_:1,__:[27]}),e(A,{disabled:w.value,onClick:r},{default:t(()=>i[28]||(i[28]=[n(" Сохранить ",-1)])),_:1,__:[28]},8,["disabled"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),Hl={class:"flex gap-4"},jl={class:"flex flex-col gap-2"},ql={class:"w-full flex items-center gap-2"},Yl={class:"w-[215px]"},Kl={key:0,class:"text-center"},Xl={key:1,class:"text-red-500 text-center"},Zl={key:2,class:"text-center"},Ql={key:3,class:"flex gap-4"},Jl={class:"w-full py-2.5 pl-4"},es=["href"],ts={key:1},ls={class:"flex items-center gap-2"},ss={key:0,class:"text-xs text-gray-500"},as={key:1,class:"text-gray-600"},os={key:0,class:"flex text-xs text-gray-600 justify-center"},ns={key:0,class:"text-green-600"},us={key:1,class:"text-sx text-red-500"},is={class:"w-full min-w-[300px]"},rs=ne({__name:"List",props:{range:{}},setup(B){const L=ze(),{$useApi:G}=ue(),{toast:F}=ce(),R=B,y=m(""),S=L.user,w=m([]),d=m([]),g=m(!1),r=m(null),j=m(!1),c=m(null),i=m(!1),f=m(null),b=m(!1),p=m(null),l=m(!1),$=m(null),T=m([]),E=m("all"),A=m(0),q=m({els:0,metrs:0,mastersSalary:0,orders:0,ordersCost:0,mastersReports:0,packersReports:0,packages:0,packagersSalary:0,repairs:0,repairsCost:0,penalties:0,penaltiesCost:0,otherReports:0,otherReportsCost:0,totalCost:0}),P=async()=>{try{if(r.value=null,!R.range)return;if(E.value==="all"){const{data:k}=await G.get("production/orders",{params:R.range});w.value=k.orders,d.value=k.orders,q.value=k.totals}else{const{data:k}=await G.get(`production/${E.value}/orders`,{params:R.range});w.value=k.orders,d.value=k.orders,q.value=k.totals}}catch{r.value="Не удалось загрузить отчеты",F({title:"Ошибка",description:r.value,variant:"destructive"})}finally{g.value=!1}},o=async()=>{try{const{data:k}=await G.get("production/workspaces");T.value=k}catch(k){console.log(k)}finally{g.value=!1}},h=k=>{A.value=k.userId,console.log(k.report_type),k.report_type==="Сборка"?(c.value={...k},j.value=!0):k.report_type==="Другое"?(p.value={...k},b.value=!0):k.report_type==="Упаковка"?($.value={...k},l.value=!0):k.report_type==="Ремонт"&&(f.value={...k},i.value=!0)},V=async()=>{await P(),j.value=!1,c.value=null,i.value=!1,f.value=null,b.value=!1,p.value=null,l.value=!1,tt.value=null};return J(E,async k=>{await P()},{deep:!0}),J(()=>R.range,async()=>{await P()}),J(y,async()=>{if(y.value.length>2)try{const{data:k}=await G.get("/production/reports/search",{params:{name:y.value}});if(w.value=k,d.value=k,!w.value.length)return}catch(k){console.log(k)}else await P()}),fe(async()=>{await P(),await o()}),(k,C)=>{const H=ge,D=Ge,z=Ne,W=Ee,I=he,x=we,U=xe,N=ye,te=ke,re=$e,X=be,de=Be,Q=_t,ie=ft,ee=We,De=tt,me=ht,Y=Ut,_e=$t,Te=Ct,He=Vt,je=Bt,qe=dt;return a(),v("div",Hl,[s("div",jl,[s("div",ql,[s("div",Yl,[e(H,{modelValue:y.value,"onUpdate:modelValue":C[0]||(C[0]=Z=>y.value=Z),placeholder:"Глобальный поиск..."},null,8,["modelValue"])])]),e(W,{modelValue:E.value,"onUpdate:modelValue":C[1]||(C[1]=Z=>E.value=Z)},{default:t(()=>[e(z,null,{default:t(()=>[e(D,{value:"all"},{default:t(()=>C[7]||(C[7]=[n(" Все ",-1)])),_:1,__:[7]}),(a(!0),v(se,null,ae(T.value,Z=>(a(),O(D,{key:Z.id,value:Z.id},{default:t(()=>[n(_(Z.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),g.value?(a(),v("div",Kl,"Загрузка...")):r.value?(a(),v("div",Xl,_(r.value),1)):w.value.length===0?(a(),v("div",Zl," Нет отчетов для выбранного мастера. ")):(a(),v("div",Ql,[e(de,{class:"h-[calc(100vh-225px)] rounded-sm shrink-0"},{default:t(()=>[e(X,{class:"bg-white text-sm relative"},{default:t(()=>[e(I),e(N,{class:"bg-gray-50 sticky top-0 z-50"},{default:t(()=>[e(U,null,{default:t(()=>[e(x,{class:"text-center font-semibold text-gray-700"},{default:t(()=>C[8]||(C[8]=[n("Дата",-1)])),_:1,__:[8]}),e(x,{class:"text-center font-semibold text-gray-700"},{default:t(()=>C[9]||(C[9]=[n("Работы",-1)])),_:1,__:[9]}),e(x,{class:"text-center font-semibold text-gray-700"},{default:t(()=>C[10]||(C[10]=[n("Исполнитель",-1)])),_:1,__:[10]}),e(x,{class:"text-center font-semibold text-gray-700"},{default:t(()=>C[11]||(C[11]=[n("Стоимость",-1)])),_:1,__:[11]})]),_:1})]),_:1}),(a(!0),v(se,null,ae(w.value,(Z,le)=>(a(),O(re,{key:le,class:"border-1 border-b-black"},{default:t(()=>[e(U,{class:"relative bg-slate-300 hover:bg-slate-300 font-semibold"},{default:t(()=>[e(te,{colspan:"3",class:"p-0"},{default:t(()=>[s("div",Jl,[Z.name.startsWith("http")?(a(),v("a",{key:0,href:Z.name,target:"_blank",class:"text-blue-600 hover:underline flex items-center",onClick:C[2]||(C[2]=Je(()=>{},["stop"]))},[C[12]||(C[12]=s("span",null," Карточка ",-1)),e(u(Yt),{class:"h-4"})],8,es)):(a(),v("div",ts,[s("span",null,_(Z.name),1)]))])]),_:2},1024),e(te,{colspan:"1",class:"text-right text-green-600 pr-4"},{default:t(()=>[n(_(w.value[le].orders.reduce((oe,Ye)=>oe+Ye.cost,0)-w.value[le].orders.reduce((oe,Ye)=>oe+Ye.penaltyCost,0)+"₽"),1)]),_:2},1024)]),_:2},1024),(a(!0),v(se,null,ae(Z.orders,(oe,Ye)=>(a(),O(U,{key:Ye,class:K({"text-center bg-gray-50 cursor-pointer hover:bg-slate-200":!0,"bg-red-100":oe.penaltyCost,"bg-blue-100/50":oe.report_type==="Ремонт","bg-yellow-100/50":oe.report_type==="Другое"}),onClick:xr=>h(oe)},{default:t(()=>[e(te,{class:"text-xs text-gray-600 py-1.5"},{default:t(()=>[s("div",ls,[s("span",null,_(new Date(oe.date).toLocaleDateString()),1),oe.comment?(a(),O(u(Ae),{key:0})):M("",!0)])]),_:2},1024),e(te,{class:"py-1.5 flex flex-col text-wrap"},{default:t(()=>[s("span",null,_(oe.penaltyCost?"Штраф":oe.report_type),1),oe.type?(a(),v("span",ss,_(oe.type),1)):M("",!0),oe.dopsComment?(a(),v("span",as," + "+_(oe.dopsComment),1)):M("",!0)]),_:2},1024),e(te,{class:"py-1.5"},{default:t(()=>[s("span",null,_(oe.user?.fullName??"Нет имени"),1),oe.report_type==="Сборка"&&oe.metrs||oe.els?(a(),v("div",os,[s("span",null,_(oe.metrs)+"м./ ",1),s("span",null,_(oe.els)+"эл. ",1)])):M("",!0)]),_:2},1024),e(te,{class:"py-1.5 flex flex-col"},{default:t(()=>[oe.cost?(a(),v("span",ns,"+"+_(oe.cost)+"₽",1)):M("",!0),oe.penaltyCost?(a(),v("span",us,"-"+_(oe.penaltyCost)+"₽",1)):M("",!0)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024))),128))]),_:1})]),_:1})])),j.value&&c.value&&u(S)?(a(),O(Q,{key:4,report:c.value,"cur-user":u(S),onReportUpdated:V,onClose:C[3]||(C[3]=Z=>j.value=!1)},null,8,["report","cur-user"])):M("",!0),i.value&&f.value&&u(S)?(a(),O(ie,{key:5,report:f.value,"cur-user":u(S),onReportUpdated:V,onClose:C[4]||(C[4]=Z=>i.value=!1)},null,8,["report","cur-user"])):M("",!0),b.value&&p.value?(a(),O(ee,{key:6,report:p.value,onReportUpdated:V,onClose:C[5]||(C[5]=Z=>b.value=!1)},null,8,["report"])):M("",!0),l.value&&$.value?(a(),O(De,{key:7,report:$.value,"cur-user":u(S),onReportUpdated:V,onClose:C[6]||(C[6]=Z=>l.value=!1)},null,8,["report","cur-user"])):M("",!0)]),s("div",is,[e(qe,null,{default:t(()=>[e(_e,null,{default:t(()=>[e(me,null,{default:t(()=>C[13]||(C[13]=[n("Статистика",-1)])),_:1,__:[13]}),e(Y)]),_:1}),e(He,null,{default:t(()=>[s("div",null,[C[14]||(C[14]=s("span",{class:"text-xl font-semibold text-gray-700"},"Фрезеровка",-1)),C[15]||(C[15]=s("ul",null,null,-1)),e(Te),C[16]||(C[16]=s("span",{class:"text-xl font-semibold text-gray-700"},"Сборка",-1)),s("ul",null,[s("li",null,"Элементы: "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(q.value.els)),1),s("li",null,"Метры: "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(+q.value.metrs.toFixed(2)))+"м",1),s("li",null,"Вывески: "+_(q.value.mastersReports),1),s("li",null," Ремонты: "+_(q.value.repairs)+" на сумму "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(q.value.repairsCost)+"₽"),1),s("li",null," Зарплата мастеров: "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(+q.value.mastersSalary.toFixed(2))+"₽"),1)]),e(Te),C[17]||(C[17]=s("span",{class:"text-xl font-semibold text-gray-700"},"Упаковка",-1)),s("ul",null,[s("li",null,"Упаковано: "+_(q.value.packages),1),s("li",null," Зарплата упаковщиков: "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(+q.value.packagersSalary.toFixed(2))+"₽"),1)]),e(Te),C[18]||(C[18]=s("span",{class:"text-xl font-semibold text-gray-700"},"Остальное",-1)),s("ul",null,[s("li",null," Штрафы: "+_(q.value.penalties)+" на сумму "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(q.value.penaltiesCost)+"₽")+"р. ",1),s("li",null," Ремонты: "+_(q.value.repairs)+" на сумму "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(q.value.repairsCost)+"₽")+"р. ",1),s("li",null," Другое: "+_(q.value.otherReports)+" на сумму "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(q.value.otherReportsCost)+"₽")+"р. ",1)]),e(Te),C[19]||(C[19]=s("span",{class:"text-xl font-semibold text-gray-700"},"Итого",-1)),s("ul",null,[s("li",null,"Затраты: "+_(("useMyFormatPrice"in k?k.useMyFormatPrice:u(ve))(q.value.totalCost)+"₽"),1)])])]),_:1}),e(je)]),_:1})])])}}}),ds={class:"w-full"},cs={class:""},ps={class:"flex flex-col gap-5"},ms={class:"relative"},vs={key:0,class:"relative"},_s={key:1,class:"relative"},fs={class:"relative"},gs={class:"flex gap-2"},bs={class:"relative"},ys={class:"flex gap-2"},xs={class:"relative"},ws={class:"flex gap-2"},ks={class:"flex flex-col gap-2"},$s={key:0,class:"relative"},hs={class:"relative"},Us={class:"flex justify-end w-full"},Vs={class:"flex flex-col gap-5"},Cs={class:"relative"},Ss={class:"relative"},Ms={class:"relative"},Rs={class:"flex gap-2"},Ds={class:"relative"},Ts={class:"relative"},Ps={class:"relative"},Is={class:"flex gap-2"},Os={class:"relative"},Fs={class:"relative"},Es={class:"flex gap-2"},Ns={class:"relative"},Gs={class:"relative"},Bs={class:"flex justify-end w-full"},Ls={class:"flex flex-col gap-5"},zs={class:"relative"},As={class:"relative"},Ws={class:"relative"},Hs={class:"relative"},js={class:"flex justify-end w-full"},Ot=ne({__name:"CreateMasterReport",props:{masterId:{},curUser:{}},emits:["report-created"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!1),w=m(!0),d=m("new"),g=["Стандартная","Уличная","РГБ","Смарт","Контражур","РГБ Контражур","ВБ","ОЗОН","Подарок"],r=["Стандартная","Контражур","Подарок","Уличная","Уличный контражур","РГБ Контражур","РГБ","Смарт"],j=["Стандартная","Уличная","РГБ","Смарт"],c={date:new Date().toISOString().slice(0,10),name:"",metrs:0,els:0,type:g[0],cost:0,userId:y.masterId,penaltyCost:0,comment:""},i={date:new Date().toISOString().slice(0,10),name:"",metrs:0,els:0,type:j[0],cost:0,userId:y.masterId,grinding:0,unpackage:0,unpackageBig:0,acoustics:0,smartContr:0},f={date:new Date().toISOString().slice(0,10),name:"",cost:0,userId:y.masterId},b=m({...f}),p=m({...c}),l=m({...i}),$=()=>{const{metrs:P,els:o,type:h}=p.value;let V=0;if(y.curUser.workSpaceId===8)switch(h){case"Стандартная":case"ВБ":case"ОЗОН":case"Подарок":V=P*60+o*30;break;case"Уличная":V=P*90+o*45;break;case"Уличный контражур":V=P*54+o*37;break;case"РГБ Контражур":V=P*80+o*67;break;case"РГБ":case"Смарт":V=P*84+o*42;break;case"Контражур":V=P*36+o*18;break;default:V=0}else switch(h){case"Стандартная":case"ВБ":case"ОЗОН":case"Подарок":V=P*100+o*50;break;case"Уличная":case"РГБ Контражур":V=P*130+o*70;break;case"РГБ":case"Смарт":V=P*140+o*150;break;case"Контражур":V=P*60+o*30;break;default:V=0}p.value.cost=V},T=()=>{const{metrs:P,els:o,type:h,grinding:V,unpackage:k,unpackageBig:C,acoustics:H,smartContr:D}=l.value;let z=0;if(y.curUser.workSpaceId!==8){switch(h){case"Стандартная":z=P*130+o*70;break;case"Уличная":z=P*140+o*80;break;case"РГБ":z=P*150+o*200;break;case"Смарт":z=P*160+o*180;break;default:z=0}z+=V*350,z+=k*50,z+=C*100,z+=H*150,z+=D*200}else{switch(h){case"Стандартная":z=P*80+o*40;break;case"Уличная":z=P*90+o*45;break;case"РГБ":z=P*100+o*90;break;case"Смарт":z=P*75+o*80;break;default:z=0}z+=V*200,z+=k*50,z+=C*100,z+=H*50,z+=D*200}l.value.cost=z},E=async()=>{try{w.value=!0,await G.post("production/master-report",{...p.value,userId:y.masterId}),S.value=!1,w.value=!1,R("report-created"),F({title:"Успех",description:"Отчет успешно создан"})}catch(P){console.log(P)}},A=async()=>{try{w.value=!0,await G.post("production/master-repair",{...l.value,userId:y.masterId}),S.value=!1,w.value=!1,R("report-created"),F({title:"Успех",description:"Ремонтный отчет успешно создан"})}catch(P){console.log(P)}},q=async()=>{try{w.value=!0,await G.post("production/other-report",{...b.value,userId:y.masterId}),S.value=!1,w.value=!1,R("report-created"),F({title:"Успех",description:"Отчет успешно создан"})}catch(P){console.log(P)}};return J(b,()=>{const{date:P,name:o,cost:h}=b.value;w.value=!(P&&o&&h)},{deep:!0}),J(p,()=>{$();const{date:P,name:o,metrs:h,els:V,type:k}=p.value;y.curUser.role.shortName==="MASTER"||y.curUser.role.shortName==="PACKER"?w.value=!(P&&o&&h>0&&V>0&&k):w.value=!(P&&o&&k)},{deep:!0}),J(l,P=>{const{date:o,name:h,metrs:V,els:k,type:C,grinding:H,unpackage:D,unpackageBig:z,acoustics:W,smartContr:I}=l.value;T(),w.value=!(o&&h&&V>=0&&k>=0&&C&&H>=0&&D>=0&&z>=0&&W>=0&&I>=0)},{deep:!0}),J(S,P=>{P||(p.value={...c,userId:y.masterId},l.value={...i,userId:y.masterId},b.value={...f,userId:y.masterId})}),J(d,()=>{p.value={...c,userId:y.masterId},l.value={...i,userId:y.masterId},b.value={...f,userId:y.masterId},w.value=!0}),(P,o)=>{const h=Oe,V=rt,k=Ce,C=Me,H=Ve,D=Ge,z=Ne,W=Ie,I=ge,x=ot,U=at,N=ut,te=it,re=nt,X=st,de=Le,Q=vt,ie=Ee,ee=Re,De=Ue,me=Se;return a(),v("div",ds,[e(me,{open:S.value,"onUpdate:open":o[23]||(o[23]=Y=>S.value=Y)},{default:t(()=>[e(V,{"as-child":""},{default:t(()=>[e(h,{class:"w-full"},{default:t(()=>o[24]||(o[24]=[n("Создать",-1)])),_:1,__:[24]})]),_:1}),e(De,{class:"max-w-[400px] flex flex-col top-0 translate-y-[0px]"},{default:t(()=>[e(H,null,{default:t(()=>[e(k,null,{default:t(()=>o[25]||(o[25]=[n("Создать запись",-1)])),_:1,__:[25]}),e(C)]),_:1}),s("div",cs,[e(ie,{modelValue:d.value,"onUpdate:modelValue":o[22]||(o[22]=Y=>d.value=Y)},{default:t(()=>[e(z,{class:"w-full mb-4"},{default:t(()=>[e(D,{class:"w-full",value:"new"},{default:t(()=>o[26]||(o[26]=[n(" Новое ",-1)])),_:1,__:[26]}),e(D,{class:"w-full",value:"repair"},{default:t(()=>o[27]||(o[27]=[n(" Ремонт ",-1)])),_:1,__:[27]}),e(D,{class:"w-full",value:"other"},{default:t(()=>o[28]||(o[28]=[n(" Другое ",-1)])),_:1,__:[28]})]),_:1}),e(Q,{value:"new"},{default:t(()=>[s("div",ps,[s("div",ms,[p.value.date?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[29]||(o[29]=[n("Дата смены",-1)])),_:1,__:[29]})):M("",!0),e(I,{modelValue:p.value.date,"onUpdate:modelValue":o[0]||(o[0]=Y=>p.value.date=Y),type:"date",placeholder:"Дата смены",class:K(p.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),y.curUser.workSpaceId!==8?(a(),v("div",vs,[p.value.type?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[30]||(o[30]=[n("Тип",-1)])),_:1,__:[30]})):M("",!0),s("div",{class:K(p.value.type?"":"outline-1 outline-rose-300 rounded-md")},[e(X,{modelValue:p.value.type,"onUpdate:modelValue":o[1]||(o[1]=Y=>p.value.type=Y)},{default:t(()=>[e(U,null,{default:t(()=>[e(x,{placeholder:"Тип"})]),_:1}),e(re,{class:"h-[250px]"},{default:t(()=>[(a(),v(se,null,ae(g,(Y,_e)=>e(te,{key:_e},{default:t(()=>[e(N,{value:Y},{default:t(()=>[n(_(Y),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):(a(),v("div",_s,[p.value.type?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[31]||(o[31]=[n("Тип",-1)])),_:1,__:[31]})):M("",!0),s("div",{class:K(p.value.type?"":"outline-1 outline-rose-300 rounded-md")},[e(X,{modelValue:p.value.type,"onUpdate:modelValue":o[2]||(o[2]=Y=>p.value.type=Y)},{default:t(()=>[e(U,null,{default:t(()=>[e(x,{placeholder:"Тип"})]),_:1}),e(re,null,{default:t(()=>[(a(),v(se,null,ae(r,(Y,_e)=>e(te,{key:_e},{default:t(()=>[e(N,{value:Y},{default:t(()=>[n(_(Y),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])),s("div",fs,[p.value.name?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[32]||(o[32]=[n("Название или ссылка",-1)])),_:1,__:[32]})):M("",!0),e(I,{modelValue:p.value.name,"onUpdate:modelValue":o[3]||(o[3]=Y=>p.value.name=Y),placeholder:"Название или ссылка",class:K(p.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",gs,[s("div",bs,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[33]||(o[33]=[n("Метры",-1)])),_:1,__:[33]}),s("div",ys,[e(I,{modelValue:p.value.metrs,"onUpdate:modelValue":o[4]||(o[4]=Y=>p.value.metrs=Y),modelModifiers:{number:!0},placeholder:"Метры",type:"number",min:"0",class:K(p.value.metrs>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",xs,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[34]||(o[34]=[n("Элементы",-1)])),_:1,__:[34]}),s("div",ws,[e(I,{modelValue:p.value.els,"onUpdate:modelValue":o[5]||(o[5]=Y=>p.value.els=Y),modelModifiers:{number:!0},placeholder:"Элементы",type:"number",min:"0",class:K(p.value.els>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])])]),s("div",ks,[["PACKER","MASTER"].includes(P.curUser?.role.shortName||"")?M("",!0):(a(),v("div",$s,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[35]||(o[35]=[n("Штраф",-1)])),_:1,__:[35]}),e(I,{modelValue:p.value.penaltyCost,"onUpdate:modelValue":o[6]||(o[6]=Y=>p.value.penaltyCost=Y),placeholder:"Штраф",type:"number"},null,8,["modelValue"])])),s("div",hs,[e(de,{modelValue:p.value.comment,"onUpdate:modelValue":o[7]||(o[7]=Y=>p.value.comment=Y),placeholder:"Комментарий"},null,8,["modelValue"]),p.value.comment?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[36]||(o[36]=[n(" Комментарий ",-1)])),_:1,__:[36]})):M("",!0)])]),s("span",null," Стоимость: "+_(p.value.cost)+"р. ",1)]),s("div",Us,[e(h,{disabled:w.value,onClick:E},{default:t(()=>o[37]||(o[37]=[n(" Создать ",-1)])),_:1,__:[37]},8,["disabled"])])]),_:1}),e(Q,{value:"repair"},{default:t(()=>[s("div",Vs,[s("div",Cs,[l.value.date?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[38]||(o[38]=[n("Дата смены",-1)])),_:1,__:[38]})):M("",!0),e(I,{modelValue:l.value.date,"onUpdate:modelValue":o[8]||(o[8]=Y=>l.value.date=Y),type:"date",placeholder:"Дата смены",class:K(l.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Ss,[l.value.type?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[39]||(o[39]=[n("Тип",-1)])),_:1,__:[39]})):M("",!0),s("div",{class:K(l.value.type?"":"outline-1 outline-rose-300 rounded-md")},[e(X,{modelValue:l.value.type,"onUpdate:modelValue":o[9]||(o[9]=Y=>l.value.type=Y)},{default:t(()=>[e(U,null,{default:t(()=>[e(x,{placeholder:"Тип"})]),_:1}),e(re,null,{default:t(()=>[(a(),v(se,null,ae(j,(Y,_e)=>e(te,{key:_e},{default:t(()=>[e(N,{value:Y},{default:t(()=>[n(_(Y),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)]),s("div",Ms,[l.value.name?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[40]||(o[40]=[n("Название или ссылка",-1)])),_:1,__:[40]})):M("",!0),e(I,{modelValue:l.value.name,"onUpdate:modelValue":o[10]||(o[10]=Y=>l.value.name=Y),placeholder:"Название или ссылка",class:K(l.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Rs,[s("div",Ds,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[41]||(o[41]=[n("Метры(неон)",-1)])),_:1,__:[41]}),e(I,{modelValue:l.value.metrs,"onUpdate:modelValue":o[11]||(o[11]=Y=>l.value.metrs=Y),modelModifiers:{number:!0},placeholder:"Метры(неон)",type:"number",min:"0"},null,8,["modelValue"])]),s("div",Ts,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[42]||(o[42]=[n("Эл-ты(неон)",-1)])),_:1,__:[42]}),e(I,{modelValue:l.value.els,"onUpdate:modelValue":o[12]||(o[12]=Y=>l.value.els=Y),modelModifiers:{number:!0},placeholder:"Эл-ты(неон)",type:"number",min:"0"},null,8,["modelValue"])]),s("div",Ps,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[43]||(o[43]=[n("Акустика",-1)])),_:1,__:[43]}),e(I,{modelValue:l.value.acoustics,"onUpdate:modelValue":o[13]||(o[13]=Y=>l.value.acoustics=Y),modelModifiers:{number:!0},placeholder:"Акустика",type:"number",min:"0"},null,8,["modelValue"])])]),s("div",Is,[s("div",Os,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[44]||(o[44]=[n("Распаковка стандарт",-1)])),_:1,__:[44]}),e(I,{modelValue:l.value.unpackage,"onUpdate:modelValue":o[14]||(o[14]=Y=>l.value.unpackage=Y),modelModifiers:{number:!0},placeholder:"Распаковка стандарт",type:"number",min:"0"},null,8,["modelValue"])]),s("div",Fs,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[45]||(o[45]=[n("Распаковка большая",-1)])),_:1,__:[45]}),e(I,{modelValue:l.value.unpackageBig,"onUpdate:modelValue":o[15]||(o[15]=Y=>l.value.unpackageBig=Y),modelModifiers:{number:!0},placeholder:"Распаковка большая",type:"number",min:"0"},null,8,["modelValue"])])]),s("div",Es,[s("div",Ns,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[46]||(o[46]=[n("Шлифовка",-1)])),_:1,__:[46]}),e(I,{modelValue:l.value.grinding,"onUpdate:modelValue":o[16]||(o[16]=Y=>l.value.grinding=Y),modelModifiers:{number:!0},placeholder:"Шлифовка",type:"number",min:"0"},null,8,["modelValue"])]),s("div",Gs,[e(W,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[47]||(o[47]=[n("Смарт контроллер",-1)])),_:1,__:[47]}),e(I,{modelValue:l.value.smartContr,"onUpdate:modelValue":o[17]||(o[17]=Y=>l.value.smartContr=Y),modelModifiers:{number:!0},placeholder:"Смарт контроллер",type:"number",min:"0"},null,8,["modelValue"])])]),s("span",null," Стоимость: "+_(l.value.cost.toFixed(2))+"р. ",1)]),s("div",Bs,[e(h,{disabled:w.value,onClick:A},{default:t(()=>o[48]||(o[48]=[n(" Создать ",-1)])),_:1,__:[48]},8,["disabled"])])]),_:1}),e(Q,{value:"other"},{default:t(()=>[s("div",Ls,[s("div",zs,[b.value.date?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[49]||(o[49]=[n("Дата",-1)])),_:1,__:[49]})):M("",!0),e(I,{modelValue:b.value.date,"onUpdate:modelValue":o[18]||(o[18]=Y=>b.value.date=Y),type:"date",placeholder:"Дата",class:K(b.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",As,[b.value.name?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[50]||(o[50]=[n("Описание",-1)])),_:1,__:[50]})):M("",!0),e(I,{modelValue:b.value.name,"onUpdate:modelValue":o[19]||(o[19]=Y=>b.value.name=Y),placeholder:"Описание",class:K(b.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Ws,[b.value.cost?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>o[51]||(o[51]=[n("Стоимость",-1)])),_:1,__:[51]})):M("",!0),e(I,{modelValue:b.value.cost,"onUpdate:modelValue":o[20]||(o[20]=Y=>b.value.cost=Y),type:"number",placeholder:"Стоимость",class:K(b.value.cost?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Hs,[e(de,{modelValue:b.value.comment,"onUpdate:modelValue":o[21]||(o[21]=Y=>b.value.comment=Y),placeholder:"Комментарий"},null,8,["modelValue"]),p.value.comment?(a(),O(W,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>o[52]||(o[52]=[n(" Комментарий ",-1)])),_:1,__:[52]})):M("",!0)]),s("span",null," Стоимость: "+_(b.value.cost)+"р. ",1)]),s("div",js,[e(h,{disabled:w.value,onClick:q},{default:t(()=>o[53]||(o[53]=[n(" Создать ",-1)])),_:1,__:[53]},8,["disabled"])])]),_:1})]),_:1},8,["modelValue"])]),e(ee)]),_:1})]),_:1},8,["open"])])}}}),qs={class:"flex flex-col gap-2 h-[calc(100vh-180px)] overflow-hidden min-h-0"},Ys={class:"flex flex-wrap gap-2 items-center"},Ks={key:0,class:"grow"},Xs={class:"grow min-w-[200px]"},Zs={class:"grow"},Qs={class:"min-w-[320px] grow rounded-lg p-2 border border-slate-200 bg-white text-slate-950 shadow-sm dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50"},Js={class:"flex justify-between"},ea={class:"grow"},ta={key:0,class:"text-center"},la={key:1,class:"text-red-500 text-center"},sa={key:2,class:"text-center"},aa={key:3,class:"text-center"},oa={key:4,class:"flex-1 min-h-0"},na={class:"flex items-center gap-2"},ua={class:"flex flex-col items-center"},ia=["href"],ra={key:1,class:"flex text-wrap flex-col items-center"},da={class:"text-wrap text-gray-600"},ca={key:0},pa={key:1},ma={key:2,class:"flex flex-col"},va={class:"flex flex-col items-center"},_a={class:"font-semibold text-green-600"},fa={key:0,class:"font-semibold text-red-500"},ga=ne({__name:"Masters",props:{range:{}},setup(B){const L=ze(),{$useApi:G}=ue(),{toast:F}=ce(),R=B,y=m(R.range.from),S=m(R.range.from.slice(0,7)),w=L.user,d=m([]),g=m(null),r=m([]),j=m([]),c=m(!1),i=m(null),f=m(!1),b=m(!1),p=m(null),l=m(null),$=m(!1),T=m(null),E=m(),A=m(0),q=m(0),P=m("all"),o=()=>{A.value=r.value.reduce((x,U)=>x+U.cost-U.penaltyCost,0),q.value=r.value.reduce((x,U)=>x+(U.isOther?0:U.els),0)},h=async()=>{try{c.value=!0,i.value=null;const{data:x}=await G.get("production/masters");d.value=x,x.length>0?g.value=x[0]:(g.value=null,F({title:"Ошибка",description:"Список мастеров пуст",variant:"destructive"}))}catch{i.value="Не удалось загрузить список мастеров",F({title:"Ошибка",description:i.value,variant:"destructive"})}finally{c.value=!1}},V=async()=>{if(g.value&&R.range)try{c.value=!0,i.value=null;const{data:x}=await G.get(`production/master/${g.value.id}/reports`,{params:R.range});r.value=x,j.value=x,I(P.value),o()}catch{i.value="Не удалось загрузить отчеты",F({title:"Ошибка",description:i.value,variant:"destructive"})}finally{c.value=!1}},k=x=>{x.isRepair?(l.value={...x},b.value=!0):x.isOther?(T.value={...x},$.value=!0):(p.value={...x},f.value=!0)},C=async()=>{await V(),f.value=!1,b.value=!1,$.value=!1,p.value=null,l.value=null,T.value=null},H=async()=>{if(g.value)try{const{data:x}=await G.get(`production/master/${g.value.id}/shifts`,{params:{period:S.value}});E.value=x.map(U=>U.shift_date)}catch{F({title:"Ошибка",description:"Не удалось загрузить смены",variant:"destructive"})}},D=x=>"Рабочих дней: "+x.length,z=async()=>{if(g.value)try{const x=E.value?E.value.map(U=>new Date(U).toISOString().slice(0,10)):[];await G.post(`production/master/${g.value.id}/shifts`,{shiftDates:x,period:R.range.from.slice(0,7)}),F({title:"Успех",description:"Смены сохранены"})}catch(x){console.log(x),F({title:"Ошибка",description:"Не удалось сохранить смены",variant:"destructive"})}},W=x=>{const U=new Date(x);return`${U.getDate().toString().padStart(2,"0")}.${(U.getMonth()+1).toString().padStart(2,"0")}.${U.getFullYear()}`},I=x=>{if(x==="repairs"){r.value=j.value.filter(U=>U.isRepair===!0),o();return}if(x==="works"){r.value=j.value.filter(U=>U.isRepair!==!0&&U.isOther!==!0),o();return}if(x==="other"){r.value=j.value.filter(U=>U.isOther===!0),o();return}r.value=j.value};return J(P,x=>{I(x),o()},{deep:!0}),J(()=>R.range,async()=>{y.value=R.range.from,S.value=R.range.from.slice(0,7),await V(),await H()}),fe(async()=>{await h()}),J(g,()=>{g.value&&(V(),H())}),(x,U)=>{const N=ct,te=Ge,re=Ne,X=Ee,de=Ot,Q=he,ie=we,ee=xe,De=ye,me=ke,Y=$e,_e=be,Te=Be,He=_t,je=ft,qe=We;return a(),v("div",qs,[s("div",Ys,[d.value.length>1?(a(),v("div",Ks,[e(N,{items:d.value.map(Z=>({value:Z.id,label:Z.fullName})),label:g.value?.fullName||"Выберите мастера",onSelectedItem:U[0]||(U[0]=Z=>{g.value=d.value.find(le=>le.id===Z)||null})},null,8,["items","label"])])):M("",!0),s("div",Xs,[e(u(Fe),{modelValue:E.value,"onUpdate:modelValue":[U[1]||(U[1]=Z=>E.value=Z),z],"multi-dates":"","enable-time-picker":!1,locale:"ru",placeholder:"Выбрать смены","select-text":"Готово","cancel-text":"Закрыть","start-date":y.value,format:D,class:"grow","hide-offset-dates":"",clearable:!1},null,8,["modelValue","start-date"])]),s("div",Zs,[e(X,{modelValue:P.value,"onUpdate:modelValue":U[2]||(U[2]=Z=>P.value=Z),class:"w-full"},{default:t(()=>[e(re,{class:"w-full"},{default:t(()=>[e(te,{value:"all",class:"grow"},{default:t(()=>U[7]||(U[7]=[n(" Все ",-1)])),_:1,__:[7]}),e(te,{value:"works",class:"grow"},{default:t(()=>U[8]||(U[8]=[n(" Вывески ",-1)])),_:1,__:[8]}),e(te,{value:"repairs",class:"grow"},{default:t(()=>U[9]||(U[9]=[n(" Ремонты ",-1)])),_:1,__:[9]}),e(te,{value:"other",class:"grow"},{default:t(()=>U[10]||(U[10]=[n(" Другое ",-1)])),_:1,__:[10]})]),_:1})]),_:1},8,["modelValue"])]),s("div",Qs,[s("div",Js,[s("span",null," Эл-ты: "+_(q.value),1),s("span",null," Сумма: "+_(A.value)+"р. ",1)])]),s("div",ea,[u(w)?(a(),O(de,{key:0,"master-id":g.value?.id??0,"cur-user":u(w),class:"w-full",onReportCreated:V},null,8,["master-id","cur-user"])):M("",!0)])]),c.value?(a(),v("div",ta,"Загрузка...")):i.value?(a(),v("div",la,_(i.value),1)):g.value?r.value.length===0?(a(),v("div",aa," Нет отчетов для выбранного мастера. ")):(a(),v("div",oa,[e(Te,{class:"h-full overflow-y-auto rounded-sm"},{default:t(()=>[e(_e,{class:"bg-white rounded-sm relative"},{default:t(()=>[e(Q),e(De,{class:"sticky top-0 z-50 bg-gray-50"},{default:t(()=>[e(ee,null,{default:t(()=>[e(ie,null,{default:t(()=>U[11]||(U[11]=[n("Дата",-1)])),_:1,__:[11]}),e(ie,{class:"text-center"},{default:t(()=>U[12]||(U[12]=[n("Название",-1)])),_:1,__:[12]}),e(ie,{class:"text-center"},{default:t(()=>U[13]||(U[13]=[n("Инфо",-1)])),_:1,__:[13]}),e(ie,{class:"text-center"},{default:t(()=>U[14]||(U[14]=[n("Стоимость",-1)])),_:1,__:[14]})]),_:1})]),_:1}),e(Y,null,{default:t(()=>[(a(!0),v(se,null,ae(r.value,Z=>(a(),O(ee,{key:Z.key,class:K({"cursor-pointer hover:bg-gray-100":!0,"bg-blue-100/50":Z.isRepair,"bg-yellow-100/50":Z.isOther,"bg-red-100":Z.penaltyCost>0}),onClick:le=>k(Z)},{default:t(()=>[e(me,null,{default:t(()=>[s("div",na,[s("span",null,_(W(Z.date).slice(0,5)),1),Z.comment?(a(),O(u(Ae),{key:0})):M("",!0)])]),_:2},1024),e(me,{class:"text-center"},{default:t(()=>[s("div",ua,[Z.name.startsWith("http")?(a(),v("a",{key:0,href:Z.name,target:"_blank",class:"text-blue-500 hover:underline",onClick:U[3]||(U[3]=Je(()=>{},["stop"]))},"Карточка",8,ia)):(a(),v("div",ra,[s("span",null,_(Z.name),1)])),s("span",da,"("+_(Z.type)+")",1)])]),_:2},1024),e(me,{class:"text-center"},{default:t(()=>[Z.isRepair?(a(),v("span",ca," Ремонт ")):Z.isOther?(a(),v("span",pa," Другое ")):(a(),v("div",ma,[s("span",null,_(Z.metrs)+"м. ",1),s("span",null,_(Z.els)+"эл. ",1)]))]),_:2},1024),e(me,{class:"text-center"},{default:t(()=>[s("div",va,[s("span",_a,"+"+_(Z.cost)+"р.",1),Z.penaltyCost?(a(),v("span",fa,_(" -"+Z.penaltyCost)+"р.",1)):M("",!0)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1})])):(a(),v("div",sa," Выберите мастера для отображения отчетов. ")),f.value&&p.value&&u(w)?(a(),O(He,{key:5,report:p.value,"cur-user":u(w),onReportUpdated:C,onClose:U[4]||(U[4]=Z=>f.value=!1)},null,8,["report","cur-user"])):M("",!0),b.value&&l.value&&u(w)?(a(),O(je,{key:6,report:l.value,"cur-user":u(w),onReportUpdated:C,onClose:U[5]||(U[5]=Z=>b.value=!1)},null,8,["report","cur-user"])):M("",!0),$.value&&T.value?(a(),O(qe,{key:7,report:T.value,onReportUpdated:C,onClose:U[6]||(U[6]=Z=>$.value=!1)},null,8,["report"])):M("",!0)])}}}),ba={class:"flex gap-3 w-full"},ya={class:"w-[500px] h-[calc(100vh-130px)] overflow-hidden rounded-md shrink-0"},xa={class:"font-bold flex justify-between"},wa={class:"mb-3"},ka={class:"flex items-center ml-auto"},$a={class:"whitespace-nowrap"},ha={class:"text-xs"},Ua={class:"min-w-[1050px] overflow-hidden"},Va={class:"flex gap-2 items-center mb-2"},Ca={class:"mt-[-42px]"},Sa=ne({__name:"Page",props:{range:{}},setup(B){const{$useApi:L}=ue();mt({title:"Закупки | Easy CRM"});const G=B,F=m(!1),R=m("0₽"),y=m([]),S=m([]),w=m([]),d=m({uniquePositions:[],uniqueCategories:[],uniqueSuppliers:[]}),g={date:new Date().toISOString().slice(0,10),shipmentDate:"",supplier:"",paymentMethod:"Счет",orderStatus:"Оформлен заказ",paymentStatus:"Не оплачен",deliveryMethod:"Доставка от поставщика",invoice:"",track:"",positions:[{name:"",quantity:1,priceForItem:1,category:""}]},r=m(g),j=async()=>{try{const{data:p}=await L.get("supplies/suppliers");y.value=p.map($=>$.name)||[];const{data:l}=await L.get("supplies/positions");S.value=l||[]}catch(p){console.log(p)}},c=async()=>{try{if(!G.range)return;const{data:p}=await L.get("supplies",{params:G.range});w.value=p.supplies||[],d.value=p.filters||[],R.value=f(w.value.filter(l=>!!l.id).map(l=>l.id))}catch(p){console.log(p)}},i=m([]),f=p=>{const $=w.value.filter(E=>p.includes(E.id)).reduce((E,A)=>E+A.positions.reduce((q,P)=>q+P.quantity*P.priceForItem,0),0),T=d.value.uniqueCategories.map(E=>{const A=w.value.flatMap(o=>o.positions).filter(o=>o.category===E),q=Object.values(A.reduce((o,{name:h,priceForItem:V,quantity:k})=>(o[h]||(o[h]={name:h,quantity:0,price:0}),o[h].quantity+=k,o[h].price+=V*k,o),{})),P=q.reduce((o,h)=>o+h.price,0);return{title:E,totalPrice:P,items:q.sort((o,h)=>h.price-o.price)}});return i.value=T.sort((E,A)=>A.totalPrice-E.totalPrice),ve(+$.toFixed(2))+"₽"},b=p=>{F.value=!0,r.value=w.value.find(l=>l.id===p)||g,console.log(r.value)};return J(()=>G.range,async()=>{await c()}),fe(async()=>{await j(),await c()}),(p,l)=>{const $=Ut,T=ht,E=$t,A=Ct,q=Vt,P=Be,o=dt,h=At,V=Wt,k=rt,C=Ce,H=Me,D=Ve,z=jt,W=Re,I=Ue,x=Se;return a(),v("div",null,[s("div",ba,[s("div",ya,[e(o,null,{default:t(()=>[e(E,{class:"p-3 pb-2 text-right"},{default:t(()=>[e($,null,{default:t(()=>l[5]||(l[5]=[n("Общая сумма",-1)])),_:1,__:[5]}),e(T,{class:"text-3xl font-semibold whitespace-nowrap"},{default:t(()=>[n(_(u(R)),1)]),_:1})]),_:1}),e(P,{class:"h-[calc(100vh-180px)]"},{default:t(()=>[e(q,{class:"pt-2"},{default:t(()=>[e(A),(a(!0),v(se,null,ae(u(i),U=>(a(),v("div",{key:U.title},[s("div",xa,[s("span",null,_(U.title),1),s("span",null,_(("useMyFormatPrice"in p?p.useMyFormatPrice:u(ve))(+U.totalPrice.toFixed(2)))+"₽ ",1)]),s("ul",wa,[(a(!0),v(se,null,ae(U.items,(N,te)=>(a(),v("li",{key:te,class:"flex items-center"},[s("span",null,_(N.name),1),s("div",ka,[s("span",$a,_(("useMyFormatPrice"in p?p.useMyFormatPrice:u(ve))(+N.price.toFixed(2)))+"₽",1),s("span",ha,"("+_(N.quantity)+"ед.)",1)])]))),128)),e(A)])]))),128))]),_:1})]),_:1})]),_:1})]),s("div",Ua,[s("div",Va,[e(h,{suppliers:u(y),"positions-list":u(S),onSupplieCreated:l[0]||(l[0]=async()=>{await c(),await j()})},null,8,["suppliers","positions-list"])]),s("div",Ca,[(a(),O(V,{key:u(w).length,data:u(w),columns:u(Ht),filters:u(d),onTableSorted:l[1]||(l[1]=U=>R.value=f(U)),onItemClicked:l[2]||(l[2]=U=>b(U))},null,8,["data","columns","filters"]))])])]),e(x,{open:u(F),"onUpdate:open":l[4]||(l[4]=U=>Pe(F)?F.value=U:null)},{default:t(()=>[e(k),e(I,{class:"max-w-[1200px] flex flex-col"},{default:t(()=>[e(D,null,{default:t(()=>[e(C,null,{default:t(()=>l[6]||(l[6]=[n("Редактировать статью",-1)])),_:1,__:[6]}),e(H)]),_:1}),(a(),O(z,{key:u(r).id,suppliers:u(y),supplie:u(r),"positions-list":u(S),onSupplieUpdated:l[3]||(l[3]=async()=>{F.value=!1,r.value=g,await c()})},null,8,["suppliers","supplie","positions-list"])),e(W)]),_:1})]),_:1},8,["open"])])}}}),Ma={class:"flex flex-col gap-2"},Ra={class:"flex flex-col gap-2"},Da={class:"flex items-center"},Ta={class:"w-full"},Pa={class:"flex items-center"},Ia={class:"w-full"},Oa={class:"flex flex-col gap-2"},Fa={class:"flex gap-2 items-center"},Ea={class:"w-full rounded-lg p-2 border border-slate-200 bg-white text-slate-950 shadow-sm dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50"},Na={class:"flex justify-between"},Ga={key:0,class:"text-center"},Ba={key:1,class:"text-red-500 text-center"},La={key:2,class:"text-center"},za={key:3,class:"text-center"},Aa={key:4},Wa={class:"flex items-center gap-2"},Ha=["href"],ja={key:1,class:"text-wrap"},qa={key:0},Ya={key:1},Ka={key:2,class:"flex flex-col"},Xa={class:"flex flex-col"},Za={class:"font-semibold text-green-600"},Qa={key:0,class:"font-semibold text-red-500"},Ja=ne({__name:"MastersReportsTable",props:{period:{},currentMaster:{}},emits:["updated"],setup(B,{emit:L}){const G=ze(),{$useApi:F}=ue(),{toast:R}=ce(),y=B,S=G.user,w=m(new Date(y.period+"-01")),d=m(new Date(+y.period.split("-")[0],+y.period.split("-")[1],0)),g=m([]),r=m([]),j=m(!1),c=m(null),i=m(!1),f=m(!1),b=m(null),p=m(null),l=m(!1),$=m(null),T=m(),E=m([new Date(y.period).toISOString().slice(0,10),new Date(+y.period.split("-")[0],+y.period.split("-")[1],1).toISOString().slice(0,10)]),A=m(0),q=m(0),P=m("all"),o=()=>{A.value=g.value.reduce((U,N)=>U+N.cost-N.penaltyCost,0),q.value=g.value.reduce((U,N)=>U+(N.isOther?0:N.els),0)},h=async()=>{if(y.currentMaster)try{j.value=!0,c.value=null;const U=new Date(E.value[0]).toISOString().slice(0,10),N=new Date(E.value[1]).toISOString().slice(0,10),{data:te}=await F.get(`production/master/${y.currentMaster.id}/reports`,{params:{from:U,to:N}});g.value=te,r.value=te,x(P.value),o()}catch{c.value="Не удалось загрузить отчеты",R({title:"Ошибка",description:c.value,variant:"destructive"})}finally{j.value=!1}},V=U=>{U.isRepair?(p.value={...U},f.value=!0):U.isOther?($.value={...U},l.value=!0):(b.value={...U},i.value=!0)},k=async()=>{await h(),i.value=!1,f.value=!1,l.value=!1,b.value=null,p.value=null,$.value=null},C=async()=>{if(y.currentMaster)try{const{data:U}=await F.get(`production/master/${y.currentMaster.id}/shifts`,{params:{period:y.period}});T.value=U.map(N=>N.shift_date)}catch{R({title:"Ошибка",description:"Не удалось загрузить смены",variant:"destructive"})}},H=U=>"Рабочих дней: "+U.length,D=U=>"Период с "+U.map(N=>{const te=new Date(N).toISOString().slice(0,10).split("-"),re=te[2],X=te[1],de=te[0];return`${re}.${X}.${de}`}).join(" по "),z=L,W=async()=>{if(y.currentMaster)try{const U=T.value?T.value.map(N=>new Date(N).toISOString().slice(0,10)):[];await F.post(`production/master/${y.currentMaster.id}/shifts`,{shiftDates:U,period:y.period}),z("updated"),R({title:"Успех",description:"Смены сохранены"})}catch(U){console.log(U),R({title:"Ошибка",description:"Не удалось сохранить смены",variant:"destructive"})}},I=U=>{const N=new Date(U);return`${N.getDate().toString().padStart(2,"0")}.${(N.getMonth()+1).toString().padStart(2,"0")}.${N.getFullYear()}`};J(E,()=>{h()},{deep:!0});const x=U=>{if(U==="repairs"){g.value=r.value.filter(N=>N.isRepair===!0),o();return}if(U==="works"){g.value=r.value.filter(N=>N.isRepair!==!0&&N.isOther!==!0),o();return}if(U==="other"){g.value=r.value.filter(N=>N.isOther===!0),o();return}g.value=r.value};return J(P,U=>{x(U),o()},{deep:!0}),fe(async()=>{await h(),await C()}),(U,N)=>{const te=Ge,re=Ne,X=Ee,de=Ot,Q=he,ie=we,ee=xe,De=ye,me=ke,Y=$e,_e=be,Te=wt,He=Be,je=_t,qe=ft,Z=We;return a(),v("div",Ma,[s("div",Ra,[s("div",Da,[s("div",Ta,[e(u(Fe),{modelValue:E.value,"onUpdate:modelValue":N[0]||(N[0]=le=>E.value=le),range:"","enable-time-picker":!1,"min-date":w.value,"max-date":d.value,"auto-apply":"",locale:"ru",placeholder:"Выбрать дни","select-text":"Готово","cancel-text":"Закрыть",class:"grow",format:D,clearable:!1},null,8,["modelValue","min-date","max-date"])])]),s("div",Pa,[s("div",Ia,[e(u(Fe),{modelValue:T.value,"onUpdate:modelValue":[N[1]||(N[1]=le=>T.value=le),W],"multi-dates":"","enable-time-picker":!1,locale:"ru","min-date":w.value,"max-date":d.value,"start-date":w.value,placeholder:"Выбрать смены","select-text":"Готово","cancel-text":"Закрыть",format:H,class:"grow",clearable:!1},null,8,["modelValue","min-date","max-date","start-date"])])]),s("div",Oa,[s("div",Fa,[e(X,{modelValue:P.value,"onUpdate:modelValue":N[2]||(N[2]=le=>P.value=le)},{default:t(()=>[e(re,null,{default:t(()=>[e(te,{value:"all"},{default:t(()=>N[7]||(N[7]=[n(" Все ",-1)])),_:1,__:[7]}),e(te,{value:"works"},{default:t(()=>N[8]||(N[8]=[n(" Вывески ",-1)])),_:1,__:[8]}),e(te,{value:"repairs"},{default:t(()=>N[9]||(N[9]=[n(" Ремонты ",-1)])),_:1,__:[9]}),e(te,{value:"other"},{default:t(()=>N[10]||(N[10]=[n(" Другое ",-1)])),_:1,__:[10]})]),_:1})]),_:1},8,["modelValue"]),u(S)?(a(),O(de,{key:0,"master-id":U.currentMaster?.id??0,"cur-user":u(S),class:"w-full",onReportCreated:k},null,8,["master-id","cur-user"])):M("",!0)]),s("div",Ea,[s("div",Na,[s("span",null," Эл-ты: "+_(q.value),1),s("span",null," Сумма: "+_(A.value)+"р. ",1)])])])]),j.value?(a(),v("div",Ga,"Загрузка...")):c.value?(a(),v("div",Ba,_(c.value),1)):y.currentMaster?g.value.length===0?(a(),v("div",za," Нет отчетов для выбранного мастера. ")):(a(),v("div",Aa,[e(He,{class:"h-[calc(100vh-270px)]"},{default:t(()=>[e(_e,{class:"bg-white rounded-sm"},{default:t(()=>[e(Q,null,{default:t(()=>[n("Отчеты мастера: "+_(y.currentMaster?.fullName),1)]),_:1}),e(De,null,{default:t(()=>[e(ee,null,{default:t(()=>[e(ie,null,{default:t(()=>N[11]||(N[11]=[n("Дата",-1)])),_:1,__:[11]}),e(ie,{class:"text-center"},{default:t(()=>N[12]||(N[12]=[n("Название",-1)])),_:1,__:[12]}),e(ie,{class:"text-center"},{default:t(()=>N[13]||(N[13]=[n("Инфо",-1)])),_:1,__:[13]}),e(ie,{class:"text-center"},{default:t(()=>N[14]||(N[14]=[n("Стоимость",-1)])),_:1,__:[14]})]),_:1})]),_:1}),e(Y,null,{default:t(()=>[(a(!0),v(se,null,ae(g.value,le=>(a(),O(ee,{key:le.key,class:K({"cursor-pointer hover:bg-gray-100":!0,"bg-blue-100/50":le.isRepair,"bg-yellow-100/50":le.isOther,"bg-red-100":le.penaltyCost>0}),onClick:oe=>V(le)},{default:t(()=>[e(me,null,{default:t(()=>[s("div",Wa,[s("span",null,_(I(le.date).slice(0,5)),1),le.comment?(a(),O(u(Ae),{key:0})):M("",!0)])]),_:2},1024),e(me,{class:"text-center"},{default:t(()=>[le.name.startsWith("http")?(a(),v("a",{key:0,href:le.name,target:"_blank",class:"text-blue-500 hover:underline",onClick:N[3]||(N[3]=Je(()=>{},["stop"]))},[N[15]||(N[15]=n("Карточка ",-1)),N[16]||(N[16]=s("br",null,null,-1)),n("("+_(le.type)+")",1)],8,Ha)):(a(),v("span",ja,[n(_(le.name),1),N[17]||(N[17]=s("br",null,null,-1)),n("("+_(le.type)+")",1)]))]),_:2},1024),e(me,{class:"text-center"},{default:t(()=>[le.isRepair?(a(),v("span",qa," Ремонт ")):le.isOther?(a(),v("span",Ya," Другое ")):(a(),v("div",Ka,[s("span",null,_(le.metrs)+"м. ",1),s("span",null,_(le.els)+"эл. ",1)]))]),_:2},1024),e(me,{class:"text-center"},{default:t(()=>[s("div",Xa,[s("span",Za,"+"+_(le.cost)+"р.",1),le.penaltyCost?(a(),v("span",Qa,_(" -"+le.penaltyCost)+"р.",1)):M("",!0)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),e(Te,{orientation:"horizontal"})]),_:1})])):(a(),v("div",La," Выберите мастера для отображения отчетов. ")),i.value&&b.value?(a(),O(je,{key:5,class:"z-[10000]",report:b.value,"cur-user":u(S),onReportUpdated:k,onClose:N[4]||(N[4]=le=>i.value=!1)},null,8,["report","cur-user"])):M("",!0),f.value&&p.value?(a(),O(qe,{key:6,class:"z-[10000]",report:p.value,onReportUpdated:k,onClose:N[5]||(N[5]=le=>f.value=!1)},null,8,["report"])):M("",!0),l.value&&$.value?(a(),O(Z,{key:7,class:"z-[10000]",report:$.value,onReportUpdated:k,onClose:N[6]||(N[6]=le=>l.value=!1)},null,8,["report"])):M("",!0)])}}});function Ze(B,L){if(B.one!==void 0&&L===1)return B.one;const G=L%10,F=L%100;return G===1&&F!==11?B.singularNominative.replace("{{count}}",String(L)):G>=2&&G<=4&&(F<10||F>20)?B.singularGenitive.replace("{{count}}",String(L)):B.pluralGenitive.replace("{{count}}",String(L))}function pe(B){return(L,G)=>G?.addSuffix?G.comparison&&G.comparison>0?B.future?Ze(B.future,L):"через "+Ze(B.regular,L):B.past?Ze(B.past,L):Ze(B.regular,L)+" назад":Ze(B.regular,L)}const eo={lessThanXSeconds:pe({regular:{one:"меньше секунды",singularNominative:"меньше {{count}} секунды",singularGenitive:"меньше {{count}} секунд",pluralGenitive:"меньше {{count}} секунд"},future:{one:"меньше, чем через секунду",singularNominative:"меньше, чем через {{count}} секунду",singularGenitive:"меньше, чем через {{count}} секунды",pluralGenitive:"меньше, чем через {{count}} секунд"}}),xSeconds:pe({regular:{singularNominative:"{{count}} секунда",singularGenitive:"{{count}} секунды",pluralGenitive:"{{count}} секунд"},past:{singularNominative:"{{count}} секунду назад",singularGenitive:"{{count}} секунды назад",pluralGenitive:"{{count}} секунд назад"},future:{singularNominative:"через {{count}} секунду",singularGenitive:"через {{count}} секунды",pluralGenitive:"через {{count}} секунд"}}),halfAMinute:(B,L)=>L?.addSuffix?L.comparison&&L.comparison>0?"через полминуты":"полминуты назад":"полминуты",lessThanXMinutes:pe({regular:{one:"меньше минуты",singularNominative:"меньше {{count}} минуты",singularGenitive:"меньше {{count}} минут",pluralGenitive:"меньше {{count}} минут"},future:{one:"меньше, чем через минуту",singularNominative:"меньше, чем через {{count}} минуту",singularGenitive:"меньше, чем через {{count}} минуты",pluralGenitive:"меньше, чем через {{count}} минут"}}),xMinutes:pe({regular:{singularNominative:"{{count}} минута",singularGenitive:"{{count}} минуты",pluralGenitive:"{{count}} минут"},past:{singularNominative:"{{count}} минуту назад",singularGenitive:"{{count}} минуты назад",pluralGenitive:"{{count}} минут назад"},future:{singularNominative:"через {{count}} минуту",singularGenitive:"через {{count}} минуты",pluralGenitive:"через {{count}} минут"}}),aboutXHours:pe({regular:{singularNominative:"около {{count}} часа",singularGenitive:"около {{count}} часов",pluralGenitive:"около {{count}} часов"},future:{singularNominative:"приблизительно через {{count}} час",singularGenitive:"приблизительно через {{count}} часа",pluralGenitive:"приблизительно через {{count}} часов"}}),xHours:pe({regular:{singularNominative:"{{count}} час",singularGenitive:"{{count}} часа",pluralGenitive:"{{count}} часов"}}),xDays:pe({regular:{singularNominative:"{{count}} день",singularGenitive:"{{count}} дня",pluralGenitive:"{{count}} дней"}}),aboutXWeeks:pe({regular:{singularNominative:"около {{count}} недели",singularGenitive:"около {{count}} недель",pluralGenitive:"около {{count}} недель"},future:{singularNominative:"приблизительно через {{count}} неделю",singularGenitive:"приблизительно через {{count}} недели",pluralGenitive:"приблизительно через {{count}} недель"}}),xWeeks:pe({regular:{singularNominative:"{{count}} неделя",singularGenitive:"{{count}} недели",pluralGenitive:"{{count}} недель"}}),aboutXMonths:pe({regular:{singularNominative:"около {{count}} месяца",singularGenitive:"около {{count}} месяцев",pluralGenitive:"около {{count}} месяцев"},future:{singularNominative:"приблизительно через {{count}} месяц",singularGenitive:"приблизительно через {{count}} месяца",pluralGenitive:"приблизительно через {{count}} месяцев"}}),xMonths:pe({regular:{singularNominative:"{{count}} месяц",singularGenitive:"{{count}} месяца",pluralGenitive:"{{count}} месяцев"}}),aboutXYears:pe({regular:{singularNominative:"около {{count}} года",singularGenitive:"около {{count}} лет",pluralGenitive:"около {{count}} лет"},future:{singularNominative:"приблизительно через {{count}} год",singularGenitive:"приблизительно через {{count}} года",pluralGenitive:"приблизительно через {{count}} лет"}}),xYears:pe({regular:{singularNominative:"{{count}} год",singularGenitive:"{{count}} года",pluralGenitive:"{{count}} лет"}}),overXYears:pe({regular:{singularNominative:"больше {{count}} года",singularGenitive:"больше {{count}} лет",pluralGenitive:"больше {{count}} лет"},future:{singularNominative:"больше, чем через {{count}} год",singularGenitive:"больше, чем через {{count}} года",pluralGenitive:"больше, чем через {{count}} лет"}}),almostXYears:pe({regular:{singularNominative:"почти {{count}} год",singularGenitive:"почти {{count}} года",pluralGenitive:"почти {{count}} лет"},future:{singularNominative:"почти через {{count}} год",singularGenitive:"почти через {{count}} года",pluralGenitive:"почти через {{count}} лет"}})},to=(B,L,G)=>eo[B](L,G),lo={full:"EEEE, d MMMM y 'г.'",long:"d MMMM y 'г.'",medium:"d MMM y 'г.'",short:"dd.MM.y"},so={full:"H:mm:ss zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},ao={any:"{{date}}, {{time}}"},oo={date:pt({formats:lo,defaultWidth:"full"}),time:pt({formats:so,defaultWidth:"full"}),dateTime:pt({formats:ao,defaultWidth:"any"})},gt=["воскресенье","понедельник","вторник","среду","четверг","пятницу","субботу"];function no(B){const L=gt[B];switch(B){case 0:return"'в прошлое "+L+" в' p";case 1:case 2:case 4:return"'в прошлый "+L+" в' p";case 3:case 5:case 6:return"'в прошлую "+L+" в' p"}}function xt(B){const L=gt[B];return B===2?"'во "+L+" в' p":"'в "+L+" в' p"}function uo(B){const L=gt[B];switch(B){case 0:return"'в следующее "+L+" в' p";case 1:case 2:case 4:return"'в следующий "+L+" в' p";case 3:case 5:case 6:return"'в следующую "+L+" в' p"}}const io={lastWeek:(B,L,G)=>{const F=B.getDay();return yt(B,L,G)?xt(F):no(F)},yesterday:"'вчера в' p",today:"'сегодня в' p",tomorrow:"'завтра в' p",nextWeek:(B,L,G)=>{const F=B.getDay();return yt(B,L,G)?xt(F):uo(F)},other:"P"},ro=(B,L,G,F)=>{const R=io[B];return typeof R=="function"?R(L,G,F):R},co={narrow:["до н.э.","н.э."],abbreviated:["до н. э.","н. э."],wide:["до нашей эры","нашей эры"]},po={narrow:["1","2","3","4"],abbreviated:["1-й кв.","2-й кв.","3-й кв.","4-й кв."],wide:["1-й квартал","2-й квартал","3-й квартал","4-й квартал"]},mo={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","март","апр.","май","июнь","июль","авг.","сент.","окт.","нояб.","дек."],wide:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},vo={narrow:["Я","Ф","М","А","М","И","И","А","С","О","Н","Д"],abbreviated:["янв.","фев.","мар.","апр.","мая","июн.","июл.","авг.","сент.","окт.","нояб.","дек."],wide:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]},_o={narrow:["В","П","В","С","Ч","П","С"],short:["вс","пн","вт","ср","чт","пт","сб"],abbreviated:["вск","пнд","втр","срд","чтв","птн","суб"],wide:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},fo={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утро",afternoon:"день",evening:"веч.",night:"ночь"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утро",afternoon:"день",evening:"вечер",night:"ночь"}},go={narrow:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},abbreviated:{am:"ДП",pm:"ПП",midnight:"полн.",noon:"полд.",morning:"утра",afternoon:"дня",evening:"веч.",night:"ночи"},wide:{am:"ДП",pm:"ПП",midnight:"полночь",noon:"полдень",morning:"утра",afternoon:"дня",evening:"вечера",night:"ночи"}},bo=(B,L)=>{const G=Number(B),F=L?.unit;let R;return F==="date"?R="-е":F==="week"||F==="minute"||F==="second"?R="-я":R="-й",G+R},yo={ordinalNumber:bo,era:Ke({values:co,defaultWidth:"wide"}),quarter:Ke({values:po,defaultWidth:"wide",argumentCallback:B=>B-1}),month:Ke({values:mo,defaultWidth:"wide",formattingValues:vo,defaultFormattingWidth:"wide"}),day:Ke({values:_o,defaultWidth:"wide"}),dayPeriod:Ke({values:fo,defaultWidth:"any",formattingValues:go,defaultFormattingWidth:"wide"})},xo=/^(\d+)(-?(е|я|й|ое|ье|ая|ья|ый|ой|ий|ый))?/i,wo=/\d+/i,ko={narrow:/^((до )?н\.?\s?э\.?)/i,abbreviated:/^((до )?н\.?\s?э\.?)/i,wide:/^(до нашей эры|нашей эры|наша эра)/i},$o={any:[/^д/i,/^н/i]},ho={narrow:/^[1234]/i,abbreviated:/^[1234](-?[ыои]?й?)? кв.?/i,wide:/^[1234](-?[ыои]?й?)? квартал/i},Uo={any:[/1/i,/2/i,/3/i,/4/i]},Vo={narrow:/^[яфмаисонд]/i,abbreviated:/^(янв|фев|март?|апр|ма[йя]|июн[ья]?|июл[ья]?|авг|сент?|окт|нояб?|дек)\.?/i,wide:/^(январ[ья]|феврал[ья]|марта?|апрел[ья]|ма[йя]|июн[ья]|июл[ья]|августа?|сентябр[ья]|октябр[ья]|октябр[ья]|ноябр[ья]|декабр[ья])/i},Co={narrow:[/^я/i,/^ф/i,/^м/i,/^а/i,/^м/i,/^и/i,/^и/i,/^а/i,/^с/i,/^о/i,/^н/i,/^я/i],any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^ав/i,/^с/i,/^о/i,/^н/i,/^д/i]},So={narrow:/^[впсч]/i,short:/^(вс|во|пн|по|вт|ср|чт|че|пт|пя|сб|су)\.?/i,abbreviated:/^(вск|вос|пнд|пон|втр|вто|срд|сре|чтв|чет|птн|пят|суб).?/i,wide:/^(воскресень[ея]|понедельника?|вторника?|сред[аы]|четверга?|пятниц[аы]|суббот[аы])/i},Mo={narrow:[/^в/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^в[ос]/i,/^п[он]/i,/^в/i,/^ср/i,/^ч/i,/^п[ят]/i,/^с[уб]/i]},Ro={narrow:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,abbreviated:/^([дп]п|полн\.?|полд\.?|утр[оа]|день|дня|веч\.?|ноч[ьи])/i,wide:/^([дп]п|полночь|полдень|утр[оа]|день|дня|вечера?|ноч[ьи])/i},Do={any:{am:/^дп/i,pm:/^пп/i,midnight:/^полн/i,noon:/^полд/i,morning:/^у/i,afternoon:/^д[ен]/i,evening:/^в/i,night:/^н/i}},To={ordinalNumber:zt({matchPattern:xo,parsePattern:wo,valueCallback:B=>parseInt(B,10)}),era:Xe({matchPatterns:ko,defaultMatchWidth:"wide",parsePatterns:$o,defaultParseWidth:"any"}),quarter:Xe({matchPatterns:ho,defaultMatchWidth:"wide",parsePatterns:Uo,defaultParseWidth:"any",valueCallback:B=>B+1}),month:Xe({matchPatterns:Vo,defaultMatchWidth:"wide",parsePatterns:Co,defaultParseWidth:"any"}),day:Xe({matchPatterns:So,defaultMatchWidth:"wide",parsePatterns:Mo,defaultParseWidth:"any"}),dayPeriod:Xe({matchPatterns:Ro,defaultMatchWidth:"wide",parsePatterns:Do,defaultParseWidth:"any"})},lt={code:"ru",formatDistance:to,formatLong:oo,formatRelative:ro,localize:yo,match:To,options:{weekStartsOn:1,firstWeekContainsDate:1}},Po={class:"flex flex-col gap-2"},Io={class:"px-2"},Oo={class:"text-xl font-semibold py-2"},Fo={key:0,class:"text-center"},Eo={key:1,class:"text-red-500 text-center"},No={key:2,class:"text-center"},Go={key:3},Bo={class:"flex flex-col sm:flex-row gap-4"},Lo={class:"flex-1"},zo={class:"text-lg font-bold text-green-600"},Ao={class:"flex-1"},Wo={class:"text-lg font-bold text-blue-600"},Ho={class:"flex-1"},jo={class:"text-lg font-bold text-blue-600"},qo={class:"overflow-x-auto"},Yo={class:"flex flex-col"},Ko=ne({__name:"Stat",props:{range:{}},setup(B){const{$useApi:L}=ue(),{toast:G}=ce(),F=B,R=m(F.range.from.slice(0,7)),y=m(!1),S=m(null),w=m(null),d=m(!1),g=async()=>{try{y.value=!0,S.value=null;const{data:l}=await L.get("production/stat",{params:{period:R.value}});w.value=l}catch{S.value="Не удалось загрузить статистику",G({title:"Ошибка",description:S.value,variant:"destructive"})}finally{y.value=!1}},r=m(),j=async l=>{r.value=l,d.value=!0},c=l=>{const $=new Date(l),T=et($,"dd",{locale:lt}),E=et($,"EEEEEE",{locale:lt});return`${T} (${E})`},i=l=>{const T=new Date(l).getDay();return T===0||T===6},f=Qe(()=>w.value?Object.values(w.value.shiftsSumByDate).reduce((l,$)=>l+$,0):0),b=Qe(()=>w.value?Object.values(w.value.regularElsSumByDate).reduce((l,$)=>l+$,0):0),p=Qe(()=>w.value?Object.values(w.value.specialElsSumByDate).reduce((l,$)=>l+$,0):0);return J(()=>F.range,async()=>{R.value=F.range.from.slice(0,7),await g()}),fe(async()=>{await g()}),(l,$)=>{const T=Rt,E=Pt,A=It,q=Tt,P=Ja,o=Dt,h=Mt,V=dt,k=he,C=we,H=xe,D=ye,z=ke,W=$e,I=be;return a(),v("div",Po,[e(h,{open:d.value,"onUpdate:open":$[0]||($[0]=x=>d.value=x)},{default:t(()=>[e(T,{class:"hidden"}),e(o,{class:"p-0 min-w-[500px]"},{default:t(()=>[e(q,{class:"hidden"},{default:t(()=>[e(E),e(A)]),_:1}),s("div",Io,[s("div",Oo,_(r.value?.fullName),1),r.value?(a(),O(P,{key:r.value.id,period:R.value,"current-master":r.value,onUpdated:g},null,8,["period","current-master"])):M("",!0)])]),_:1})]),_:1},8,["open"]),y.value?(a(),v("div",Fo,"Загрузка...")):S.value?(a(),v("div",Eo,_(S.value),1)):!w.value||w.value.masters.length===0?(a(),v("div",No," Нет данных за выбранный период ")):(a(),v("div",Go,[e(V,{class:"mb-4 p-4 bg-white rounded-sm shadow-sm"},{default:t(()=>[s("div",Bo,[s("div",Lo,[$[1]||($[1]=s("h3",{class:"text-sm font-semibold text-gray-700"}," Общее количество смен ",-1)),s("p",zo,_(f.value),1)]),s("div",Ao,[$[2]||($[2]=s("h3",{class:"text-sm font-semibold text-gray-700"}," Общее количество обычных элементов ",-1)),s("p",Wo,_(b.value),1)]),s("div",Ho,[$[3]||($[3]=s("h3",{class:"text-sm font-semibold text-gray-700"}," Общее количество специальных элементов ",-1)),s("p",jo,_(p.value),1)])])]),_:1}),s("div",qo,[e(I,{class:"bg-white rounded-sm text-xs w-full"},{default:t(()=>[e(k,null,{default:t(()=>[n("Статистика мастеров за "+_(R.value),1)]),_:1}),e(D,null,{default:t(()=>[e(H,null,{default:t(()=>[e(C,{class:"p-2 sticky left-0 bg-gray-300 font-bold border border-black/50"},{default:t(()=>$[4]||($[4]=[n("Мастер (Рейтинг)",-1)])),_:1,__:[4]}),(a(!0),v(se,null,ae(w.value.dates,x=>(a(),O(C,{key:x,class:"p-1 text-center bg-gray-300 border border-black/50"},{default:t(()=>[s("div",Yo,[s("span",null,_(c(x).split(" ")[0]),1),s("span",null,_(c(x).split(" ")[1]),1)])]),_:2},1024))),128))]),_:1})]),_:1}),e(W,null,{default:t(()=>[e(H,null,{default:t(()=>[e(z,{class:"p-2 sticky left-0 bg-gray-300 font-semibold border border-black/50"},{default:t(()=>$[5]||($[5]=[n("Смены",-1)])),_:1,__:[5]}),(a(!0),v(se,null,ae(w.value.dates,x=>(a(),O(z,{key:x,class:"p-1 text-center bg-green-500/50 border border-black/50"},{default:t(()=>[n(_(w.value.shiftsSumByDate[x]||0),1)]),_:2},1024))),128))]),_:1}),e(H,null,{default:t(()=>[e(z,{class:"p-2 sticky left-0 bg-gray-300 font-semibold border border-black/50"},{default:t(()=>$[6]||($[6]=[n("Элементы",-1)])),_:1,__:[6]}),(a(!0),v(se,null,ae(w.value.dates,x=>(a(),O(z,{key:x,class:"p-1 text-center bg-gray-300/50 border border-black/50"},{default:t(()=>[n(_(w.value.regularElsSumByDate[x]||0)+" / "+_(w.value.specialElsSumByDate[x]||0),1)]),_:2},1024))),128))]),_:1}),(a(!0),v(se,null,ae(w.value.masters,x=>(a(),O(H,{key:x.masterId,class:"cursor-pointer",onClick:U=>j({id:x.masterId,fullName:x.fullName})},{default:t(()=>[e(z,{class:"p-2 sticky left-0 bg-gray-300 border border-black/50"},{default:t(()=>[n(_(x.fullName)+" ("+_(x.rating)+") ",1)]),_:2},1024),(a(!0),v(se,null,ae(w.value.dates,U=>(a(),O(z,{key:U,class:K(["p-1 text-center border border-black/50",{"bg-blue-100/50":i(U),"bg-green-500/50":x.shiftsByDate[U],"font-bold":x.elsByDate[U].regular||x.elsByDate[U].special}])},{default:t(()=>[n(_(x.elsByDate[U].regular||0)+" / "+_(x.elsByDate[U].special||0),1)]),_:2},1032,["class"]))),128))]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})])]))])}}}),Xo={class:""},Zo={class:"flex flex-col gap-5"},Qo={class:"relative"},Jo={class:"relative"},en={class:"flex justify-between"},tn={class:"relative flex items-center gap-2"},ln={class:"relative flex items-center gap-4"},sn={class:"flex gap-2"},an={class:"relative"},on={class:"relative"},nn={class:"relative"},un={class:"relative"},rn={class:"relative"},dn={class:"relative"},cn={class:"flex flex-col gap-2"},pn={key:0,class:"relative"},mn={class:"relative"},vn={class:"flex justify-between w-full"},_n={class:"flex flex-col gap-5"},fn={class:"relative"},gn={class:"relative"},bn={class:"relative"},yn={class:"relative"},xn={class:"flex justify-between w-full"},Ft=ne({__name:"CreatePackerReport",props:{packerId:{},curUser:{}},emits:["report-created"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!1),w=m(!0),d=m("new"),g={date:new Date().toISOString().slice(0,10),name:"",overSize:!1,isGift:!1,items:1,adapters:1,lam:1,cost:0,dimmers:0,userId:y.packerId,dops:0,dopsComment:"",comment:"",penaltyCost:0},r=m({...g}),j={date:new Date().toISOString().slice(0,10),name:"",cost:0,userId:y.packerId},c=m({...j}),i=()=>{const{items:p,dimmers:l,overSize:$,isGift:T,dops:E,adapters:A,lam:q}=r.value;let P=0;console.log(y.curUser?.workSpaceId),y.curUser?.workSpaceId===8?P=p*100+A*60+q*20+l*60+($?200:0)+(T?120:0)+E:P=p*100+A*60+q*20+l*60+($?100:0)+(T?120:0)+E,r.value.cost=P},f=async()=>{try{await G.post("production/packer-report",{...r.value,userId:y.packerId}),S.value=!1,R("report-created"),F({title:"Успех",description:"Отчет успешно создан"})}catch{F({title:"Ошибка",description:"Не удалось создать отчет",variant:"destructive"})}},b=async()=>{try{await G.post("production/other-report",{...c.value,userId:y.packerId}),S.value=!1,R("report-created"),F({title:"Успех",description:"Отчет успешно создан"})}catch{F({title:"Ошибка",description:"Не удалось создать отчет",variant:"destructive"})}};return J(c,()=>{const{date:p,name:l,cost:$}=c.value;w.value=!(p&&l&&$)},{deep:!0}),J(r,()=>{const{date:p,name:l,items:$,adapters:T,lam:E,dimmers:A}=r.value;i(),y.curUser?.role.shortName==="PACKER"||y.curUser?.role.shortName==="LOGIST"?w.value=!(p&&l&&($||T||E||A)):w.value=!(p&&l)},{deep:!0}),J(S,p=>{p||(r.value={...g,userId:y.packerId},c.value={...j,userId:y.packerId})}),J(d,()=>{r.value={...g,userId:y.packerId},c.value={...j,userId:y.packerId},w.value=!0}),(p,l)=>{const $=Oe,T=rt,E=Ce,A=Me,q=Ve,P=Ge,o=Ne,h=Ie,V=ge,k=kt,C=Le,H=vt,D=Ee,z=Re,W=Ue,I=Se;return a(),v("div",null,[e(I,{open:S.value,"onUpdate:open":l[17]||(l[17]=x=>S.value=x)},{default:t(()=>[e(T,{"as-child":""},{default:t(()=>[e($,{class:"w-full"},{default:t(()=>l[18]||(l[18]=[n("Создать",-1)])),_:1,__:[18]})]),_:1}),e(W,{class:"max-w-[400px] flex flex-col top-0 translate-y-[0px]"},{default:t(()=>[e(q,null,{default:t(()=>[e(E,null,{default:t(()=>l[19]||(l[19]=[n("Создать запись",-1)])),_:1,__:[19]}),e(A)]),_:1}),s("div",Xo,[e(D,{modelValue:d.value,"onUpdate:modelValue":l[16]||(l[16]=x=>d.value=x)},{default:t(()=>[e(o,{class:"w-full mb-4"},{default:t(()=>[e(P,{class:"w-full",value:"new"},{default:t(()=>l[20]||(l[20]=[n(" Новое ",-1)])),_:1,__:[20]}),e(P,{class:"w-full",value:"other"},{default:t(()=>l[21]||(l[21]=[n(" Другое ",-1)])),_:1,__:[21]})]),_:1}),e(H,{value:"new"},{default:t(()=>[s("div",Zo,[s("div",Qo,[r.value.date?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[22]||(l[22]=[n("Дата смены",-1)])),_:1,__:[22]})):M("",!0),e(V,{modelValue:r.value.date,"onUpdate:modelValue":l[0]||(l[0]=x=>r.value.date=x),type:"date",placeholder:"Дата смены",class:K(r.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",Jo,[r.value.name?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[23]||(l[23]=[n("Название или ссылка",-1)])),_:1,__:[23]})):M("",!0),e(V,{modelValue:r.value.name,"onUpdate:modelValue":l[1]||(l[1]=x=>r.value.name=x),placeholder:"Название или ссылка",class:K(r.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",en,[s("div",tn,[e(k,{checked:r.value.overSize,"onUpdate:checked":l[2]||(l[2]=x=>r.value.overSize=x)},null,8,["checked"]),e(h,{class:""},{default:t(()=>l[24]||(l[24]=[n("Негабарит",-1)])),_:1,__:[24]})]),l[26]||(l[26]=s("div",null,"|",-1)),s("div",ln,[e(k,{checked:r.value.isGift,"onUpdate:checked":l[3]||(l[3]=x=>r.value.isGift=x)},null,8,["checked"]),e(h,{class:""},{default:t(()=>l[25]||(l[25]=[n("Подарок",-1)])),_:1,__:[25]})])]),s("div",sn,[s("div",an,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[27]||(l[27]=[n("Уп-ка",-1)])),_:1,__:[27]}),e(V,{modelValue:r.value.items,"onUpdate:modelValue":l[4]||(l[4]=x=>r.value.items=x),modelModifiers:{number:!0},placeholder:"Уп-ка",type:"number",min:"0"},null,8,["modelValue"])]),s("div",on,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[28]||(l[28]=[n("Блоки",-1)])),_:1,__:[28]}),e(V,{modelValue:r.value.adapters,"onUpdate:modelValue":l[5]||(l[5]=x=>r.value.adapters=x),modelModifiers:{number:!0},placeholder:"Блоки",type:"number",min:"0"},null,8,["modelValue"])]),s("div",nn,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[29]||(l[29]=[n("Пленка",-1)])),_:1,__:[29]}),e(V,{modelValue:r.value.lam,"onUpdate:modelValue":l[6]||(l[6]=x=>r.value.lam=x),modelModifiers:{number:!0},placeholder:"Пленка",type:"number",min:"0"},null,8,["modelValue"])]),s("div",un,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[30]||(l[30]=[n("Дим",-1)])),_:1,__:[30]}),e(V,{modelValue:r.value.dimmers,"onUpdate:modelValue":l[7]||(l[7]=x=>r.value.dimmers=x),modelModifiers:{number:!0},placeholder:"Дим",type:"number",min:"0"},null,8,["modelValue"])])]),s("div",rn,[r.value.dopsComment?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[31]||(l[31]=[n("Доп работы",-1)])),_:1,__:[31]})):M("",!0),e(V,{modelValue:r.value.dopsComment,"onUpdate:modelValue":l[8]||(l[8]=x=>r.value.dopsComment=x),placeholder:"Доп работы"},null,8,["modelValue"])]),s("div",dn,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[32]||(l[32]=[n("Стоимость",-1)])),_:1,__:[32]}),e(V,{modelValue:r.value.dops,"onUpdate:modelValue":l[9]||(l[9]=x=>r.value.dops=x),placeholder:"Стоимость",type:"number"},null,8,["modelValue"])]),s("div",cn,[["PACKER","LOGIST"].includes(p.curUser?.role.shortName||"")?M("",!0):(a(),v("div",pn,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[33]||(l[33]=[n("Штраф",-1)])),_:1,__:[33]}),e(V,{modelValue:r.value.penaltyCost,"onUpdate:modelValue":l[10]||(l[10]=x=>r.value.penaltyCost=x),placeholder:"Штраф",type:"number"},null,8,["modelValue"])])),s("div",mn,[e(C,{modelValue:r.value.comment,"onUpdate:modelValue":l[11]||(l[11]=x=>r.value.comment=x),placeholder:"Комментарий"},null,8,["modelValue"]),r.value.comment?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[34]||(l[34]=[n(" Комментарий ",-1)])),_:1,__:[34]})):M("",!0)])]),s("span",null," Стоимость: "+_(r.value.cost)+"р. ",1)]),s("div",vn,[e($,{disabled:w.value,onClick:f},{default:t(()=>l[35]||(l[35]=[n(" Создать ",-1)])),_:1,__:[35]},8,["disabled"])])]),_:1}),e(H,{value:"other"},{default:t(()=>[s("div",_n,[s("div",fn,[c.value.date?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[36]||(l[36]=[n("Дата",-1)])),_:1,__:[36]})):M("",!0),e(V,{modelValue:c.value.date,"onUpdate:modelValue":l[12]||(l[12]=x=>c.value.date=x),type:"date",placeholder:"Дата",class:K(c.value.date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",gn,[c.value.name?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[37]||(l[37]=[n("Описание",-1)])),_:1,__:[37]})):M("",!0),e(V,{modelValue:c.value.name,"onUpdate:modelValue":l[13]||(l[13]=x=>c.value.name=x),placeholder:"Описание",class:K(c.value.name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",bn,[c.value.cost?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[38]||(l[38]=[n("Стоимость",-1)])),_:1,__:[38]})):M("",!0),e(V,{modelValue:c.value.cost,"onUpdate:modelValue":l[14]||(l[14]=x=>c.value.cost=x),type:"number",placeholder:"Стоимость",class:K(c.value.cost?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",yn,[e(C,{modelValue:c.value.comment,"onUpdate:modelValue":l[15]||(l[15]=x=>c.value.comment=x),placeholder:"Комментарий"},null,8,["modelValue"]),c.value.comment?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[39]||(l[39]=[n(" Комментарий ",-1)])),_:1,__:[39]})):M("",!0)]),s("span",null," Стоимость: "+_(c.value.cost)+"р. ",1)]),s("div",xn,[e($,{disabled:w.value,onClick:b},{default:t(()=>l[40]||(l[40]=[n(" Создать ",-1)])),_:1,__:[40]},8,["disabled"])])]),_:1})]),_:1},8,["modelValue"])]),e(z)]),_:1})]),_:1},8,["open"])])}}}),wn={class:"flex flex-col gap-2"},kn={class:"flex flex-col gap-2"},$n={key:0,class:"flex gap-2"},hn={class:"flex items-center gap-2"},Un={class:"min-w-[200px]"},Vn={class:"w-full rounded-lg p-2 border border-slate-200 bg-white text-slate-950 shadow-sm dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50"},Cn={class:"flex justify-end"},Sn={key:0,class:"text-center"},Mn={key:1,class:"text-red-500 text-center"},Rn={key:2,class:"text-center"},Dn={key:3,class:"text-center"},Tn={key:4},Pn={class:"flex items-center gap-2"},In={class:"flex flex-col items-center"},On=["href"],Fn={key:1,class:"flex flex-col text-wrap text-gray-600"},En={key:2,class:"text-wrap text-gray-600"},Nn={class:"flex flex-col gap-1"},Gn={key:0},Bn={key:1},Ln={key:2},zn={key:3},An={key:4},Wn={class:"flex flex-col"},Hn={class:"font-semibold text-green-600"},jn={key:0,class:"font-semibold text-red-500"},qn=ne({__name:"Packers",props:{range:{}},setup(B){const L=ze(),{$useApi:G}=ue(),{toast:F}=ce(),R=B,y=L.user,S=m(R.range.from.slice(0,7)),w=m(R.range.from),d=m([]),g=m(null),r=m([]),j=m(!1),c=m(null),i=m(!1),f=m(null),b=m(),p=m(!1),l=m(null),$=m(0),T=async()=>{try{j.value=!0,c.value=null;const{data:k}=await G.get("production/packers");d.value=k,k.length>0?g.value=k[0]:(g.value=null,F({title:"Ошибка",description:"Список упаковщиков пуст",variant:"destructive"}))}catch{c.value="Не удалось загрузить список упаковщиков",F({title:"Ошибка",description:c.value,variant:"destructive"})}finally{j.value=!1}},E=async()=>{if(g.value&&R.range)try{j.value=!0,c.value=null;const{data:k}=await G.get(`production/packer/${g.value.id}/reports`,{params:R.range});r.value=k,$.value=k.reduce((C,H)=>C+H.cost-H.penaltyCost,0)}catch{c.value="Не удалось загрузить отчеты",F({title:"Ошибка",description:c.value,variant:"destructive"})}finally{j.value=!1}},A=k=>{k.isOther?(l.value={...k},p.value=!0):(f.value={...k},i.value=!0)},q=async()=>{await E(),i.value=!1,f.value=null},P=async()=>{if(g.value)try{const{data:k}=await G.get(`production/packer/${g.value.id}/shifts`,{params:{period:S.value}});b.value=k.map(C=>C.shift_date)}catch{F({title:"Ошибка",description:"Не удалось загрузить смены",variant:"destructive"})}},o=k=>"Рабочих дней: "+k.length,h=async()=>{if(g.value)try{const k=b.value?b.value.map(C=>new Date(C).toISOString().slice(0,10)):[];await G.post(`production/packer/${g.value.id}/shifts`,{shiftDates:k,period:S.value}),F({title:"Успех",description:"Смены сохранены"})}catch(k){console.log(k),F({title:"Ошибка",description:"Не удалось сохранить смены",variant:"destructive"})}},V=k=>{const C=new Date(k);return`${C.getDate().toString().padStart(2,"0")}.${(C.getMonth()+1).toString().padStart(2,"0")}.${C.getFullYear()}`};return fe(async()=>{await T()}),J(g,()=>{g.value&&(E(),P())}),J(()=>R.range,async()=>{w.value=R.range.from,S.value=R.range.from.slice(0,7),await E(),await P()}),(k,C)=>{const H=ct,D=he,z=we,W=xe,I=ye,x=ke,U=$e,N=be,te=Be,re=Ft,X=tt,de=We;return a(),v("div",wn,[s("div",kn,[d.value.length>1||!["PACKER","LOGIST"].includes(u(y)?.role.shortName||"")?(a(),v("div",$n,[e(H,{items:d.value.map(Q=>({value:Q.id,label:Q.fullName})),class:"w-[180px]",label:g.value?.fullName||"Выберите упаковщика",onSelectedItem:C[0]||(C[0]=Q=>{g.value=d.value.find(ie=>ie.id===Q)||null})},null,8,["items","label"])])):M("",!0),s("div",hn,[s("div",Un,[e(u(Fe),{modelValue:b.value,"onUpdate:modelValue":[C[1]||(C[1]=Q=>b.value=Q),h],"multi-dates":"","enable-time-picker":!1,locale:"ru","start-date":w.value,placeholder:"Выбрать смены","select-text":"Готово","cancel-text":"Закрыть","hide-offset-dates":"",format:o,class:"grow",clearable:!1},null,8,["modelValue","start-date"])]),s("div",Vn,[s("div",Cn,[s("span",null," Сумма: "+_($.value)+"р. ",1)])])])]),j.value?(a(),v("div",Sn,"Загрузка...")):c.value?(a(),v("div",Mn,_(c.value),1)):g.value?r.value.length===0?(a(),v("div",Dn," Нет отчетов для выбранного упаковщика ")):(a(),v("div",Tn,[e(te,{class:"h-[calc(100vh-300px)] rounded-sm"},{default:t(()=>[e(N,{class:"bg-white rounded-sm relative"},{default:t(()=>[e(D),e(I,{class:"bg-gray-50 sticky top-0 z-50"},{default:t(()=>[e(W,null,{default:t(()=>[e(z,null,{default:t(()=>C[5]||(C[5]=[n("Дата",-1)])),_:1,__:[5]}),e(z,{class:"text-center"},{default:t(()=>C[6]||(C[6]=[n("Название",-1)])),_:1,__:[6]}),e(z,{class:"text-center"},{default:t(()=>C[7]||(C[7]=[n("Инфо",-1)])),_:1,__:[7]}),e(z,{class:"text-center"},{default:t(()=>C[8]||(C[8]=[n("Стоимость",-1)])),_:1,__:[8]})]),_:1})]),_:1}),e(U,null,{default:t(()=>[(a(!0),v(se,null,ae(r.value,Q=>(a(),O(W,{key:Q.id,class:K({"cursor-pointer hover:bg-gray-100":!0,"bg-yellow-100/50":Q.isOther,"bg-red-100":Q.penaltyCost>0}),onClick:ie=>A(Q)},{default:t(()=>[e(x,null,{default:t(()=>[s("div",Pn,[s("span",null,_(V(Q.date).slice(0,5)),1),Q.comment?(a(),O(u(Ae),{key:0})):M("",!0)])]),_:2},1024),e(x,{class:"text-center"},{default:t(()=>[s("div",In,[Q.name.startsWith("http")?(a(),v("a",{key:0,href:Q.name,target:"_blank",class:"text-blue-500 hover:underline",onClick:C[2]||(C[2]=Je(()=>{},["stop"]))},"Карточка",8,On)):(a(),v("div",Fn,[s("span",null,_(Q.name),1)])),Q.dopsComment?(a(),v("span",En," + "+_(Q.dopsComment),1)):M("",!0)])]),_:2},1024),Q.isOther?(a(),O(x,{key:0,class:"text-center"},{default:t(()=>C[9]||(C[9]=[n(" Другое ",-1)])),_:1,__:[9]})):(a(),O(x,{key:1,class:"text-center"},{default:t(()=>[s("div",Nn,[Q.items?(a(),v("span",Gn,_(Q.items)+" выв.",1)):M("",!0),Q.dimmers?(a(),v("span",Bn,_(Q.dimmers)+" дим.",1)):M("",!0),Q.adapters?(a(),v("span",Ln,_(Q.adapters)+" блок",1)):M("",!0),Q.lam?(a(),v("span",zn,_(Q.lam)+" пленка",1)):M("",!0),Q.overSize?(a(),v("span",An,"Не габарит")):M("",!0)])]),_:2},1024)),e(x,{class:"text-center"},{default:t(()=>[s("div",Wn,[s("span",Hn,"+"+_(Q.cost)+"р.",1),Q.penaltyCost?(a(),v("span",jn,_(" -"+Q.penaltyCost)+"р.",1)):M("",!0)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1})])):(a(),v("div",Rn," Выберите упаковщика для отображения отчетов ")),e(re,{"packer-id":g.value?.id??0,"cur-user":u(y),class:"w-full mb-4 fixed bottom-0 left-0 px-4",onReportCreated:E},null,8,["packer-id","cur-user"]),i.value&&f.value?(a(),O(X,{key:5,report:f.value,"cur-user":u(y),onReportUpdated:q,onClose:C[3]||(C[3]=Q=>i.value=!1)},null,8,["report","cur-user"])):M("",!0),p.value&&l.value?(a(),O(de,{key:6,report:l.value,onReportUpdated:q,onClose:C[4]||(C[4]=Q=>p.value=!1)},null,8,["report"])):M("",!0)])}}}),Yn={class:"flex flex-col gap-2"},Kn={class:"flex flex-col gap-2"},Xn={class:"flex gap-2"},Zn={class:"flex items-center"},Qn={class:"w-full"},Jn={class:"rounded-lg p-2 border border-slate-200 bg-white text-slate-950 shadow-sm dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50"},eu={class:"flex justify-end"},tu={key:0,class:"text-center"},lu={key:1,class:"text-red-500 text-center"},su={key:2,class:"text-center"},au={key:3},ou={class:"flex items-center gap-2"},nu={class:"flex flex-col"},uu={class:"font-semibold text-green-600"},iu=ne({__name:"Logist",props:{range:{}},setup(B){const L=ze(),{$useApi:G}=ue(),{toast:F}=ce(),R=B,y=m(R.range.from.slice(0,7)),S=m(R.range.from),w=L.user,d=m([]),g=m(null),r=m(!1),j=m(null),c=m(),i=m([]),f=m(0),b=async()=>{try{r.value=!0,j.value=null;const{data:T}=await G.get("production/logists");d.value=T,T.length>0?g.value=T[0]:(g.value=null,F({title:"Ошибка",description:"Список логистов пуст",variant:"destructive"}))}catch{j.value="Не удалось загрузить список логистов",F({title:"Ошибка",description:j.value,variant:"destructive"})}finally{r.value=!1}},p=async()=>{if(g.value&&R.range)try{const{data:T}=await G.get(`production/logist/${g.value.id}/shifts`,{params:R.range});c.value=T.map(E=>E.shift_date),i.value=T||[],f.value=i.value.reduce((E,A)=>E+A.cost,0)}catch{F({title:"Ошибка",description:"Не удалось загрузить смены",variant:"destructive"})}},l=T=>"Рабочих дней: "+T.length,$=async()=>{if(g.value)try{const T=c.value?c.value.map(E=>new Date(E).toISOString().slice(0,10)):[];await G.post(`production/logists/${g.value.id}/shifts`,{shiftDates:T,period:y.value}),p(),F({title:"Успех",description:"Смены сохранены"})}catch(T){console.log(T),F({title:"Ошибка",description:"Не удалось сохранить смены",variant:"destructive"})}};return fe(async()=>{await b()}),J(g,()=>{g.value&&p()}),J(()=>R.range,async()=>{S.value=R.range.from,y.value=R.range.from.slice(0,7),await p()}),(T,E)=>{const A=ct,q=he,P=we,o=xe,h=ye,V=ke,k=$e,C=be;return a(),v("div",Yn,[s("div",Kn,[s("div",Xn,[d.value.length>1||u(w)?.role.shortName!=="PACKER"?(a(),O(A,{key:0,items:d.value.map(H=>({value:H.id,label:H.fullName})),class:"w-[180px]",label:g.value?.fullName||"Выберите упаковщика",onSelectedItem:E[0]||(E[0]=H=>{g.value=d.value.find(D=>D.id===H)||null})},null,8,["items","label"])):M("",!0)]),s("div",Zn,[s("div",Qn,[e(u(Fe),{modelValue:c.value,"onUpdate:modelValue":[E[1]||(E[1]=H=>c.value=H),$],"multi-dates":"","enable-time-picker":!1,locale:"ru","start-date":S.value,"hide-offset-dates":"",placeholder:"Выбрать смены","select-text":"Готово","cancel-text":"Закрыть",format:l,class:"grow",clearable:!1},null,8,["modelValue","start-date"])])])]),s("div",Jn,[s("div",eu,[s("span",null," Сумма: "+_(f.value)+"р. ",1)])]),r.value?(a(),v("div",tu,"Загрузка...")):j.value?(a(),v("div",lu,_(j.value),1)):g.value?(a(),v("div",au,[e(C,{class:"bg-white rounded-sm"},{default:t(()=>[e(q,null,{default:t(()=>[n("Отчеты логиста: "+_(g.value?.fullName),1)]),_:1}),e(h,null,{default:t(()=>[e(o,null,{default:t(()=>[e(P,null,{default:t(()=>E[2]||(E[2]=[n("Дата",-1)])),_:1,__:[2]}),e(P,{class:"text-center"},{default:t(()=>E[3]||(E[3]=[n("Стоимость",-1)])),_:1,__:[3]})]),_:1})]),_:1}),e(k,null,{default:t(()=>[(a(!0),v(se,null,ae(i.value,H=>(a(),O(o,{key:H.id,class:K({"cursor-pointer hover:bg-gray-100":!0})},{default:t(()=>[e(V,null,{default:t(()=>[s("div",ou,[s("span",null,_(("dateFormat"in T?T.dateFormat:u(qt))(H.shift_date).slice(0,5)),1)])]),_:2},1024),e(V,{class:"text-center"},{default:t(()=>[s("div",nu,[s("span",uu,"+"+_(H.cost)+"р.",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(a(),v("div",su," Выберите логиста для отображения отчетов "))])}}}),ru={class:"flex flex-col gap-2"},du={class:"flex flex-col gap-2"},cu={class:"flex items-center"},pu={class:"w-full"},mu={class:"flex items-center"},vu={class:"w-full"},_u={class:"flex gap-2 items-center"},fu={class:"w-full rounded-lg p-2 border border-slate-200 bg-white text-slate-950 shadow-sm dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50"},gu={key:0,class:"text-center"},bu={key:1,class:"text-red-500 text-center"},yu={key:2,class:"text-center"},xu={key:3,class:"text-center"},wu={class:"flex items-center gap-2"},ku={class:"flex flex-col items-center"},$u=["href"],hu={key:1,class:"flex flex-col text-wrap"},Uu={key:2,class:"text-wrap text-gray-600"},Vu={class:"flex flex-col gap-1"},Cu={key:0},Su={key:1},Mu={key:2},Ru={key:3},Du={key:4},Tu={class:"flex flex-col"},Pu={class:"font-semibold text-green-600"},Iu={key:0,class:"font-semibold text-red-500"},Ou=ne({__name:"PackersReportTable",props:{period:{},curentPacker:{}},emits:["updated"],setup(B,{emit:L}){const G=ze(),{$useApi:F}=ue(),{toast:R}=ce(),y=B,S=G.user,w=m(y.period),d=m(new Date(y.period+"-01")),g=m(new Date(+y.period.split("-")[0],+y.period.split("-")[1],0)),r=m([]),j=m(!1),c=m(null),i=m(!1),f=m(null),b=m(!1),p=m(null),l=m(),$=m(0),T=m([new Date(y.period).toISOString().slice(0,10),new Date(+y.period.split("-")[0],+y.period.split("-")[1],1).toISOString().slice(0,10)]),E=async()=>{if(y.curentPacker)try{j.value=!0,c.value=null;const H=new Date(T.value[0]).toISOString().slice(0,10),D=new Date(T.value[1]).toISOString().slice(0,10),{data:z}=await F.get(`production/packer/${y.curentPacker.id}/reports`,{params:{from:H,to:D}});r.value=z,$.value=z.reduce((W,I)=>W+I.cost-I.penaltyCost,0)}catch{c.value="Не удалось загрузить отчеты",R({title:"Ошибка",description:c.value,variant:"destructive"})}finally{j.value=!1}},A=H=>{H.isOther?(p.value={...H},b.value=!0):(f.value={...H},i.value=!0)},q=async()=>{await E(),i.value=!1,f.value=null},P=async()=>{if(y.curentPacker)try{const{data:H}=await F.get(`production/packer/${y.curentPacker.id}/shifts`,{params:{period:w.value}});l.value=H.map(D=>D.shift_date)}catch{R({title:"Ошибка",description:"Не удалось загрузить смены",variant:"destructive"})}},o=H=>"Рабочих дней: "+H.length,h=H=>"Период с "+H.map(D=>{const z=new Date(D).toISOString().slice(0,10).split("-"),W=z[2],I=z[1],x=z[0];return`${W}.${I}.${x}`}).join(" по "),V=async()=>{if(y.curentPacker)try{const H=l.value?l.value.map(D=>new Date(D).toISOString().slice(0,10)):[];await F.post(`production/packer/${y.curentPacker.id}/shifts`,{shiftDates:H,period:w.value}),R({title:"Успех",description:"Смены сохранены"}),C("updated")}catch(H){console.log(H),R({title:"Ошибка",description:"Не удалось сохранить смены",variant:"destructive"})}},k=H=>{const D=new Date(H);return`${D.getDate().toString().padStart(2,"0")}.${(D.getMonth()+1).toString().padStart(2,"0")}.${D.getFullYear()}`},C=L;return J(T,()=>{E()},{deep:!0}),fe(async()=>{await E(),await P()}),(H,D)=>{const z=Ft,W=he,I=we,x=xe,U=ye,N=ke,te=$e,re=be,X=wt,de=Be,Q=tt,ie=We;return a(),v("div",ru,[s("div",du,[s("div",cu,[s("div",pu,[e(u(Fe),{modelValue:u(T),"onUpdate:modelValue":D[0]||(D[0]=ee=>Pe(T)?T.value=ee:null),range:"","enable-time-picker":!1,"min-date":u(d),"max-date":u(g),"auto-apply":"",locale:"ru",placeholder:"Выбрать дни","select-text":"Готово","cancel-text":"Закрыть",class:"grow",format:h,clearable:!1},null,8,["modelValue","min-date","max-date"])])]),s("div",mu,[s("div",vu,[e(u(Fe),{modelValue:u(l),"onUpdate:modelValue":[D[1]||(D[1]=ee=>Pe(l)?l.value=ee:null),V],"multi-dates":"","enable-time-picker":!1,locale:"ru","min-date":u(d),"max-date":u(g),"start-date":u(d),placeholder:"Выбрать смены","select-text":"Готово","cancel-text":"Закрыть",format:o,class:"grow",clearable:!1},null,8,["modelValue","min-date","max-date","start-date"])])])]),s("div",_u,[e(z,{"packer-id":H.curentPacker?.id??0,"cur-user":u(S),class:"w-full",onReportCreated:q},null,8,["packer-id","cur-user"]),s("div",fu,[s("span",null," Сумма: "+_(u($))+"р. ",1)])]),u(j)?(a(),v("div",gu,"Загрузка...")):u(c)?(a(),v("div",bu,_(u(c)),1)):H.curentPacker?u(r).length===0?(a(),v("div",xu," Нет отчетов для выбранного упаковщика ")):(a(),O(de,{key:4,class:"h-[calc(100vh-200px)]"},{default:t(()=>[e(re,{class:"bg-white rounded-sm"},{default:t(()=>[e(W,null,{default:t(()=>[n("Отчеты упаковщика: "+_(H.curentPacker?.fullName),1)]),_:1}),e(U,null,{default:t(()=>[e(x,null,{default:t(()=>[e(I,null,{default:t(()=>D[5]||(D[5]=[n("Дата",-1)])),_:1,__:[5]}),e(I,{class:"text-center"},{default:t(()=>D[6]||(D[6]=[n("Название",-1)])),_:1,__:[6]}),e(I,{class:"text-center"},{default:t(()=>D[7]||(D[7]=[n("Инфо",-1)])),_:1,__:[7]}),e(I,{class:"text-center"},{default:t(()=>D[8]||(D[8]=[n("Стоимость",-1)])),_:1,__:[8]})]),_:1})]),_:1}),e(te,null,{default:t(()=>[(a(!0),v(se,null,ae(u(r),ee=>(a(),O(x,{key:ee.id,class:K({"cursor-pointer hover:bg-gray-100":!0,"bg-yellow-100/50":ee.isOther,"bg-red-100":ee.penaltyCost>0}),onClick:De=>A(ee)},{default:t(()=>[e(N,null,{default:t(()=>[s("div",wu,[s("span",null,_(k(ee.date).slice(0,5)),1),ee.comment?(a(),O(u(Ae),{key:0})):M("",!0)])]),_:2},1024),e(N,{class:"text-center"},{default:t(()=>[s("div",ku,[ee.name.startsWith("http")?(a(),v("a",{key:0,href:ee.name,target:"_blank",class:"text-blue-500 hover:underline",onClick:D[2]||(D[2]=Je(()=>{},["stop"]))},"Карточка",8,$u)):(a(),v("div",hu,[s("span",null,_(ee.name),1)])),ee.dopsComment?(a(),v("span",Uu," + "+_(ee.dopsComment),1)):M("",!0)])]),_:2},1024),ee.isOther?(a(),O(N,{key:0,class:"text-center"},{default:t(()=>D[9]||(D[9]=[n(" Другое ",-1)])),_:1,__:[9]})):(a(),O(N,{key:1,class:"text-center"},{default:t(()=>[s("div",Vu,[ee.items?(a(),v("span",Cu,_(ee.items)+" выв.",1)):M("",!0),ee.dimmers?(a(),v("span",Su,_(ee.dimmers)+" дим.",1)):M("",!0),ee.adapters?(a(),v("span",Mu,_(ee.adapters)+" блок",1)):M("",!0),ee.lam?(a(),v("span",Ru,_(ee.lam)+" пленка",1)):M("",!0),ee.overSize?(a(),v("span",Du,"Не габарит")):M("",!0)])]),_:2},1024)),e(N,{class:"text-center"},{default:t(()=>[s("div",Tu,[s("span",Pu,"+"+_(ee.cost)+"р.",1),ee.penaltyCost?(a(),v("span",Iu,_(" -"+ee.penaltyCost)+"р.",1)):M("",!0)])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),e(X,{orientation:"horizontal"})]),_:1})):(a(),v("div",yu," Выберите упаковщика для отображения отчетов ")),u(i)&&u(f)?(a(),O(Q,{key:5,report:u(f),"cur-user":u(S),onReportUpdated:q,onClose:D[3]||(D[3]=ee=>i.value=!1)},null,8,["report","cur-user"])):M("",!0),u(b)&&u(p)?(a(),O(ie,{key:6,report:u(p),onReportUpdated:q,onClose:D[4]||(D[4]=ee=>b.value=!1)},null,8,["report"])):M("",!0)])}}}),Fu={class:"flex flex-col gap-2"},Eu={class:"px-2"},Nu={class:"text-xl font-semibold py-2"},Gu={key:0,class:"text-center"},Bu={key:1,class:"text-red-500 text-center"},Lu={key:2,class:"text-center"},zu={key:3},Au={class:"flex flex-col sm:flex-row gap-4"},Wu={class:"flex-1"},Hu={class:"text-lg font-bold text-green-600"},ju={class:"flex-1"},qu={class:"text-lg font-bold text-blue-600"},Yu={class:"overflow-x-auto"},Ku=ne({__name:"PackersStat",props:{range:{}},setup(B){const{$useApi:L}=ue(),{toast:G}=ce(),F=B,R=m(F.range.from.slice(0,7)),y=m(!1),S=m(null),w=m(null),d=m(),g=m(!1),r=async()=>{try{y.value=!0,S.value=null;const{data:p}=await L.get("production/packer-stat",{params:{period:R.value}});w.value=p}catch{S.value="Не удалось загрузить статистику",G({title:"Ошибка",description:S.value,variant:"destructive"})}finally{y.value=!1}},j=p=>{const l=new Date(p),$=et(l,"dd",{locale:lt}),T=et(l,"EEEEEE",{locale:lt});return`${$} (${T})`},c=p=>{const $=new Date(p).getDay();return $===0||$===6},i=Qe(()=>w.value?Object.values(w.value.shiftsSumByDate).reduce((p,l)=>p+l,0):0),f=Qe(()=>w.value?Object.values(w.value.itemsSumByDate).reduce((p,l)=>p+l,0):0),b=async p=>{d.value=p,g.value=!0};return J(()=>F.range,async()=>{R.value=F.range.from.slice(0,7),await r()}),fe(async()=>{await r()}),(p,l)=>{const $=Rt,T=Pt,E=It,A=Tt,q=Ou,P=Dt,o=Mt,h=dt,V=he,k=we,C=xe,H=ye,D=ke,z=$e,W=be;return a(),v("div",Fu,[e(o,{open:g.value,"onUpdate:open":l[0]||(l[0]=I=>g.value=I)},{default:t(()=>[e($,{class:"hidden"}),e(P,{class:"min-w-[500px] p-0"},{default:t(()=>[e(A,{class:"hidden"},{default:t(()=>[e(T),e(E)]),_:1}),s("div",Eu,[s("div",Nu,_(d.value?.fullName),1),d.value?(a(),O(q,{key:0,period:R.value,"curent-packer":d.value,onUpdated:r},null,8,["period","curent-packer"])):M("",!0)])]),_:1})]),_:1},8,["open"]),y.value?(a(),v("div",Gu,"Загрузка...")):S.value?(a(),v("div",Bu,_(S.value),1)):!w.value||w.value.packers.length===0?(a(),v("div",Lu," Нет данных за выбранный период ")):(a(),v("div",zu,[e(h,{class:"mb-4 p-4 bg-white rounded-sm shadow-sm"},{default:t(()=>[s("div",Au,[s("div",Wu,[l[1]||(l[1]=s("h3",{class:"text-sm font-semibold text-gray-700"}," Общее количество смен ",-1)),s("p",Hu,_(i.value),1)]),s("div",ju,[l[2]||(l[2]=s("h3",{class:"text-sm font-semibold text-gray-700"}," Общее количество вывесок ",-1)),s("p",qu,_(f.value),1)])])]),_:1}),s("div",Yu,[e(W,{class:"bg-white rounded-sm text-xs w-full border border-black"},{default:t(()=>[e(V,null,{default:t(()=>[n("Статистика упаковщиков за "+_(R.value),1)]),_:1}),e(H,null,{default:t(()=>[e(C,null,{default:t(()=>[e(k,{class:"p-2 sticky left-0 bg-gray-300 font-bold border border-black"},{default:t(()=>l[3]||(l[3]=[n("Упаковщик",-1)])),_:1,__:[3]}),(a(!0),v(se,null,ae(w.value.dates,(I,x)=>(a(),O(k,{key:I,class:"p-1 text-center bg-gray-300 border border-black"},{default:t(()=>[n(_(j(I).split(" ")[0]),1),l[4]||(l[4]=s("br",null,null,-1)),n(" "+_(j(I).split(" ")[1]),1)]),_:2,__:[4]},1024))),128))]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(C,null,{default:t(()=>[e(D,{class:"p-2 sticky left-0 bg-gray-300 font-semibold border border-black"},{default:t(()=>l[5]||(l[5]=[n("Смены",-1)])),_:1,__:[5]}),(a(!0),v(se,null,ae(w.value.dates,(I,x)=>(a(),O(D,{key:I,class:"p-1 text-center bg-green-500/50 border border-black"},{default:t(()=>[n(_(w.value.shiftsSumByDate[I]||0),1)]),_:2},1024))),128))]),_:1}),e(C,null,{default:t(()=>[e(D,{class:"p-2 sticky left-0 bg-gray-300 font-semibold border border-black"},{default:t(()=>l[6]||(l[6]=[n("Вывески",-1)])),_:1,__:[6]}),(a(!0),v(se,null,ae(w.value.dates,(I,x)=>(a(),O(D,{key:I,class:"p-1 text-center bg-gray-300/50 border border-black"},{default:t(()=>[n(_(w.value.itemsSumByDate[I]||0),1)]),_:2},1024))),128))]),_:1}),(a(!0),v(se,null,ae(w.value.packers,I=>(a(),O(C,{key:I.packerId,class:"cursor-pointer",onClick:x=>b({id:I.packerId,fullName:I.fullName})},{default:t(()=>[e(D,{class:"p-2 sticky left-0 bg-gray-300 border border-black"},{default:t(()=>[n(_(I.fullName),1)]),_:2},1024),(a(!0),v(se,null,ae(w.value.dates,(x,U)=>(a(),O(D,{key:x,class:K(["p-1 text-center border border-black",{"bg-blue-100/50":c(x),"bg-green-500/50":I.shiftsByDate[x],"font-bold":I.itemsByDate[x]}])},{default:t(()=>[n(_(I.itemsByDate[x]||0),1)]),_:2},1032,["class"]))),128))]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})])]))])}}}),Xu={class:"w-full"},Zu={class:""},Qu={class:"flex flex-col gap-5"},Ju={class:"relative"},ei={class:"flex gap-2"},ti={class:"relative"},li={class:"flex gap-2"},si={class:"relative"},ai={class:"flex gap-2"},oi={class:"flex gap-2"},ni={class:"relative"},ui={class:"flex gap-2"},ii={class:"relative"},ri={class:"relative"},di={key:0,class:"relative"},ci={class:"relative"},pi={class:"flex justify-end w-full"},mi={class:"flex flex-col gap-5"},vi={class:"relative"},_i={class:"relative"},fi={class:"relative"},gi={class:"flex justify-end w-full"},bi=ne({__name:"ReportCreate",props:{frezerId:{},curUser:{}},emits:["report-created"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!1),w=m(!0),d=m("new"),g={date:new Date().toISOString().slice(0,10),items:0,sheets:0,remake:0,hours:0,cost:0,square:0,userId:y.frezerId,comment:"",penaltyCost:0},r=m({...g}),j={date:new Date().toISOString().slice(0,10),name:"",cost:0,userId:y.frezerId},c=m({...j}),i=()=>{const{hours:p}=r.value,l=p*300;r.value.cost=l},f=async()=>{try{w.value=!0,await G.post("production/frezer-report",{...r.value,userId:y.frezerId}),S.value=!1,w.value=!1,R("report-created"),F({title:"Успех",description:"Отчет успешно создан"})}catch(p){console.log(p)}},b=async()=>{try{w.value=!0,await G.post("production/other-report",{...c.value,userId:y.frezerId}),S.value=!1,w.value=!1,R("report-created"),F({title:"Успех",description:"Отчет успешно создан"})}catch(p){console.log(p)}};return J(r,()=>{i();const{date:p,items:l,sheets:$,hours:T,square:E}=r.value;w.value=!(p&&l&&$&&T&&E)},{deep:!0}),J(c,()=>{const{date:p,name:l,cost:$}=c.value;w.value=!(p&&l&&$)},{deep:!0}),J(S,p=>{p||(r.value={...g},c.value={...j,userId:y.frezerId})}),J(d,()=>{r.value={...g},c.value={...j,userId:y.masterId},w.value=!0}),(p,l)=>{const $=Oe,T=rt,E=Ce,A=Me,q=Ve,P=Ge,o=Ne,h=Ie,V=ge,k=Le,C=vt,H=Ee,D=Re,z=Ue,W=Se;return a(),v("div",Xu,[e(W,{open:u(S),"onUpdate:open":l[12]||(l[12]=I=>Pe(S)?S.value=I:null)},{default:t(()=>[e(T,{"as-child":""},{default:t(()=>[e($,{class:"w-full"},{default:t(()=>l[13]||(l[13]=[n("Создать",-1)])),_:1,__:[13]})]),_:1}),e(z,{class:"max-w-[400px] flex flex-col top-0 translate-y-[0px]"},{default:t(()=>[e(q,null,{default:t(()=>[e(E,null,{default:t(()=>l[14]||(l[14]=[n("Создать запись",-1)])),_:1,__:[14]}),e(A)]),_:1}),e(H,{modelValue:u(d),"onUpdate:modelValue":l[11]||(l[11]=I=>Pe(d)?d.value=I:null)},{default:t(()=>[e(o,{class:"w-full mb-4"},{default:t(()=>[e(P,{class:"w-full",value:"new"},{default:t(()=>l[15]||(l[15]=[n(" Новое ",-1)])),_:1,__:[15]}),e(P,{class:"w-full",value:"other"},{default:t(()=>l[16]||(l[16]=[n(" Другое ",-1)])),_:1,__:[16]})]),_:1}),e(C,{value:"new"},{default:t(()=>[s("div",Zu,[s("div",Qu,[s("div",Ju,[u(r).date?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[17]||(l[17]=[n("Дата смены",-1)])),_:1,__:[17]})):M("",!0),e(V,{modelValue:u(r).date,"onUpdate:modelValue":l[0]||(l[0]=I=>u(r).date=I),type:"date",placeholder:"Дата смены",class:K(u(r).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",ei,[s("div",ti,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[18]||(l[18]=[n("Вывески",-1)])),_:1,__:[18]}),s("div",li,[e(V,{modelValue:u(r).items,"onUpdate:modelValue":l[1]||(l[1]=I=>u(r).items=I),modelModifiers:{number:!0},placeholder:"Вывески",type:"number",min:"0",class:K(u(r).items>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",si,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[19]||(l[19]=[n("Целые листы",-1)])),_:1,__:[19]}),s("div",ai,[e(V,{modelValue:u(r).sheets,"onUpdate:modelValue":l[2]||(l[2]=I=>u(r).sheets=I),modelModifiers:{number:!0},placeholder:"Целые листы",type:"number",min:"0",class:K(u(r).sheets>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])])]),s("div",oi,[s("div",ni,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[20]||(l[20]=[n("Площадь",-1)])),_:1,__:[20]}),s("div",ui,[e(V,{modelValue:u(r).square,"onUpdate:modelValue":l[3]||(l[3]=I=>u(r).square=I),modelModifiers:{number:!0},placeholder:"Площадь",type:"number",min:"0",class:K(u(r).square>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",ii,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[21]||(l[21]=[n("Часы работы",-1)])),_:1,__:[21]}),e(V,{modelValue:u(r).hours,"onUpdate:modelValue":l[4]||(l[4]=I=>u(r).hours=I),modelModifiers:{number:!0},placeholder:"Часы работы",type:"number",min:"0",class:K(u(r).hours>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",ri,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[22]||(l[22]=[n("Переделки",-1)])),_:1,__:[22]}),e(V,{modelValue:u(r).remake,"onUpdate:modelValue":l[5]||(l[5]=I=>u(r).remake=I),modelModifiers:{number:!0},placeholder:"Переделки",type:"number",min:"0",class:K(u(r).remake>=0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),p.curUser?.role.shortName!=="FRZ"?(a(),v("div",di,[e(h,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[23]||(l[23]=[n("Штраф",-1)])),_:1,__:[23]}),e(V,{modelValue:u(r).penaltyCost,"onUpdate:modelValue":l[6]||(l[6]=I=>u(r).penaltyCost=I),placeholder:"Штраф",type:"number"},null,8,["modelValue"])])):M("",!0),s("div",ci,[e(k,{modelValue:u(r).comment,"onUpdate:modelValue":l[7]||(l[7]=I=>u(r).comment=I),placeholder:"Комментарий",disabled:p.curUser?.role.shortName==="FRZ"},null,8,["modelValue","disabled"]),u(r).comment?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[24]||(l[24]=[n(" Комментарий ",-1)])),_:1,__:[24]})):M("",!0)]),s("span",null," Стоимость: "+_(u(r).cost)+"р. ",1)]),s("div",pi,[e($,{disabled:u(w),onClick:f},{default:t(()=>l[25]||(l[25]=[n(" Создать ",-1)])),_:1,__:[25]},8,["disabled"])])])]),_:1}),e(C,{value:"other"},{default:t(()=>[s("div",mi,[s("div",vi,[u(c).date?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[26]||(l[26]=[n("Дата",-1)])),_:1,__:[26]})):M("",!0),e(V,{modelValue:u(c).date,"onUpdate:modelValue":l[8]||(l[8]=I=>u(c).date=I),type:"date",placeholder:"Дата",class:K(u(c).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",_i,[u(c).name?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[27]||(l[27]=[n("Описание",-1)])),_:1,__:[27]})):M("",!0),e(V,{modelValue:u(c).name,"onUpdate:modelValue":l[9]||(l[9]=I=>u(c).name=I),placeholder:"Описание",class:K(u(c).name?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",fi,[u(c).cost?(a(),O(h,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[28]||(l[28]=[n("Стоимость",-1)])),_:1,__:[28]})):M("",!0),e(V,{modelValue:u(c).cost,"onUpdate:modelValue":l[10]||(l[10]=I=>u(c).cost=I),type:"number",placeholder:"Стоимость",class:K(u(c).cost?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("span",null," Стоимость: "+_(u(c).cost)+"р. ",1)]),s("div",gi,[e($,{disabled:u(w),onClick:b},{default:t(()=>l[29]||(l[29]=[n(" Создать ",-1)])),_:1,__:[29]},8,["disabled"])])]),_:1})]),_:1},8,["modelValue"]),e(D)]),_:1})]),_:1},8,["open"])])}}}),yi={class:"w-full"},xi={class:""},wi={class:"flex flex-col gap-5"},ki={class:"relative"},$i={class:"flex gap-2"},hi={class:"relative"},Ui={class:"flex gap-2"},Vi={class:"relative"},Ci={class:"flex gap-2"},Si={class:"flex gap-2"},Mi={class:"relative"},Ri={class:"flex gap-2"},Di={class:"relative"},Ti={class:"relative"},Pi={key:0,class:"relative"},Ii={class:"relative"},Oi={class:"flex justify-between w-full gap-2"},Fi=ne({__name:"ReportEdit",props:{report:{},curUser:{}},emits:["report-updated","close"],setup(B,{emit:L}){const{$useApi:G}=ue(),{toast:F}=ce(),R=L,y=B,S=m(!0),w=m(!0),d=m({...y.report}),g=()=>{const{hours:c}=d.value,i=c*300;d.value.cost=i},r=async()=>{try{w.value=!0,await G.patch(`production/frezer-report/${d.value.id}`,{...d.value}),S.value=!1,w.value=!1,R("report-updated"),F({title:"Успех",description:"Отчет успешно отредактирован"})}catch(c){console.log(c)}},j=async()=>{try{await G.delete(`production/frezer-report/${d.value.id}`),S.value=!1,R("report-updated"),F({title:"Успех",description:"Отчет успешно удален"})}catch(c){console.log(c)}};return J(d,()=>{g();const{date:c,items:i,sheets:f,hours:b,square:p}=d.value;w.value=!(c&&i&&f&&b&&p)},{deep:!0}),J(S,c=>{c||R("close")}),(c,i)=>{const f=Ce,b=Me,p=Ve,l=Ie,$=ge,T=Le,E=Oe,A=Re,q=Ue,P=Se;return a(),v("div",yi,[e(P,{open:u(S),"onUpdate:open":i[8]||(i[8]=o=>Pe(S)?S.value=o:null)},{default:t(()=>[e(q,{class:"max-w-[400px] flex flex-col top-0 translate-y-[0px]"},{default:t(()=>[e(p,null,{default:t(()=>[e(f,null,{default:t(()=>i[9]||(i[9]=[n("Редактировать запись",-1)])),_:1,__:[9]}),e(b)]),_:1}),s("div",xi,[s("div",wi,[s("div",ki,[u(d).date?(a(),O(l,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[10]||(i[10]=[n("Дата смены",-1)])),_:1,__:[10]})):M("",!0),e($,{modelValue:u(d).date,"onUpdate:modelValue":i[0]||(i[0]=o=>u(d).date=o),type:"date",placeholder:"Дата смены",class:K(u(d).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),s("div",$i,[s("div",hi,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[11]||(i[11]=[n("Вывески",-1)])),_:1,__:[11]}),s("div",Ui,[e($,{modelValue:u(d).items,"onUpdate:modelValue":i[1]||(i[1]=o=>u(d).items=o),modelModifiers:{number:!0},placeholder:"Вывески",type:"number",min:"0",class:K(u(d).items>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",Vi,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[12]||(i[12]=[n("Целые листы",-1)])),_:1,__:[12]}),s("div",Ci,[e($,{modelValue:u(d).sheets,"onUpdate:modelValue":i[2]||(i[2]=o=>u(d).sheets=o),modelModifiers:{number:!0},placeholder:"Целые листы",type:"number",min:"0",class:K(u(d).sheets>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])])]),s("div",Si,[s("div",Mi,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[13]||(i[13]=[n("Площадь",-1)])),_:1,__:[13]}),s("div",Ri,[e($,{modelValue:u(d).square,"onUpdate:modelValue":i[3]||(i[3]=o=>u(d).square=o),modelModifiers:{number:!0},placeholder:"Площадь",type:"number",min:"0",class:K(u(d).square>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",Di,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[14]||(i[14]=[n("Часы работы",-1)])),_:1,__:[14]}),e($,{modelValue:u(d).hours,"onUpdate:modelValue":i[4]||(i[4]=o=>u(d).hours=o),modelModifiers:{number:!0},placeholder:"Часы работы",type:"number",min:"0",class:K(u(d).hours>0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),s("div",Ti,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[15]||(i[15]=[n("Переделки",-1)])),_:1,__:[15]}),e($,{modelValue:u(d).remake,"onUpdate:modelValue":i[5]||(i[5]=o=>u(d).remake=o),modelModifiers:{number:!0},placeholder:"Переделки",type:"number",min:"0",class:K(u(d).remake>=0?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),c.curUser?.role.shortName!=="FRZ"?(a(),v("div",Pi,[e(l,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[16]||(i[16]=[n("Штраф",-1)])),_:1,__:[16]}),e($,{modelValue:u(d).penaltyCost,"onUpdate:modelValue":i[6]||(i[6]=o=>u(d).penaltyCost=o),placeholder:"Штраф",type:"number"},null,8,["modelValue"])])):M("",!0),s("div",Ii,[e(T,{modelValue:u(d).comment,"onUpdate:modelValue":i[7]||(i[7]=o=>u(d).comment=o),placeholder:"Комментарий",disabled:c.curUser?.role.shortName==="FRZ"},null,8,["modelValue","disabled"]),u(d).comment?(a(),O(l,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>i[17]||(i[17]=[n(" Комментарий ",-1)])),_:1,__:[17]})):M("",!0)]),s("span",null," Стоимость: "+_(u(d).cost)+"р. ",1)]),s("div",Oi,[e(E,{variant:"destructive",onClick:j},{default:t(()=>i[18]||(i[18]=[n(" Удалить ",-1)])),_:1,__:[18]}),e(E,{disabled:u(w),onClick:r},{default:t(()=>i[19]||(i[19]=[n(" Сохранить ",-1)])),_:1,__:[19]},8,["disabled"])])]),e(A)]),_:1})]),_:1},8,["open"])])}}}),Ei={class:"flex flex-col gap-2"},Ni={class:"flex flex-col gap-2"},Gi={class:"flex gap-2 flex-wrap items-center"},Bi={class:"flex justify-between w-[300px] rounded-lg p-2 border border-slate-200 bg-white text-slate-950 shadow-sm"},Li={key:0,class:"text-center"},zi={key:1,class:"text-red-500 text-center"},Ai={key:2,class:"text-center"},Wi={key:3,class:"text-center"},Hi={key:4},ji={class:"flex items-center gap-2"},qi={class:"font-semibold"},Yi={class:"text-center"},Ki={class:"flex flex-col"},Xi={class:"font-semibold text-green-600"},Zi={key:0,class:"text-xs text-gray-500"},Qi={key:1,class:"font-semibold text-red-500"},Ji={key:0},er={key:1,class:"text-xs text-gray-500"},tr={key:2,class:"text-xs text-gray-500"},lr={key:0,class:"flex flex-col"},sr={key:1,class:"flex flex-col"},ar=ne({__name:"index",props:{range:{}},setup(B){mt({title:"Фререзовка | Easy CRM",meta:[{name:"viewport",content:"width=device-width, initial-scale=1.0"}]});const L=ze(),{$useApi:G}=ue(),{toast:F}=ce(),R=B,y=L.user,S=m(R.range.from.slice(0,7)),w=m([]),d=m(null),g=m([]),r=m([]),j=m(!1),c=m(null),i=m(!1),f=m(null),b=m(!1),p=m(null),l=m(0),$=m(0),T=async()=>{try{j.value=!0,c.value=null;const{data:h}=await G.get("production/frezers");w.value=h,h.length>0?d.value=h[0]:(d.value=null,F({title:"Ошибка",description:"Список фрезеровщиков пуст",variant:"destructive"}))}catch{c.value="Не удалось загрузить список фрезеровщиков",F({title:"Ошибка",description:c.value,variant:"destructive"})}finally{j.value=!1}},E=async()=>{if(d.value&&R.range)try{j.value=!0,c.value=null;const{data:h}=await G.get(`production/frezer/${d.value.id}/reports`,{params:R.range}),V=h.map(k=>({...k,avgCostPerItem:k.items>0?Number((k.cost/k.items).toFixed(2)):0,materialCostSheets:k.sheets*6e3,materialCostSquare:k.square*2e3,avgSubstrateCost:k.items>0?(k.sheets*6e3/k.items).toFixed(2):0,totalCostPerItem:k.items>0?(k.cost/k.items+k.sheets*6e3/k.items).toFixed(2):0}));g.value=V,r.value=V,o()}catch{c.value="Не удалось загрузить отчеты",F({title:"Ошибка",description:c.value,variant:"destructive"})}finally{j.value=!1}},A=h=>{const V=new Date(h);return`${V.getDate().toString().padStart(2,"0")}.${(V.getMonth()+1).toString().padStart(2,"0")}.${V.getFullYear()}`},q=h=>{if(h.isOther){p.value={...h},b.value=!0;return}f.value={...h},i.value=!0},P=async()=>{await E(),i.value=!1,f.value=null},o=()=>{l.value=g.value.reduce((h,V)=>h+(V.cost-V.penaltyCost),0),$.value=g.value.reduce((h,V)=>h+(V.hours??0),0)};return fe(async()=>{await T()}),J(d,()=>{d.value&&E()}),J(()=>R.range,async()=>{S.value=R.range.from.slice(0,7),await E()}),(h,V)=>{const k=ct,C=bi,H=he,D=we,z=xe,W=ye,I=ke,x=$e,U=be,N=Be,te=Fi,re=We;return a(),v("div",Ei,[s("div",Ni,[s("div",Gi,[u(w).length>1||u(y)?.role.shortName!=="FRZ"?(a(),O(k,{key:0,items:u(w).map(X=>({value:X.id,label:X.fullName})),label:u(d)?.fullName||"Выберите фрезеровщика",onSelectedItem:V[0]||(V[0]=X=>{d.value=u(w).find(de=>de.id===X)||null})},null,8,["items","label"])):M("",!0),s("div",null,[u(y)?(a(),O(C,{key:0,"frezer-id":u(d)?.id??0,"cur-user":u(y),onReportCreated:E},null,8,["frezer-id","cur-user"])):M("",!0)]),s("div",Bi,[s("span",null," Часы: "+_(u($)),1),s("span",null," Сумма: "+_(u(l))+"р. ",1)])])]),u(j)?(a(),v("div",Li,"Загрузка...")):u(c)?(a(),v("div",zi,_(u(c)),1)):u(d)?u(g).length===0?(a(),v("div",Wi," Нет отчетов для выбранного мастера. ")):(a(),v("div",Hi,[e(N,{class:"h-[calc(100vh-325px)] rounded-sm"},{default:t(()=>[e(U,{class:"bg-white rounded-sm relative"},{default:t(()=>[e(H),e(W,{class:"sticky top-0 z-50 bg-gray-50"},{default:t(()=>[e(z,null,{default:t(()=>[e(D,null,{default:t(()=>V[3]||(V[3]=[n("Дата",-1)])),_:1,__:[3]}),e(D,{class:"text-center"},{default:t(()=>V[4]||(V[4]=[n("Подложки",-1)])),_:1,__:[4]}),e(D,{class:"text-center"},{default:t(()=>V[5]||(V[5]=[n("Листы",-1)])),_:1,__:[5]}),e(D,{class:"text-center"},{default:t(()=>V[6]||(V[6]=[n("Площадь",-1)])),_:1,__:[6]}),e(D,{class:"text-center"},{default:t(()=>V[7]||(V[7]=[n("В ЗП",-1)])),_:1,__:[7]}),e(D,{class:"text-center"},{default:t(()=>V[8]||(V[8]=[n("Переделки",-1)])),_:1,__:[8]}),e(D,{class:"text-center whitespace-break-spaces"},{default:t(()=>V[9]||(V[9]=[n("Стоимость подложки",-1)])),_:1,__:[9]}),e(D,{class:"text-center whitespace-break-spaces"},{default:t(()=>V[10]||(V[10]=[n("Стоимость материала",-1)])),_:1,__:[10]})]),_:1})]),_:1}),e(x,null,{default:t(()=>[(a(!0),v(se,null,ae(u(g),X=>(a(),O(z,{key:X.id,class:K({"cursor-pointer hover:bg-gray-100":!0,"bg-yellow-100/50":X.isOther,"bg-red-100":X.penaltyCost>0}),onClick:de=>q(X)},{default:t(()=>[e(I,null,{default:t(()=>[s("div",ji,[s("span",null,_(A(X.date).slice(0,5)),1),X.comment?(a(),O(u(Ae),{key:0})):M("",!0)])]),_:2},1024),e(I,{class:"text-center"},{default:t(()=>[s("span",qi,_(X.items??0)+" шт.",1)]),_:2},1024),e(I,null,{default:t(()=>[s("div",Yi,[s("span",null,_(X.sheets??0)+" шт.",1)])]),_:2},1024),e(I,{class:"text-center"},{default:t(()=>[s("span",null,_(X.square??0)+"м2.",1)]),_:2},1024),e(I,{class:"text-center"},{default:t(()=>[s("div",Ki,[s("span",Xi," +"+_(X.cost)+"р. ",1),X.isOther?M("",!0):(a(),v("span",Zi,"за "+_(X.hours)+"ч.",1)),X.penaltyCost?(a(),v("span",Qi,_(" -"+X.penaltyCost)+"р.",1)):M("",!0)])]),_:2},1024),e(I,{class:"text-center"},{default:t(()=>[s("span",{class:K({"text-red-500 font-semibold":X.remake})},_(X.remake??0)+"шт.",3)]),_:2},1024),e(I,{class:"text-center flex flex-col"},{default:t(()=>[X.isOther?M("",!0):(a(),v("span",Ji,_(X.totalCostPerItem)+"р.",1)),X.isOther?M("",!0):(a(),v("span",er,"Фрезеровка - "+_(X.avgCostPerItem)+"р.",1)),X.isOther?M("",!0):(a(),v("span",tr,"Материал - "+_(X.avgSubstrateCost)+"р.",1))]),_:2},1024),e(I,{class:"text-center"},{default:t(()=>[X.isOther?(a(),v("div",sr,[s("span",null,_(X.name),1)])):(a(),v("div",lr,[s("span",null,"По листам - "+_(X.materialCostSheets)+"р.",1),s("span",null,"По площади - "+_(X.materialCostSquare)+"р.",1)]))]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1})])):(a(),v("div",Ai," Выберите мастера для отображения отчетов. ")),u(i)&&u(f)?(a(),O(te,{key:5,report:u(f),"cur-user":u(y),onReportUpdated:P,onClose:V[1]||(V[1]=X=>i.value=!1)},null,8,["report","cur-user"])):M("",!0),u(b)&&u(p)?(a(),O(re,{key:6,report:u(p),onReportUpdated:P,onClose:V[2]||(V[2]=X=>b.value=!1)},null,8,["report"])):M("",!0)])}}}),or={class:"relative h-screen hidden-scrollbar"},nr={class:"w-full fixed z-10"},ur={class:"h-[full] flex px-4 gap-2 mx-[auto] max-w-[2048px] pt-16"},ir={class:"flex flex-col gap-2 w-full"},rr={class:"flex gap-2 items-center flex-wrap"},dr={key:1,class:"md:hidden w-[240px]"},cr={key:0},pr={key:1},mr={key:2},vr={key:3},_r={key:4},fr={key:5},gr={key:6},br={key:7},yr={key:8},_d=ne({__name:"index",setup(B){const{$useApi:L}=ue();mt({title:"Производство | Easy CRM"});const G=m(new Date().toISOString().slice(0,7)),F=m({month:new Date().getMonth(),year:new Date().getFullYear()}),R=m([]),y=m(""),S=m(null),w=g=>{S.value=g},d=async()=>{const{data:g}=await L.get("production/predata");R.value=g.tabs,y.value=g.tabs[0].value};return J(F,g=>{const{month:r,year:j}=g;G.value=new Date(j,r+1).toISOString().slice(0,7)}),fe(async()=>{await d()}),(g,r)=>{const j=Et,c=Nt,i=Ge,f=Ne,b=Ee,p=ot,l=at,$=Gt,T=ut,E=it,A=nt,q=st,P=rs,o=ga,h=Sa,V=Ko,k=qn,C=iu,H=Ku,D=ar;return a(),v("div",or,[s("div",nr,[e(j)]),s("div",ur,[s("div",ir,[s("div",rr,[e(c,{onRangeUpdated:w}),u(R).length&&u(R).length>1?(a(),O(b,{key:0,modelValue:u(y),"onUpdate:modelValue":r[0]||(r[0]=z=>Pe(y)?y.value=z:null),class:"hidden md:block w-[400px]"},{default:t(()=>[e(f,null,{default:t(()=>[(a(!0),v(se,null,ae(u(R),z=>(a(),O(i,{key:z.value,value:z.value},{default:t(()=>[n(_(z.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):M("",!0),u(R).length?(a(),v("div",dr,[e(q,{modelValue:u(y),"onUpdate:modelValue":r[1]||(r[1]=z=>Pe(y)?y.value=z:null)},{default:t(()=>[e(l,null,{default:t(()=>[e(p,{placeholder:"Выберите раздел"})]),_:1}),e(A,null,{default:t(()=>[e(E,null,{default:t(()=>[e($,null,{default:t(()=>r[2]||(r[2]=[n("Разделы",-1)])),_:1,__:[2]}),(a(!0),v(se,null,ae(u(R),z=>(a(),O(T,{key:z.value,value:z.value},{default:t(()=>[n(_(z.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])):M("",!0)]),u(y)==="orders"&&u(S)?(a(),v("div",cr,[e(P,{range:u(S)},null,8,["range"])])):M("",!0),u(y)==="masters"&&u(S)?(a(),v("div",pr,[e(o,{range:u(S)},null,8,["range"])])):u(y)==="supplie"&&u(S)?(a(),v("div",mr,[e(h,{range:u(S)},null,8,["range"])])):u(y)==="table"&&u(S)?(a(),v("div",vr,[e(V,{range:u(S)},null,8,["range"])])):u(y)==="package"&&u(S)?(a(),v("div",_r,[e(k,{range:u(S)},null,8,["range"])])):u(y)==="logist"&&u(S)?(a(),v("div",fr,[e(C,{range:u(S)},null,8,["range"])])):u(y)==="packers-stat"&&u(S)?(a(),v("div",gr,[e(H,{range:u(S)},null,8,["range"])])):u(y)==="frezer"&&u(S)?(a(),v("div",br,[e(D,{range:u(S)},null,8,["range"])])):u(y)==="salaries"&&u(S)?(a(),v("div",yr,"Зарплаты")):M("",!0)])])])}}});export{_d as default};
