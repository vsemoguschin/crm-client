import{_ as be}from"./Bye7C16d.js";import{_ as ke}from"./CprHmdOe.js";import{_ as De,a as Pe,b as Fe,c as Me,d as Se}from"./JYeLPbKT.js";import{_ as Te}from"./DLLw9AXE.js";import{_ as $e}from"./D0zfKHPR.js";import{_ as Ue,a as Ce}from"./l1eRtAXP.js";import{_ as Ve}from"./BhleEUCu.js";import{_ as je}from"./BND4UK_1.js";import{_ as Ae}from"./CaiudRgb.js";import{_ as Be}from"./CHKwxJtM.js";import{b as Ne,c as Re,a as Ge,d as He,e as Ee,_ as Ie}from"./C6vK2VYI.js";import{_ as Le,a as We,b as ze,c as qe}from"./_d3GkdNY.js";import{_ as Oe}from"./DVdymwQ5.js";import{_ as Je}from"./0qYh0Ops.js";import{u as c}from"./Dt19OLxm.js";import{e as Ke,g as Qe,u as Xe,r as d,B as te,i as Ye,c as i,a as o,b as t,m as k,D as p,H as ae,l as n,w as l,o as r,d as m,F as D,z as P,t as u,A as Y}from"./BbheI0mw.js";import"./CDst0A0O.js";import"./B9M8ggfK.js";import"./D0Fd2yXn.js";import"./oLxPQbNe.js";import"./D2GZmoDz.js";import"./CaPtdwNj.js";import"./KSX9JOtw.js";import"./ZTyVILcU.js";import"./s39mgViW.js";import"./CJOOd8Dx.js";import"./BR3DQNok.js";import"./odSmgr3d.js";import"./DzJc7hp_.js";import"./CCknexPU.js";import"./CssJESp-.js";import"./_14b2CUj.js";import"./DaWZu8wl.js";const Ze={class:"relative h-screen hidden-scrollbar"},et={class:"w-full fixed z-10"},tt={class:"h-[full] flex p-4 gap-2 mx-[auto] max-w-[2048px] pt-16"},at={class:"flex flex-col gap-4 w-full"},lt={class:"flex gap-2"},st={class:"flex flex-col gap-2"},nt={class:"flex gap-2"},ot={key:0,class:"w-[220px]"},rt={key:1,class:"w-[220px]"},ut={class:"flex justify-between items-center"},it={class:"font-medium text-gray-800"},ct={class:Y(["font-bold text-lg"])},dt={class:"text-xs text-muted-foreground flex justify-between mt-1"},ft={key:0,class:"text-gray-500"},_t={class:"flex justify-between gap-5 items-center"},mt={class:"font-medium text-gray-800"},pt={class:Y(["font-bold text-lg"])},vt={class:"text-xs text-muted-foreground flex justify-between mt-1"},yt={key:0,class:"text-gray-500"},gt={key:1,class:"grow"},xt={class:"flex justify-between gap-5 items-center"},ht={class:"font-medium text-gray-800"},wt={class:Y(["font-bold text-lg"])},bt={class:"text-xs text-muted-foreground flex justify-between mt-1"},kt={key:0,class:"text-gray-500"},Dt={class:"flex justify-between gap-5 items-center"},Pt={class:Y(["font-bold text-lg"])},Ft={class:"flex flex-col gap-4"},Mt={class:"w-full flex gap-2"},St={class:"mt-4 flex flex-col"},Tt={class:"mt-4 flex flex-col"},$t={class:"mt-4 flex flex-col pb-3 relative"},Ut={class:"w-[150px] overflow-hidden text-ellipsis"},Ct={class:"relative"},Vt={class:"absolute font-bold top-[55%] left-1/2 translate-x-[-50%] h-full"},jt={class:"mt-4 flex flex-col"},At={class:"text-nowrap"},Bt={class:"text-nowrap"},Nt={key:0,class:"grow"},Rt={key:1,class:"grow"},xa=Ke({__name:"index",setup(Gt){const{$useApi:Z}=Qe();Xe({title:"Статистика | Easy CRM"});const V=d(new Date().toISOString().slice(0,7)),le=d(!1),B=d([]),N=d([]),R=d([]),q=d(0),G=d(0),se=d([]),O=d([]),J=d([]),K=d([]),H=d([]),E=d([]),I=d([]),j=d([]),Q=d([]),F=d(""),T=d([]),M=d(""),ne=d(0),ee=async e=>{if(!e){T.value=[],M.value="",L();return}try{const s={period:V.value};e&&e!=="all"&&(s.groupId=String(e));const f=await Z.get("/commercial-datas/stat",{params:s}),{data:v}=f,_=v;let y=[];if(Array.isArray(_)?y=_:_&&typeof _=="object"&&"workspaces"in _&&Array.isArray(_.workspaces)?y=_.workspaces:_&&typeof _=="object"&&(y=[_]),se.value=y,T.value=y.map(b=>b.workSpaceName).filter(b=>!!b),!T.value.length){M.value="",L();return}M.value=T.value[0],ue(y[0])}catch(s){console.log(s)}},oe=async()=>{try{const{data:e}=await Z.get("/groups/available"),s=Array.isArray(e)?e:[];Q.value=s.map(f=>({id:f.id?String(f.id):"",title:f.title??""})).filter(f=>f.id&&f.title),Q.value.length?F.value="all":(F.value="",T.value=[],M.value="",L())}catch(e){console.log(e)}},re=async()=>{try{const{data:e}=await Z.get("/deliveries/registers",{params:{period:V.value}});ne.value=e.sum||0}catch(e){console.log(e)}},L=()=>{O.value=[],J.value=[],K.value=[],H.value=[],E.value=[],I.value=[],j.value=[],B.value=[],N.value=[],R.value=[],G.value=0,q.value=0,le.value=!1},fe=(e=[])=>{if(!e.length||!G.value){q.value=0;return}const s=e.reduce((f,v)=>f+(v.sales??0),0);q.value=+(s/G.value*100).toFixed(2)},_e=e=>{if(!e){B.value=[],G.value=0;return}const s=e.plan??0,f=e.temp??0,v=e.totalSales??0,_=e.receivedPayments??0,y=e.remainder??s-v,b=e.dealsSales??0,A=e.dealsAmount??0,W=e.dopSales??0,S=e.dopsToSales??0,x=e.averageBill??0,h=e.tempToPlan??0,z=e.salesToPlan??0;G.value=v,le.value=s<f;const g=v-_,w=v?(g/v*100).toFixed():"0";B.value=[{title:"Общий план",value:c(s)+"₽",content:"Остаток",footer:c(y)+"₽"},{title:"Темп",value:c(f)+"₽",content:"Процент от плана",footer:h.toFixed()+"%"},{title:"Продажи",value:c(v)+"₽",content:"Процент от плана",footer:z.toFixed()+"%"},{title:"Заказы",value:c(b)+"₽",content:"Колличество заказов",footer:A.toString()},{title:"Доп. услуги",value:c(W)+"₽",content:"Процент от продаж",footer:S.toFixed()+"%"},{title:"Выручка(Факт)",value:c(_)+"₽",content:"Средний чек",footer:c(Math.round(x))+"₽"},{title:"Остаток",value:c(g)+"₽",content:"Процент неоплачено",footer:w+"%"}]},me=e=>{if(!e){N.value=[];return}N.value=[{title:"ДРР",value:(e.drr??0)+"%"},{title:"Стоимость заявки",value:(e.callCost??0)+"₽",content:"Колличество заявок",footer:e.calls??0},{title:"% из заявки в продажу",value:(e.conversionDealsToCalls??0)+"%"},{title:"% из заявки в макет",value:(e.conversionMaketsToCalls??0)+"%",content:"Общее количество макетов",footer:e.makets??0},{title:"% из макета в продажу",value:(e.conversionMaketsToSales??0)+"%"},{title:"% из заявки в макет день в день",value:(e.conversionMaketsDayToDayToCalls??0)+"%",content:"Макеты день в день",footer:e.maketsDayToDay??0},{title:"Продажи день в день",value:c(e.dealsDayToDayPrice??0)+"₽",content:"Количество продаж день в день",footer:e.dealsDayToDay??0},{title:"Без дизайнера",value:c(e.dealsSalesWithoutDesigners??0)+"₽",content:"Продажи без участия дизайнера",footer:e.dealsWithoutDesigners??0},{title:"Переходы в мессенджер",value:e.redirectToMSG??0}]},pe=e=>{if(!e){R.value=[];return}R.value=[{title:"Отправлено",value:c(e.sendDeliveriesPrice??0)+"₽",content:"Колличество",footer:e.sendDeliveries??0},{title:"Доставлено",value:c(e.deliveredDeliveriesPrice??0)+"₽",content:"Колличество",footer:e.deliveredDeliveries??0},{title:"Бесплатные доставки",value:e.freeDeliveries??0,content:"Стоимость доставок",footer:(e.freeDeliveriesPrice??0).toFixed(2)}]},ue=e=>{if(!e){L();return}const{chartData:s=[],callsChartData:f=[],users:v=[],maketsSales:_=[],sources:y=[],adTags:b=[],adExpenses:A=[],workSpaceName:W,...S}=e;O.value=s??[],J.value=f??[],K.value=v??[],H.value=_??[],E.value=y??[],I.value=b??[],j.value=A??[],_e(S),me(S),pe(S),fe(j.value)};return te(M,e=>{if(!e){L();return}const s=se.value.find(f=>f.workSpaceName===e);ue(s)}),te(F,e=>{e?ee(e):ee()}),Ye(()=>{oe(),re()}),te(V,()=>{F.value?ee(F.value):oe(),re()}),(e,s)=>{const f=be,v=ke,_=Fe,y=Pe,b=Se,A=Te,W=Me,S=De,x=Ce,h=Ue,z=Be,g=je,w=$e,$=Ve,ie=He,ce=Ge,ve=Re,de=Ie,ye=Ee,ge=Ne,U=Ae,X=Le,xe=Oe,he=We,we=Je;return r(),i("div",Ze,[o("div",et,[t(f)]),o("div",tt,[o("div",at,[o("div",lt,[o("div",st,[o("div",nt,[t(v,{modelValue:n(V),"onUpdate:modelValue":s[0]||(s[0]=a=>ae(V)?V.value=a:null),type:"month",class:""},null,8,["modelValue"]),n(Q).length?(r(),i("div",ot,[t(S,{modelValue:n(F),"onUpdate:modelValue":s[1]||(s[1]=a=>ae(F)?F.value=a:null)},{default:l(()=>[t(y,null,{default:l(()=>[t(_,{placeholder:"Выберите группу"})]),_:1}),t(W,null,{default:l(()=>[t(A,null,{default:l(()=>[t(b,{value:"all"},{default:l(()=>s[3]||(s[3]=[m(" Все проекты ",-1)])),_:1,__:[3]}),(r(!0),i(D,null,P(n(Q),a=>(r(),k(b,{key:a.id,value:a.id},{default:l(()=>[m(u(a.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])):p("",!0),n(T).length>1?(r(),i("div",rt,[t(S,{modelValue:n(M),"onUpdate:modelValue":s[2]||(s[2]=a=>ae(M)?M.value=a:null)},{default:l(()=>[t(y,null,{default:l(()=>[t(_,{placeholder:"Выберите рабочее пространство"})]),_:1}),t(W,null,{default:l(()=>[t(A,null,{default:l(()=>[(r(!0),i(D,null,P(n(T),a=>(r(),k(b,{key:a,value:a},{default:l(()=>[m(u(a),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])])):p("",!0)]),n(B).length?(r(),k(w,{key:0,class:"h-full"},{default:l(()=>[t(h,{class:"px-4 py-4"},{default:l(()=>[t(x,null,{default:l(()=>s[4]||(s[4]=[m("Продажи",-1)])),_:1,__:[4]})]),_:1}),t(g,{class:"p-4 space-y-3"},{default:l(()=>[(r(!0),i(D,null,P(n(B),a=>(r(),i("div",{key:a.title,class:"text-sm md:text-base leading-normal"},[o("div",ut,[o("span",it,u(a.title),1),o("span",ct,u(a.value),1)]),o("div",dt,[o("span",null,u(a.content),1),a.footer?(r(),i("span",ft,u(a.footer),1)):p("",!0)]),t(z)]))),128))]),_:1})]),_:1})):p("",!0)]),n(N).length?(r(),k(w,{key:0,class:"min-w-[350px]"},{default:l(()=>[t(h,{class:"px-4 py-4"},{default:l(()=>[t(x,null,{default:l(()=>s[5]||(s[5]=[m("Показатели",-1)])),_:1,__:[5]})]),_:1}),t(g,{class:"p-4 space-y-3"},{default:l(()=>[(r(!0),i(D,null,P(n(N),a=>(r(),i("div",{key:a.title,class:"text-sm md:text-base leading-normal"},[o("div",_t,[o("span",mt,u(a.title),1),o("span",pt,u(a.value),1)]),o("div",vt,[o("span",null,u(a.content),1),a.footer?(r(),i("span",yt,u(a.footer),1)):p("",!0)]),t(z)]))),128))]),_:1})]),_:1})):p("",!0),n(K).length?(r(),i("div",gt,[t(w,{class:"h-full"},{default:l(()=>[t(h,{class:"px-4 py-4"},{default:l(()=>[t(x,null,{default:l(()=>s[6]||(s[6]=[m("Топ менеджеров",-1)])),_:1,__:[6]}),t($)]),_:1}),t(g,{class:"p-0"},{default:l(()=>[t(ge,null,{default:l(()=>[t(ve,null,{default:l(()=>[t(ce,null,{default:l(()=>[t(ie,{class:"text-left"},{default:l(()=>s[7]||(s[7]=[m(" Менеджер ",-1)])),_:1,__:[7]}),t(ie,{class:"text-right"},{default:l(()=>s[8]||(s[8]=[m(" Сумма ",-1)])),_:1,__:[8]})]),_:1})]),_:1}),t(ye,null,{default:l(()=>[(r(!0),i(D,null,P(n(K),(a,C)=>(r(),k(ce,{key:C},{default:l(()=>[t(de,{class:"font-medium whitespace-nowrap"},{default:l(()=>[m(u(C+1+". "+a.fullName),1)]),_:2},1024),t(de,{class:"text-right whitespace-nowrap"},{default:l(()=>[m(u(("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a.sales)+"₽"),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(U,{class:"p-0"})]),_:1})])):p("",!0),n(R).length?(r(),k(w,{key:2,class:"min-w-[350px]"},{default:l(()=>[t(h,{class:"px-4 py-4"},{default:l(()=>[t(x,null,{default:l(()=>s[9]||(s[9]=[m("Доставка",-1)])),_:1,__:[9]})]),_:1}),t(g,{class:"p-4 space-y-3"},{default:l(()=>[(r(!0),i(D,null,P(n(R),a=>(r(),i("div",{key:a.title,class:"text-sm md:text-base leading-normal"},[o("div",xt,[o("span",ht,u(a.title),1),o("span",wt,u(a.value),1)]),o("div",bt,[o("span",null,u(a.content),1),a.footer?(r(),i("span",kt,u(a.footer),1)):p("",!0)]),t(z)]))),128)),o("div",Dt,[s[10]||(s[10]=o("span",{class:"font-medium text-gray-800"},"Реестр СДЕК",-1)),o("span",Pt,u(("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(+n(ne).toFixed(2))+"₽"),1)])]),_:1})]),_:1})):p("",!0)]),o("div",Ft,[o("div",Mt,[n(H).length?(r(),k(w,{key:0,class:"w-full"},{default:l(()=>[t(h,null,{default:l(()=>[t(x,null,{default:l(()=>s[11]||(s[11]=[m("Макеты",-1)])),_:1,__:[11]}),t($)]),_:1}),t(g,null,{default:l(()=>[t(X,{index:"name",category:"sales",data:n(H),"value-formatter":(a,C)=>typeof a=="number"?("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a)+"₽":""},null,8,["data","value-formatter"]),o("div",St,[(r(!0),i(D,null,P(n(H),a=>(r(),i("div",{key:a.name,class:"flex items-center justify-between"},[o("span",null,u(a.name)+"("+u(a.amount)+")",1),o("span",null,u(("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a.sales))+"₽",1)]))),128))])]),_:1}),t(U)]),_:1})):p("",!0),n(E).length?(r(),k(w,{key:1,class:"w-full"},{default:l(()=>[t(h,null,{default:l(()=>[t(x,null,{default:l(()=>s[12]||(s[12]=[m("Источники",-1)])),_:1,__:[12]}),t($)]),_:1}),t(g,null,{default:l(()=>[t(X,{index:"name",category:"sales",data:n(E),"value-formatter":(a,C)=>typeof a=="number"?("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a)+"₽":""},null,8,["data","value-formatter"]),o("div",Tt,[(r(!0),i(D,null,P(n(E),a=>(r(),i("div",{key:a.name,class:"flex items-center justify-between"},[o("span",null,u(a.name),1),o("span",null,u(("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a.sales))+"₽",1)]))),128))])]),_:1}),t(U)]),_:1})):p("",!0),n(I).length?(r(),k(w,{key:2,class:"w-full"},{default:l(()=>[t(h,null,{default:l(()=>[t(x,null,{default:l(()=>s[13]||(s[13]=[m("Теги",-1)])),_:1,__:[13]}),t($)]),_:1}),t(g,null,{default:l(()=>[t(X,{index:"name",category:"sales",data:n(I),"value-formatter":(a,C)=>typeof a=="number"?("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a)+"₽":""},null,8,["data","value-formatter"]),t(xe,{class:"h-[300px] pr-2"},{default:l(()=>[o("div",$t,[(r(!0),i(D,null,P(n(I),a=>(r(),i("div",{key:a.name,class:"flex items-center justify-between"},[o("span",Ut,u(a.name),1),o("span",null,u(("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a.sales))+"₽",1)]))),128)),s[14]||(s[14]=o("div",{class:"h-[20px] bg-gradient-to-b from-transparent to-slate-700/10 fixed"},null,-1))])]),_:1})]),_:1}),t(U)]),_:1})):p("",!0),n(j).length?(r(),k(w,{key:3,class:"w-full"},{default:l(()=>[t(h,null,{default:l(()=>[t(x,null,{default:l(()=>s[15]||(s[15]=[m("Расходы на рекламу",-1)])),_:1,__:[15]}),t($)]),_:1}),t(g,null,{default:l(()=>[o("div",Ct,[t(X,{index:"name",category:"sales",data:n(j),"value-formatter":a=>typeof a=="number"?("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a)+"₽":""},null,8,["data","value-formatter"]),o("div",Vt," ДРР: "+u(n(q))+"% ",1)]),o("div",jt,[(r(!0),i(D,null,P(n(j),a=>(r(),i("div",{key:a.name,class:"flex items-center justify-between gap-4"},[o("span",At,u(a.name),1),o("span",Bt,u(("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a.sales))+"₽",1)]))),128))])]),_:1}),t(U)]),_:1})):p("",!0)]),n(O).length?(r(),i("div",Nt,[t(w,null,{default:l(()=>[t(h,null,{default:l(()=>[t(x,null,{default:l(()=>s[16]||(s[16]=[m("График продаж",-1)])),_:1,__:[16]}),t($)]),_:1}),t(g,null,{default:l(()=>[t(he,{index:"name",data:n(O),categories:["Сделки","Допы"],"y-formatter":(a,C)=>typeof a=="number"?("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a)+"₽":"",type:"stacked","custom-tooltip":ze},null,8,["data","y-formatter"])]),_:1}),t(U)]),_:1})])):p("",!0),n(J).length?(r(),i("div",Rt,[t(w,null,{default:l(()=>[t(h,null,{default:l(()=>[t(x,null,{default:l(()=>s[17]||(s[17]=[m("График заявок",-1)])),_:1,__:[17]}),t($)]),_:1}),t(g,null,{default:l(()=>[t(we,{index:"name",data:n(J),categories:["ВК","B2B"],"y-formatter":(a,C)=>typeof a=="number"?("useMyFormatPrice"in e?e.useMyFormatPrice:n(c))(a):"","custom-tooltip":qe},null,8,["data","y-formatter"])]),_:1}),t(U)]),_:1})])):p("",!0)])])])])}}});export{xa as default};
