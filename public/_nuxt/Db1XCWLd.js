import{_ as ie}from"./Bye7C16d.js";import{_ as ue,a as ce,b as de}from"./BF3m7Vf0.js";import{_ as me}from"./CprHmdOe.js";import{_ as _e}from"./D0zfKHPR.js";import{_ as pe,a as fe}from"./l1eRtAXP.js";import{_ as ve}from"./BhleEUCu.js";import{_ as ge}from"./BND4UK_1.js";import{_ as be}from"./CaiudRgb.js";import{_ as we}from"./C30fSUvl.js";import{_ as ye}from"./C5Bd_Bx3.js";import{_ as T}from"./CDst0A0O.js";import{_ as xe}from"./CHKwxJtM.js";import{_ as he}from"./BWn7SjA7.js";import{_ as ee,a as te,b as se}from"./DAmwS8V7.js";import{_ as Ce,a as ke,b as Se,c as Ue,d as $e,e as Ve}from"./DAy9nm00.js";import{C as Fe,_ as De}from"./DFFUo3JN.js";import{c as Y,v as q}from"./B9M8ggfK.js";import{C as Ie}from"./_14b2CUj.js";import{e as L,v as X,m as b,o,w as s,b as t,d as _,c as x,D as k,l,t as A,F as V,a as d,z as R,A as K,E as Te,r as U,B as E,G as m,g as Me,u as Ae,i as Ne,H as G}from"./BbheI0mw.js";import{X as Re}from"./oLxPQbNe.js";import{_ as Be}from"./DImM_Wqr.js";import{b as He,c as ze,e as Pe,_ as je,a as Ee,d as Ke}from"./C6vK2VYI.js";import{u as Le,g as Oe,a as qe,b as Ge,F as Z}from"./lvbecDJM.js";import{C as Xe}from"./CJOOd8Dx.js";import{u as J}from"./Dt19OLxm.js";import{A as j}from"./Boz4PYjF.js";import"./D0Fd2yXn.js";import"./CaPtdwNj.js";import"./DVdymwQ5.js";import"./KSX9JOtw.js";import"./ZTyVILcU.js";import"./s39mgViW.js";import"./BR3DQNok.js";import"./odSmgr3d.js";import"./DzJc7hp_.js";import"./CCknexPU.js";import"./CssJESp-.js";import"./D2GZmoDz.js";const Je={class:"hidden space-x-1 lg:flex"},Qe={key:1,class:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs"},We=L({__name:"DataTableFacetedFilter",props:{column:{},title:{},options:{}},setup(a){const v=a,u=X(()=>v.column?.getFacetedUniqueValues()),n=X(()=>new Set(v.column?.getFilterValue()));return(f,g)=>{const h=xe,S=he,M=T,r=ee,$=ke,N=Ue,B=Ve,F=$e,H=De,P=Se,c=Ce,e=te,w=se;return o(),b(w,null,{default:s(()=>[t(r,{"as-child":""},{default:s(()=>[t(M,{variant:"outline",size:"sm",class:"h-8 border-dashed"},{default:s(()=>[t(l(Fe),{class:"mr-2 h-4 w-4"}),_(" "+A(f.title)+" ",1),n.value.size>0?(o(),x(V,{key:0},[t(h,{orientation:"vertical",class:"mx-2 h-4"}),t(S,{variant:"secondary",class:"rounded-sm px-1 font-normal lg:hidden"},{default:s(()=>[_(A(n.value.size),1)]),_:1}),d("div",Je,[n.value.size>1?(o(),b(S,{key:0,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:s(()=>[_(A(n.value.size),1)]),_:1})):(o(!0),x(V,{key:1},R(f.options.filter(i=>n.value.has(i.value)),i=>(o(),b(S,{key:i.value,variant:"secondary",class:"rounded-sm px-1 font-normal"},{default:s(()=>[_(A(i.label),1)]),_:2},1024))),128))])],64)):k("",!0)]),_:1})]),_:1}),t(e,{class:"w-[250px] p-0",align:"start"},{default:s(()=>[t(c,{"filter-function":(i,D)=>i.filter(I=>I.label.toLowerCase()?.includes(D))},{default:s(()=>[t($,{placeholder:f.title},null,8,["placeholder"]),t(P,null,{default:s(()=>[t(N,null,{default:s(()=>g[1]||(g[1]=[_("Нет совпадений.",-1)])),_:1,__:[1]}),t(F,null,{default:s(()=>[(o(!0),x(V,null,R(f.options,i=>(o(),b(B,{key:i.value,value:i,onSelect:D=>{n.value.has(i.value)?n.value.delete(i.value):n.value.add(i.value);const z=Array.from(n.value);f.column?.setFilterValue(z.length?z:void 0)}},{default:s(()=>[d("div",{class:K(l(Y)("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",n.value.has(i.value)?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"))},[t(l(Ie),{class:K(l(Y)("h-4 w-4"))},null,8,["class"])],2),i.icon?(o(),b(Te(i.icon),{key:0,class:"mr-2 h-4 w-4 text-muted-foreground"})):k("",!0),d("span",null,A(i.label),1),u.value?.get(i.value)?(o(),x("span",Qe,A(u.value.get(i.value)),1)):k("",!0)]),_:2},1032,["value","onSelect"]))),128))]),_:1}),n.value.size>0?(o(),x(V,{key:0},[t(H),t(F,null,{default:s(()=>[t(B,{value:{label:"Очистить"},class:"justify-center text-center",onSelect:g[0]||(g[0]=i=>f.column?.setFilterValue(void 0))},{default:s(()=>g[2]||(g[2]=[_(" Очистить ",-1)])),_:1,__:[2]})]),_:1})],64)):k("",!0)]),_:1})]),_:1},8,["filter-function"])]),_:1})]),_:1})}}}),Ye={class:"flex items-center justify-between"},Ze={class:"flex flex-1 items-center space-x-2"},et=L({__name:"DataTableToolbar",props:{table:{},sources:{},workSpacesFilter:{}},setup(a){const v=a,u=X(()=>v.table.getState().columnFilters.length>0);return(n,f)=>{const g=We,h=T;return o(),x("div",Ye,[d("div",Ze,[n.table.getColumn("source")?(o(),b(g,{key:0,column:n.table.getColumn("source"),title:"Источник",options:n.sources},null,8,["column","options"])):k("",!0),n.table.getColumn("group")?(o(),b(g,{key:1,column:n.table.getColumn("group"),title:"Проект",options:n.workSpacesFilter},null,8,["column","options"])):k("",!0),u.value?(o(),b(h,{key:2,variant:"secondary",class:"h-8 px-2 lg:px-3",onClick:f[0]||(f[0]=S=>n.table.resetColumnFilters())},{default:s(()=>[f[1]||(f[1]=_(" Сброс ",-1)),t(l(Re),{class:"ml-2 h-4 w-4"})]),_:1,__:[1]})):k("",!0)])])}}}),tt={class:"flex mb-2 justify-between"},st={class:"bg-slate-100"},lt=L({__name:"DataTable",props:{columns:{},data:{},sources:{},workSpacesFilter:{}},emits:["table-sorted","on-delete-item"],setup(a,{emit:v}){const u=a,n=U([]),f=U([]),g=U({}),h=Le({get data(){return u.data},get columns(){return u.columns},getCoreRowModel:Ge(),getSortedRowModel:qe(),getFilteredRowModel:Oe(),onSortingChange:r=>q(r,n),onColumnFiltersChange:r=>q(r,f),onColumnVisibilityChange:r=>q(r,g),state:{get sorting(){return n.value},get columnFilters(){return f.value},get columnVisibility(){return g.value}},meta:{deleteItem:r=>M(r.id)}}),S=v,M=r=>{S("on-delete-item",r)};return E(()=>h.getSortedRowModel().rows,r=>{const $=r.map(N=>N.original.id);S("table-sorted",$)},{deep:!0}),(r,$)=>{const N=et,B=T,F=ee,H=Be,P=te,c=se,e=Ke,w=Ee,i=ze,D=je,I=Pe,z=He;return o(),x(V,null,[d("div",tt,[t(N,{table:l(h),sources:r.sources,"work-spaces-filter":r.workSpacesFilter},null,8,["table","sources","work-spaces-filter"]),d("div",null,[t(c,null,{default:s(()=>[t(F,null,{default:s(()=>[t(B,{variant:"outline",class:"ml-auto"},{default:s(()=>[$[0]||($[0]=_(" Колонки ",-1)),t(l(Xe),{class:"w-4 h-4 ml-2"})]),_:1,__:[0]})]),_:1}),t(P,{class:"w-[180px]"},{default:s(()=>[(o(!0),x(V,null,R(l(h).getAllColumns().filter(y=>y.getCanHide()),y=>(o(),x("div",{key:y.id},[t(H,{checked:y.getIsVisible(),"onUpdate:checked":C=>{y.toggleVisibility(!!C)}},null,8,["checked","onUpdate:checked"]),_(" "+A(y.columnDef.ruName),1)]))),128))]),_:1})]),_:1})])]),d("div",st,[t(z,null,{default:s(()=>[t(i,{class:"bg-white"},{default:s(()=>[(o(!0),x(V,null,R(l(h).getHeaderGroups(),y=>(o(),b(w,{key:y.id,class:""},{default:s(()=>[(o(!0),x(V,null,R(y.headers,C=>(o(),b(e,{key:C.id},{default:s(()=>[C.isPlaceholder?k("",!0):(o(),b(l(Z),{key:0,render:C.column.columnDef.header,props:C.getContext()},null,8,["render","props"]))]),_:2},1024))),128))]),_:2},1024))),128))]),_:1}),t(I,null,{default:s(()=>[l(h).getRowModel().rows?.length?(o(!0),x(V,{key:0},R(l(h).getRowModel().rows,y=>(o(),b(w,{key:y.id,"data-state":y.getIsSelected()?"selected":void 0},{default:s(()=>[(o(!0),x(V,null,R(y.getVisibleCells(),C=>(o(),b(D,{key:C.id},{default:s(()=>[t(l(Z),{render:C.column.columnDef.cell,props:C.getContext()},null,8,["render","props"])]),_:2},1024))),128))]),_:2},1032,["data-state"]))),128)):(o(),b(w,{key:1},{default:s(()=>[t(D,{colspan:r.columns.length,class:"text-left"},{default:s(()=>$[1]||($[1]=[_(" Нет результатов. ",-1)])),_:1,__:[1]},8,["colspan"])]),_:1}))]),_:1})]),_:1})])],64)}}}),at=[{accessorKey:"workSpace",ruName:"Отдел",enableHiding:!0,header:()=>m("div",{class:"hidden p-0"}),cell:()=>m("div",{class:"hidden p-0"})},{accessorKey:"group",ruName:"Проект",header:({column:a})=>m(T,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"text-center h-full w-full p-1"},()=>["Проект",m(j,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"text-center flex flex-col"},[m("span",{class:"text-slate-800"},a.getValue("group")),m("span",{class:"text-slate-400 text-xs"},a.getValue("workSpace"))]),filterFn:(a,v,u)=>u.includes(a.getValue(v))},{accessorKey:"source",ruName:"Источник",enableHiding:!1,header:({column:a})=>m(T,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"justify-start h-full w-full"},()=>["Источник",m(j,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"text-left pl-3"},a.getValue("source")),filterFn:(a,v,u)=>u.includes(a.getValue(v))},{accessorKey:"date",ruName:"Дата",header:({column:a})=>m(T,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"text-center h-full w-full"},()=>["Дата",m(j,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"text-center"},a.getValue("date"))},{accessorKey:"price",ruName:"Стоимость",header:({column:a})=>m(T,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),class:"h-full w-full"},()=>["Стоимость",m(j,{class:"ml-2 h-4 w-4"})]),cell:({row:a})=>m("div",{class:"text-center"},J(a.getValue("price"))+"₽")},{accessorKey:"dealSourceId",ruName:"ID источника",enableHiding:!1,header:()=>m("div",{class:"text-center"},""),cell:()=>m("div",{class:"text-center"},"")},{ruName:"Действия",id:"actions",header:()=>m("div",{class:"text-center"},"Действия"),enableHiding:!1,cell:({row:a,table:v})=>{const u=a.original;return m("div",{class:"text-center"},m(T,{class:"h-5 px-1 mx-auto",item:u,onClick:()=>v.options.meta?.deleteItem(u)},()=>"Удалить"))}}],ot={class:"relative h-screen hidden-scrollbar"},nt={class:"w-full fixed z-10"},rt={class:"h-full flex flex-col p-4 gap-2 mx-[auto] max-w-[2048px] pt-16 min-w-[1024px]"},it={class:"flex items-center gap-2"},ut={class:"flex items-center"},ct={key:0,class:"ml-2"},dt={key:1,class:"ml-2"},mt={class:"w-full flex gap-2"},_t={class:"min-w-[250px] flex flex-col gap-2"},pt={class:"flex flex-col gap-5"},ft={class:"relative"},vt={class:"relative w-full"},gt={class:"flex"},bt={class:"relative"},wt={class:"flex gap-2"},yt={class:"grow"},os=L({__name:"index",setup(a){const{$useApi:v}=Me();Ae({title:"Медиаплан | Easy CRM"});const u=U(new Date().toISOString().slice(0,7)),n=U("this_month"),f=U(!0),g=U(J(0)+"₽"),h=U([]),S=U([]),M=U([]),r=U({date:new Date().toISOString().slice(0,10),adSourceId:0,price:0}),$=async()=>{const{data:c}=await v.post("ads/expenses",r.value);console.log(c),await F()},N=async()=>{const{data:c}=await v.get("ads/sources");h.value=c||[]};function B(c){return Array.from(c.reduce((e,w)=>e.set(w.value,w),new Map)).map(([,e])=>e)}const F=async()=>{const{data:c}=await v.get("ads/expenses",{params:{period:u.value}});M.value=c||[],c.length>=0?g.value=H(c.map(e=>e.id)):g.value="0",S.value=B(c.map(e=>({value:e.group,label:e.group}))),console.log(S.value)},H=c=>{const w=M.value.filter(i=>c.includes(i.id)).reduce((i,D)=>i+D.price,0);return J(w)+"₽"},P=async c=>{await v.delete("ads/"+c),await F()};return E(r,()=>{const{date:c,price:e,adSourceId:w}=r.value;c&&e&&w&&/^\d{4}-\d{2}-\d{2}$/.test(r.value.date)?f.value=!1:f.value=!0},{deep:!0}),E(n,()=>{if(console.log(n.value),n.value==="this_month"&&(u.value=new Date().toISOString().slice(0,7)),n.value==="yesterday"){const c=new Date,e=new Date(c);e.setDate(c.getDate()-1);const w=e.toISOString().split("T")[0];u.value=w}}),E(u,async()=>{await F()},{deep:!0}),Ne(async()=>{await N(),await F()}),(c,e)=>{const w=ie,i=de,D=ce,I=me,z=ue,y=ve,C=fe,Q=pe,W=_e,O=we,le=ye,ae=T,oe=ge,ne=be,re=lt;return o(),x("div",ot,[d("div",nt,[t(w)]),d("div",rt,[e[17]||(e[17]=d("div",{class:"flex gap-6 items-center"},[d("h1",{class:"text-3xl font-semibold"},"Маркетинг")],-1)),d("div",null,[t(z,{modelValue:l(n),"onUpdate:modelValue":e[2]||(e[2]=p=>G(n)?n.value=p:null),"default-value":"month"},{default:s(()=>[d("div",it,[d("div",ut,[t(D,null,{default:s(()=>[t(i,{value:"this_month"},{default:s(()=>e[7]||(e[7]=[_(" Этот месяц ",-1)])),_:1,__:[7]}),t(i,{value:"yesterday"},{default:s(()=>e[8]||(e[8]=[_(" Вчера ",-1)])),_:1,__:[8]}),t(i,{value:"month"},{default:s(()=>e[9]||(e[9]=[_(" Выбрать месяц ",-1)])),_:1,__:[9]}),t(i,{value:"day"},{default:s(()=>e[10]||(e[10]=[_(" Выбрать день ",-1)])),_:1,__:[10]})]),_:1}),l(n)==="month"?(o(),x("div",ct,[t(I,{modelValue:l(u),"onUpdate:modelValue":e[0]||(e[0]=p=>G(u)?u.value=p:null),type:"month"},null,8,["modelValue"])])):k("",!0),l(n)==="day"?(o(),x("div",dt,[t(I,{modelValue:l(u),"onUpdate:modelValue":e[1]||(e[1]=p=>G(u)?u.value=p:null),type:"date"},null,8,["modelValue"])])):k("",!0)])])]),_:1},8,["modelValue"])]),d("div",mt,[d("div",_t,[t(W,null,{default:s(()=>[t(Q,{class:"p-3 pb-2"},{default:s(()=>[t(y,null,{default:s(()=>e[11]||(e[11]=[_("Потрачено на рекламу",-1)])),_:1,__:[11]}),t(C,{class:"text-3xl font-semibold whitespace-nowrap"},{default:s(()=>[_(A(l(g)),1)]),_:1})]),_:1})]),_:1}),t(W,null,{default:s(()=>[t(Q,null,{default:s(()=>[t(C,null,{default:s(()=>e[12]||(e[12]=[_(" Добавить статью ",-1)])),_:1,__:[12]}),t(y)]),_:1}),t(oe,null,{default:s(()=>[d("div",pt,[d("div",ft,[l(r).date?(o(),b(O,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:s(()=>e[13]||(e[13]=[_("Дата",-1)])),_:1,__:[13]})):k("",!0),t(I,{modelValue:l(r).date,"onUpdate:modelValue":e[3]||(e[3]=p=>l(r).date=p),type:"date",placeholder:"Дата",class:K(l(r).date?"":"outline outline-1 outline-rose-300")},null,8,["modelValue","class"])]),d("div",vt,[l(r).adSourceId!==0?(o(),b(O,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:s(()=>e[14]||(e[14]=[_("Источник",-1)])),_:1,__:[14]})):k("",!0),d("div",gt,[t(le,{items:l(h).map(p=>({value:p.id,label:p.title})),class:"w-full",label:"Выберите источник",onSelectedItem:e[4]||(e[4]=p=>{l(r).adSourceId=p})},null,8,["items"])])]),d("div",bt,[t(O,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:s(()=>e[15]||(e[15]=[_("Стоимость",-1)])),_:1,__:[15]}),d("div",wt,[t(I,{modelValue:l(r).price,"onUpdate:modelValue":e[5]||(e[5]=p=>l(r).price=p),placeholder:"Стоимость",type:"number",class:K(l(r).price?"":"outline outline-1 outline-rose-300")},null,8,["modelValue","class"])])]),t(ae,{disabled:l(f),onClick:$},{default:s(()=>e[16]||(e[16]=[_(" Создать ",-1)])),_:1,__:[16]},8,["disabled"])])]),_:1}),t(ne)]),_:1})]),d("div",yt,[(o(),b(re,{key:l(M).length,data:l(M),columns:l(at),sources:l(h).map(p=>({value:p.title,label:p.title})),"work-spaces-filter":l(S),onTableSorted:e[6]||(e[6]=p=>g.value=H(p)),onOnDeleteItem:P},null,8,["data","columns","sources","work-spaces-filter"]))])])])])}}});export{os as default};
