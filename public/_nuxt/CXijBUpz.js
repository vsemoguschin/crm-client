import{s as qe}from"./B9M8ggfK.js";import{v as oe,g as le,B as O,e as te,r as F,c as k,o as _,b as e,w as t,a as o,d as u,m as B,D as S,F as Q,z as J,t as $,l as s,A as H,H as we,i as De}from"./BbheI0mw.js";import{u as ee}from"./Bay1Kywl.js";import{_ as We}from"./CaPtdwNj.js";import{_ as ve}from"./D0zfKHPR.js";import{_ as ge,a as ye}from"./l1eRtAXP.js";import{_ as Ue}from"./BhleEUCu.js";import{_ as be}from"./BND4UK_1.js";import{_ as Ye}from"./CaiudRgb.js";import ae from"./ROxBBV8N.js";import{_ as ne}from"./CDst0A0O.js";import{_ as ie,a as ue,b as re,c as pe,d as me}from"./cStEOrWd.js";import{_ as he}from"./BHuR11Jx.js";import{_ as ce}from"./DiZ4QL0M.js";import{b as Ze,c as et,a as tt,d as lt,e as st,_ as ot}from"./C6vK2VYI.js";import{_ as Ve}from"./D-8t_H8v.js";import{_ as _e}from"./C30fSUvl.js";import{_ as fe}from"./CprHmdOe.js";import{_ as Se,a as Te,b as Me,c as Fe,d as Le}from"./JYeLPbKT.js";import{_ as ze}from"./DLLw9AXE.js";import{_ as je}from"./C-JUEUN9.js";import{u as at}from"./s39mgViW.js";import{_ as Be}from"./CHKwxJtM.js";import{_ as nt}from"./D0d2ZlUf.js";import{_ as dt}from"./Sc4DFA1e.js";import{_ as ke}from"./C5Bd_Bx3.js";import{X as it}from"./oLxPQbNe.js";import{_ as ut}from"./QXfa84Px.js";import{_ as rt,a as pt,b as mt}from"./BF3m7Vf0.js";import{u as Ee}from"./DzJc7hp_.js";import{_ as ct}from"./Bh3bOtDY.js";import{_ as _t}from"./DVdymwQ5.js";import{d as se}from"./Cxp-zkhu.js";import{u as ft}from"./1Y235EgL.js";const Ne=()=>({groups:[],managers:[],methods:[],sources:[],adTags:[],spheres:[]}),Pe=()=>({statuses:[],maketTypes:[],source:[],adTag:[],daysGone:[],dealers:[],haveReviews:[],isRegular:[],boxsize:[],methods:[],spheres:[]}),vt={status:"statuses",maketType:"maketTypes",source:"source",adTag:"adTag",daysGone:"daysGone",dealers:"dealers",haveReviews:"haveReviews",isRegular:"isRegular",boxsize:"boxsize",method:"methods",sphere:"spheres"},gt={statuses:"status",maketTypes:"maketType",source:"source",adTag:"adTag",daysGone:"daysGone",dealers:"dealers",haveReviews:"haveReviews",isRegular:"isRegular",boxsize:"boxsize",methods:"methods",spheres:"spheres"},xe=()=>{const I=ee("deals-datas",Ne),T=ee("deals-datas-loaded",()=>!1),V=ee("deals-datas-loading",()=>!1),b=ee("deals-datas-error",()=>null),y=ee("deals-datas-selected",Pe),M=f=>Array.isArray(f)?f.filter(r=>typeof r=="object"&&r!==null&&"id"in r&&"fullName"in r):[],w=f=>{if(!f){I.value=Ne();return}I.value={groups:f.groups??[],managers:M(f.managers),methods:f.methods??[],sources:f.sources??[],adTags:f.adTags??[],spheres:f.spheres??[]}},i=async(f=!1)=>{if(T.value&&!f)return I.value;try{V.value=!0,b.value=null;const{$useApi:r}=le(),{data:h}=await r.get("/deals/datas");return w(h),T.value=!0,I.value}catch(r){throw b.value=r,T.value=!1,r}finally{V.value=!1}},z=async()=>(T.value=!1,i(!0)),d=f=>f?vt[f]??null:null,c=(f,r)=>{y.value={...y.value,[f]:Array.from(new Set(r.filter(Boolean)))}},g=(f,r)=>{const h=d(f);h&&c(h,r)},a=f=>{const r=d(f);return r?y.value[r]??[]:[]},p=f=>{const r=d(f);r&&c(r,[])},x=()=>{y.value=Pe()},L=oe(()=>{const f={};return Object.keys(y.value).forEach(r=>{const h=y.value[r]??[];if(!Array.isArray(h)||h.length===0)return;const n=gt[r];if(n){if(r==="dealers"){const l=h.map(v=>Number(v)).filter(v=>Number.isFinite(v));l.length&&(f[n]=l);return}f[n]=h}}),f});return{filters:I,isLoaded:T,isLoading:V,error:b,loadDealsDatas:i,refreshDealsDatas:z,selectedFilters:y,filtersQuery:L,resolveSelectedKey:d,getColumnFilterValues:a,setColumnFilterValues:g,clearColumnFilter:p,clearAllFilters:x}},Ge=50,yt=100;function He(I){if(typeof I!="number"||!Number.isFinite(I))return Ge;const T=Math.max(1,Math.floor(I));return Math.min(T,yt)}function bt(I,T){if(!I)return T;const V=typeof I.page=="number"&&I.page>0?I.page:T.page,b=He(I.limit??T.limit),y=typeof I.totalCount=="number"&&I.totalCount>=0?I.totalCount:T.totalCount;return{page:V,limit:b,totalCount:y}}function Fo(){const{$useApi:I}=le(),{filters:T,loadDealsDatas:V,isLoaded:b,isLoading:y,error:M}=xe(),w=oe(()=>T.value.groups??[]),i=oe(()=>y.value),z=oe(()=>M.value?.message??null),d=ee("my-deals:selected-group",()=>"all"),c=ee("my-deals:list",()=>[]),g=ee("my-deals:loading",()=>!1),a=ee("my-deals:error",()=>null),p=ee("my-deals:loading-more",()=>!1),x=ee("my-deals:meta",()=>({page:1,limit:Ge,totalCount:0})),L=()=>{const l=w.value??[];if(!l.length){d.value="",c.value=[];return}if(l.length>1){d.value&&d.value!=="all"&&l.some(U=>String(U.id)===d.value)||(d.value="all");return}const[v]=l;if(!v){d.value="";return}d.value=String(v.id)},f=async(l=!1)=>{if(b.value&&!l&&w.value.length)return L(),w.value;try{return await V(l),L(),w.value}catch(v){throw console.error("Failed to ensure deal groups",v),v}};O(()=>w.value,()=>{L()},{deep:!0});const r=l=>{if(l==null)return;if(typeof l=="number")return Number.isFinite(l)?l:void 0;if(l==="all"||l==="")return;const v=Number(l);return Number.isFinite(v)?v:void 0};return{groups:w,fetchGroups:f,isGroupsLoading:i,groupsError:z,selectedGroupId:d,deals:c,getDeals:async(l={})=>{const v=r(l.groupId),A=r(d.value),U=v??A,D=Math.max(1,Math.floor(l.page??1)),j=He(l.limit??x.value.limit),G=!!(l.append??D>1);if(G){if(p.value)return null;p.value=!0}else g.value=!0;a.value=null;try{const m={page:D,limit:j,...l.params??{}};l.sortBy&&(m.sortBy=l.sortBy),l.sortOrder&&(m.sortOrder=l.sortOrder),U!==void 0&&(m.groupId=U);const{data:P}=await I.get("/deals",{params:m,paramsSerializer:{serialize:qe}}),W=Array.isArray(P?.deals)?P.deals??[]:[];if(G){const X=new Set(c.value.map(K=>K.id)),q=W.filter(K=>!K||typeof K.id!="number"||X.has(K.id)?!1:(X.add(K.id),!0));c.value=[...c.value,...q]}else c.value=W;const Y={page:D,limit:j,totalCount:typeof P?.total=="number"?P.total:G?Math.max(x.value.totalCount,c.value.length):W.length};return x.value=bt(P?.meta,Y),P??null}catch(m){throw console.error("Failed to load deals",m),G||(c.value=[],x.value={page:1,limit:j,totalCount:0}),a.value="Не удалось загрузить сделки",m}finally{g.value=!1,p.value=!1}},getDeal:async l=>{if(!l)return null;try{const{data:v}=await I.get(`/deals/${l}`);return v??null}catch(v){throw console.error("Failed to load deal",v),v}},isDealsLoading:g,isDealsLoadingMore:p,dealsError:a,dealsMeta:x}}const xt={class:"flex gap-4 max-h-[500px] overflow-y-scroll"},wt=te({__name:"DealHistory",props:{dealId:{}},setup(I){const{$useApi:T}=le(),V=I,b=F([]),y=async()=>{try{const{data:M}=await T.get(`deals/${V.dealId}/deal-history`);b.value=M,console.log("История изменений:",M)}catch(M){console.error("Ошибка при загрузке истории:",M)}};return(M,w)=>{const i=ae,z=ne,d=ue,c=me,g=he,a=pe,p=lt,x=tt,L=et,f=ot,r=st,h=Ze,n=ce,l=re,v=ie;return _(),k("div",null,[e(v,null,{default:t(()=>[e(d,{"as-child":""},{default:t(()=>[e(z,{class:"h-7 w-7 gap-1",size:"icon",onClick:y},{default:t(()=>[e(i,{name:"material-symbols:history-rounded",color:"white",size:"25px"})]),_:1})]),_:1}),e(l,{class:"max-w-[1200px] flex flex-col"},{default:t(()=>[e(a,null,{default:t(()=>[e(c,null,{default:t(()=>w[0]||(w[0]=[u("История изменений",-1)])),_:1,__:[0]}),e(g)]),_:1}),o("div",xt,[e(h,null,{default:t(()=>[e(L,null,{default:t(()=>[e(x,null,{default:t(()=>[e(p,{class:"text-left"},{default:t(()=>w[1]||(w[1]=[u("Дата",-1)])),_:1,__:[1]}),e(p,{class:"text-center"},{default:t(()=>w[2]||(w[2]=[u("Пользователь",-1)])),_:1,__:[2]}),e(p,{class:"text-left"},{default:t(()=>w[3]||(w[3]=[u("Комментарий",-1)])),_:1,__:[3]})]),_:1})]),_:1}),e(r,null,{default:t(()=>[(_(!0),k(Q,null,J(s(b),A=>(_(),B(x,{key:A.id},{default:t(()=>[e(f,{class:"whitespace-nowrap"},{default:t(()=>[u($(new Date(A.createdAt).toLocaleString("ru-RU")),1)]),_:2},1024),e(f,{class:"whitespace-nowrap text-center"},{default:t(()=>[u($(A.user.fullName),1)]),_:2},1024),e(f,{class:"whitespace-nowrap"},{default:t(()=>[u($(A.comment),1)]),_:2},1024)]),_:2},1024))),128)),s(b).length===0?(_(),B(x,{key:0},{default:t(()=>[e(f,{colspan:"4",class:"text-center"},{default:t(()=>w[4]||(w[4]=[u("Нет данных для отображения",-1)])),_:1,__:[4]})]),_:1})):S("",!0)]),_:1})]),_:1})]),e(n)]),_:1})]),_:1})])}}}),Dt={class:"flex items-center justify-between"},Ut={class:"relative flex items-center space-x-2"},kt={class:"flex gap-4 w-full"},$t={class:"flex flex-col gap-5 w-full"},Ct={class:"relative"},It={class:"relative"},ht={class:"relative"},Vt={key:0,class:"relative"},St={key:1,class:"relative"},Tt={key:2,class:"relative"},Mt={key:3,class:"relative"},Ft={key:4,class:"relative"},Lt={class:"relative"},zt={key:5,class:"relative"},At={key:6,class:"relative"},Nt={key:7,class:"relative"},Pt={class:"flex flex-col gap-5 w-full"},jt={class:"relative"},Bt={class:"relative"},Et={class:"relative"},Gt={class:"relative"},Ht={class:"relative"},Rt={class:"relative"},Ot={key:0,class:"relative"},Kt=te({__name:"EditDealForm",props:{dealSubDatas:{},deal:{}},emits:["dealDataChanged"],setup(I,{emit:T}){const V=I,b=["Предложения услуг","Оборудование для бизнеса","Мебель и интерьер"],y=["Старт","Старт + Профильный","Доп. Профильный","Частный"],M=["Дизайнерский","Заготовка из базы","Рекламный","Визуализатор","Из рассылки"],w=["Без скидки","Желтая","ОПТ","Рассылка","Красная"],i=["20х20","20х30","25х25","30х30"],z=["Журнал","Пластик"],d=F({...V.deal}),c=T;return O(d,()=>{c("dealDataChanged",d.value)},{deep:!0}),(g,a)=>{const p=Ve,x=_e,L=ye,f=ge,r=fe,h=Me,n=Te,l=Le,v=ze,A=Fe,U=Se,D=je,j=be,G=ve;return _(),B(G,{class:"w-full"},{default:t(()=>[e(f,null,{default:t(()=>[e(L,null,{default:t(()=>[o("div",Dt,[a[21]||(a[21]=u(" Сделка ",-1)),o("div",Ut,[e(p,{id:"reservation",checked:s(d).reservation,"onUpdate:checked":a[0]||(a[0]=m=>s(d).reservation=m)},null,8,["checked"]),e(x,{for:"reservation"},{default:t(()=>a[20]||(a[20]=[u("Бронь",-1)])),_:1,__:[20]})])])]),_:1})]),_:1}),e(j,null,{default:t(()=>[o("div",kt,[o("div",$t,[o("div",Ct,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[22]||(a[22]=[u("Название",-1)])),_:1,__:[22]}),e(r,{modelValue:s(d).title,"onUpdate:modelValue":a[1]||(a[1]=m=>s(d).title=m),placeholder:"Название",class:"col-span-3"},null,8,["modelValue"])]),o("div",It,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[23]||(a[23]=[u("Дата продажи",-1)])),_:1,__:[23]}),e(r,{modelValue:s(d).saleDate,"onUpdate:modelValue":a[2]||(a[2]=m=>s(d).saleDate=m),type:"date",min:new Date().toISOString().slice(0,7)+"-01",class:H(s(d).saleDate?"":"outline-1 outline-rose-300")},null,8,["modelValue","min","class"])]),o("div",ht,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[24]||(a[24]=[u("Стоимость",-1)])),_:1,__:[24]}),e(r,{modelValue:s(d).price,"onUpdate:modelValue":a[3]||(a[3]=m=>s(d).price=m),type:"number",placeholder:"Стоимость",class:"col-span-3"},null,8,["modelValue"])]),s(d).groupId!==16&&s(d).groupId!==19?(_(),k("div",Vt,[s(d).discont?(_(),B(x,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[25]||(a[25]=[u("Скидка",-1)])),_:1,__:[25]})):S("",!0),o("div",{class:H(s(d).discont?"":"outline-1 outline-rose-300 rounded-md")},[e(U,{modelValue:s(d).discont,"onUpdate:modelValue":a[4]||(a[4]=m=>s(d).discont=m)},{default:t(()=>[e(n,null,{default:t(()=>[e(h,{placeholder:"Скидка"})]),_:1}),e(A,null,{default:t(()=>[(_(),k(Q,null,J(w,(m,P)=>e(v,{key:P},{default:t(()=>[e(l,{value:m},{default:t(()=>[u($(m),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):S("",!0),s(d).groupId===16?(_(),k("div",St,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[26]||(a[26]=[u("Скидка",-1)])),_:1,__:[26]}),e(r,{modelValue:s(d).discontAmount,"onUpdate:modelValue":a[5]||(a[5]=m=>s(d).discontAmount=m),type:"number",placeholder:"Скидка",class:H(s(d).discontAmount?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):S("",!0),s(d).groupId!==19?(_(),k("div",Tt,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>a[27]||(a[27]=[u("Дата презентации макета",-1)])),_:1,__:[27]}),e(r,{modelValue:s(d).maketPresentation,"onUpdate:modelValue":a[6]||(a[6]=m=>s(d).maketPresentation=m),type:"date",placeholder:"dsad",class:H(s(d).maketPresentation?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):S("",!0),s(d).groupId!==16&&s(d).groupId!==19?(_(),k("div",Mt,[s(d).maketType?(_(),B(x,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[28]||(a[28]=[u("Тип макета",-1)])),_:1,__:[28]})):S("",!0),o("div",{class:H(s(d).maketType?"":"outline-1 outline-rose-300 rounded-md")},[e(U,{modelValue:s(d).maketType,"onUpdate:modelValue":a[7]||(a[7]=m=>s(d).maketType=m)},{default:t(()=>[e(n,null,{default:t(()=>[e(h,{placeholder:"Тип макета"})]),_:1}),e(A,null,{default:t(()=>[(_(),k(Q,null,J(M,(m,P)=>e(v,{key:P},{default:t(()=>[e(l,{value:m},{default:t(()=>[u($(m),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):S("",!0),s(d).groupId===16?(_(),k("div",Ft,[s(d).courseType?(_(),B(x,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[29]||(a[29]=[u("Тип курса",-1)])),_:1,__:[29]})):S("",!0),o("div",{class:H(s(d).courseType?"":"outline-1 outline-rose-300 rounded-md")},[e(U,{modelValue:s(d).courseType,"onUpdate:modelValue":a[8]||(a[8]=m=>s(d).courseType=m)},{default:t(()=>[e(n,null,{default:t(()=>[e(h,{placeholder:"Тип курса"})]),_:1}),e(A,null,{default:t(()=>[(_(),k(Q,null,J(y,(m,P)=>e(v,{key:P},{default:t(()=>[e(l,{value:m},{default:t(()=>[u($(m),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):S("",!0),o("div",Lt,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[30]||(a[30]=[u("id карточки производства",-1)])),_:1,__:[30]}),e(r,{modelValue:s(d).card_id,"onUpdate:modelValue":a[9]||(a[9]=m=>s(d).card_id=m),placeholder:"id карточки производства",class:"col-span-3"},null,8,["modelValue"])]),s(d).groupId===19?(_(),k("div",zt,[s(d).bookSize?(_(),B(x,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[31]||(a[31]=[u("Размер фотокниги",-1)])),_:1,__:[31]})):S("",!0),o("div",{class:H(s(d).bookSize?"":"outline-1 outline-rose-300 rounded-md ")},[e(U,{modelValue:s(d).bookSize,"onUpdate:modelValue":a[10]||(a[10]=m=>s(d).bookSize=m)},{default:t(()=>[e(n,null,{default:t(()=>[e(h,{placeholder:"Размер фотокниги"})]),_:1}),e(A,null,{default:t(()=>[(_(),k(Q,null,J(i,(m,P)=>e(v,{key:P},{default:t(()=>[e(l,{value:m},{default:t(()=>[u($(m),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):S("",!0),s(d).groupId===19?(_(),k("div",At,[s(d).pageType?(_(),B(x,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[32]||(a[32]=[u("Страницы",-1)])),_:1,__:[32]})):S("",!0),o("div",{class:H(s(d).pageType?"":"outline-1 outline-rose-300 rounded-md ")},[e(U,{modelValue:s(d).pageType,"onUpdate:modelValue":a[11]||(a[11]=m=>s(d).pageType=m)},{default:t(()=>[e(n,null,{default:t(()=>[e(h,{placeholder:"Страницы"})]),_:1}),e(A,null,{default:t(()=>[(_(),k(Q,null,J(z,(m,P)=>e(v,{key:P},{default:t(()=>[e(l,{value:m},{default:t(()=>[u($(m),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])],2)])):S("",!0),s(d).groupId===19?(_(),k("div",Nt,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>a[33]||(a[33]=[u("Развороты",-1)])),_:1,__:[33]}),e(r,{modelValue:s(d).pages,"onUpdate:modelValue":a[12]||(a[12]=m=>s(d).pages=m),type:"number",placeholder:"Развороты",class:H(s(d).pages?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])])):S("",!0)]),o("div",Pt,[o("div",jt,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[34]||(a[34]=[u("Способ закрытия",-1)])),_:1,__:[34]}),e(D,{items:g.dealSubDatas.methods,label:s(d).clothingMethod,onSelectedItem:a[13]||(a[13]=m=>s(d).clothingMethod=m)},null,8,["items","label"])]),o("div",Bt,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[35]||(a[35]=[u("Источник сделки",-1)])),_:1,__:[35]}),e(D,{items:g.dealSubDatas.sources,label:s(d).source,onSelectedItem:a[14]||(a[14]=m=>s(d).source=m)},null,8,["items","label"])]),o("div",Et,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[36]||(a[36]=[u("ТЕГ",-1)])),_:1,__:[36]}),e(D,{items:g.dealSubDatas.adTags,label:s(d).adTag,onSelectedItem:a[15]||(a[15]=m=>s(d).adTag=m)},null,8,["items","label"])]),o("div",Gt,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[37]||(a[37]=[u("Сфера",-1)])),_:1,__:[37]}),e(D,{items:g.dealSubDatas.spheres,label:s(d).sphere,onSelectedItem:a[16]||(a[16]=m=>s(d).sphere=m)},null,8,["items","label"])]),o("div",Ht,[s(d).city!==""?(_(),B(x,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[38]||(a[38]=[u("Город",-1)])),_:1,__:[38]})):S("",!0),e(r,{modelValue:s(d).city,"onUpdate:modelValue":a[17]||(a[17]=m=>s(d).city=m),placeholder:"Город",class:"col-span-3"},null,8,["modelValue"])]),o("div",Rt,[s(d).region!==""?(_(),B(x,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[39]||(a[39]=[u("Регион/Область",-1)])),_:1,__:[39]})):S("",!0),e(r,{modelValue:s(d).region,"onUpdate:modelValue":a[18]||(a[18]=m=>s(d).region=m),placeholder:"Регион/Область",class:"col-span-3"},null,8,["modelValue"])]),g.deal.client.chatLink.includes("easyneon.amocrm.ru")?(_(),k("div",Ot,[e(x,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>a[40]||(a[40]=[u("Категория",-1)])),_:1,__:[40]}),o("div",null,[e(U,{modelValue:s(d).category,"onUpdate:modelValue":a[19]||(a[19]=m=>s(d).category=m)},{default:t(()=>[e(n,null,{default:t(()=>[e(h,{placeholder:"Категория"})]),_:1}),e(A,null,{default:t(()=>[(_(),k(Q,null,J(b,(m,P)=>e(v,{key:P},{default:t(()=>[e(l,{value:m},{default:t(()=>[u($(m),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])])])):S("",!0)])])]),_:1})]),_:1})}}}),Qt={class:"flex gap-4"},Jt={class:"flex flex-col gap-2"},Xt={class:"relative"},qt={key:0,class:"flex items-center gap-2 text-sm text-slate-500"},Wt={key:1,class:"flex items-center gap-2 p-2 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-700"},Yt={key:0,class:"text-blue-500"},Zt={key:2,class:"flex items-center gap-2 p-2 bg-amber-50 border border-amber-200 rounded-md text-sm text-amber-700"},el={class:"flex justify-between w-full"},tl=te({__name:"EditDealModal",props:{deal:{}},emits:["isDealEdited","isDealDeleted"],setup(I,{emit:T}){const{$useApi:V}=le(),b=I,{filters:y,loadDealsDatas:M,isLoaded:w}=xe(),i=F({...b.deal}),z=oe(()=>({adTags:y.value.adTags??[],methods:y.value.methods??[],sources:y.value.sources??[],spheres:y.value.spheres??[]})),d=F(!1),c=F(""),g=F(null),a=F(!1),p=at(async n=>{if(!n||n===b.deal.client?.chatLink){g.value=null,i.value.clientId=b.deal.client?.id;return}a.value=!0;try{const{data:l}=await V.get("/clients",{params:{chatLink:n}});l&&l.length>0?(g.value=l[0],i.value.clientId=l[0].id):g.value=null}catch(l){console.error("Ошибка при поиске клиента:",l),g.value=null}finally{a.value=!1}},500);O(c,n=>{p(n.trim())});const x=async()=>{w.value||await M()};O(()=>b.deal,n=>{d.value||(i.value={...n})},{deep:!0}),O(d,async n=>{n&&(await x(),i.value={...b.deal},i.value.clientId=b.deal.client?.id,c.value=b.deal.client?.chatLink??"",g.value=null)});const L=T,f=async()=>{try{return await V.patch(`/deals/${b.deal.id}`,i.value),console.log(i.value),console.log("success!!"),L("isDealEdited"),d.value=!1}catch(n){console.log(n)}},r=async()=>{try{return await V.delete(`/deals/${b.deal.id}`,{}),console.log("success!!"),L("isDealDeleted"),d.value=!1}catch(n){console.log(n)}},h=n=>{i.value={...n}};return(n,l)=>{const v=ae,A=ne,U=ue,D=me,j=he,G=pe,m=Kt,P=_e,W=fe,Y=ce,X=re,q=ie;return _(),k("div",null,[e(q,{open:d.value,"onUpdate:open":l[1]||(l[1]=K=>d.value=K)},{default:t(()=>[e(U,{"as-child":""},{default:t(()=>[e(A,{class:"h-7 w-7 gap-1",size:"icon"},{default:t(()=>[e(v,{name:"mingcute:edit-line",color:"white",size:"25px"})]),_:1})]),_:1}),e(X,{class:"max-w-[700px] flex flex-col"},{default:t(()=>[e(G,null,{default:t(()=>[e(D,null,{default:t(()=>l[2]||(l[2]=[u("Редактирование сделки",-1)])),_:1,__:[2]}),e(j,null,{default:t(()=>l[3]||(l[3]=[u(' Заполни все поля и нажми "Сохранить" ',-1)])),_:1,__:[3]})]),_:1}),o("div",Qt,[e(m,{deal:n.deal,"deal-sub-datas":z.value,onDealDataChanged:h},null,8,["deal","deal-sub-datas"])]),o("div",Jt,[o("div",Xt,[i.value.client?(_(),B(P,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>[u("Клиент - "+$(i.value.client.fullName),1)]),_:1})):S("",!0),e(W,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=K=>c.value=K),placeholder:"Ссылка на чат клиента"},null,8,["modelValue"])]),a.value?(_(),k("div",qt,[e(v,{name:"svg-spinners:ring-resize",size:"16"}),l[4]||(l[4]=o("span",null,"Поиск клиента...",-1))])):g.value?(_(),k("div",Wt,[e(v,{name:"mdi:information-outline",size:"18"}),o("span",null,[l[5]||(l[5]=u(" Клиент будет изменён на: ",-1)),o("strong",null,$(g.value.fullName),1),g.value.phone?(_(),k("span",Yt,"("+$(g.value.phone)+")",1)):S("",!0)])])):c.value&&c.value!==b.deal.client?.chatLink?(_(),k("div",Zt,[e(v,{name:"mdi:alert-outline",size:"18"}),l[6]||(l[6]=o("span",null,"Клиент с такой ссылкой не найден в системе, изменения не будут сохранены ",-1))])):S("",!0)]),e(Y,{class:"w-full"},{default:t(()=>[o("div",el,[e(A,{onClick:r},{default:t(()=>l[7]||(l[7]=[u(" Удалить ",-1)])),_:1,__:[7]}),e(A,{onClick:f},{default:t(()=>l[8]||(l[8]=[u(" Сохранить ",-1)])),_:1,__:[8]})])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),ll={class:"w-full h-full"},sl={class:"flex flex-col gap-4"},ol={class:"relative"},al={class:"relative"},nl={class:"relative"},dl={class:"relative"},il={class:"relative"},ul={class:"flex items-center justify-center gap-1 justify-left relative"},rl={class:"relative"},pl={class:"relative"},ml={class:"flex items-center space-x-2"},cl=te({__name:"Client",props:{client:{}},emits:["clientDataChanged"],setup(I,{emit:T}){const V=I;F(!0);const b={...V.client},y=F(b),M=T;return O(y,()=>{M("clientDataChanged",y.value)},{deep:!0}),(w,i)=>{const z=ye,d=ge,c=_e,g=fe,a=Me,p=Te,x=Le,L=ze,f=Fe,r=Se,h=Ve,n=be,l=ve;return _(),k("div",ll,[e(l,null,{default:t(()=>[e(d,null,{default:t(()=>[e(z,null,{default:t(()=>i[9]||(i[9]=[u("Клиент",-1)])),_:1,__:[9]})]),_:1}),e(n,null,{default:t(()=>[o("div",sl,[o("div",ol,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[10]||(i[10]=[u("Ссылка на чат",-1)])),_:1,__:[10]}),e(g,{modelValue:s(y).chatLink,"onUpdate:modelValue":i[0]||(i[0]=v=>s(y).chatLink=v),placeholder:"Ссылка на чат",class:"col-span-3"},null,8,["modelValue"])]),o("div",al,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[11]||(i[11]=[u("ФИО",-1)])),_:1,__:[11]}),e(g,{modelValue:s(y).fullName,"onUpdate:modelValue":i[1]||(i[1]=v=>s(y).fullName=v),class:"col-span-3"},null,8,["modelValue"])]),o("div",nl,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[12]||(i[12]=[u("Телефон",-1)])),_:1,__:[12]}),e(g,{modelValue:s(y).phone,"onUpdate:modelValue":i[2]||(i[2]=v=>s(y).phone=v),placeholder:"Телефон",class:"col-span-3"},null,8,["modelValue"])]),o("div",dl,[s(y).adLink!==""?(_(),B(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[13]||(i[13]=[u("Ссылка на объявление",-1)])),_:1,__:[13]})):S("",!0),e(g,{modelValue:s(y).adLink,"onUpdate:modelValue":i[3]||(i[3]=v=>s(y).adLink=v),placeholder:"Ссылка на объявление",class:"col-span-3"},null,8,["modelValue"])]),o("div",il,[s(y).inn!==""?(_(),B(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[14]||(i[14]=[u("ИНН",-1)])),_:1,__:[14]})):S("",!0),e(g,{modelValue:s(y).inn,"onUpdate:modelValue":i[4]||(i[4]=v=>s(y).inn=v),placeholder:"ИНН",class:"col-span-3"},null,8,["modelValue"])]),o("div",ul,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[15]||(i[15]=[u("Дата первого контакта",-1)])),_:1,__:[15]}),e(g,{modelValue:s(y).firstContact,"onUpdate:modelValue":i[5]||(i[5]=v=>s(y).firstContact=v),type:"date",class:H(s(y).firstContact?"":"outline outline-1 outline-rose-300")},null,8,["modelValue","class"])]),o("div",rl,[s(y).type?(_(),B(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[16]||(i[16]=[u("Тип клиента",-1)])),_:1,__:[16]})):S("",!0),o("div",null,[e(r,{modelValue:s(y).type,"onUpdate:modelValue":i[6]||(i[6]=v=>s(y).type=v)},{default:t(()=>[e(p,null,{default:t(()=>[e(a,{placeholder:"Тип клиента"})]),_:1}),e(f,null,{default:t(()=>[e(L,null,{default:t(()=>[e(x,{value:"ФИЗ"},{default:t(()=>i[17]||(i[17]=[u(" ФИЗ ",-1)])),_:1,__:[17]}),e(x,{value:"ИП"},{default:t(()=>i[18]||(i[18]=[u(" ИП ",-1)])),_:1,__:[18]}),e(x,{value:"ООО"},{default:t(()=>i[19]||(i[19]=[u(" ООО ",-1)])),_:1,__:[19]}),e(x,{value:"НКО"},{default:t(()=>i[20]||(i[20]=[u(" НКО ",-1)])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),o("div",pl,[s(y).gender?(_(),B(c,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>i[21]||(i[21]=[u("Пол клиента",-1)])),_:1,__:[21]})):S("",!0),o("div",null,[e(r,{modelValue:s(y).gender,"onUpdate:modelValue":i[7]||(i[7]=v=>s(y).gender=v)},{default:t(()=>[e(p,null,{default:t(()=>[e(a,{placeholder:"Пол клиента"})]),_:1}),e(f,null,{default:t(()=>[e(L,null,{default:t(()=>[e(x,{value:"M"},{default:t(()=>i[22]||(i[22]=[u(" Мужской ",-1)])),_:1,__:[22]}),e(x,{value:"F"},{default:t(()=>i[23]||(i[23]=[u(" Женский ",-1)])),_:1,__:[23]}),e(x,{value:"IT"},{default:t(()=>i[24]||(i[24]=[u(" ХЗ ",-1)])),_:1,__:[24]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),o("div",ml,[e(h,{id:"reservation",checked:s(y).isRegular,"onUpdate:checked":i[8]||(i[8]=v=>s(y).isRegular=v)},null,8,["checked"]),e(c,{for:"reservation"},{default:t(()=>i[25]||(i[25]=[u("Постоянный",-1)])),_:1,__:[25]})])])]),_:1})]),_:1})])}}}),_l={class:"flex gap-4"},fl=te({__name:"EditClient",props:{client:{}},emits:["isClientEdited"],setup(I,{emit:T}){const{$useApi:V}=le(),b=I,y=F({...b.client}),M=F(!1),w=d=>{y.value={...d}},i=T,z=async()=>{try{return await V.patch(`/clients/${b.client.id}`,y.value),i("isClientEdited"),M.value=!1}catch(d){console.log(d)}};return(d,c)=>{const g=ae,a=ne,p=ue,x=me,L=he,f=pe,r=cl,h=ce,n=re,l=ie;return _(),k("div",null,[e(l,{open:s(M),"onUpdate:open":c[0]||(c[0]=v=>we(M)?M.value=v:null)},{default:t(()=>[e(p,{"as-child":""},{default:t(()=>[e(a,{size:"icon",class:"h-5 w-5 gap-1"},{default:t(()=>[e(g,{name:"mingcute:edit-line",color:"white",size:"15px"})]),_:1})]),_:1}),e(n,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(f,null,{default:t(()=>[e(x,null,{default:t(()=>c[1]||(c[1]=[u("Редактирование клиента",-1)])),_:1,__:[1]}),e(L,null,{default:t(()=>c[2]||(c[2]=[u(' Заполни все поля и нажми "Сохранить" ',-1)])),_:1,__:[2]})]),_:1}),o("div",_l,[e(r,{client:d.client,onClientDataChanged:w},null,8,["client"])]),e(h,null,{default:t(()=>[e(a,{onClick:z},{default:t(()=>c[3]||(c[3]=[u(" Сохранить ",-1)])),_:1,__:[3]})]),_:1})]),_:1})]),_:1},8,["open"])])}}}),vl={class:"flex gap-4"},gl={class:"relative"},yl={class:"flex gap-2"},bl={class:"relative"},xl={key:0,class:"text-red-500 text-sm mb-2"},wl=te({__name:"AddDealerModal",props:{deal:{}},emits:["isDealerAdded"],setup(I,{emit:T}){const{$useApi:V}=le(),{filters:b,loadDealsDatas:y,isLoaded:M}=xe(),w=oe(()=>b.value.managers??[]),i=I,z=F(!1),d=f=>Array.isArray(f)?f.map(r=>({...r})):[],c=F(d(i.deal.dealers)),g=F(null),a=T,p=()=>{c.value.push({id:0,dealId:i.deal.id,userId:0,price:0})},x=f=>{c.value.splice(f,1),g.value=null},L=async()=>{try{if(c.value.some(D=>D.price<=0)){g.value="Стоимость не может быть меньше или равна нулю.";return}if(c.value.some(D=>D.userId===0)){g.value="Не выбран менеджер.";return}const h=c.value.map(D=>D.userId);if(new Set(h).size!==h.length){g.value="Не должно быть одинаковых менеджеров.";return}const l=c.value.reduce((D,j)=>D+(j.price||0),0),v=i.deal.price||0;if(l!==v){g.value=`Сумма (${l}) не равна стоимости сделки (${v}).`;return}const A=c.value.map((D,j)=>({id:D.id,userId:D.userId,price:D.price,dealId:i.deal.id,idx:j})),{data:U}=await V.patch(`/deals/${i.deal.id}/dealers`,{dealers:A});console.log("Dealers updated:",U),c.value=d(U?.dealers),a("isDealerAdded"),z.value=!1,g.value=null}catch(f){console.error("Error updating dealers:",f),g.value="Ошибка при сохранении дилеров."}};return O(c,()=>{c.value.length===1&&(c.value[0].price=i.deal.price)},{deep:!0}),De(async()=>{try{M.value||await y()}catch(f){console.error("Ошибка загрузки менеджеров:",f)}}),O(()=>i.deal.dealers,f=>{z.value||(c.value=d(f))},{deep:!0}),O(z,f=>{f&&(c.value=d(i.deal.dealers),g.value=null)}),(f,r)=>{const h=ae,n=ne,l=ue,v=me,A=pe,U=ye,D=Ue,j=ge,G=_e,m=ke,P=fe,W=Be,Y=be,X=ve,q=ce,K=re,de=ie;return _(),B(de,{open:z.value,"onUpdate:open":r[1]||(r[1]=R=>z.value=R)},{default:t(()=>[e(l,{"as-child":""},{default:t(()=>[e(n,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(h,{name:"mingcute:edit-line",color:"white",size:"15px"})]),_:1})]),_:1}),e(K,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(A,null,{default:t(()=>[e(v,null,{default:t(()=>r[2]||(r[2]=[u("Редактировать участников",-1)])),_:1,__:[2]})]),_:1}),o("div",vl,[e(X,{class:"w-full"},{default:t(()=>[e(j,null,{default:t(()=>[e(U,null,{default:t(()=>r[3]||(r[3]=[u("Участники",-1)])),_:1,__:[3]}),e(D,null,{default:t(()=>r[4]||(r[4]=[u("Управляйте списком дилеров",-1)])),_:1,__:[4]})]),_:1}),e(Y,{class:"flex flex-col gap-4"},{default:t(()=>[(_(!0),k(Q,null,J(c.value,(R,Z)=>(_(),k("div",{key:R.id||`new-${Z}`,class:"flex flex-col gap-4"},[o("div",gl,[e(G,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[5]||(r[5]=[u("Менеджер",-1)])),_:1,__:[5]}),o("div",yl,[e(m,{items:w.value.map(E=>({value:E.id,label:E.fullName})),class:"w-full",label:R.user?.fullName||"Выберите менеджера",onSelectedItem:E=>{R.userId=E,g.value=null}},null,8,["items","label","onSelectedItem"]),c.value.length>1?(_(),B(n,{key:0,variant:"destructive",onClick:E=>x(Z)},{default:t(()=>[e(s(it))]),_:2},1032,["onClick"])):S("",!0)])]),o("div",bl,[e(G,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>r[6]||(r[6]=[u("Стоимость",-1)])),_:1,__:[6]}),e(P,{modelValue:R.price,"onUpdate:modelValue":E=>R.price=E,modelModifiers:{number:!0},type:"number",placeholder:"Часть от 10 до 90",class:H(R.price?"":"outline outline-1 outline-rose-300 rounded-md"),onInput:r[0]||(r[0]=E=>g.value=null)},null,8,["modelValue","onUpdate:modelValue","class"])]),c.value.length?(_(),B(W,{key:0})):S("",!0)]))),128)),c.value.length<3?(_(),B(n,{key:0,onClick:p},{default:t(()=>r[7]||(r[7]=[u(" Добавить менеджера ",-1)])),_:1,__:[7]})):S("",!0)]),_:1})]),_:1})]),e(q,null,{default:t(()=>[g.value?(_(),k("p",xl,$(g.value),1)):S("",!0),e(n,{onClick:L},{default:t(()=>r[8]||(r[8]=[u("Сохранить",-1)])),_:1,__:[8]})]),_:1})]),_:1})]),_:1},8,["open"])}}}),Dl={class:"flex gap-4"},Ul={class:"flex flex-col gap-6"},kl={class:"relative"},$l={class:"relative"},Cl={class:"relative"},Il={class:"relative"},hl={key:0,class:"relative"},Vl={class:"relative"},Sl={class:"relative"},Tl={class:"relative flex items-center space-x-2"},Ml=te({__name:"CreatePaymentModal",props:{dealId:{}},emits:["isPayCreated"],setup(I,{emit:T}){const{$useApi:V}=le(),b=Ee(),{filters:y,loadDealsDatas:M,isLoaded:w}=xe(),i=oe(()=>y.value.managers??[]),z=I,d=F(!1),c=["Наличные","Перевод","Договор","Наложка","Ссылка","Долями","Рассрочка","Счет","Возврат"],g=["Терминал Изинеон СБП","Терминал Изинеон","Терминал ИзиБук"],a={title:"1",price:0,date:new Date().toISOString().slice(0,10),method:"Ссылка",reservation:!1,paymentId:"",paymentLink:"",terminal:"",isConfirmed:!1,userId:0},p=F({...a}),x=F("Статус"),L=F(!1),f=T,r=()=>{const n=b.user?.id;!n||p.value.userId||i.value.some(l=>l.id===n)&&(p.value.userId=n)};De(async()=>{try{w.value||await M(),r()}catch(n){console.error("Ошибка загрузки менеджеров:",n)}}),O(()=>i.value,()=>{r()},{deep:!0});const h=async()=>{if(!L.value)try{L.value=!0,p.value.paymentId||(p.value.terminal=""),await V.post("/payments/",{...p.value,dealId:z.dealId,userId:p.value.userId||void 0}),console.log("payment created"),f("isPayCreated"),d.value=!1;return}catch(n){console.log(n)}finally{L.value=!1}};return O(d,()=>{d.value?r():p.value={...a}}),O(()=>[p.value.paymentId,p.value.terminal],async([n,l])=>{if(n&&n.length>5&&l){const{data:v}=await V.get("payments/checkPayment",{params:{paymentId:n,terminal:l}});x.value=v.message,p.value.price=v.price,p.value.isConfirmed=v.isConfirmed}}),O(()=>[p.value.paymentLink],async([n])=>{if(n&&n.length>5){const{data:l}=await V.get("payments/checkPaymentLink",{params:{link:n}});x.value=l.message,p.value.price=l.price,p.value.isConfirmed=l.isConfirmed,p.value.paymentId=l.paymentId}}),(n,l)=>{const v=ae,A=ne,U=ue,D=me,j=pe,G=ye,m=Ue,P=ge,W=Me,Y=Te,X=Le,q=ze,K=Fe,de=Se,R=_e,Z=fe,E=ke,$e=ut,Ce=mt,Ie=pt,C=rt,Re=Ve,Oe=be,Ke=ve,Qe=ce,Je=re,Xe=ie;return _(),B(Xe,{open:s(d),"onUpdate:open":l[8]||(l[8]=N=>we(d)?d.value=N:null)},{default:t(()=>[e(U,{"as-child":""},{default:t(()=>[e(A,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(v,{name:"akar-icons:plus",color:"white",size:"15px"})]),_:1})]),_:1}),e(Je,{class:"flex flex-col max-w-[450px]"},{default:t(()=>[e(j,null,{default:t(()=>[e(D,null,{default:t(()=>l[9]||(l[9]=[u("Создать платеж",-1)])),_:1,__:[9]})]),_:1}),o("div",Dl,[e(Ke,{class:"w-full"},{default:t(()=>[e(P,null,{default:t(()=>[e(G),e(m,null,{default:t(()=>[u($(s(x)),1)]),_:1})]),_:1}),e(Oe,null,{default:t(()=>[o("div",Ul,[o("div",kl,[e(de,{modelValue:s(p).method,"onUpdate:modelValue":l[0]||(l[0]=N=>s(p).method=N)},{default:t(()=>[e(Y,null,{default:t(()=>[e(W,{placeholder:s(p).method},null,8,["placeholder"])]),_:1}),e(K,null,{default:t(()=>[(_(),k(Q,null,J(c,(N,Ae)=>e(q,{key:Ae},{default:t(()=>[e(X,{value:N},{default:t(()=>[u($(N),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),o("div",$l,[e(R,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[10]||(l[10]=[u("Сумма",-1)])),_:1,__:[10]}),e(Z,{modelValue:s(p).price,"onUpdate:modelValue":l[1]||(l[1]=N=>s(p).price=N),type:"number",placeholder:"Сумма",class:H(s(p).price?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),o("div",Cl,[e(R,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[11]||(l[11]=[u("Дата оплаты",-1)])),_:1,__:[11]}),e(Z,{modelValue:s(p).date,"onUpdate:modelValue":l[2]||(l[2]=N=>s(p).date=N),type:"date",placeholder:"Дата оплаты",class:H(s(p).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),o("div",Il,[e(R,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[12]||(l[12]=[u("Менеджер",-1)])),_:1,__:[12]}),e(E,{class:H(s(p).userId?"":"outline-1 outline-rose-300 rounded-md"),items:s(i).map(N=>({value:N.id,label:N.fullName})),label:s(i).find(N=>N.id===s(p).userId)?.fullName||"Выбрать менеджера",onSelectedItem:l[3]||(l[3]=N=>s(p).userId=N)},null,8,["class","items","label"])]),s(p).method==="Возврат"?(_(),k("div",hl,[e(R,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>l[13]||(l[13]=[u("Причина",-1)])),_:1,__:[13]}),e($e,{modelValue:s(p).description,"onUpdate:modelValue":l[4]||(l[4]=N=>s(p).description=N),placeholder:"Информация о возврате"},null,8,["modelValue"])])):S("",!0),o("div",Vl,[s(p).paymentLink?(_(),B(R,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[14]||(l[14]=[u("Ссылка на оплату",-1)])),_:1,__:[14]})):S("",!0),e(Z,{modelValue:s(p).paymentLink,"onUpdate:modelValue":l[5]||(l[5]=N=>s(p).paymentLink=N),placeholder:"Ссылка на оплату"},null,8,["modelValue"])]),o("div",Sl,[s(p).paymentId?(_(),B(R,{key:0,class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>l[15]||(l[15]=[u("paymentId",-1)])),_:1,__:[15]})):S("",!0),e(Z,{modelValue:s(p).paymentId,"onUpdate:modelValue":l[6]||(l[6]=N=>s(p).paymentId=N),placeholder:"paymentId"},null,8,["modelValue"])]),s(p).paymentId&&!s(p).paymentLink?(_(),k("div",{key:1,class:H(s(p).terminal?"":"outline-1 outline-rose-300")},[e(C,null,{default:t(()=>[e(Ie,{class:"flex"},{default:t(()=>[(_(),k(Q,null,J(g,N=>e(Ce,{key:N,value:N,class:"w-full",onClick:Ae=>s(p).terminal=N},{default:t(()=>[u($(N.slice(9)),1)]),_:2},1032,["value","onClick"])),64))]),_:1})]),_:1})],2)):S("",!0),o("div",Tl,[e(Re,{id:"isConfirmed",checked:s(p).isConfirmed,"onUpdate:checked":l[7]||(l[7]=N=>s(p).isConfirmed=N)},null,8,["checked"]),e(R,{for:"isConfirmed"},{default:t(()=>l[16]||(l[16]=[u("Подтвержден",-1)])),_:1,__:[16]})])])]),_:1})]),_:1})]),e(Qe,null,{default:t(()=>[e(A,{disabled:s(L),onClick:h},{default:t(()=>[u($(s(L)?"Создание...":"Создать"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])}}}),Fl={class:"w-full"},Ll={class:"flex flex-col gap-6"},zl={class:"relative"},Al={class:"relative"},Nl={class:"relative"},Pl={class:"relative"},jl=te({__name:"CreateDopCard",props:{managers:{},doptypes:{}},emits:["update:dopBlank"],setup(I,{emit:T}){const V={id:0,dealId:0,saleDate:new Date().toISOString().slice(0,10),type:"",price:0,userId:0},b=F({...V}),y=T;return O(b,()=>{y("update:dopBlank",b.value)},{deep:!0}),(M,w)=>{const i=ye,z=Ue,d=ge,c=_e,g=fe,a=ke,p=je,x=be,L=ve;return _(),k("div",Fl,[e(L,null,{default:t(()=>[e(d,null,{default:t(()=>[e(i,null,{default:t(()=>w[4]||(w[4]=[u("Доп. продажа",-1)])),_:1,__:[4]}),e(z,null,{default:t(()=>w[5]||(w[5]=[u("Заполни данные",-1)])),_:1,__:[5]})]),_:1}),e(x,null,{default:t(()=>[o("div",Ll,[o("div",zl,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>w[6]||(w[6]=[u("Дата продажи",-1)])),_:1,__:[6]}),e(g,{modelValue:s(b).saleDate,"onUpdate:modelValue":w[0]||(w[0]=f=>s(b).saleDate=f),type:"date",placeholder:"Дата продажи",class:H(s(b).saleDate?"":"outline outline-1 outline-rose-300")},null,8,["modelValue","class"])]),o("div",Al,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>w[7]||(w[7]=[u("Менеджер",-1)])),_:1,__:[7]}),e(a,{class:H(s(b).userId?"":"outline-1 outline-rose-300 rounded-md"),items:M.managers.map(f=>({value:f.id,label:f.fullName})),label:"Выбрать менеджера",onSelectedItem:w[1]||(w[1]=f=>s(b).userId=f)},null,8,["class","items"])]),o("div",Nl,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>w[8]||(w[8]=[u("Стоимость",-1)])),_:1,__:[8]}),e(g,{modelValue:s(b).price,"onUpdate:modelValue":w[2]||(w[2]=f=>s(b).price=f),type:"number",placeholder:"Стоимость",class:H(s(b).price?"":"outline outline-1 outline-rose-300 rounded-md")},null,8,["modelValue","class"])]),o("div",Pl,[e(c,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1"},{default:t(()=>w[9]||(w[9]=[u("Тип",-1)])),_:1,__:[9]}),e(p,{class:H(s(b).type?"":"outline outline-1 outline-rose-300 rounded-md"),items:M.doptypes,label:s(b).type,onSelectedItem:w[3]||(w[3]=f=>s(b).type=f)},null,8,["class","items","label"])])])]),_:1})]),_:1})])}}}),Bl={class:"flex gap-4"},El=te({__name:"CreateDopModal",props:{dealId:{}},emits:["isDopCreated"],setup(I,{emit:T}){const{$useApi:V}=le(),b=I,y=F(!1),M=F([]),w=F([]),i=async()=>{try{const{data:a}=await V.get("/managers")||[];M.value=a;const{data:p}=await V.get("/dops/types")||[];w.value=p}catch(a){console.log(a)}},z={id:0,dealId:0,saleDate:"",type:"",price:0,userId:0},d=F(z),c=T,g=async()=>{try{await V.post("/dops",{...d.value,dealId:b.dealId}),c("isDopCreated"),y.value=!1;return}catch(a){console.log(a)}};return O(y,()=>{y.value||(d.value=z)}),(a,p)=>{const x=ae,L=ne,f=ue,r=me,h=pe,n=jl,l=ce,v=re,A=ie;return _(),B(A,{open:s(y),"onUpdate:open":p[1]||(p[1]=U=>we(y)?y.value=U:null)},{default:t(()=>[e(f,{"as-child":""},{default:t(()=>[e(L,{class:"h-5 w-5 px-0 py-2",onClick:i},{default:t(()=>[e(x,{name:"akar-icons:plus",color:"white",size:"15px"})]),_:1})]),_:1}),e(v,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(h,null,{default:t(()=>[e(r,null,{default:t(()=>p[2]||(p[2]=[u("Создать",-1)])),_:1,__:[2]})]),_:1}),o("div",Bl,[e(n,{managers:s(M),doptypes:s(w),"onUpdate:dopBlank":p[0]||(p[0]=U=>d.value=U)},null,8,["managers","doptypes"])]),e(l,null,{default:t(()=>[e(L,{onClick:g},{default:t(()=>p[3]||(p[3]=[u(" Создать ",-1)])),_:1,__:[3]})]),_:1})]),_:1})]),_:1},8,["open"])}}}),Gl={class:"flex flex-col gap-6"},Hl={key:0,class:"text-red-500 text-sm"},Rl={class:"relative"},Ol={class:"relative"},Kl={class:"relative"},Ql={key:1,class:"mt-2"},Jl={key:0},Xl={key:1},ql=te({__name:"CreateModal",props:{dealId:{}},emits:["isReviewCreated","error"],setup(I,{emit:T}){const{$useApi:V}=le(),b=Ee(),{filters:y,loadDealsDatas:M,isLoaded:w}=xe(),i=oe(()=>y.value.managers??[]),z=I,d=T,c=F(!1),g=F(null),a=F(null),p=F(null),x=F(!1),L=F(!0),f={id:0,dealId:0,date:"",userId:0},r=F({...f}),h=()=>{const U=b.user?.id;!U||r.value.userId||i.value.some(D=>D.id===U)&&(r.value.userId=U)};De(async()=>{try{w.value||await M(),h()}catch(U){console.error("Ошибка загрузки менеджеров:",U)}}),O(()=>i.value,()=>{h()},{deep:!0});const n=U=>{const j=U.target.files?.[0];if(!j){a.value="Пожалуйста, выберите файл",g.value=null,p.value=null;return}A(j)},l=async()=>{if(!g.value){a.value="Файл обязателен для загрузки";return}x.value=!0,a.value=null;try{const U=new FormData;U.append("file",g.value),U.append("date",r.value.date),U.append("userId",String(r.value.userId)),U.append("dealId",String(z.dealId)),await V.post("/reviews",U,{headers:{"Content-Type":"multipart/form-data"}}),d("isReviewCreated"),c.value=!1}catch(U){const D=U.response?.data?.message||"Ошибка при создании отзыва";a.value=D,d("error",D)}finally{x.value=!1}},v=U=>{const D=U.clipboardData?.items;if(!D){a.value="Невозможно получить данные из буфера обмена";return}for(const j of D)if(j.type.startsWith("image/")){const G=j.getAsFile();if(G){A(G);return}}a.value="В буфере обмена нет изображения"},A=U=>{if(!["image/jpeg","image/png"].includes(U.type)){a.value="Допустимы только изображения (JPEG, PNG)",g.value=null,p.value=null;return}if(U.size>5242880){a.value="Размер файла не должен превышать 5MB",g.value=null,p.value=null;return}a.value=null,g.value=U;const G=new FileReader;G.onload=m=>{p.value=m.target?.result},G.readAsDataURL(U)};return O([r,g],()=>{const{date:U,userId:D}=r.value;L.value=!(U&&D&&g.value)},{deep:!0}),O(c,U=>{if(U)h();else{r.value={...f},g.value=null,p.value=null,a.value=null;const D=document.getElementById("file-input");console.log(D)}}),(U,D)=>{const j=ae,G=ne,m=ue,P=me,W=pe,Y=_e,X=fe,q=ke,K=ct,de=ce,R=re,Z=ie;return _(),B(Z,{open:s(c),"onUpdate:open":D[3]||(D[3]=E=>we(c)?c.value=E:null)},{default:t(()=>[e(m,{"as-child":""},{default:t(()=>[e(G,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(j,{name:"akar-icons:plus",color:"white",size:"15px"})]),_:1})]),_:1}),e(R,{class:"max-w-[400px] flex flex-col"},{default:t(()=>[e(W,null,{default:t(()=>[e(P,null,{default:t(()=>D[4]||(D[4]=[u("Создать отзыв",-1)])),_:1,__:[4]})]),_:1}),o("div",Gl,[s(a)?(_(),k("div",Hl,$(s(a)),1)):S("",!0),o("div",Rl,[e(Y,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>D[5]||(D[5]=[u("Скриншот(Ctrl+v)",-1)])),_:1,__:[5]}),e(X,{id:"file-input",type:"file",accept:"image/jpeg,image/png",class:H([s(g)?"":"outline-1 outline-rose-300 rounded-md","cursor-pointer"]),onChange:D[0]||(D[0]=E=>n(E)),onPaste:v},null,8,["class"])]),o("div",Ol,[e(Y,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>D[6]||(D[6]=[u("Дата",-1)])),_:1,__:[6]}),e(X,{modelValue:s(r).date,"onUpdate:modelValue":D[1]||(D[1]=E=>s(r).date=E),type:"date",placeholder:"Дата продажи",class:H(s(r).date?"":"outline-1 outline-rose-300")},null,8,["modelValue","class"])]),o("div",Kl,[e(Y,{class:"font-medium text-slate-400 absolute left-2 top-[-13px] bg-white rounded-md p-1 whitespace-nowrap"},{default:t(()=>D[7]||(D[7]=[u("Менеджер",-1)])),_:1,__:[7]}),e(q,{class:H(s(r).userId?"":"outline-1 outline-rose-300 rounded-md"),items:s(i).map(E=>({value:E.id,label:E.fullName})),label:s(i).find(E=>E.id===s(r).userId)?.fullName||"Выбрать менеджера",onSelectedItem:D[2]||(D[2]=E=>s(r).userId=E)},null,8,["class","items","label"])]),s(p)?(_(),k("div",Ql,[e(K,{src:s(p),alt:"Превью изображения",class:"w-full h-auto rounded-md"},null,8,["src"])])):S("",!0)]),e(de,null,{default:t(()=>[e(G,{disabled:s(L)||s(x),onClick:l},{default:t(()=>[s(x)?(_(),k("span",Jl,"Сохранение...")):(_(),k("span",Xl,"Создать"))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])}}}),Wl={key:0,class:"h-full"},Yl={class:"flex-1 min-w-0"},Zl={class:"flex flex-col"},es={key:0},ts={class:"flex gap-2 mb-2 items-center"},ls={class:"ml-auto flex items-center gap-2"},ss={class:"gap-3"},os={class:"gap-1 text-gray-600"},as={class:"flex items-center justify-between font-semibold"},ns={class:"flex items-center justify-between"},ds={class:"flex items-center justify-between"},is={class:"flex items-center justify-between"},us={class:"flex items-center justify-between font-semibold"},rs={class:"gap-1"},ps={class:"font-semibold pb-2 flex justify-between"},ms={class:"text-gray-600 flex justify-between"},cs={class:"font-semibold pb-2 flex justify-between"},_s={class:""},fs={class:"flex gap-2"},vs={class:"flex flex-col"},gs={class:"text-gray-600"},ys={class:"flex gap-1"},bs={class:"text-gray-900 font-bold"},xs={class:"ml-[auto]"},ws={class:"flex flex-col"},Ds={class:"flex justify-between font-semibold pb-2"},Us={class:"flex flex-col text-gray-600"},ks={class:"flex"},$s={class:"flex justify-between grow mr-1"},Cs={class:""},Is={class:"flex items-center justify-between"},hs={class:""},Vs={class:""},Ss={class:""},Ts={class:"gap-1"},Ms={class:"flex items-center justify-between"},Fs={class:"flex"},Ls={class:"flex flex-col justify-between grow mr-1 mb-1"},zs={class:"text-muted-foreground"},As={class:"text-muted-foreground"},Ns={class:"w-full flex flex-col items-center"},Ps={key:0,class:"gap-1 mt-3"},js={class:"flex flex-col"},Bs={class:"font-bold"},Es={class:"gap-1 mt-3"},Gs={class:"flex flex-col justify-between grow mr-1 mb-1"},Hs={class:"text-muted-foreground"},Rs={class:"flex flex-col justify-between grow mr-1 mb-1"},Os={class:"text-muted-foreground"},Ks={class:"gap-1"},Qs={class:"flex items-center justify-between"},Js={class:"flex"},Xs={class:"flex flex-col justify-between grow mr-1 mb-1"},qs={class:"text-muted-foreground"},Ws={class:"w-full flex flex-col items-center"},Lo=te({__name:"DealCard",props:{deal:{}},emits:["deal-updated","deal-deleted","update-deal"],setup(I,{emit:T}){const{$useApi:V}=le(),b=I,y=F(b.deal.status||"Не установлен"),M=F(0),w=F(0),i=F(0),z=F(0),d=F(0),c=T,g=()=>{console.log("dealUpdated"),c("deal-updated",b.deal.id)},a=()=>{console.log("dealDeleted"),c("deal-deleted")},p=async n=>{try{await V.delete(`/payments/${n.id}`),console.log("payment deleted"),c("deal-updated",b.deal.id);return}catch(l){console.log(l)}},x=async n=>{try{await V.delete(`/dops/${n.id}`),console.log("dop deleted"),c("deal-updated",b.deal.id);return}catch(l){console.log(l)}},L=async n=>{try{await V.delete(`/reviews/${n.id}`),console.log("review deleted"),c("deal-updated",b.deal.id);return}catch(l){console.log(l)}},f=async()=>{try{await V.patch(`/deals/${b.deal.id}`,{status:y.value}),c("deal-updated",b.deal.id)}catch(n){console.log(n)}},r=async n=>{try{await V.delete("deliveries/"+n),c("deal-updated",b.deal.id)}catch(l){console.log(l)}},h=()=>{M.value=b.deal.dops?.reduce((n,l)=>n+l.price,0)||0,w.value=b.deal.payments?.reduce((n,l)=>n+l.price,0)||0,i.value=b.deal.price+M.value,z.value=i.value-w.value,d.value=ft(b.deal.client.firstContact,b.deal.saleDate)};return O(y,()=>{console.log(y.value),f()}),De(()=>{h()}),O(()=>b.deal,()=>{h()},{deep:!0}),(n,l)=>{const v=We,A=ye,U=Ue,D=wt,j=tl,G=ge,m=Be,P=fl,W=nt,Y=dt,X=ae,q=ne,K=wl,de=Ml,R=El,Z=ql,E=be,$e=_t,Ce=Ye,Ie=ve;return n.deal.id!==0?(_(),k("div",Wl,[e(Ie,{class:"flex flex-col overflow-hidden h-full"},{default:t(()=>[e(G,{class:"flex flex-row items-start bg-slate-50 pb-1"},{default:t(()=>[o("div",Yl,[e(A,{class:"flex items-center gap-2 text-lg pb-2 pr-2 break-all leading-tight"},{default:t(()=>[e(v,{to:`/deals/${n.deal.id}`,class:"cursor-pointer hover:underline"},{default:t(()=>[u($(n.deal.title),1)]),_:1},8,["to"])]),_:1}),e(U,null,{default:t(()=>[o("div",Zl,[o("span",null," Первый контакт: "+$(("dateFormat"in n?n.dateFormat:s(se))(n.deal.client.firstContact)),1),o("span",null," Дата продажи: "+$(("dateFormat"in n?n.dateFormat:s(se))(n.deal.saleDate)),1),o("span",null," Прошло дней: "+$(s(d)),1),n.deal.maketPresentation?(_(),k("span",es,"Презентация макета: "+$(("dateFormat"in n?n.dateFormat:s(se))(n.deal.maketPresentation)),1)):S("",!0)]),o("div",ts,[o("span",null,"Статус: "+$(n.deal.status),1)])]),_:1})]),o("div",ls,[e(D,{"deal-id":n.deal.id,onIsDealEdited:g,onIsDealDeleted:a},null,8,["deal-id"]),e(j,{deal:n.deal,onIsDealEdited:g,onIsDealDeleted:a},null,8,["deal"])])]),_:1}),e($e,null,{default:t(()=>[e(E,{class:"p-6 text-sm h-full"},{default:t(()=>[o("div",ss,[l[5]||(l[5]=o("div",{class:"font-semibold pb-2"},"Детали оплаты",-1)),o("ul",os,[o("li",as,[l[0]||(l[0]=o("span",{class:"text-muted-foreground"}," Сумма заказа ",-1)),o("span",null,$(s(i))+"₽ ",1)]),o("li",ns,[l[1]||(l[1]=o("span",{class:"text-muted-foreground"}," Стоимость вывески ",-1)),o("span",null,$(n.deal.price)+"₽ ",1)]),o("li",ds,[l[2]||(l[2]=o("span",{class:"text-muted-foreground"}," Стоимость доп. услуг ",-1)),o("span",null,$(s(M))+"₽ ",1)]),o("li",is,[l[3]||(l[3]=o("span",{class:"text-muted-foreground"}," Оплачено ",-1)),o("span",null,$(s(w))+"₽ ",1)]),o("li",us,[l[4]||(l[4]=o("span",{class:"text-muted-foreground"}," Остаток ",-1)),o("span",{class:H(s(z)>0?"text-red-600":"text-green-600")},$(s(z))+"₽ ",3)])])]),e(m,{class:"my-2"}),o("div",rs,[o("div",ps,[l[6]||(l[6]=o("span",null,"Клиент",-1)),e(P,{client:n.deal.client,onIsClientEdited:g},null,8,["client"])]),o("div",ms,[o("div",null,$(n.deal.client?.fullName),1),e(v,{class:"underlin whitespace-nowrap",to:n.deal.client.chatLink,target:"_blank"},{default:t(()=>l[7]||(l[7]=[u(" Ссылка на чат ",-1)])),_:1,__:[7]},8,["to"])])]),e(m,{class:"my-2"}),o("div",null,[o("div",cs,[l[8]||(l[8]=o("span",null,"Доставка",-1)),e(W,{deal:n.deal,onDeliveryCreated:g},null,8,["deal"])]),o("ul",_s,[(_(!0),k(Q,null,J(n.deal.deliveries,C=>(_(),k("li",{key:C.id},[o("div",fs,[e(Y,{delivery:C,onDeliveryEdited:g},null,8,["delivery"]),o("div",vs,[o("span",gs,$(C.method),1),o("div",ys,[l[9]||(l[9]=o("span",null,"Трек-номер:",-1)),o("span",bs,$(C.track),1)])]),o("div",xs,[e(q,{class:"ml-[auto] w-5 h-5 p-0",onClick:()=>r(C.id)},{default:t(()=>[e(X,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])])])]))),128))])]),e(m,{class:"my-2"}),o("div",ws,[o("div",Ds,[u($(n.deal.dealers.length>1?"Менеджеры":"Менеджер")+" ",1),(_(),B(K,{key:n.deal.id,deal:n.deal,onIsDealerAdded:g},null,8,["deal"]))]),o("div",Us,[(_(!0),k(Q,null,J(n.deal.dealers,C=>(_(),k("ul",{key:C.id,class:"w-full flex-cols items-center mb-2"},[o("li",ks,[o("div",$s,[o("span",null,$(C.user?.fullName||"Nope"),1),o("span",null,$(C.price+"p"),1)])])]))),128))])]),e(m,{class:"my-2"}),o("div",Cs,[o("div",Is,[l[10]||(l[10]=o("div",{class:"font-semibold pb-2"},"Платежи",-1)),e(de,{"deal-id":n.deal.id,onIsPayCreated:g},null,8,["deal-id"])]),(_(!0),k(Q,null,J(n.deal.payments,C=>(_(),k("ul",{key:C.id,class:"text-gray-600 flex"},[o("li",{class:H(["flex items-center justify-between grow mr-1 mb-1",C.isConfirmed?"text-green-600":"text-red-500"])},[o("span",hs,$(C.method),1),o("span",Vs,$(("dateFormat"in n?n.dateFormat:s(se))(C.date)),1),o("span",Ss,$(C.price)+"₽ ",1)],2),e(q,{class:"h-5 w-5 px-0 py-2",onClick:()=>p(C)},{default:t(()=>[e(X,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])]))),128))]),e(m,{class:"my-2"}),o("div",Ts,[o("div",Ms,[l[11]||(l[11]=o("div",{class:"font-semibold pb-2"},"Доп. услуги",-1)),e(q,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(R,{"deal-id":n.deal.id,onIsDopCreated:g},null,8,["deal-id"])]),_:1})]),(_(!0),k(Q,null,J(n.deal.dops,C=>(_(),k("ul",{key:C.id,class:"text-gray-600 flex flex-col"},[o("div",Fs,[o("li",Ls,[o("span",zs,$(("dateFormat"in n?n.dateFormat:s(se))(C.saleDate)+" - "+C.type),1),o("span",As,$(C.user.fullName+" - "+C.price+"₽"||""),1)]),e(q,{class:"h-5 w-5 px-0 py-2",onClick:()=>x(C)},{default:t(()=>[e(X,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])]),o("div",Ns,[e(m,{class:"my-1"})])]))),128))]),n.deal&&n.deal.tasks&&n.deal.tasks.length>0?(_(),k("div",Ps,[l[13]||(l[13]=o("div",{class:"flex items-center justify-between"},[o("div",{class:"font-semibold pb-2"},"Карточки")],-1)),o("div",js,[(_(!0),k(Q,null,J(n.deal.tasks,C=>(_(),B(v,{key:C.id,to:`boards/${C.boardId}/task/${C.id}`,target:"_blank",rel:"noopener",class:"hover:underline",title:"Открыть карточку"},{default:t(()=>[o("span",Bs," - "+$(C.board.title),1),l[12]||(l[12]=u(" - ",-1)),o("span",null,$(C.title.slice(0,20)),1)]),_:2,__:[12]},1032,["to"]))),128))]),e(m,{class:"my-1"})])):S("",!0),o("div",Es,[l[17]||(l[17]=o("div",{class:"flex items-center justify-between"},[o("div",{class:"font-semibold pb-2"},"Изготовление")],-1)),e(v,{class:"underline text-gray-600",to:"https://easyneonwork.kaiten.ru/"+n.deal.card_id,target:"_blank"},{default:t(()=>l[14]||(l[14]=[u(" Дизайн ",-1)])),_:1,__:[14]},8,["to"]),(_(!0),k(Q,null,J(n.deal.masterReports,C=>(_(),k("ul",{key:C.id,class:"text-gray-600 flex flex-col"},[o("li",null,[e(v,{class:"underline",to:C.name,target:"_blank"},{default:t(()=>l[15]||(l[15]=[u(" Производство ",-1)])),_:2,__:[15]},1032,["to"])]),o("li",Gs,[o("span",Hs," ("+$(C.type)+") Собрана "+$(("dateFormat"in n?n.dateFormat:s(se))(C.date)),1)])]))),128)),(_(!0),k(Q,null,J(n.deal.packerReports,C=>(_(),k("ul",{key:C.id,class:"text-gray-600 flex flex-col"},[o("li",null,[e(v,{class:"underline",to:C.name,target:"_blank"},{default:t(()=>l[16]||(l[16]=[u(" Упаковка ",-1)])),_:2,__:[16]},1032,["to"])]),o("li",Rs,[o("span",Os," ("+$(C.items)+"-шт.) Упакована "+$(("dateFormat"in n?n.dateFormat:s(se))(C.date)),1)])]))),128))]),e(m,{class:"my-1"}),o("div",Ks,[o("div",Qs,[l[18]||(l[18]=o("div",{class:"font-semibold pb-2"},"Отзыв",-1)),e(q,{class:"h-5 w-5 px-0 py-2"},{default:t(()=>[e(Z,{"deal-id":n.deal.id,onIsReviewCreated:g},null,8,["deal-id"])]),_:1})]),(_(!0),k(Q,null,J(n.deal.reviews,C=>(_(),k("ul",{key:C.id,class:"text-gray-600 flex flex-col"},[o("div",Js,[o("li",Xs,[o("span",qs,$(("dateFormat"in n?n.dateFormat:s(se))(C.date)),1)]),e(v,{class:"underline",to:C.file[0]?.preview??"",target:"_blank"},{default:t(()=>l[19]||(l[19]=[u(" Скриншот ",-1)])),_:2,__:[19]},1032,["to"]),e(q,{class:"h-5 w-5 px-0 py-2 ml-2",onClick:()=>L(C)},{default:t(()=>[e(X,{name:"lucide:minus",color:"white",size:"15px"})]),_:2},1032,["onClick"])]),o("div",Ws,[e(m,{class:"my-1"})])]))),128))])]),_:1})]),_:1}),e(Ce)]),_:1})])):S("",!0)}}});export{Lo as _,Fo as a,xe as u};
