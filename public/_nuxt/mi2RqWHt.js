import{_ as J}from"./Bmr5wyhr.js";import{_ as K,a as Q,b as W}from"./CNLsaPwj.js";import{_ as X}from"./BCRlC5xu.js";import{_ as Y,a as Z,s as tt,b as et}from"./CzdNxZn3.js";import{_ as st,a as at,b as ot}from"./DkMjgWCi.js";import{_ as it}from"./mqOaxR0N.js";import{_ as lt,a as nt,b as pt,c as ut,d as mt}from"./B-kig6KZ.js";import{_ as rt}from"./BqmAL8DW.js";import{_ as _t}from"./Pvv-dh1L.js";import{e as dt,g as ct,u as ft,r as l,B as V,i as vt,c as C,a as n,b as e,w as s,m as M,l as yt,o as f,d as u,t as gt,D as B}from"./LcRD3ia0.js";import{u as F}from"./Dt19OLxm.js";import"./D8Osd5Ax.js";import"./DfRdkKc3.js";import"./D5ydJhlK.js";import"./D9TSNOAg.js";import"./DkkQ8vn7.js";import"./D8EW8v7U.js";import"./BdQOAs7V.js";import"./BOGtf0gU.js";import"./QkXyQO2w.js";import"./BcuVElyA.js";import"./ClQAoZ75.js";import"./CACSUplU.js";import"./xEZuT4Nf.js";import"./BcyKike4.js";import"./AeDsR3BR.js";import"./CCJdEHHg.js";import"./Da2JRHOT.js";import"./BsJBhgTW.js";import"./BUo7Dhyt.js";import"./BXoTK-I8.js";import"./Df1Q6CGn.js";import"./DSl2Rovl.js";import"./D6LOIvye.js";const wt={class:"relative h-screen hidden-scrollbar"},xt={class:"w-full fixed z-10"},St={class:"h-full flex flex-col p-4 gap-2 mx-[auto] max-w-[2048px] pt-16 min-w-[1024px]"},Dt={class:"w-full flex gap-2"},Ut={class:"flex flex-col w-full gap-2"},$t={class:"flex gap-2"},bt={class:"flex items-center gap-2"},Vt={class:"flex items-center"},Ct={key:0,class:"ml-2"},Tt={key:1,class:"ml-2"},me=dt({__name:"index",setup(kt){const{$useApi:w}=ct();ft({title:"Закупки | Easy CRM"});const m=l(!1),i=l(new Date().toISOString().slice(0,7)),p=l("this_month"),x=l(F(0)+"₽"),S=l(['ООО "ТДВ ГРУПП"',"ИП Королёв"]),D=l([]),r=l([]),U={date:new Date().toISOString().slice(0,10),shipmentDate:"",supplier:"",paymentMethod:"Счет",orderStatus:"Оформлен заказ",paymentStatus:"Не оплачен",deliveryMethod:"Доставка от поставщика",invoice:"",track:"",positions:[{name:"",quantity:1,priceForItem:1,category:""}]},v=l(U),T=async()=>{const{data:a}=await w.get("supplies/suppliers");S.value=a.map(d=>d.name)||[];const{data:t}=await w.get("supplies/positions");D.value=t||[]},_=async()=>{const{data:a}=await w.get("supplies",{params:{period:i.value}});r.value=a||[],x.value=k(r.value.filter(t=>!!t.id).map(t=>t.id))},k=a=>{const d=r.value.filter(c=>a.includes(c.id)).reduce((c,$)=>c+$.positions.reduce((b,y)=>b+y.quantity*y.priceForItem,0),0);return F(+d.toFixed(2))+"₽"},N=a=>{m.value=!0,v.value=r.value.find(t=>t.id===a)||U};return V(p,()=>{if(p.value==="this_month"&&(i.value=new Date().toISOString().slice(0,7)),p.value==="yesterday"){const a=new Date,t=new Date(a);t.setDate(a.getDate()-1),i.value=t.toISOString().split("T")[0]}}),V(i,async()=>{await _()},{deep:!0}),V(m,async()=>{m.value||await _()}),vt(async()=>{await T(),await _()}),(a,t)=>{const d=J,c=X,$=W,b=Q,y=K,O=Y,g=ot,h=at,I=it,E=st,H=Z,L=nt,q=mt,A=rt,P=ut,j=et,z=_t,R=pt,G=lt;return f(),C("div",wt,[n("div",xt,[e(d)]),n("div",St,[n("div",Dt,[n("div",Ut,[e(y,null,{default:s(()=>[e(b,{class:"p-3 pb-2"},{default:s(()=>[e(c,null,{default:s(()=>t[8]||(t[8]=[u("Приобретено на сумму",-1)])),_:1,__:[8]}),e($,{class:"text-3xl font-semibold whitespace-nowrap"},{default:s(()=>[u(gt(x.value),1)]),_:1})]),_:1})]),_:1}),n("div",$t,[e(O,{suppliers:S.value,"positions-list":D.value,onSupplieCreated:t[0]||(t[0]=async()=>{await _(),await T()})},null,8,["suppliers","positions-list"]),e(E,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value=o),"default-value":"month"},{default:s(()=>[n("div",bt,[n("div",Vt,[e(h,null,{default:s(()=>[e(g,{value:"this_month"},{default:s(()=>t[9]||(t[9]=[u(" Этот месяц ",-1)])),_:1,__:[9]}),e(g,{value:"yesterday"},{default:s(()=>t[10]||(t[10]=[u(" Вчера ",-1)])),_:1,__:[10]}),e(g,{value:"month"},{default:s(()=>t[11]||(t[11]=[u(" Выбрать месяц ",-1)])),_:1,__:[11]}),e(g,{value:"day"},{default:s(()=>t[12]||(t[12]=[u(" Выбрать день ",-1)])),_:1,__:[12]})]),_:1}),p.value==="month"?(f(),C("div",Ct,[e(I,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=o=>i.value=o),type:"month"},null,8,["modelValue"])])):B("",!0),p.value==="day"?(f(),C("div",Tt,[e(I,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=o=>i.value=o),type:"date"},null,8,["modelValue"])])):B("",!0)])])]),_:1},8,["modelValue"])]),n("div",null,[(f(),M(H,{key:r.value.length,data:r.value,columns:yt(tt),onTableSorted:t[4]||(t[4]=o=>x.value=k(o)),onItemClicked:t[5]||(t[5]=o=>N(o))},null,8,["data","columns"]))])])]),e(G,{open:m.value,"onUpdate:open":t[7]||(t[7]=o=>m.value=o)},{default:s(()=>[e(L),e(R,{class:"max-w-[1200px] flex flex-col"},{default:s(()=>[e(P,null,{default:s(()=>[e(q,null,{default:s(()=>t[13]||(t[13]=[u("Редактировать статью",-1)])),_:1,__:[13]}),e(A)]),_:1}),(f(),M(j,{key:v.value.id,suppliers:S.value,supplie:v.value,"positions-list":D.value,onSupplieUpdated:t[6]||(t[6]=async()=>{m.value=!1,v.value=U,await _()})},null,8,["suppliers","supplie","positions-list"])),e(z)]),_:1})]),_:1},8,["open"])])])}}});export{me as default};
