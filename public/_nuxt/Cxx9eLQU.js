import{_ as ct}from"./CprHmdOe.js";import{_ as We}from"./CDst0A0O.js";import{y as ka,z as wa,A as Ca,o as $a,B as Mt,C as Va,E as Ia,p as Nt,r as Kt,j as Sa,F as Ge,V as Ta,e as Oe,P as Se,d as Ne,f as tt,g as _t,u as He,t as it,h as Xe,G as Aa,s as at,D as Ba,l as Ye,n as Ea,H as qa,k as Ua,_ as Da,a as Fa,b as Ma,c as La}from"./ZTyVILcU.js";import{S as jt,aA as Oa,O as Pa,c as Te,aB as Ra,aC as za}from"./B9M8ggfK.js";import{v as oe,r as T,B as we,a0 as Na,W as Ce,l as t,S as lt,e as le,m as H,o as d,x as _e,c as k,D as W,F as he,z as be,w as r,b as n,n as fe,J as nt,ar as Ue,k as xe,aq as Ka,i as Ve,be as ja,Q as Ha,H as Ke,E as Wa,d as U,p as xt,t as L,q as Ht,g as Pe,a as m,O as Je,U as Ga,A as Be,aT as ht,aU as Wt,ap as gt,y as et,C as kt,L as Gt,I as wt,aM as Xa,aj as yt,ak as Lt,h as Ya,f as Qa}from"./BbheI0mw.js";import{c as Ja}from"./D2GZmoDz.js";import{_ as Za,a as el,b as tl}from"./BF3m7Vf0.js";import{_ as al}from"./C8Hj2bae.js";import{_ as ll}from"./CHKwxJtM.js";import{_ as Ct}from"./C30fSUvl.js";import{P as nl,a as ol,b as sl,T as rl,_ as $t,c as il,d as ul,e as dl,u as Xt}from"./BR3DQNok.js";import{_ as Yt}from"./C5Bd_Bx3.js";import{_ as Vt,a as It,b as St,c as Tt,d as At}from"./JYeLPbKT.js";import{_ as Bt}from"./DLLw9AXE.js";import{_ as cl}from"./CaPtdwNj.js";import{_ as Qt}from"./DVdymwQ5.js";import{r as De,u as Jt}from"./s39mgViW.js";import{S as pl}from"./DAy9nm00.js";import{X as ut}from"./oLxPQbNe.js";import{_ as Et}from"./QXfa84Px.js";import{_ as fl}from"./D-8t_H8v.js";import{b as ml,_ as vl,a as hl}from"./DAmwS8V7.js";import{_ as gl,E as Ot}from"./CSgLdkbr.js";import{u as Zt}from"./DzJc7hp_.js";import yl from"./ROxBBV8N.js";import{_ as pt}from"./DlAUqK2U.js";import{_ as bl,a as _l,b as xl,c as kl,d as wl}from"./cStEOrWd.js";import{_ as Cl}from"./BHuR11Jx.js";import{_ as $l}from"./DiZ4QL0M.js";import{E as Vl}from"./BdpCbTaQ.js";function Pt(o){return typeof o=="string"?`'${o}'`:new Il().serialize(o)}const Il=function(){class o{#e=new Map;compare(e,l){const i=typeof e,u=typeof l;return i==="string"&&u==="string"?e.localeCompare(l):i==="number"&&u==="number"?e-l:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(l,!0))}serialize(e,l){if(e===null)return"null";switch(typeof e){case"string":return l?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const l=Object.prototype.toString.call(e);if(l!=="[object Object]")return this.serializeBuiltInType(l.length<10?`unknown:${l}`:l.slice(8,-1),e);const i=e.constructor,u=i===Object||i===void 0?"":i.name;if(u!==""&&globalThis[u]===i)return this.serializeBuiltInType(u,e);if(typeof e.toJSON=="function"){const g=e.toJSON();return u+(g!==null&&typeof g=="object"?this.$object(g):`(${this.serialize(g)})`)}return this.serializeObjectEntries(u,Object.entries(e))}serializeBuiltInType(e,l){const i=this["$"+e];if(i)return i.call(this,l);if(typeof l?.entries=="function")return this.serializeObjectEntries(e,l.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,l){const i=Array.from(l).sort((g,v)=>this.compare(g[0],v[0]));let u=`${e}{`;for(let g=0;g<i.length;g++){const[v,h]=i[g];u+=`${this.serialize(v,!0)}:${this.serialize(h)}`,g<i.length-1&&(u+=",")}return u+"}"}$object(e){let l=this.#e.get(e);return l===void 0&&(this.#e.set(e,`#${this.#e.size}`),l=this.serializeObject(e),this.#e.set(e,l)),l}$function(e){const l=Function.prototype.toString.call(e);return l.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${l.replace(/\s*\n\s*/g,"")}`}$Array(e){let l="[";for(let i=0;i<e.length;i++)l+=this.serialize(e[i]),i<e.length-1&&(l+=",");return l+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((l,i)=>this.compare(l,i)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const a of["Error","RegExp","URL"])o.prototype["$"+a]=function(e){return`${a}(${e})`};for(const a of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])o.prototype["$"+a]=function(e){return`${a}[${e.join(",")}]`};for(const a of["BigInt64Array","BigUint64Array"])o.prototype["$"+a]=function(e){return`${a}[${e.join("n,")}${e.length>0?"n":""}]`};return o}();function dt(o,a){return o===a||Pt(o)===Pt(a)}function Sl(o){return new URL(window.location.href)}/**
 * @license lucide-vue-next v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tl=Ja("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function Al(o,a,e){const l=o.findIndex(v=>dt(v,a)),i=o.findIndex(v=>dt(v,e));if(l===-1||i===-1)return[];const[u,g]=[l,i].sort((v,h)=>v-h);return o.slice(u,g+1)}const Bl=ka(()=>{const o=T(new Map),a=T(),e=oe(()=>{for(const g of o.value.values())if(g)return!0;return!1}),l=Ca({scrollBody:T(!0)});let i=null;const u=()=>{document.body.style.paddingRight="",document.body.style.marginRight="",document.body.style.pointerEvents="",document.documentElement.style.removeProperty("--scrollbar-width"),document.body.style.overflow=a.value??"",Mt&&i?.(),a.value=void 0};return we(e,(g,v)=>{if(!$a)return;if(!g){v&&u();return}a.value===void 0&&(a.value=document.body.style.overflow);const h=window.innerWidth-document.documentElement.clientWidth,I={padding:h,margin:0},V=l.scrollBody?.value?typeof l.scrollBody.value=="object"?Na({padding:l.scrollBody.value.padding===!0?h:l.scrollBody.value.padding,margin:l.scrollBody.value.margin===!0?h:l.scrollBody.value.margin},I):I:{padding:0,margin:0};h>0&&(document.body.style.paddingRight=typeof V.padding=="number"?`${V.padding}px`:String(V.padding),document.body.style.marginRight=typeof V.margin=="number"?`${V.margin}px`:String(V.margin),document.documentElement.style.setProperty("--scrollbar-width",`${h}px`),document.body.style.overflow="hidden"),Mt&&(i=Va(document,"touchmove",y=>ql(y),{passive:!1})),Ce(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})},{immediate:!0,flush:"sync"}),o});function El(o){const a=Math.random().toString(36).substring(2,7),e=Bl();e.value.set(a,o??!1);const l=oe({get:()=>e.value.get(a)??!1,set:i=>e.value.set(a,i)});return wa(()=>{e.value.delete(a)}),l}function ea(o){const a=window.getComputedStyle(o);if(a.overflowX==="scroll"||a.overflowY==="scroll"||a.overflowX==="auto"&&o.clientWidth<o.scrollWidth||a.overflowY==="auto"&&o.clientHeight<o.scrollHeight)return!0;{const e=o.parentNode;return!(e instanceof Element)||e.tagName==="BODY"?!1:ea(e)}}function ql(o){const a=o||window.event,e=a.target;return e instanceof Element&&ea(e)?!1:a.touches.length>1?!0:(a.preventDefault&&a.cancelable&&a.preventDefault(),!1)}function ta(o){const a=oe(()=>t(o)),e=oe(()=>new Intl.Collator("en",{usage:"search",...a.value}));return{startsWith:(g,v)=>v.length===0?!0:(g=g.normalize("NFC"),v=v.normalize("NFC"),e.value.compare(g.slice(0,v.length),v)===0),endsWith:(g,v)=>v.length===0?!0:(g=g.normalize("NFC"),v=v.normalize("NFC"),e.value.compare(g.slice(-v.length),v)===0),contains:(g,v)=>{if(v.length===0)return!0;g=g.normalize("NFC"),v=v.normalize("NFC");let h=0;const I=v.length;for(;h+I<=g.length;h++){const V=g.slice(h,h+I);if(e.value.compare(v,V)===0)return!0}return!1}}}function aa(o){return oe(()=>Ia(o)?!!Nt(o)?.closest("form"):!0)}var Ul=function(o){if(typeof document>"u")return null;var a=Array.isArray(o)?o[0]:o;return a.ownerDocument.body},je=new WeakMap,ot=new WeakMap,st={},vt=0,la=function(o){return o&&(o.host||la(o.parentNode))},Dl=function(o,a){return a.map(function(e){if(o.contains(e))return e;var l=la(e);return l&&o.contains(l)?l:(console.error("aria-hidden",e,"in not contained inside",o,". Doing nothing"),null)}).filter(function(e){return!!e})},Fl=function(o,a,e,l){var i=Dl(a,Array.isArray(o)?o:[o]);st[e]||(st[e]=new WeakMap);var u=st[e],g=[],v=new Set,h=new Set(i),I=function(y){!y||v.has(y)||(v.add(y),I(y.parentNode))};i.forEach(I);var V=function(y){!y||h.has(y)||Array.prototype.forEach.call(y.children,function(x){if(v.has(x))V(x);else try{var b=x.getAttribute(l),C=b!==null&&b!=="false",A=(je.get(x)||0)+1,N=(u.get(x)||0)+1;je.set(x,A),u.set(x,N),g.push(x),A===1&&C&&ot.set(x,!0),N===1&&x.setAttribute(e,"true"),C||x.setAttribute(l,"true")}catch(j){console.error("aria-hidden: cannot operate on ",x,j)}})};return V(a),v.clear(),vt++,function(){g.forEach(function(y){var x=je.get(y)-1,b=u.get(y)-1;je.set(y,x),u.set(y,b),x||(ot.has(y)||y.removeAttribute(l),ot.delete(y)),b||y.removeAttribute(e)}),vt--,vt||(je=new WeakMap,je=new WeakMap,ot=new WeakMap,st={})}},Ml=function(o,a,e){e===void 0&&(e="data-aria-hidden");var l=Array.from(Array.isArray(o)?o:[o]),i=Ul(o);return i?(l.push.apply(l,Array.from(i.querySelectorAll("[aria-live], script"))),Fl(l,i,e,"aria-hidden")):function(){return null}};function Ll(o){let a;we(()=>Nt(o),e=>{e?a=Ml(e):a&&a()}),lt(()=>{a&&a()})}function Ol(){return{ALT:"Alt",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",BACKSPACE:"Backspace",CAPS_LOCK:"CapsLock",CONTROL:"Control",DELETE:"Delete",END:"End",ENTER:"Enter",ESCAPE:"Escape",F1:"F1",F10:"F10",F11:"F11",F12:"F12",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",HOME:"Home",META:"Meta",PAGE_DOWN:"PageDown",PAGE_UP:"PageUp",SHIFT:"Shift",SPACE:" ",TAB:"Tab",CTRL:"Control",ASTERISK:"*",SPACE_CODE:"Space"}}function Pl(o){const a=Kt("",1e3);return{search:a,handleTypeaheadSearch:(i,u)=>{a.value=a.value+i;{const g=Sa(),v=u.map(x=>({...x,textValue:x.value?.textValue??x.ref.textContent?.trim()??""})),h=v.find(x=>x.ref===g),I=v.map(x=>x.textValue),V=zl(I,a.value,h?.textValue),y=v.find(x=>x.textValue===V);return y&&y.ref.focus(),y?.ref}},resetTypeahead:()=>{a.value=""}}}function Rl(o,a){return o.map((e,l)=>o[(a+l)%o.length])}function zl(o,a,e){const i=a.length>1&&Array.from(a).every(I=>I===a[0])?a[0]:a,u=e?o.indexOf(e):-1;let g=Rl(o,Math.max(u,0));i.length===1&&(g=g.filter(I=>I!==e));const h=g.find(I=>I.toLowerCase().startsWith(i.toLowerCase()));return h!==e?h:void 0}const Nl={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Kl(o,a){return a!=="rtl"?o:o==="ArrowLeft"?"ArrowRight":o==="ArrowRight"?"ArrowLeft":o}function jl(o,a,e){const l=Kl(o.key,e);if(!(a==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(a==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return Nl[l]}var Hl=le({inheritAttrs:!1,__name:"VisuallyHiddenInputBubble",props:{name:{type:String,required:!0},value:{type:null,required:!0},checked:{type:Boolean,required:!1,default:void 0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},feature:{type:String,required:!1,default:"fully-hidden"}},setup(o){const a=o,{primitiveElement:e,currentElement:l}=Ge(),i=oe(()=>a.checked??a.value);return we(i,(u,g)=>{if(!l.value)return;const v=l.value,h=window.HTMLInputElement.prototype,V=Object.getOwnPropertyDescriptor(h,"value").set;if(V&&u!==g){const y=new Event("input",{bubbles:!0}),x=new Event("change",{bubbles:!0});V.call(v,u),v.dispatchEvent(y),v.dispatchEvent(x)}}),(u,g)=>(d(),H(Ta,_e({ref_key:"primitiveElement",ref:e},{...a,...u.$attrs},{as:"input"}),null,16))}}),Rt=Hl,Wl=le({inheritAttrs:!1,__name:"VisuallyHiddenInput",props:{name:{type:String,required:!0},value:{type:null,required:!0},checked:{type:Boolean,required:!1,default:void 0},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},feature:{type:String,required:!1,default:"fully-hidden"}},setup(o){const a=o,e=oe(()=>typeof a.value=="object"&&Array.isArray(a.value)&&a.value.length===0&&a.required),l=oe(()=>typeof a.value=="string"||typeof a.value=="number"||typeof a.value=="boolean"||a.value===null||a.value===void 0?[{name:a.name,value:a.value}]:typeof a.value=="object"&&Array.isArray(a.value)?a.value.flatMap((i,u)=>typeof i=="object"?Object.entries(i).map(([g,v])=>({name:`${a.name}[${u}][${g}]`,value:v})):{name:`${a.name}[${u}]`,value:i}):a.value!==null&&typeof a.value=="object"&&!Array.isArray(a.value)?Object.entries(a.value).map(([i,u])=>({name:`${a.name}[${i}]`,value:u})):[]);return(i,u)=>(d(),k(he,null,[W(" We render single input if it's required "),e.value?(d(),H(Rt,_e({key:i.name},{...a,...i.$attrs},{name:i.name,value:i.value}),null,16,["name","value"])):(d(!0),k(he,{key:1},be(l.value,g=>(d(),H(Rt,_e({key:g.name},{ref_for:!0},{...a,...i.$attrs},{name:g.name,value:g.value}),null,16,["name","value"]))),128))],2112))}}),na=Wl,Gl=le({__name:"ComboboxAnchor",props:{reference:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(o){const{forwardRef:a}=Oe();return(e,l)=>(d(),H(t(nl),{"as-child":"",reference:e.reference},{default:r(()=>[n(t(Se),_e({ref:t(a),"as-child":e.asChild,as:e.as},e.$attrs),{default:r(()=>[fe(e.$slots,"default")]),_:3},16,["as-child","as"])]),_:3},8,["reference"]))}}),Xl=Gl;function Yl(o,a,e){return o===void 0?!1:Array.isArray(o)?o.some(l=>Ze(l,a,e)):Ze(o,a,e)}function Ze(o,a,e){return o===void 0||a===void 0?!1:typeof o=="string"?o===a:typeof e=="function"?e(o,a):typeof e=="string"?o?.[e]===a?.[e]:dt(o,a)}const[ft,Ql]=Ne("ListboxRoot");var Jl=le({__name:"ListboxRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},multiple:{type:Boolean,required:!1},orientation:{type:String,required:!1,default:"vertical"},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},selectionBehavior:{type:String,required:!1,default:"toggle"},highlightOnHover:{type:Boolean,required:!1},by:{type:[String,Function],required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:modelValue","highlight","entryFocus","leave"],setup(o,{expose:a,emit:e}){const l=o,i=e,{multiple:u,highlightOnHover:g,orientation:v,disabled:h,selectionBehavior:I,dir:V}=nt(l),{getItems:y}=tt({isProvider:!0}),{handleTypeaheadSearch:x}=Pl(),{primitiveElement:b,currentElement:C}=Ge(),A=Ol(),N=_t(V),j=aa(C),B=T(),pe=T(!1),R=T(!0),Y=He(l,"modelValue",i,{defaultValue:l.defaultValue??(u.value?[]:void 0),passive:l.modelValue===void 0,deep:!0});function ge(f){if(pe.value=!0,l.multiple){const s=Array.isArray(Y.value)?[...Y.value]:[],E=s.findIndex(q=>Ze(q,f,l.by));l.selectionBehavior==="toggle"?(E===-1?s.push(f):s.splice(E,1),Y.value=s):(Y.value=[f],B.value=f)}else l.selectionBehavior==="toggle"&&Ze(Y.value,f,l.by)?Y.value=void 0:Y.value=f;setTimeout(()=>{pe.value=!1},1)}const te=T(null),G=T(null),z=T(!1),S=T(!1),c=it(),P=it(),Q=it();function Z(){return y().map(f=>f.ref).filter(f=>f.dataset.disabled!=="")}function X(f,s=!0){if(!f)return;te.value=f,R.value&&te.value.focus(),s&&te.value.scrollIntoView({block:"nearest"});const E=y().find(q=>q.ref===f);i("highlight",E)}function D(f){if(z.value)Q.trigger(f);else{const s=y().find(E=>Ze(E.value,f,l.by));s&&(te.value=s.ref,X(s.ref))}}function se(f){te.value&&te.value.isConnected&&(f.preventDefault(),f.stopPropagation(),S.value||te.value.click())}function _(f){if(R.value){if(pe.value=!0,z.value)P.trigger(f);else{const s=f.altKey||f.ctrlKey||f.metaKey;if(s&&f.key==="a"&&u.value){const E=y(),q=E.map(ae=>ae.value);Y.value=[...q],f.preventDefault(),X(E[E.length-1].ref)}else if(!s){const E=x(f.key,y());E&&X(E)}}setTimeout(()=>{pe.value=!1},1)}}function F(){S.value=!0}function ne(){Ce(()=>{S.value=!1})}function ue(){Ce(()=>{const f=new KeyboardEvent("keydown",{key:"PageUp"});$e(f)})}function ve(f){const s=te.value;s?.isConnected&&(G.value=s),te.value=null,i("leave",f)}function Ie(f){const s=new CustomEvent("listbox.entryFocus",{bubbles:!1,cancelable:!0});if(f.currentTarget?.dispatchEvent(s),i("entryFocus",s),!s.defaultPrevented)if(G.value)X(G.value);else{const E=Z()?.[0];X(E)}}function $e(f){const s=jl(f,v.value,N.value);if(!s)return;let E=Z();if(te.value){if(s==="last")E.reverse();else if(s==="prev"||s==="next"){s==="prev"&&E.reverse();const q=E.indexOf(te.value);E=E.slice(q+1)}M(f,E[0])}if(E.length){const q=!te.value&&s==="prev"?E.length-1:0;X(E[q])}if(z.value)return P.trigger(f)}function M(f,s){if(!(z.value||l.selectionBehavior!=="replace"||!u.value||!Array.isArray(Y.value)||(f.altKey||f.ctrlKey||f.metaKey)&&!f.shiftKey)&&f.shiftKey){const q=y().filter(ye=>ye.ref.dataset.disabled!=="");let ae=q.find(ye=>ye.ref===s)?.value;if(f.key===A.END?ae=q[q.length-1].value:f.key===A.HOME&&(ae=q[0].value),!ae||!B.value)return;const me=Al(q.map(ye=>ye.value),B.value,ae);Y.value=me}}async function p(f){if(await Ce(),z.value)c.trigger(f);else{const s=Z(),E=s.find(q=>q.dataset.state==="checked");E?X(E):s.length&&X(s[0])}}return we(Y,()=>{pe.value||Ce(()=>{p()})},{immediate:!0,deep:!0}),a({highlightedElement:te,highlightItem:D,highlightFirstItem:ue,highlightSelected:p,getItems:y}),Ql({modelValue:Y,onValueChange:ge,multiple:u,orientation:v,dir:N,disabled:h,highlightOnHover:g,highlightedElement:te,isVirtual:z,virtualFocusHook:c,virtualKeydownHook:P,virtualHighlightHook:Q,by:l.by,firstValue:B,selectionBehavior:I,focusable:R,onLeave:ve,onEnter:Ie,changeHighlight:X,onKeydownEnter:se,onKeydownNavigation:$e,onKeydownTypeAhead:_,onCompositionStart:F,onCompositionEnd:ne,highlightFirstItem:ue}),(f,s)=>(d(),H(t(Se),{ref_key:"primitiveElement",ref:b,as:f.as,"as-child":f.asChild,dir:t(N),"data-disabled":t(h)?"":void 0,onPointerleave:ve,onFocusout:s[0]||(s[0]=async E=>{const q=E.relatedTarget||E.target;await Ce(),te.value&&t(C)&&!t(C).contains(q)&&ve(E)})},{default:r(()=>[fe(f.$slots,"default",{modelValue:t(Y)}),t(j)&&f.name?(d(),H(t(na),{key:0,name:f.name,value:t(Y),disabled:t(h),required:f.required},null,8,["name","value","disabled","required"])):W("v-if",!0)]),_:3},8,["as","as-child","dir","data-disabled"]))}}),Zl=Jl,en=le({__name:"ListboxContent",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(o){const{CollectionSlot:a}=tt(),e=ft(),l=Kt(!1,10);return(i,u)=>(d(),H(t(a),null,{default:r(()=>[n(t(Se),{role:"listbox",as:i.as,"as-child":i.asChild,tabindex:t(e).focusable.value?t(e).highlightedElement.value?"-1":"0":void 0,"aria-orientation":t(e).orientation.value,"aria-multiselectable":!!t(e).multiple.value,"data-orientation":t(e).orientation.value,onMousedown:u[0]||(u[0]=xe(g=>l.value=!0,["left"])),onFocus:u[1]||(u[1]=g=>{t(l)||t(e).onEnter(g)}),onKeydown:[u[2]||(u[2]=Ue(xe(g=>{t(e).focusable.value&&t(e).onKeydownNavigation(g)},["prevent"]),["down","up","left","right","home","end"])),Ue(t(e).onKeydownEnter,["enter"]),t(e).onKeydownTypeAhead]},{default:r(()=>[fe(i.$slots,"default")]),_:3},8,["as","as-child","tabindex","aria-orientation","aria-multiselectable","data-orientation","onKeydown"])]),_:3}))}}),tn=en,an=le({__name:"ListboxFilter",props:{modelValue:{type:String,required:!1},autoFocus:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"input"}},emits:["update:modelValue"],setup(o,{emit:a}){const e=o,i=He(e,"modelValue",a,{defaultValue:"",passive:e.modelValue===void 0}),u=ft(),{primitiveElement:g,currentElement:v}=Ge(),h=oe(()=>e.disabled||u.disabled.value||!1),I=T();return Ka(()=>I.value=u.highlightedElement.value?.id),Ve(()=>{u.focusable.value=!1,setTimeout(()=>{e.autoFocus&&v.value?.focus()},1)}),lt(()=>{u.focusable.value=!0}),(V,y)=>(d(),H(t(Se),{ref_key:"primitiveElement",ref:g,as:V.as,"as-child":V.asChild,value:t(i),disabled:h.value?"":void 0,"data-disabled":h.value?"":void 0,"aria-disabled":h.value??void 0,"aria-activedescendant":I.value,type:"text",onKeydown:[Ue(xe(t(u).onKeydownNavigation,["prevent"]),["down","up","home","end"]),Ue(t(u).onKeydownEnter,["enter"])],onInput:y[0]||(y[0]=x=>{i.value=x.target.value,t(u).highlightFirstItem()}),onCompositionstart:t(u).onCompositionStart,onCompositionend:t(u).onCompositionEnd},{default:r(()=>[fe(V.$slots,"default",{modelValue:t(i)})]),_:3},8,["as","as-child","value","disabled","data-disabled","aria-disabled","aria-activedescendant","onKeydown","onCompositionstart","onCompositionend"]))}}),ln=an;const[Ru,nn]=Ne("ListboxGroup");var on=le({__name:"ListboxGroup",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(o){const a=o,e=Xe(void 0,"reka-listbox-group");return nn({id:e}),(l,i)=>(d(),H(t(Se),_e({role:"group"},a,{"aria-labelledby":t(e)}),{default:r(()=>[fe(l.$slots,"default")]),_:3},16,["aria-labelledby"]))}}),sn=on;const rn="listbox.select",[zu,un]=Ne("ListboxItem");var dn=le({__name:"ListboxItem",props:{value:{type:null,required:!0},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"div"}},emits:["select"],setup(o,{emit:a}){const e=o,l=a,i=Xe(void 0,"reka-listbox-item"),{CollectionItem:u}=tt(),{forwardRef:g,currentElement:v}=Oe(),h=ft(),I=oe(()=>v.value===h.highlightedElement.value),V=oe(()=>Yl(h.modelValue.value,e.value,h.by)),y=oe(()=>h.disabled.value||e.disabled);async function x(C){l("select",C),!C?.defaultPrevented&&!y.value&&C&&(h.onValueChange(e.value),h.changeHighlight(v.value))}function b(C){const A={originalEvent:C,value:e.value};Aa(rn,x,A)}return un({isSelected:V}),(C,A)=>(d(),H(t(u),{value:C.value},{default:r(()=>[ja([I.value,V.value],()=>n(t(Se),_e({id:t(i)},C.$attrs,{ref:t(g),role:"option",tabindex:t(h).focusable.value?I.value?"0":"-1":-1,"aria-selected":V.value,as:C.as,"as-child":C.asChild,disabled:y.value?"":void 0,"data-disabled":y.value?"":void 0,"data-highlighted":I.value?"":void 0,"data-state":V.value?"checked":"unchecked",onClick:b,onKeydown:Ue(xe(b,["prevent"]),["space"]),onPointermove:A[0]||(A[0]=N=>{t(h).highlightedElement.value!==t(v)&&(t(h).highlightOnHover.value?t(h).changeHighlight(t(v),!1):t(h).focusable.value||t(h).changeHighlight(t(v),!1))})}),{default:r(()=>[fe(C.$slots,"default")]),_:3},16,["id","tabindex","aria-selected","as","as-child","disabled","data-disabled","data-highlighted","data-state","onKeydown"]),A,1)]),_:3},8,["value"]))}}),cn=dn;const[Qe,pn]=Ne("ComboboxRoot");var fn=le({__name:"ComboboxRoot",props:{open:{type:Boolean,required:!1,default:void 0},defaultOpen:{type:Boolean,required:!1},resetSearchTermOnBlur:{type:Boolean,required:!1,default:!0},resetSearchTermOnSelect:{type:Boolean,required:!1,default:!0},openOnFocus:{type:Boolean,required:!1,default:!1},openOnClick:{type:Boolean,required:!1,default:!1},ignoreFilter:{type:Boolean,required:!1},modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},multiple:{type:Boolean,required:!1},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},highlightOnHover:{type:Boolean,required:!1},by:{type:[String,Function],required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:modelValue","highlight","update:open"],setup(o,{expose:a,emit:e}){const l=o,i=e,{primitiveElement:u,currentElement:g}=Ge(),{multiple:v,disabled:h,ignoreFilter:I,resetSearchTermOnSelect:V,openOnFocus:y,openOnClick:x,dir:b}=nt(l),C=_t(b),A=He(l,"modelValue",i,{defaultValue:l.defaultValue??(v.value?[]:void 0),passive:l.modelValue===void 0,deep:!0}),N=He(l,"open",i,{defaultValue:l.defaultOpen,passive:l.open===void 0});async function j(Z){N.value=Z,c.value="",Z?(await Ce(),u.value?.highlightSelected(),pe.value=!0):pe.value=!1,Y.value?.focus(),setTimeout(()=>{!Z&&l.resetSearchTermOnBlur&&B.trigger()},1)}const B=it(),pe=T(!1),R=T(!1),Y=T(),ge=T(),te=oe(()=>u.value?.highlightedElement??void 0),G=T(new Map),z=T(new Map),{contains:S}=ta({sensitivity:"base"}),c=T(""),P=oe(Z=>{if(!c.value||l.ignoreFilter||R.value)return{count:G.value.size,items:Z?.items??new Map,groups:Z?.groups??new Set(z.value.keys())};let X=0;const D=new Map,se=new Set;for(const[_,F]of G.value){const ne=S(F,c.value);D.set(_,ne?1:0),ne&&X++}for(const[_,F]of z.value)for(const ne of F)if(D.get(ne)>0){se.add(_);break}return{count:X,items:D,groups:se}}),Q=Ha();return Ve(()=>{Q?.exposed&&(Q.exposed.highlightItem=u.value?.highlightItem,Q.exposed.highlightFirstItem=u.value?.highlightFirstItem,Q.exposed.highlightSelected=u.value?.highlightSelected)}),a({filtered:P,highlightedElement:te,highlightItem:u.value?.highlightItem,highlightFirstItem:u.value?.highlightFirstItem,highlightSelected:u.value?.highlightSelected}),pn({modelValue:A,multiple:v,disabled:h,open:N,onOpenChange:j,contentId:"",isUserInputted:pe,isVirtual:R,inputElement:Y,highlightedElement:te,onInputElementChange:Z=>Y.value=Z,triggerElement:ge,onTriggerElementChange:Z=>ge.value=Z,parentElement:g,resetSearchTermOnSelect:V,onResetSearchTerm:B.on,allItems:G,allGroups:z,filterSearch:c,filterState:P,ignoreFilter:I,openOnFocus:y,openOnClick:x}),(Z,X)=>(d(),H(t(ol),null,{default:r(()=>[n(t(Zl),_e({ref_key:"primitiveElement",ref:u},Z.$attrs,{modelValue:t(A),"onUpdate:modelValue":X[0]||(X[0]=D=>Ke(A)?A.value=D:null),style:{pointerEvents:t(N)?"auto":void 0},as:Z.as,"as-child":Z.asChild,dir:t(C),multiple:t(v),name:Z.name,required:Z.required,disabled:t(h),"highlight-on-hover":!0,by:l.by,onHighlight:X[1]||(X[1]=D=>i("highlight",D))}),{default:r(()=>[fe(Z.$slots,"default",{open:t(N),modelValue:t(A)})]),_:3},16,["modelValue","style","as","as-child","dir","multiple","name","required","disabled","by"])]),_:3}))}}),mn=fn;const[Nu,vn]=Ne("ComboboxContent");var hn=le({__name:"ComboboxContentImpl",props:{position:{type:String,required:!1,default:"inline"},bodyLock:{type:Boolean,required:!1},side:{type:null,required:!1},sideOffset:{type:Number,required:!1},sideFlip:{type:Boolean,required:!1},align:{type:null,required:!1},alignOffset:{type:Number,required:!1},alignFlip:{type:Boolean,required:!1},avoidCollisions:{type:Boolean,required:!1},collisionBoundary:{type:null,required:!1},collisionPadding:{type:[Number,Object],required:!1},arrowPadding:{type:Number,required:!1},sticky:{type:String,required:!1},hideWhenDetached:{type:Boolean,required:!1},positionStrategy:{type:String,required:!1},updatePositionStrategy:{type:String,required:!1},disableUpdateOnLayoutShift:{type:Boolean,required:!1},prioritizePosition:{type:Boolean,required:!1},reference:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},disableOutsidePointerEvents:{type:Boolean,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside"],setup(o,{emit:a}){const e=o,l=a,{position:i}=nt(e),u=Qe(),{forwardRef:g,currentElement:v}=Oe();El(e.bodyLock),Ll(u.parentElement);const h=oe(()=>e.position==="popper"?e:{}),I=at(h.value),V={boxSizing:"border-box","--reka-combobox-content-transform-origin":"var(--reka-popper-transform-origin)","--reka-combobox-content-available-width":"var(--reka-popper-available-width)","--reka-combobox-content-available-height":"var(--reka-popper-available-height)","--reka-combobox-trigger-width":"var(--reka-popper-anchor-width)","--reka-combobox-trigger-height":"var(--reka-popper-anchor-height)"};vn({position:i});const y=T(!1);return Ve(()=>{u.inputElement.value&&(y.value=v.value.contains(u.inputElement.value),y.value&&u.inputElement.value.focus())}),lt(()=>{y.value&&u.triggerElement.value?.focus()}),(x,b)=>(d(),H(t(tn),{"as-child":""},{default:r(()=>[n(t(Ba),{"as-child":"","disable-outside-pointer-events":x.disableOutsidePointerEvents,onDismiss:b[0]||(b[0]=C=>t(u).onOpenChange(!1)),onFocusOutside:b[1]||(b[1]=C=>{t(u).parentElement.value?.contains(C.target)&&C.preventDefault(),l("focusOutside",C)}),onInteractOutside:b[2]||(b[2]=C=>l("interactOutside",C)),onEscapeKeyDown:b[3]||(b[3]=C=>l("escapeKeyDown",C)),onPointerDownOutside:b[4]||(b[4]=C=>{t(u).parentElement.value?.contains(C.target)&&C.preventDefault(),l("pointerDownOutside",C)})},{default:r(()=>[(d(),H(Wa(t(i)==="popper"?t(sl):t(Se)),_e({...x.$attrs,...t(I)},{id:t(u).contentId,ref:t(g),"data-state":t(u).open.value?"open":"closed",style:{display:"flex",flexDirection:"column",outline:"none",...t(i)==="popper"?V:{}}}),{default:r(()=>[fe(x.$slots,"default")]),_:3},16,["id","data-state","style"]))]),_:3},8,["disable-outside-pointer-events"])]),_:3}))}}),gn=hn,yn=le({__name:"ComboboxContent",props:{forceMount:{type:Boolean,required:!1},position:{type:String,required:!1},bodyLock:{type:Boolean,required:!1},side:{type:null,required:!1},sideOffset:{type:Number,required:!1},sideFlip:{type:Boolean,required:!1},align:{type:null,required:!1},alignOffset:{type:Number,required:!1},alignFlip:{type:Boolean,required:!1},avoidCollisions:{type:Boolean,required:!1},collisionBoundary:{type:null,required:!1},collisionPadding:{type:[Number,Object],required:!1},arrowPadding:{type:Number,required:!1},sticky:{type:String,required:!1},hideWhenDetached:{type:Boolean,required:!1},positionStrategy:{type:String,required:!1},updatePositionStrategy:{type:String,required:!1},disableUpdateOnLayoutShift:{type:Boolean,required:!1},prioritizePosition:{type:Boolean,required:!1},reference:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},disableOutsidePointerEvents:{type:Boolean,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside"],setup(o,{emit:a}){const i=Ye(o,a),{forwardRef:u}=Oe(),g=Qe();return g.contentId||=Xe(void 0,"reka-combobox-content"),(v,h)=>(d(),H(t(Ea),{present:v.forceMount||t(g).open.value},{default:r(()=>[n(gn,_e({...t(i),...v.$attrs},{ref:t(u)}),{default:r(()=>[fe(v.$slots,"default")]),_:3},16)]),_:3},8,["present"]))}}),bn=yn,_n=le({__name:"ComboboxEmpty",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(o){const a=o,e=Qe(),l=oe(()=>e.ignoreFilter.value?e.allItems.value.size===0:e.filterState.value.count===0);return(i,u)=>l.value?(d(),H(t(Se),xt(_e({key:0},a)),{default:r(()=>[fe(i.$slots,"default",{},()=>[u[0]||(u[0]=U("No options"))])]),_:3},16)):W("v-if",!0)}}),xn=_n;const[oa,kn]=Ne("ComboboxGroup");var wn=le({__name:"ComboboxGroup",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(o){const a=o,e=Xe(void 0,"reka-combobox-group"),l=Qe(),i=oe(()=>l.ignoreFilter.value?!0:l.filterSearch.value?l.filterState.value.groups.has(e):!0),u=kn({id:e,labelId:""});return Ve(()=>{l.allGroups.value.has(e)||l.allGroups.value.set(e,new Set)}),lt(()=>{l.allGroups.value.delete(e)}),(g,v)=>(d(),H(t(sn),_e({id:t(e),"aria-labelledby":t(u).labelId},a,{hidden:i.value?void 0:!0}),{default:r(()=>[fe(g.$slots,"default")]),_:3},16,["id","aria-labelledby","hidden"]))}}),Cn=wn,$n=le({__name:"ComboboxInput",props:{displayValue:{type:Function,required:!1},modelValue:{type:String,required:!1},autoFocus:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"input"}},emits:["update:modelValue"],setup(o,{emit:a}){const e=o,l=a,i=Qe(),u=ft(),{primitiveElement:g,currentElement:v}=Ge(),h=He(e,"modelValue",l,{passive:e.modelValue===void 0});Ve(()=>{v.value&&i.onInputElementChange(v.value)});function I(C){i.open.value||i.onOpenChange(!0)}function V(C){const A=C.target;i.open.value?i.filterSearch.value=A.value:(i.onOpenChange(!0),Ce(()=>{A.value&&(i.filterSearch.value=A.value,u.highlightFirstItem())}))}function y(){i.openOnFocus.value&&!i.open.value&&i.onOpenChange(!0)}function x(){i.openOnClick.value&&!i.open.value&&i.onOpenChange(!0)}function b(){const C=i.modelValue.value;e.displayValue?h.value=e.displayValue(C):!i.multiple.value&&C&&!Array.isArray(C)&&typeof C!="object"?h.value=C.toString():h.value="",Ce(()=>{h.value=h.value})}return i.onResetSearchTerm(()=>{b()}),we(i.modelValue,async()=>{!i.isUserInputted.value&&i.resetSearchTermOnSelect.value&&b()},{immediate:!0,deep:!0}),we(i.filterState,()=>{i.isVirtual.value||u.highlightFirstItem()}),(C,A)=>(d(),H(t(ln),{ref_key:"primitiveElement",ref:g,modelValue:t(h),"onUpdate:modelValue":A[0]||(A[0]=N=>Ke(h)?h.value=N:null),as:C.as,"as-child":C.asChild,"auto-focus":C.autoFocus,disabled:C.disabled,"aria-expanded":t(i).open.value,"aria-controls":t(i).contentId,"aria-autocomplete":"list",role:"combobox",autocomplete:"off",onClick:x,onInput:V,onKeydown:Ue(xe(I,["prevent"]),["down","up"]),onFocus:y},{default:r(()=>[fe(C.$slots,"default")]),_:3},8,["modelValue","as","as-child","auto-focus","disabled","aria-expanded","aria-controls","onKeydown"]))}}),Vn=$n,In=le({__name:"ComboboxItem",props:{textValue:{type:String,required:!1},value:{type:null,required:!0},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["select"],setup(o,{emit:a}){const e=o,l=a,i=Xe(void 0,"reka-combobox-item"),u=Qe(),g=oa(null),{primitiveElement:v,currentElement:h}=Ge();if(e.value==="")throw new Error("A <ComboboxItem /> must have a value prop that is not an empty string. This is because the Combobox value can be set to an empty string to clear the selection and show the placeholder.");const I=oe(()=>{if(u.isVirtual.value||u.ignoreFilter.value||!u.filterSearch.value)return!0;{const V=u.filterState.value.items.get(i);return V===void 0?!0:V>0}});return Ve(()=>{u.allItems.value.set(i,e.textValue||h.value.textContent||h.value.innerText);const V=g?.id;V&&(u.allGroups.value.has(V)?u.allGroups.value.get(V)?.add(i):u.allGroups.value.set(V,new Set([i])))}),lt(()=>{u.allItems.value.delete(i)}),(V,y)=>I.value?(d(),H(t(cn),_e({key:0},e,{id:t(i),ref_key:"primitiveElement",ref:v,disabled:t(u).disabled.value||V.disabled,onSelect:y[0]||(y[0]=x=>{l("select",x),!x.defaultPrevented&&!t(u).multiple.value&&!V.disabled&&!t(u).disabled.value&&(x.preventDefault(),t(u).onOpenChange(!1),t(u).modelValue.value=e.value)})}),{default:r(()=>[fe(V.$slots,"default",{},()=>[U(L(V.value),1)])]),_:3},16,["id","disabled"])):W("v-if",!0)}}),Sn=In,Tn=le({__name:"ComboboxLabel",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"div"}},setup(o){const a=o;Oe();const e=oa({id:"",labelId:""});return e.labelId||=Xe(void 0,"reka-combobox-group-label"),(l,i)=>(d(),H(t(Se),_e(a,{id:t(e).labelId}),{default:r(()=>[fe(l.$slots,"default")]),_:3},16,["id"]))}}),An=Tn,Bn=le({__name:"ComboboxPortal",props:{to:{type:null,required:!1},disabled:{type:Boolean,required:!1},defer:{type:Boolean,required:!1},forceMount:{type:Boolean,required:!1}},setup(o){const a=o;return(e,l)=>(d(),H(t(rl),xt(Ht(a)),{default:r(()=>[fe(e.$slots,"default")]),_:3},16))}}),En=Bn;const[qt,qn]=Ne("TagsInputRoot");var Un=le({__name:"TagsInputRoot",props:{modelValue:{type:[Array,null],required:!1},defaultValue:{type:Array,required:!1,default:()=>[]},addOnPaste:{type:Boolean,required:!1},addOnTab:{type:Boolean,required:!1},addOnBlur:{type:Boolean,required:!1},duplicate:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},delimiter:{type:null,required:!1,default:","},dir:{type:String,required:!1},max:{type:Number,required:!1,default:0},id:{type:String,required:!1},convertValue:{type:Function,required:!1},displayValue:{type:Function,required:!1,default:o=>o.toString()},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:modelValue","invalid","addTag","removeTag"],setup(o,{emit:a}){const e=o,l=a,{addOnPaste:i,disabled:u,delimiter:g,max:v,id:h,dir:I,addOnBlur:V,addOnTab:y}=nt(e),x=_t(I),b=He(e,"modelValue",l,{defaultValue:e.defaultValue,passive:!0,deep:!0}),{forwardRef:C,currentElement:A}=Oe(),{focused:N}=qa(A),j=aa(A),{getItems:B,CollectionSlot:pe}=tt({isProvider:!0}),R=T(),Y=T(!1),ge=oe(()=>Array.isArray(b.value)?[...b.value]:[]);function te(G){if(G!==-1){const z=B().filter(S=>S.ref.dataset.disabled!=="");b.value=b.value.filter((S,c)=>c!==G),l("removeTag",z[G].value)}}return qn({modelValue:b,onAddValue:G=>{const z=[...ge.value],S=z.length>0&&typeof z[0]=="object",c=z.length>0&&typeof e.defaultValue[0]=="object";if((S||c)&&typeof e.convertValue!="function")throw new Error("You must provide a `convertValue` function when using objects as values.");const P=e.convertValue?e.convertValue(G):G;if(z.length>=v.value&&v.value)return l("invalid",P),!1;if(e.duplicate)return b.value=[...z,P],l("addTag",P),!0;if(z.includes(P))Y.value=!0;else return b.value=[...z,P],l("addTag",P),!0;return l("invalid",P),!1},onRemoveValue:te,onInputKeydown:G=>{const z=G.target,S=B().map(P=>P.ref).filter(P=>P.dataset.disabled!=="");if(!S.length)return;const c=S.at(-1);switch(G.key){case"Delete":case"Backspace":{if(z.selectionStart!==0||z.selectionEnd!==0)break;if(R.value){const P=S.findIndex(Q=>Q===R.value);te(P),R.value=R.value===c?S.at(P-1):S.at(P+1),G.preventDefault()}else G.key==="Backspace"&&(R.value=c,G.preventDefault());break}case"Home":case"End":case"ArrowRight":case"ArrowLeft":{const P=G.key==="ArrowRight"&&x.value==="ltr"||G.key==="ArrowLeft"&&x.value==="rtl",Q=!P;if(z.selectionStart!==0||z.selectionEnd!==0)break;if(Q&&!R.value)R.value=c,G.preventDefault();else if(P&&c&&R.value===c)R.value=void 0,G.preventDefault();else if(R.value){const Z=Ua(G,R.value,void 0,{itemsArray:S,loop:!1,dir:x.value});Z&&(R.value=Z),G.preventDefault()}break}case"ArrowUp":case"ArrowDown":{R.value&&G.preventDefault();break}default:R.value=void 0}},selectedElement:R,isInvalidInput:Y,addOnPaste:i,addOnBlur:V,addOnTab:y,dir:x,disabled:u,delimiter:g,max:v,id:h,displayValue:e.displayValue}),(G,z)=>(d(),H(t(pe),null,{default:r(()=>[n(t(Se),{ref:t(C),dir:t(x),as:G.as,"as-child":G.asChild,"data-invalid":Y.value?"":void 0,"data-disabled":t(u)?"":void 0,"data-focused":t(N)?"":void 0},{default:r(()=>[fe(G.$slots,"default",{modelValue:t(b)}),t(j)&&G.name?(d(),H(t(na),{key:0,name:G.name,value:t(b),required:G.required,disabled:t(u)},null,8,["name","value","required","disabled"])):W("v-if",!0)]),_:3},8,["dir","as","as-child","data-invalid","data-disabled","data-focused"])]),_:3}))}}),Dn=Un,Fn=le({__name:"TagsInputInput",props:{placeholder:{type:String,required:!1},autoFocus:{type:Boolean,required:!1},maxLength:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"input"}},setup(o){const a=o,e=qt(),{forwardRef:l,currentElement:i}=Oe();function u(b){if(e.selectedElement.value=void 0,!e.addOnBlur.value)return;const C=b.target;if(!C.value)return;e.onAddValue(C.value)&&(C.value="")}function g(b){e.addOnTab.value&&V(b)}const v=T(!1);function h(){v.value=!0}function I(){Ce(()=>{v.value=!1})}async function V(b){if(v.value||(await Ce(),b.defaultPrevented))return;const C=b.target;if(!C.value)return;e.onAddValue(C.value)&&(C.value=""),b.preventDefault()}function y(b){if(e.isInvalidInput.value=!1,b.data===null)return;const C=e.delimiter.value;if(C===b.data||C instanceof RegExp&&C.test(b.data)){const N=b.target;N.value=N.value.replace(C,""),e.onAddValue(N.value)&&(N.value="")}}function x(b){if(e.addOnPaste.value){b.preventDefault();const C=b.clipboardData;if(!C)return;const A=C.getData("text");e.delimiter.value?A.split(e.delimiter.value).forEach(j=>{e.onAddValue(j)}):e.onAddValue(A)}}return Ve(()=>{const b=i.value.nodeName==="INPUT"?i.value:i.value.querySelector("input");b&&setTimeout(()=>{a.autoFocus&&b?.focus()},1)}),(b,C)=>(d(),H(t(Se),{id:t(e).id?.value,ref:t(l),type:"text",autocomplete:"off",autocorrect:"off",autocapitalize:"off",as:b.as,"as-child":b.asChild,maxlength:b.maxLength,placeholder:b.placeholder,disabled:t(e).disabled.value,"data-invalid":t(e).isInvalidInput.value?"":void 0,onInput:y,onKeydown:[Ue(V,["enter"]),Ue(g,["tab"]),t(e).onInputKeydown],onBlur:u,onCompositionstart:h,onCompositionend:I,onPaste:x},{default:r(()=>[fe(b.$slots,"default")]),_:3},8,["id","as","as-child","maxlength","placeholder","disabled","data-invalid","onKeydown"]))}}),Mn=Fn;const[Ln,On]=Ne("TagsInputItem");var Pn=le({__name:"TagsInputItem",props:{value:{type:[String,Object],required:!0},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(o){const a=o,{value:e}=nt(a),l=qt(),{forwardRef:i,currentElement:u}=Oe(),{CollectionItem:g}=tt(),v=oe(()=>l.selectedElement.value===u.value),h=oe(()=>a.disabled||l.disabled.value),I=On({value:e,isSelected:v,disabled:h,textId:"",displayValue:oe(()=>l.displayValue(e.value))});return(V,y)=>(d(),H(t(g),{value:t(e)},{default:r(()=>[n(t(Se),{ref:t(i),as:V.as,"as-child":V.asChild,"aria-labelledby":t(I).textId,"aria-current":v.value,"data-disabled":h.value?"":void 0,"data-state":v.value?"active":"inactive"},{default:r(()=>[fe(V.$slots,"default")]),_:3},8,["as","as-child","aria-labelledby","aria-current","data-disabled","data-state"])]),_:3},8,["value"]))}}),Rn=Pn,zn=le({__name:"TagsInputItemDelete",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(o){const a=o;Oe();const e=qt(),l=Ln(),i=oe(()=>l.disabled?.value||e.disabled.value);function u(){if(i.value)return;const g=e.modelValue.value.findIndex(v=>dt(v,l.value.value));e.onRemoveValue(g)}return(g,v)=>(d(),H(t(Se),_e({tabindex:"-1"},a,{"aria-labelledby":t(l).textId,"aria-current":t(l).isSelected.value,"data-state":t(l).isSelected.value?"active":"inactive","data-disabled":i.value?"":void 0,type:g.as==="button"?"button":void 0,onClick:u}),{default:r(()=>[fe(g.$slots,"default")]),_:3},16,["aria-labelledby","aria-current","data-state","data-disabled","type"]))}}),Nn=zn;const Kn=le({__name:"DropdownMenuSub",props:{defaultOpen:{type:Boolean},open:{type:Boolean}},emits:["update:open"],setup(o,{emit:a}){const i=jt(o,a);return(u,g)=>(d(),H(t(Oa),xt(Ht(t(i))),{default:r(()=>[fe(u.$slots,"default")]),_:3},16))}}),jn=le({__name:"DropdownMenuSubTrigger",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},class:{}},setup(o){const a=o,e=oe(()=>{const{class:i,...u}=a;return u}),l=Pa(e);return(i,u)=>(d(),H(t(Ra),_e(t(l),{class:t(Te)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-slate-100 data-[state=open]:bg-slate-100 dark:focus:bg-slate-800 dark:data-[state=open]:bg-slate-800",a.class)}),{default:r(()=>[fe(i.$slots,"default"),n(t(Tl),{class:"ml-auto h-4 w-4"})]),_:3},16,["class"]))}}),Hn=le({__name:"DropdownMenuSubContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},sideOffset:{},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","entryFocus","openAutoFocus","closeAutoFocus"],setup(o,{emit:a}){const e=o,l=a,i=oe(()=>{const{class:g,...v}=e;return v}),u=jt(i,l);return(g,v)=>(d(),H(t(za),_e(t(u),{class:t(Te)("z-50 min-w-32 overflow-hidden rounded-md border border-slate-200 bg-white p-1 text-slate-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",e.class)}),{default:r(()=>[fe(g.$slots,"default")]),_:3},16,["class"]))}}),Wn={class:"flex items-center w-full gap-1"},Gn={class:"w-full"},Xn=["disabled"],Yn=le({__name:"move",props:{taskId:{},columnId:{},label:{},columns:{}},emits:["update-task-column","task-moved"],setup(o,{emit:a}){const{$useApi:e}=Pe(),l=o,i=T(l.columns?.length?l.columns.filter(V=>V.id!==l.columnId):[]),u=a;async function g(){if(!i.value.length)try{const{data:V}=await e.get(`tasks/${l.taskId}/avaliable-columns`);i.value=V}catch(V){console.log(V)}}async function v(V,y){u("update-task-column",{taskId:V,toColumnId:y})}const h=T(!1);async function I(){try{h.value=!0;const V=await e.patch(`/tasks/${l.taskId}/move-to-next-column`);u("task-moved",{taskId:l.taskId})}catch(V){console.error("Не удалось переместить задачу в следующую колонку",V)}finally{h.value=!1}}return Ve(g),(V,y)=>{const x=Yt;return d(),k("div",Wn,[m("div",Gn,[n(x,{items:t(i).map(b=>({value:b.id,label:b.title})),class:"w-full grow overflow-hidden border-0","button-class":"bg-neutral-700 border-neutral-400/50 text-neutral-300 hover:bg-neutral-600 hover:text-neutral-300","list-class":"bg-neutral-400 text-neutral-600",label:V.label||"?",onSelectedItem:y[0]||(y[0]=b=>v(V.taskId,b))},null,8,["items","label"])]),V.label==="Переместить"?(d(),k("button",{key:0,class:"bg-neutral-700 w-10 p-1 cursor-pointer rounded-sm border-1 border-neutral-400/50 text-neutral-300 hover:bg-neutral-600 hover:text-neutral-300",disabled:t(h),title:"Переместить в следующую колонку",onClick:y[1]||(y[1]=b=>I())}," ➜ ",8,Xn)):W("",!0)])}}});function zt(o){const a=(o||"").toLowerCase();if(a.toLowerCase()==="улица")return{backgroundColor:"#FF6C00	",color:"#E3E3E3"};if(a.toUpperCase()==="НАЛОЖЕННЫЙ ПЛАТЁЖ")return{backgroundColor:"#FF0000",color:"#FFFFFF"};if(a.toLowerCase()==="очень срочно")return{backgroundColor:"hsl(0deg 70% 50%)",color:"#E3E3E3"};let e=5382;for(let g=0;g<a.length;g++)e=(e<<5)+e+a.charCodeAt(g),e|=0;const l=Math.abs(e)%360,i=40+Math.abs(e)%30,u=40+Math.abs(e)%10;return{backgroundColor:`hsl(${l}deg ${i}% ${u}%)`,color:"#FFFFFF"}}function sa(o){const{$useApi:a}=Pe();function e(y){const x=y??(o?Je(o):void 0);if(!x)throw new Error("Task ID is required");return Number(x)}async function l(y){const x=e(y),{data:b}=await a.get(`tasks/${x}`);return b}async function i(y,x){const b=e(x),{data:C}=await a.patch(`tasks/${b}`,y);return C}async function u(y){const x=e(y),{data:b}=await a.delete(`tasks/${x}`);return b}async function g(y,x){const b=e(x);return await a.patch(`tasks/${b}/move`,y)}async function v(y,x){const b=e(x),{data:C}=await a.post(`/tasks/${b}/copy-to-board`,{boardId:y});return C}async function h(y,x){const b=e(x),{data:C}=await a.post(`/tasks/${b}/move-to-board`,{boardId:y});return C}async function I(y,x){const b=e(x);return await a.patch(`tasks/${b}/archived`,{archived:y})}async function V(y,x){const b=e(x);return await a.patch(`/tasks/${b}/cover`,{path:y})}return{getTask:l,updateTask:i,deleteTask:u,moveTask:g,copyToBoard:v,moveToBoard:h,setArchived:I,setCover:V}}function Qn(o){const{$useApi:a}=Pe(),e=T([]),l=T(!1),i=T(null),u=T({}),g=T({});let v=null;async function h(y){const x=Je(o);if(!x)return;v?.abort(),v=new AbortController;const b=!!y?.silent;b||(l.value=!0,i.value=null);try{const{data:C}=await a.get(`tasks/${x}/members`,{signal:v.signal});e.value=Array.isArray(C)?C:[]}catch(C){C?.name!=="AbortError"&&(b||(i.value=C?.message||"Не удалось загрузить участников",e.value=[]))}finally{b||(l.value=!1)}}async function I(y){const x=Je(o);if(!x||!y||u.value[y])return;if(u.value={...u.value,[y]:!0},e.value.some(C=>C.id===y)){u.value={...u.value,[y]:!1};return}const b=[...e.value];e.value=[...e.value,{id:y,fullName:`#${y}`,role:void 0}];try{await a.post(`tasks/${x}/members/${y}`),await h({silent:!0})}catch(C){throw e.value=b,C}finally{u.value={...u.value,[y]:!1}}}async function V(y){const x=Je(o);if(!x||!y||g.value[y])return;g.value={...g.value,[y]:!0};const b=[...e.value];e.value=e.value.filter(C=>C.id!==y);try{await a.delete(`tasks/${x}/members/${y}`)}catch(C){throw e.value=b,C}finally{g.value={...g.value,[y]:!1}}}return we(()=>Je(o),()=>{h()},{immediate:!0}),Ga(()=>v?.abort()),{members:e,loading:l,error:i,refresh:h,addMember:I,removeMember:V,adding:u,removing:g}}const Jn={class:"flex items-center bg-neutral-600/50 p-2 rounded-sm gap-2 flex-wrap"},Zn={key:0,class:"text-xs text-neutral-500"},eo={key:1,class:"text-xs text-red-500"},to={key:2,class:"flex gap-2 flex-wrap mt-2"},ao={class:""},lo={key:0,class:"absolute -top-1 -right-1"},no=le({__name:"MembersPanel",props:{taskId:{},actions:{type:Boolean}},setup(o){const{$useApi:a}=Pe(),e=o,l=T([]),i=oe(()=>Number(e.taskId)||null),{members:u,loading:g,error:v,removeMember:h,removing:I,addMember:V}=Qn(i);function y(A){return!!I.value[A]}async function x(){try{const{data:A}=await a.get(`tasks/${e.taskId}/avaliable-members`);l.value=A}catch(A){console.log(A)}}const b=T(0);async function C(A){await V(A),b.value++}return(A,N)=>{const j=$t,B=We,pe=Yt;return d(),k("div",Jn,[t(g)?(d(),k("div",Zn," Загрузка участников… ")):t(v)?(d(),k("div",eo,L(t(v)),1)):(d(),k("div",to,[(d(!0),k(he,null,be(t(u),R=>(d(),k("div",{key:R.id,class:"relative"},[m("div",ao,[n(j,{"full-name":R.fullName,"role-name":R.role?.fullName,"avatar-url":R.avatarUrl,dark:!0,hover:!0,tg:R.tg,size:"lg"},null,8,["full-name","role-name","avatar-url","tg"])]),A.actions?(d(),k("div",lo,[n(B,{size:"sm",variant:"outline",class:Be("bg-neutral-300/50 p-0 rounded-full h-4 w-4 flex items-center justify-center"),disabled:y(R.id),onClick:Y=>t(h)(R.id)},{default:r(()=>N[1]||(N[1]=[U(" X ",-1)])),_:2,__:[1]},1032,["disabled","onClick"])])):W("",!0)]))),128)),(d(),H(pe,{key:t(b),items:t(l).map(R=>({value:R.id,label:R.fullName})),"button-class":"bg-neutral-700 border-neutral-400/50 text-neutral-300 hover:bg-neutral-600 hover:text-neutral-300 rounded-full h-10 w-10 p-0 flex items-center justify-center","list-class":"bg-neutral-400 text-neutral-600",label:"+",onSelectedItem:N[0]||(N[0]=R=>C(R)),onClick:x},null,8,["items"]))]))])}}}),oo=le({__name:"Combobox",props:{open:{type:Boolean},defaultOpen:{type:Boolean},resetSearchTermOnBlur:{type:Boolean},resetSearchTermOnSelect:{type:Boolean},openOnFocus:{type:Boolean},openOnClick:{type:Boolean},ignoreFilter:{type:Boolean},modelValue:{},defaultValue:{},multiple:{type:Boolean},dir:{},disabled:{type:Boolean},highlightOnHover:{type:Boolean},by:{type:[String,Function]},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean}},emits:["update:modelValue","highlight","update:open"],setup(o,{emit:a}){const i=Ye(o,a);return(u,g)=>(d(),H(t(mn),_e({"data-slot":"combobox"},t(i)),{default:r(()=>[fe(u.$slots,"default")]),_:3},16))}}),so=le({__name:"ComboboxAnchor",props:{reference:{},asChild:{type:Boolean},as:{},class:{}},setup(o){const a=o,e=De(a,"class"),l=at(e);return(i,u)=>(d(),H(t(Xl),_e({"data-slot":"combobox-anchor"},t(l),{class:t(Te)("w-[200px]",a.class)}),{default:r(()=>[fe(i.$slots,"default")]),_:3},16,["class"]))}}),ro=le({__name:"ComboboxEmpty",props:{asChild:{type:Boolean},as:{},class:{}},setup(o){const a=o,e=De(a,"class");return(l,i)=>(d(),H(t(xn),_e({"data-slot":"combobox-empty"},t(e),{class:t(Te)("py-6 text-center text-sm",a.class)}),{default:r(()=>[fe(l.$slots,"default")]),_:3},16,["class"]))}}),io=le({__name:"ComboboxGroup",props:{asChild:{type:Boolean},as:{},class:{},heading:{}},setup(o){const a=o,e=De(a,"class");return(l,i)=>(d(),H(t(Cn),_e({"data-slot":"combobox-group"},t(e),{class:t(Te)("overflow-hidden p-1 text-foreground",a.class)}),{default:r(()=>[l.heading?(d(),H(t(An),{key:0,class:"px-2 py-1.5 text-xs font-medium text-muted-foreground"},{default:r(()=>[U(L(l.heading),1)]),_:1})):W("",!0),fe(l.$slots,"default")]),_:3},16,["class"]))}}),uo={"data-slot":"command-input-wrapper",class:"flex h-9 items-center gap-2 border-b px-3 w-full"},co=le({inheritAttrs:!1,__name:"ComboboxInput",props:{displayValue:{type:Function},modelValue:{},autoFocus:{type:Boolean},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["update:modelValue"],setup(o,{emit:a}){const e=o,l=a,i=De(e,"class"),u=Ye(i,l);return(g,v)=>(d(),k("div",uo,[n(t(pl),{class:"size-4 shrink-0 opacity-50"}),n(t(Vn),_e({"data-slot":"command-input",class:t(Te)("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-2 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",e.class)},{...t(u),...g.$attrs}),{default:r(()=>[fe(g.$slots,"default")]),_:3},16,["class"])]))}}),po=le({__name:"ComboboxItem",props:{textValue:{},value:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["select"],setup(o,{emit:a}){const e=o,l=a,i=De(e,"class"),u=Ye(i,l);return(g,v)=>(d(),H(t(Sn),_e({"data-slot":"combobox-item"},t(u),{class:t(Te)("data-[highlighted]:bg-accent data-[highlighted]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e.class)}),{default:r(()=>[fe(g.$slots,"default")]),_:3},16,["class"]))}}),fo=le({__name:"ComboboxList",props:{forceMount:{type:Boolean},position:{default:"popper"},bodyLock:{type:Boolean},side:{},sideOffset:{default:4},sideFlip:{type:Boolean},align:{default:"center"},alignOffset:{},alignFlip:{type:Boolean},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},positionStrategy:{},updatePositionStrategy:{},disableUpdateOnLayoutShift:{type:Boolean},prioritizePosition:{type:Boolean},reference:{},asChild:{type:Boolean},as:{},disableOutsidePointerEvents:{type:Boolean},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside"],setup(o,{emit:a}){const e=o,l=a,i=De(e,"class"),u=Ye(i,l);return(g,v)=>(d(),H(t(En),null,{default:r(()=>[n(t(bn),_e({"data-slot":"combobox-list"},t(u),{class:t(Te)("z-50 w-[200px] rounded-md border bg-popover text-popover-foreground origin-(--reka-combobox-content-transform-origin) overflow-hidden shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e.class)}),{default:r(()=>[fe(g.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),mo=le({__name:"TagsInput",props:{modelValue:{},defaultValue:{},addOnPaste:{type:Boolean},addOnTab:{type:Boolean},addOnBlur:{type:Boolean},duplicate:{type:Boolean},disabled:{type:Boolean},delimiter:{},dir:{},max:{},id:{},convertValue:{type:Function},displayValue:{type:Function},asChild:{type:Boolean},as:{},name:{},required:{type:Boolean},class:{}},emits:["update:modelValue","invalid","addTag","removeTag"],setup(o,{emit:a}){const e=o,l=a,i=De(e,"class"),u=Ye(i,l);return(g,v)=>(d(),H(t(Dn),_e(t(u),{class:t(Te)("flex flex-col gap-2 items-start rounded-md border border-input bg-background px-3 py-1.5 text-sm",e.class)}),{default:r(()=>[fe(g.$slots,"default")]),_:3},16,["class"]))}}),vo=le({__name:"TagsInputInput",props:{placeholder:{},autoFocus:{type:Boolean},maxLength:{},asChild:{type:Boolean},as:{},class:{}},setup(o){const a=o,e=De(a,"class"),l=at(e);return(i,u)=>(d(),H(t(Mn),_e(t(l),{class:t(Te)("text-sm min-h-5 focus:outline-none flex-1 bg-transparent px-1",a.class)}),null,16,["class"]))}}),ho=le({__name:"TagsInputItem",props:{value:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(o){const a=o,e=De(a,"class"),l=at(e);return(i,u)=>(d(),H(t(Rn),_e(t(l),{class:t(Te)("flex h-5 items-center rounded-md bg-secondary data-[state=active]:ring-ring data-[state=active]:ring-2 data-[state=active]:ring-offset-2 ring-offset-background",a.class)}),{default:r(()=>[fe(i.$slots,"default")]),_:3},16,["class"]))}}),go=le({__name:"TagsInputItemDelete",props:{asChild:{type:Boolean},as:{},class:{}},setup(o){const a=o,e=De(a,"class"),l=at(e);return(i,u)=>(d(),H(t(Nn),_e(t(l),{class:t(Te)("flex rounded bg-transparent mr-1",a.class)}),{default:r(()=>[fe(i.$slots,"default",{},()=>[n(t(ut),{class:"w-4 h-4"})])]),_:3},16,["class"]))}}),yo={class:"flex gap-2 flex-wrap items-center"},bo={class:"px-1 text-sm"},_o={key:0},xo={key:1},ko={key:2},wo={class:"flex items-center gap-2 p-2"},Co=le({__name:"TagsInput",props:ht({boardId:{},taskId:{},initialSelected:{},warnings:{}},{modelValue:{default:[]},modelModifiers:{}}),emits:ht(["update"],["update:modelValue"]),setup(o,{emit:a}){const{$useApi:e}=Pe(),l=a,i=Wt(o,"modelValue"),u=o,g=T([]),v=T(!1),h=T(""),I=T(!1),V=T(null),y=T(""),x=T(!1),b=T(null),{contains:C}=ta({sensitivity:"base"}),A=oe({get(){return i.value.map(S=>String(S.id))},set(S){const c=new Map(g.value.map(P=>[P.value,P.label]));i.value=S.map(P=>{const Q=Number(P);return{id:Q,name:c.get(Q)??P}})}}),N=oe(()=>{const S=new Set(A.value),c=g.value.filter(P=>!S.has(String(P.value)));return h.value?c.filter(P=>C(P.label,h.value)):c});function j(){v.value=!0}const B=S=>{const c=Number(S);return g.value.find(P=>P.value===c)?.label??S};async function pe(){try{I.value=!0,V.value=null;const{data:S}=await e.get(`boards/${u.boardId}/tags`),c=Array.isArray(S)?S:S?.data;g.value=(c??[]).map(P=>{const Q=P?.name??P?.label??String(P?.id??""),Z=Number(P?.id);return Number.isFinite(Z)?{value:Z,label:Q}:null}).filter(Boolean)}catch(S){V.value=S?.message||"Не удалось загрузить теги",g.value=[]}finally{I.value=!1}}async function R(){try{await e.post(`tasks/${u.taskId}/tags`,{tags:i.value.map(S=>S.name)}),l("update",i.value)}catch(S){console.error("Failed to save task tags",S)}}function Y(S){const c=S?.detail?.value;c&&(A.value.includes(c)||(A.value=[...A.value,c]),h.value="",N.value.length===0&&(v.value=!1))}async function ge(S){A.value=A.value.filter(c=>c!==S)}async function te(){const S=y.value.trim();if(S)try{x.value=!0,b.value=null;const{data:c}=await e.post(`boards/${u.boardId}/tags`,{name:S}),P=c?.data??c,Q=Number(P?.id),Z=String(P?.name??S);Number.isFinite(Q)&&!g.value.some(X=>X.value===Q)&&g.value.push({value:Q,label:Z}),Number.isFinite(Q)&&!A.value.includes(String(Q))&&(A.value=[...A.value,String(Q)]),y.value="",v.value=!1}catch(c){b.value=c?.response?.data?.message||c?.message||"Не удалось создать метку"}finally{x.value=!1}}const G=T(!1),z=Jt(()=>R(),200);return we(A,()=>{G.value&&z()}),Ve(async()=>{if(await pe(),u.initialSelected?.length&&i.value.length===0){const S=new Map(g.value.map(c=>[c.label,c.value]));i.value=u.initialSelected.map(c=>{const P=S.get(c);return Number.isFinite(P)?{id:P,name:c}:null}).filter(Boolean)}G.value=!0}),(S,c)=>{const P=ct,Q=We,Z=Qt;return d(),k("div",null,[n(t(oo),{modelValue:A.value,"onUpdate:modelValue":c[5]||(c[5]=X=>A.value=X),open:v.value,"onUpdate:open":c[6]||(c[6]=X=>v.value=X),"ignore-filter":!0},{default:r(()=>[n(t(so),{"as-child":""},{default:r(()=>[n(t(mo),{modelValue:A.value,"onUpdate:modelValue":c[3]||(c[3]=X=>A.value=X),class:"px-2 pt-3 gap-2 w-full bg-neutral-700 text-neutral-300 border-neutral-500/50",onClick:j},{default:r(()=>[m("div",yo,[(d(!0),k(he,null,be(S.warnings,(X,D)=>(d(),k("span",{key:D,class:"inline-flex items-center rounded-full px-2 py-0.5 text-xs",style:gt(("useStyleFromText"in S?S.useStyleFromText:t(zt))(X))}," ! "+L(X)+" ! ",5))),128)),(d(!0),k(he,null,be(A.value,X=>(d(),H(t(ho),{key:X,value:X,class:Be("text-neutral-600 bg-neutral-300 "),style:gt(("useStyleFromText"in S?S.useStyleFromText:t(zt))(B(X))),onKeydown:c[0]||(c[0]=xe(()=>{},["stop"]))},{default:r(()=>[m("span",bo,L(B(X)),1),n(t(go),{onClick:xe(D=>ge(X),["prevent","stop"])},null,8,["onClick"])]),_:2},1032,["value","style"]))),128))]),n(t(co),{modelValue:h.value,"onUpdate:modelValue":c[2]||(c[2]=X=>h.value=X),"as-child":""},{default:r(()=>[n(t(vo),{placeholder:"Добавить...",class:"w-full flex p-0 border-none focus-visible:ring-0 h-auto placeholder:text-neutral-500 bg-neutral-700 text-neutral-300 border-neutral-500/50",onKeydown:c[1]||(c[1]=Ue(xe(()=>{},["prevent"]),["enter"])),onClick:j})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),n(t(fo),{class:"w-full border-neutral-500/50 bg-neutral-700 text-neutral-300"},{default:r(()=>[n(t(ro),null,{default:r(()=>[I.value?(d(),k("span",_o,"Загрузка…")):V.value?(d(),k("span",xo,L(V.value),1)):(d(),k("span",ko,"Ничего не найдено"))]),_:1}),m("div",wo,[n(P,{modelValue:y.value,"onUpdate:modelValue":c[4]||(c[4]=X=>y.value=X),placeholder:"Название метки",class:"bg-neutral-700 text-neutral-300 border-neutral-500/50 placeholder:text-neutral-500",onKeydown:Ue(xe(te,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),n(Q,{class:"text-neutral-300 bg-neutral-600 hover:bg-neutral-600/50",disabled:!y.value.trim()||x.value,onClick:te},{default:r(()=>[U(L(x.value?"Создаём…":"Создать новый"),1)]),_:1},8,["disabled"])]),n(Z,{class:"h-[300px]"},{default:r(()=>[N.value.length?(d(),H(t(io),{key:0},{default:r(()=>[(d(!0),k(he,null,be(N.value,X=>(d(),H(t(po),{key:X.value,value:X.value,class:"text-neutral-300",onSelect:xe(Y,["prevent"])},{default:r(()=>[U(L(X.label),1)]),_:2},1032,["value"]))),128))]),_:1})):W("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","open"])])}}}),$o={class:"flex items-start gap-2 mb-4 w-full"},Vo={class:"flex items-center gap-2 flex-wrap"},Io={class:"ml-auto flex gap-2"},So={key:0,class:"mb-2 text-sm text-neutral-400"},To={key:1,class:"mb-2 text-sm text-red-400"},Ao={key:2,class:"mb-2 text-sm text-emerald-400"},Bo={key:3,class:"flex flex-col gap-4"},Eo={class:"flex flex-col gap-2"},qo={class:"flex gap-2 items-center"},Uo={class:"flex gap-2 items-center"},Do={class:"flex gap-2 items-center"},Fo={class:"flex gap-2 items-center"},Mo={class:"flex gap-2 items-center"},Lo={class:"flex gap-2 items-center"},Oo={class:"flex gap-2 items-center"},Po={class:"flex gap-2 flex-col"},Ro=le({__name:"Delivery",props:{taskId:{},initialDeliveries:{}},emits:["changed"],setup(o,{emit:a}){const{$useApi:e}=Pe(),l=o,i=a,u=["СДЕК","ПОЧТА РОССИИ","Яндекс","Балтийский курьер","Самовывоз","ТК КИТ","ПЭТ","Боксбери","Деловые линии"],g=["Создана","Доступна","Отправлена","Вручена","Возврат"],v=["Платно","Бесплатно","Досыл"],h=et([]),I=T(0),V=T(!1),y=T(!1),x=T(null),b=T(null),C=new Map,A=new Map;let N=0;function j(){return{method:u[0],type:v[0],price:0,track:"",description:"",status:"Создана",date:"",deliveredDate:""}}function B(_){return{method:_.method??u[0],type:_.type??v[0],price:Number(_.price??0),track:_.track??"",description:_.description??"",status:_.status??"Создана",date:_.date??"",deliveredDate:_.deliveredDate??""}}function pe(_){const F=C.get(_);F&&(F(),C.delete(_)),A.delete(_)}function R(){for(const[_]of Array.from(C.entries()))h.includes(_)||pe(_);h.forEach(_=>Y(_))}function Y(_){if(C.has(_))return;const F=we(()=>[_.form.method,_.form.track],async([ne,ue])=>{ne==="СДЕК"&&ue?await te(_,ue):A.delete(_)});C.set(_,F)}function ge(_){_.form.price=0,_.form.status="Создана",_.form.date=new Date().toISOString().slice(0,10),_.form.deliveredDate=""}async function te(_,F){const ne=++N;A.set(_,ne);try{const ue=await e.get("deliveries/checkTrack",{params:{track:F}});if(A.get(_)!==ne||_.form.method!=="СДЕК"||_.form.track!==F)return;const ve=ue?.data??ue;ve?(_.form.price=Number(ve.price??0),_.form.status=ve.status??"Создана",_.form.date=ve.send_date??new Date().toISOString().slice(0,10),_.form.deliveredDate=ve.delivered_date??""):ge(_)}catch(ue){console.error("checkTrack failed",ue),A.get(_)===ne&&ge(_)}finally{A.get(_)===ne&&A.delete(_)}}function G(_,F={}){const{source:ne="props",resetMessages:ue=!1}=F,ve=P(_);if(ne==="props"&&ve.length===0)return;const Ie=ve.map($e=>({id:$e.id??null,form:B($e)}));h.splice(0,h.length,...Ie),R(),h.length&&(I.value=Math.min(I.value,h.length-1),I.value<0&&(I.value=0),ue&&(x.value=null,b.value=null))}const z=oe(()=>h[I.value]??h[0]);function S(_){if(_==null)return;const F=h.findIndex(ne=>ne.id===_);F>=0&&(I.value=F)}we(()=>l.initialDeliveries,_=>{const F=h[I.value]?.id??null;G(_??[],{source:"props"}),F!=null&&S(F)},{deep:!0});const c=T(!1);function P(_){return Array.isArray(_)?_:Array.isArray(_?.data)?_.data:Array.isArray(_?.data?.data)?_.data.data:Array.isArray(_?.data?.deliveries)?_.data.deliveries:Array.isArray(_?.deliveries)?_.deliveries:Array.isArray(_?.data?.data?.deliveries)?_.data.data.deliveries:Array.isArray(_?.data?.deliveries?.data)?_.data.deliveries.data:Array.isArray(_?.deliveries?.data)?_.deliveries.data:Array.isArray(_?.data?.data?.data)?_.data.data.data:[]}async function Q(_){if(!l.taskId){G([],{source:"api",resetMessages:!0});return}try{c.value=!0,x.value=null;const F=h[I.value]?.id??null,ne=await e.get(`/tasks/${l.taskId}/deliveries`),ue=ne?.data??ne;G(ue,{source:"api"});const ve=typeof _=="number"&&_!=null?_:F;ve!=null?S(ve):I.value=Math.min(I.value,Math.max(h.length-1,0))}catch(F){console.error("fetch deliveries failed",F),x.value="Не удалось загрузить доставки"}finally{c.value=!1}}Ve(()=>{Q()}),we(()=>l.taskId,()=>{G([],{source:"api",resetMessages:!0}),Q()});function Z(_){return _.id?`${_.form.method}`:`${_.form.method}`}function X(){h.push({id:null,form:j()}),I.value=h.length-1,b.value=null,x.value=null,R()}async function D(_){const F=h[_];if(!(!F||y.value)){if(h.length===1){if(F.id)try{y.value=!0,await e.delete(`/deliveries/${F.id}`),await Q(),i("changed"),b.value="Доставка удалена",setTimeout(()=>b.value=null,2500)}catch(ne){console.error("delete delivery failed",ne),x.value="Не удалось удалить доставку";return}finally{y.value=!1}F.id=null,Object.assign(F.form,j()),b.value=null,x.value=null;return}if(F.id)try{y.value=!0,await e.delete(`/deliveries/${F.id}`),await Q(),i("changed"),b.value="Доставка удалена",setTimeout(()=>b.value=null,2500);return}catch(ne){console.error("delete delivery failed",ne),x.value="Не удалось удалить доставку";return}finally{y.value=!1}h.splice(_,1),R(),I.value=Math.min(_,Math.max(h.length-1,0)),x.value=null,b.value=null}}async function se(){const _=z.value;if(!_||V.value)return;const F={taskId:l.taskId,method:_.form.method,type:_.form.type,price:Number.isFinite(_.form.price)?Number(_.form.price):0,track:_.form.track?.trim()??"",description:_.form.description?.trim()??"",status:_.form.status,date:_.form.date??"",deliveredDate:_.form.deliveredDate??""};try{V.value=!0,x.value=null,b.value=null;let ne=_.id??null;if(_.id)await e.patch(`/deliveries/${_.id}`,{...F});else{const ue=await e.post(`/tasks/${l.taskId}/deliveries`,{...F}),ve=ue?.data??ue;ve?.id&&(_.id=ve.id,ne=ve.id)}await Q(ne),b.value="Доставка сохранена",i("changed"),setTimeout(()=>b.value=null,2500)}catch(ne){console.error("save delivery failed",ne),x.value="Не удалось сохранить доставку"}finally{V.value=!1}}return kt(()=>{for(const[_]of Array.from(C.entries()))pe(_)}),(_,F)=>{const ne=We,ue=Ct,ve=St,Ie=It,$e=At,M=Bt,p=Tt,f=Vt,s=ct,E=Et;return d(),k("div",null,[m("div",$o,[m("div",Vo,[(d(!0),k(he,null,be(h,(q,ae)=>(d(),H(ne,{key:q.id??`new-${ae}`,variant:ae===I.value?"default":"secondary",size:"sm",class:"bg-neutral-800 text-neutral-300 border border-neutral-600 data-[active=true]:bg-neutral-600 data-[active=true]:text-white","data-active":ae===I.value,onClick:me=>I.value=ae},{default:r(()=>[U(L(Z(q)),1)]),_:2},1032,["variant","data-active","onClick"]))),128)),n(ne,{variant:"secondary",size:"sm",class:"text-neutral-300 bg-neutral-700/50 hover:bg-neutral-600/50",onClick:X},{default:r(()=>F[9]||(F[9]=[U(" + Доставка ",-1)])),_:1,__:[9]})]),m("div",Io,[h.length&&(h[I.value]?.id||h.length>1)?(d(),H(ne,{key:0,variant:"secondary",size:"sm",class:"text-red-300 bg-red-900/40 hover:bg-red-900/60",disabled:y.value||c.value,onClick:F[0]||(F[0]=q=>D(I.value))},{default:r(()=>[U(L(y.value?"Удаляем…":"Удалить"),1)]),_:1},8,["disabled"])):W("",!0),n(ne,{disabled:V.value||c.value,size:"sm",class:"text-neutral-300 bg-neutral-600 hover:bg-neutral-600/50",onClick:se},{default:r(()=>[U(L(V.value?"Сохраняем…":"Сохранить"),1)]),_:1},8,["disabled"])])]),c.value?(d(),k("div",So," Загружаем доставки… ")):W("",!0),x.value?(d(),k("div",To,L(x.value),1)):W("",!0),b.value?(d(),k("div",Ao,L(b.value),1)):W("",!0),z.value?(d(),k("div",Bo,[m("div",Eo,[m("div",qo,[n(ue,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>F[10]||(F[10]=[U(" Способ: ",-1)])),_:1,__:[10]}),n(f,{modelValue:z.value.form.method,"onUpdate:modelValue":F[1]||(F[1]=q=>z.value.form.method=q),class:"flex-1 min-w-[200px]"},{default:r(()=>[n(Ie,{class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20"},{default:r(()=>[n(ve)]),_:1}),n(p,{class:"bg-neutral-800 text-neutral-300"},{default:r(()=>[(d(),k(he,null,be(u,q=>n(M,{key:q},{default:r(()=>[n($e,{value:q},{default:r(()=>[U(L(q),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),m("div",Uo,[n(ue,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>F[11]||(F[11]=[U(" Тип: ",-1)])),_:1,__:[11]}),n(f,{modelValue:z.value.form.type,"onUpdate:modelValue":F[2]||(F[2]=q=>z.value.form.type=q),class:"flex-1 min-w-[180px]"},{default:r(()=>[n(Ie,{class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20"},{default:r(()=>[n(ve)]),_:1}),n(p,{class:"bg-neutral-800 text-neutral-300"},{default:r(()=>[(d(),k(he,null,be(v,q=>n(M,{key:q},{default:r(()=>[n($e,{value:q},{default:r(()=>[U(L(q),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),m("div",Do,[n(ue,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>F[12]||(F[12]=[U(" Стоимость: ",-1)])),_:1,__:[12]}),n(s,{modelValue:z.value.form.price,"onUpdate:modelValue":F[3]||(F[3]=q=>z.value.form.price=q),modelModifiers:{number:!0},type:"number",min:"0",class:"h-8 flex-1 bg-neutral-800 text-neutral-300 border-neutral-500/20"},null,8,["modelValue"])]),m("div",Fo,[n(ue,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>F[13]||(F[13]=[U(" Трек: ",-1)])),_:1,__:[13]}),n(s,{modelValue:z.value.form.track,"onUpdate:modelValue":F[4]||(F[4]=q=>z.value.form.track=q),class:"h-8 flex-1 bg-neutral-800 text-neutral-300 border-neutral-500/20",placeholder:"Номер отслеживания"},null,8,["modelValue"])]),m("div",Mo,[n(ue,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>F[14]||(F[14]=[U(" Дата отправки: ",-1)])),_:1,__:[14]}),n(s,{modelValue:z.value.form.date,"onUpdate:modelValue":F[5]||(F[5]=q=>z.value.form.date=q),type:"date",class:"h-8 flex-1 bg-neutral-800 text-neutral-300 border-neutral-500/20"},null,8,["modelValue"])]),m("div",Lo,[n(ue,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>F[15]||(F[15]=[U(" Дата вручения: ",-1)])),_:1,__:[15]}),n(s,{modelValue:z.value.form.deliveredDate,"onUpdate:modelValue":F[6]||(F[6]=q=>z.value.form.deliveredDate=q),type:"date",min:z.value.form.date,class:"h-8 flex-1 bg-neutral-800 text-neutral-300 border-neutral-500/20"},null,8,["modelValue","min"])])]),m("div",Oo,[n(ue,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>F[16]||(F[16]=[U(" Статус: ",-1)])),_:1,__:[16]}),n(f,{modelValue:z.value.form.status,"onUpdate:modelValue":F[7]||(F[7]=q=>z.value.form.status=q),class:"flex-1 min-w-[180px]"},{default:r(()=>[n(Ie,{class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20"},{default:r(()=>[n(ve)]),_:1}),n(p,{class:"bg-neutral-800 text-neutral-300"},{default:r(()=>[(d(),k(he,null,be(g,q=>n(M,{key:q},{default:r(()=>[n($e,{value:q},{default:r(()=>[U(L(q),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),m("div",Po,[n(ue,{class:"font-medium flex text-neutral-400 pt-1"},{default:r(()=>F[17]||(F[17]=[U(" Доп. информация: ",-1)])),_:1,__:[17]}),n(E,{modelValue:z.value.form.description,"onUpdate:modelValue":F[8]||(F[8]=q=>z.value.form.description=q),placeholder:"Комментарий к доставке",class:"flex-1 bg-neutral-800 text-neutral-300 border-neutral-500/20",rows:"4"},null,8,["modelValue"])])])):W("",!0)])}}}),zo={class:"flex items-start gap-2 mb-4 w-full"},No={class:"flex items-center gap-2 flex-wrap"},Ko={class:"ml-auto cursor-not-allowed"},jo={class:"flex flex-col gap-2"},Ho={class:"flex gap-2"},Wo={key:0,class:"text-red-500"},Go={class:"flex gap-2"},Xo={key:0,class:"text-red-500"},Yo={class:"flex flex-col gap-2"},Qo={class:"flex gap-2"},Jo={key:0,class:"text-red-500"},Zo={class:"flex gap-2"},es={key:0,class:"text-red-500"},ts={class:"flex gap-2"},as={key:0,class:"text-red-500"},ls=["onClick"],ns={class:"flex flex-col gap-2"},os={class:"flex gap-2"},ss={class:"flex gap-2"},rs={class:"flex gap-2"},is={key:0,class:"text-red-500"},us={class:"flex flex-col gap-2"},ds={class:"flex gap-2"},cs={key:0,class:"text-red-500"},ps={class:"flex gap-2"},fs={key:0,class:"text-red-500"},ms={key:0,class:"flex gap-2 text-neutral-400 items-center"},vs={class:"font-medium text-neutral-300"},hs={class:"flex gap-2"},gs={class:"col-span-2 text-sm text-neutral-300"},ys={key:0,class:"text-red-500"},bs={class:"col-span-2 flex flex-col gap-1"},_s={key:0,class:"text-red-500"},xs={class:"flex h-6 items-center text-neutral-300 bg-neutral-800 border-1 border-neutral-500/20 rounded-sm"},ks=["onClick"],ws={class:"flex gap-2 items-center"},Cs={class:"w-full"},$s={key:0,class:"text-red-500"},Vs={key:0,class:"text-red-500"},Is={class:"min-w-[80px]"},Ss={key:0,class:"text-red-500"},Ts={key:0,class:"text-red-500"},As={class:"flex h-6 items-center text-neutral-300 bg-neutral-800 border-1 border-neutral-500/20 rounded-sm"},Bs=["onClick"],Es={class:"flex gap-2 items-center"},qs={class:"w-full"},Us={key:0,class:"text-red-500"},Ds={key:0,class:"text-red-500"},Fs={class:"min-w-[80px]"},Ms={key:0,class:"text-red-500"},Ls={key:0,class:"mt-4"},Os={class:"flex flex-col gap-2"},Ps={class:"flex gap-2"},Rs={key:0,class:"text-red-500"},zs={class:"flex gap-2"},Ns={key:0,class:"text-red-500"},Ks=["onClick"],js={class:"flex gap-2"},Hs={key:0,class:"text-red-500"},Ws={class:"flex gap-2"},Gs={key:0,class:"text-red-500"},Xs=["onClick"],Ys={class:"flex gap-2"},Qs={class:"flex gap-2"},Js={class:"flex gap-2"},Zs={class:"flex gap-2"},er={class:"flex gap-2"},tr={class:"flex gap-2"},ar={class:"flex flex-col my-6 gap-2"},lr={key:1,class:"text-sm text-red-500 mt-3 mb-6"},nr={key:2,class:"text-sm text-emerald-400 mt-3 mb-6"},or=le({__name:"TaskOrder",props:{taskId:{}},setup(o,{expose:a}){const{$useApi:e}=Pe(),l=Gt(),i=Zt(),u=o,g=["6мм","9мм","Нет"],v=["Помещение","Уличный","Нет"],h=["Помещение","Улица"],I=["Держатели стальные","Держатели золотые","Держатели черные","Крепления для окна","Шуруп + дюбель","Присоски","Нет"],V=["красный","синий","голубой","оранжевый","фиолетовый","розовый","бирюзовый","желтый","зеленый","холодный белый","теплый белый","смарт","rgb"],y=["6мм","8мм"],x=T(null),b=T([]),C=T(!1),A=T(null),N=T(null),j=et([]),B=T(!1),pe=T(!1),R=T(!1),Y=i.user,ge=oe(()=>{const M=l.params.id;return Number(typeof M=="string"?M:M?.[0]??0)}),te=oe(()=>{const M=Y?.role?.shortName;return M?["ADMIN","G","KD","DP","RP","MASTER","PACKER"].includes(M):!1}),G=oe(()=>{const M=c.value.form;if(!M)return null;let p="Стандартная";if(M.type==="Улица")p="Уличная";else if(M.neons&&M.neons.length>0){const ae=M.neons.some(ye=>ye.color?.toLowerCase()==="rgb"),me=M.neons.some(ye=>ye.color?.toLowerCase()==="смарт");ae?p="РГБ":me&&(p="Смарт")}let f="";M.lightings&&M.lightings.length>0&&(f=M.lightings.some(me=>me.color?.toLowerCase()==="rgb")?"РГБ Контражур":"Контражур");const s=Math.round((M.neons?.reduce((ae,me)=>{const ye=typeof me.length=="number"?me.length:parseFloat(String(me.length).replace(",","."))||0;return ae+ye},0)??0)*100)/100,E=M.lightings?.reduce((ae,me)=>{const ye=typeof me.length=="number"?me.length:parseFloat(String(me.length).replace(",","."))||0;return ae+ye},0)??0,q=M.lightings?.reduce((ae,me)=>ae+(Number(me.elements)||0),0)??0;return{date:new Date().toISOString().slice(0,10),name:`https://easy-crm.pro/boards/${ge.value}/task/${u.taskId}`,type:p,metrs:s,els:M.elements||0,lightingType:f||"none",lightingLength:E,lightingElements:q,orderId:c.value.id??void 0}}),z=Jt(async()=>{B.value||!j.length||await ve(!0)},800),S=T(0),c=oe(()=>j[S.value]??{id:null,form:Z()}),P=oe(()=>{try{return(c.value?.form?.neons??[]).reduce((f,s)=>{const E=s?.length??0,q=typeof E=="number"?E:parseFloat(String(E).replace(",","."))||0;return f+q},0)}catch{return 0}});function Q(M,p){const f=(M.form.title??"").trim();return f||`Вывеска ${p+1}`}function Z(){return{title:"",deadline:"",material:"",boardWidth:0,boardHeight:0,holeType:"",stand:!1,laminate:"",print:!1,printQuality:!1,acrylic:"Нет",type:"",wireLength:"",elements:0,gift:!1,adapter:"",plug:"",switch:!0,fitting:"",dimmer:!1,giftPack:!1,description:"",neons:[],lightings:[],docs:!1}}function X(M){return{title:M?.title??"",deadline:M?.deadline??"",material:M?.material??"",boardWidth:Number(M?.boardWidth??0),boardHeight:Number(M?.boardHeight??0),holeType:M?.holeType??"",stand:!!M?.stand,laminate:M?.laminate??"",print:!!M?.print,printQuality:!!M?.printQuality,acrylic:M?.acrylic??"",type:M?.type??"",wireLength:M?.wireLength??"",elements:Number(M?.elements??0),gift:!!M?.gift,adapter:M?.adapter??"",plug:M?.plug??"",switch:!!M?.switch,fitting:M?.fitting??"",dimmer:!!M?.dimmer,giftPack:!!M?.giftPack,description:M?.description??"",docs:!!M?.docs,neons:Array.isArray(M?.neons)?M.neons.map(p=>({id:p.id,width:p.width??"6мм",length:Number(p.length??0),color:p.color??""})):[],lightings:Array.isArray(M?.lightings)?M.lightings.map(p=>({id:p.id,length:Number(p.length??0),color:p.color??"",elements:Number(p.elements??0)})):[]}}async function D(){if(!R.value){R.value=!0,B.value=!0,z.cancel?.();try{A.value=null;const M=j[S.value]?.id??null,{data:p}=await e.get(`tasks/${u.taskId}/orders`),f=Array.isArray(p)?p:p?.data,s=Array.isArray(f)?f:[];b.value=s.map(ae=>({id:ae.id,title:ae.title??`Заказ #${ae.id}`})),j.splice(0,j.length,...s.map(ae=>({id:ae.id??null,form:X(ae)}))),j.length===0&&j.push({id:null,form:Z()});const E=M??j[0]?.id??null,q=j.findIndex(ae=>ae.id===E);S.value=q>=0?q:0,x.value=j[S.value]?.id??null,N.value=null}catch(M){A.value=M?.response?.data?.message||M?.message||"Не удалось загрузить заказы",j.splice(0,j.length,{id:null,form:Z()}),S.value=0}finally{Ce(()=>{B.value=!1,R.value=!1})}}}function se(){c.value.form.neons.push({width:"6мм",length:0,color:""})}function _(M){c.value.form.neons.splice(M,1)}function F(){c.value.form.lightings.push({length:0,color:"",elements:0})}function ne(M){c.value.form.lightings.splice(M,1)}function ue(){B.value=!0,j.push({id:null,form:Z()}),S.value=j.length-1,N.value=null,A.value=null,Ce(()=>{B.value=!1})}async function ve(M=!1){if(j?.length){z.cancel?.(),B.value=!0,C.value=!0,pe.value=!1,M||(A.value=null,N.value=null);try{const p=[];for(const s of j){const E=JSON.parse(JSON.stringify(s.form));try{if(s.id==null){const{data:q}=await e.post(`tasks/${u.taskId}/orders`,E),ae=q?.id??null;s.id=ae,p.push({ok:!0,id:ae})}else await e.patch(`tasks/orders/${s.id}`,E),p.push({ok:!0,id:s.id})}catch(q){const ae=q?.response?.data?.message||q?.message||"Ошибка сохранения заказа";p.push({ok:!1,id:s.id??null,err:ae})}}const f=p.filter(s=>!s.ok);f.length?(A.value=`Не удалось сохранить ${f.length} из ${p.length}: ${f.map(s=>s.err).join("; ")}`,N.value=null,Ce(async()=>{await D()})):p.length&&(A.value=null,N.value=M?"Изменения сохранены":`Сохранены ${p.length} заказ(ов)`)}finally{C.value=!1,Ce(()=>{B.value=!1,pe.value&&z()})}}}async function Ie(M){M!==S.value&&(S.value=M),await ve()}async function $e(M){const p=j[M];if(p)try{B.value=!0;const f=S.value===M;p.id!=null&&await e.delete(`tasks/orders/${p.id}`),j.splice(M,1),j.length===0?(j.push({id:null,form:Z()}),S.value=0):f&&(S.value=Math.min(M,j.length-1)),N.value="Заказ удалён"}catch(f){A.value=f?.response?.data?.message||f?.message||"Не удалось удалить заказ"}finally{B.value=!1}}return we(j,()=>{if(R.value||B.value){C.value&&(pe.value=!0);return}pe.value=!0,z()},{deep:!0}),Ve(D),a({fetchOrders:D,addNewOrder:ue,saveOrderAt:Ie,deleteOrderAt:$e,get orders(){return b.value},get currentOrderId(){return j[0]?.id??null},get forms(){return j}}),(M,p)=>{const f=We,s=Ct,E=ct,q=ul,ae=dl,me=il,ye=fl,Fe=St,Me=It,Ee=At,Le=Bt,qe=Tt,Re=Vt,$=vl,O=hl,J=ml,ie=gl,ke=Et;return d(),k("div",null,[m("div",zo,[m("div",No,[(d(!0),k(he,null,be(j,(w,ce)=>(d(),H(f,{key:w.id??"new-"+ce,variant:ce===S.value?"default":"secondary",size:"sm",class:"bg-neutral-800 text-neutral-300 border border-neutral-600 data-[active=true]:bg-neutral-600 data-[active=true]:text-white","data-active":ce===S.value,onClick:re=>S.value=ce},{default:r(()=>[U(L(Q(w,ce)),1)]),_:2},1032,["variant","data-active","onClick"]))),128)),n(f,{variant:"secondary",size:"sm",class:"text-neutral-300 bg-neutral-700/50 hover:bg-neutral-600/50",onClick:ue},{default:r(()=>p[24]||(p[24]=[U(" + Вывеска ",-1)])),_:1,__:[24]})]),m("div",Ko,[n(f,{disabled:"",size:"sm",class:"text-neutral-300 bg-neutral-600 hover:bg-neutral-600/50",title:"Автосохранение"},{default:r(()=>[U(L(C.value?"Сохраняем…":"Сохранено"),1)]),_:1})])]),m("div",jo,[m("div",Ho,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.title?W("",!0):(d(),k("span",Wo,"*")),p[25]||(p[25]=U(" Название: ",-1))]),_:1,__:[25]}),n(E,{modelValue:c.value.form.title,"onUpdate:modelValue":p[0]||(p[0]=w=>c.value.form.title=w),class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",placeholder:"Название заказа"},null,8,["modelValue"])]),m("div",Go,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.deadline?W("",!0):(d(),k("span",Xo,"*")),p[26]||(p[26]=U(" Срок: ",-1))]),_:1,__:[26]}),n(E,{modelValue:c.value.form.deadline,"onUpdate:modelValue":p[1]||(p[1]=w=>c.value.form.deadline=w),class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",type:"date",placeholder:"Срок"},null,8,["modelValue"])])]),p[49]||(p[49]=m("div",{class:"relative border-b-1 border-neutral-500 mb-5 mt-8"},[m("span",{class:"absolute top-[-9px] left-[50%] translate-x-[-50%] text-neutral-400 bg-neutral-800 text-xs font-medium px-1"},"Подложка")],-1)),m("div",Yo,[m("div",Qo,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.boardWidth?W("",!0):(d(),k("span",Jo,"*")),p[27]||(p[27]=m("span",null,"Ширина(см):",-1))]),_:1,__:[27]}),n(E,{modelValue:c.value.form.boardWidth,"onUpdate:modelValue":p[2]||(p[2]=w=>c.value.form.boardWidth=w),modelModifiers:{number:!0},type:"number",class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20"},null,8,["modelValue"])]),m("div",Zo,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.boardHeight?W("",!0):(d(),k("span",es,"*")),p[28]||(p[28]=U(" Высота(см): ",-1))]),_:1,__:[28]}),n(E,{modelValue:c.value.form.boardHeight,"onUpdate:modelValue":p[3]||(p[3]=w=>c.value.form.boardHeight=w),modelModifiers:{number:!0},type:"number",class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20"},null,8,["modelValue"])]),m("div",ts,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.holeType?W("",!0):(d(),k("span",as,"*")),p[29]||(p[29]=U(" Отверстия: ",-1))]),_:1,__:[29]}),n(me,null,{default:r(()=>[n(q,{class:"w-full"},{default:r(()=>[n(E,{modelValue:c.value.form.holeType,"onUpdate:modelValue":p[4]||(p[4]=w=>c.value.form.holeType=w),class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20 placeholder:text-neutral-600",placeholder:"6мм/9мм/другое"},null,8,["modelValue"])]),_:1}),n(ae,{class:"w-[100px] p-1"},{default:r(()=>[(d(),k(he,null,be(g,w=>m("div",{key:w,class:"hover:bg-slate-100 text-gray-400 cursor-pointer",onClick:()=>c.value.form.holeType=w},L(w),9,ls)),64))]),_:1})]),_:1})])]),p[50]||(p[50]=m("div",{class:"relative border-b border-neutral-500 mb-5 mt-8"},[m("span",{class:"absolute -top-2 left-1/2 -translate-x-1/2 bg-neutral-800 text-neutral-400 text-xs px-1"},"Печать/Акрил")],-1)),m("div",ns,[m("div",os,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[U(" Печать: "+L(c.value.form.print?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.print,"onUpdate:checked":p[5]||(p[5]=w=>c.value.form.print=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])]),m("div",ss,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[U(" Качество согласовано: "+L(c.value.form.printQuality?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.printQuality,"onUpdate:checked":p[6]||(p[6]=w=>c.value.form.printQuality=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])]),m("div",rs,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.acrylic?W("",!0):(d(),k("span",is,"*")),p[30]||(p[30]=U(" Акрил: ",-1))]),_:1,__:[30]}),n(E,{modelValue:c.value.form.acrylic,"onUpdate:modelValue":p[7]||(p[7]=w=>c.value.form.acrylic=w),class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20 placeholder:text-neutral-600",placeholder:"Цвет и тп"},null,8,["modelValue"])])]),p[51]||(p[51]=m("div",{class:"relative border-b-1 border-neutral-500 mb-5 mt-8"},[m("span",{class:"absolute top-[-9px] left-[50%] translate-x-[-50%] text-neutral-400 bg-neutral-800 text-xs font-medium px-1"},"Неон")],-1)),m("div",us,[m("div",ds,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.type?W("",!0):(d(),k("span",cs,"*")),p[31]||(p[31]=U(" Тип: ",-1))]),_:1,__:[31]}),n(Re,{modelValue:c.value.form.type,"onUpdate:modelValue":p[8]||(p[8]=w=>c.value.form.type=w)},{default:r(()=>[n(Me,{class:"h-8 bg-neutral-800 text-neutral-300 border-neutral-500/20"},{default:r(()=>[n(Fe,{class:"placeholder:text-neutral-600",placeholder:"Помещение/Улица"})]),_:1}),n(qe,{class:"bg-neutral-800 text-neutral-300"},{default:r(()=>[(d(),k(he,null,be(h,(w,ce)=>n(Le,{key:ce},{default:r(()=>[n(Ee,{value:w},{default:r(()=>[U(L(w),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["modelValue"])]),m("div",ps,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.elements?W("",!0):(d(),k("span",fs,"*")),p[32]||(p[32]=U(" Элементы: ",-1))]),_:1,__:[32]}),n(E,{modelValue:c.value.form.elements,"onUpdate:modelValue":p[9]||(p[9]=w=>c.value.form.elements=w),modelModifiers:{number:!0},class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",type:"number"},null,8,["modelValue"])]),c.value.form.neons.length?(d(),k("div",ms,[n(s,{class:"font-medium"},{default:r(()=>p[33]||(p[33]=[U(" Общая длина неона: ",-1)])),_:1,__:[33]}),m("span",vs,L(P.value.toFixed(2))+"м ",1)])):W("",!0),m("div",hs,[p[36]||(p[36]=m("span",{class:"font-medium flex text-neutral-400 mr-auto"},"Неоны: ",-1)),n(f,{variant:"secondary",size:"sm",class:"text-neutral-300 bg-neutral-600 hover:bg-neutral-600/50",onClick:p[10]||(p[10]=w=>se())},{default:r(()=>p[34]||(p[34]=[U(" + Неон ",-1)])),_:1,__:[34]}),n(f,{variant:"secondary",size:"sm",class:"text-neutral-300 bg-neutral-600 hover:bg-neutral-600/50",onClick:p[11]||(p[11]=w=>F())},{default:r(()=>p[35]||(p[35]=[U(" + Подсветка ",-1)])),_:1,__:[35]})]),m("div",gs,[c.value.form.neons.length===0?(d(),k("div",ys," Неон не добавлен ")):W("",!0)]),m("div",bs,[(d(!0),k(he,null,be(c.value.form.neons,(w,ce)=>(d(),k("div",{key:ce,class:"flex items-center"},[n(J,null,{default:r(()=>[!w.color||!w.length?(d(),k("span",_s,"*")):W("",!0),m("div",xs,[n($,{class:"text-sm p-2 bg-transparent hover:underline cursor-pointer"},{default:r(()=>[m("span",null,L(w.color)+"("+L(w.width)+") - "+L(w.length)+"м",1)]),_:2},1024),m("button",{class:"flex bg-transparent mx-1 cursor-pointer",onClick:re=>_(ce)},[n(t(ut),{class:"w-4 x-4"})],8,ks)]),n(O,{class:"w-[400px] bg-neutral-700"},{default:r(()=>[m("div",ws,[m("div",Cs,[n(s,{class:"font-light text-neutral-400"},{default:r(()=>[p[37]||(p[37]=U(" Цвет ",-1)),w.color?W("",!0):(d(),k("span",$s,"*"))]),_:2,__:[37]},1024),n(Re,{modelValue:w.color,"onUpdate:modelValue":re=>w.color=re},{default:r(()=>[n(Me,{class:"h-8 bg-neutral-700 text-neutral-300 border-neutral-500/20"},{default:r(()=>[n(Fe,{placeholder:""})]),_:1}),n(qe,{class:"bg-neutral-800 text-neutral-300"},{default:r(()=>[(d(),k(he,null,be(V,(re,de)=>n(Le,{key:de,class:"p-0.5"},{default:r(()=>[n(Ee,{value:re,class:"py-0 pr-0"},{default:r(()=>[U(L(re),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),m("div",null,[n(s,{class:"font-light text-neutral-400"},{default:r(()=>[p[38]||(p[38]=U(" Толщина ",-1)),w.width?W("",!0):(d(),k("span",Vs,"*"))]),_:2,__:[38]},1024),n(Re,{modelValue:w.width,"onUpdate:modelValue":re=>w.width=re},{default:r(()=>[n(Me,{class:"h-8 bg-neutral-700 text-neutral-300 border-neutral-500/20"},{default:r(()=>[n(Fe,{placeholder:""})]),_:1}),n(qe,{class:"bg-neutral-800 text-neutral-300"},{default:r(()=>[(d(),k(he,null,be(y,(re,de)=>n(Le,{key:de},{default:r(()=>[n(Ee,{value:re},{default:r(()=>[U(L(re),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),m("div",Is,[n(s,{class:"font-light text-neutral-400"},{default:r(()=>[p[39]||(p[39]=U(" Длина (м) ",-1)),w.length?W("",!0):(d(),k("span",Ss,"*"))]),_:2,__:[39]},1024),n(E,{modelValue:w.length,"onUpdate:modelValue":re=>w.length=re,modelModifiers:{number:!0},class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",type:"number",placeholder:"м"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024)]))),128)),(d(!0),k(he,null,be(c.value.form.lightings,(w,ce)=>(d(),k("div",{key:ce,class:"flex items-center"},[!w.color||!w.length||!w.elements?(d(),k("span",Ts,"*")):W("",!0),n(J,null,{default:r(()=>[m("div",As,[n($,{class:"text-sm p-1 bg-transparent hover:underline cursor-pointer"},{default:r(()=>[m("span",null," Подсветка - "+L(w.color)+" - "+L(w.elements)+"эл./"+L(w.length)+"м ",1)]),_:2},1024),m("button",{class:"flex rounded bg-transparent mr-1 cursor-pointer",onClick:re=>ne(ce)},[n(t(ut),{class:"w-4 x-4"})],8,Bs)]),n(O,{class:"w-[400px] bg-neutral-700"},{default:r(()=>[m("div",Es,[m("div",qs,[n(s,{class:"font-light text-neutral-400"},{default:r(()=>[p[40]||(p[40]=U(" Цвет ",-1)),w.color?W("",!0):(d(),k("span",Us,"*"))]),_:2,__:[40]},1024),n(Re,{modelValue:w.color,"onUpdate:modelValue":re=>w.color=re},{default:r(()=>[n(Me,{class:"h-8 bg-neutral-700 text-neutral-300 border-neutral-500/20"},{default:r(()=>[n(Fe,{placeholder:""})]),_:1}),n(qe,{class:"bg-neutral-800 text-neutral-300"},{default:r(()=>[(d(),k(he,null,be(V,(re,de)=>n(Le,{key:de,class:"p-0.5"},{default:r(()=>[n(Ee,{value:re,class:"py-0 pr-0"},{default:r(()=>[U(L(re),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),m("div",null,[n(s,{class:"font-light text-neutral-400"},{default:r(()=>[p[41]||(p[41]=U(" Элементы ",-1)),w.elements?W("",!0):(d(),k("span",Ds,"*"))]),_:2,__:[41]},1024),n(E,{modelValue:w.elements,"onUpdate:modelValue":re=>w.elements=re,modelModifiers:{number:!0},class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),m("div",Fs,[n(s,{class:"font-light text-neutral-400"},{default:r(()=>[p[42]||(p[42]=U(" Длина (м) ",-1)),w.length?W("",!0):(d(),k("span",Ms,"*"))]),_:2,__:[42]},1024),n(E,{modelValue:w.length,"onUpdate:modelValue":re=>w.length=re,modelModifiers:{number:!0},class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",type:"number",placeholder:"м"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024)]))),128))])]),te.value?(d(),k("div",Ls,[t(Y)?(d(),H(ie,{key:0,"master-id":t(Y).id,"cur-user":t(Y),"initial-data":G.value,class:"w-full",onReportCreated:()=>{}},null,8,["master-id","cur-user","initial-data"])):W("",!0)])):W("",!0),p[52]||(p[52]=m("div",{class:"relative border-b-1 border-neutral-500 mb-5 mt-8"},[m("span",{class:"absolute top-[-9px] left-[50%] translate-x-[-50%] text-neutral-400 bg-neutral-800 text-xs font-medium px-1"},"Упаковка/Комплектация")],-1)),m("div",Os,[m("div",Ps,[n(s,{class:"font-medium flex text-neutral-400 self-center whitespace-nowrap"},{default:r(()=>[c.value.form.wireLength?W("",!0):(d(),k("span",Rs,"*")),p[43]||(p[43]=U(" Провод от вывески: ",-1))]),_:1,__:[43]}),n(E,{modelValue:c.value.form.wireLength,"onUpdate:modelValue":p[12]||(p[12]=w=>c.value.form.wireLength=w),class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",placeholder:"Длина"},null,8,["modelValue"])]),m("div",zs,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.adapter?W("",!0):(d(),k("span",Ns,"*")),p[44]||(p[44]=U(" Блок: ",-1))]),_:1,__:[44]}),n(me,null,{default:r(()=>[n(q,{class:"w-full"},{default:r(()=>[n(E,{modelValue:c.value.form.adapter,"onUpdate:modelValue":p[13]||(p[13]=w=>c.value.form.adapter=w),class:"h-8 w-full bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",placeholder:""},null,8,["modelValue"])]),_:1}),n(ae,{class:"p-1 w-[150px]"},{default:r(()=>[(d(),k(he,null,be(v,w=>m("div",{key:w,class:"hover:bg-slate-100 text-gray-400",onClick:()=>c.value.form.adapter=w},L(w),9,Ks)),64))]),_:1})]),_:1})]),m("div",js,[n(s,{class:"font-medium flex text-neutral-400 self-center whitespace-nowrap"},{default:r(()=>[c.value.form.plug?W("",!0):(d(),k("span",Hs,"*")),p[45]||(p[45]=U(" Провод от блока: ",-1))]),_:1,__:[45]}),n(E,{modelValue:c.value.form.plug,"onUpdate:modelValue":p[14]||(p[14]=w=>c.value.form.plug=w),class:"h-8 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",placeholder:"Длина/Цвет"},null,8,["modelValue"])]),m("div",Ws,[n(s,{class:"font-medium flex text-neutral-400 self-center"},{default:r(()=>[c.value.form.fitting?W("",!0):(d(),k("span",Gs,"*")),p[46]||(p[46]=U(" Фурнитура: ",-1))]),_:1,__:[46]}),n(me,null,{default:r(()=>[n(q,{class:"w-full"},{default:r(()=>[n(E,{modelValue:c.value.form.fitting,"onUpdate:modelValue":p[15]||(p[15]=w=>c.value.form.fitting=w),class:"h-8 w-full bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",placeholder:"Фурнитура"},null,8,["modelValue"])]),_:1}),n(ae,{class:"p-1"},{default:r(()=>[(d(),k(he,null,be(I,w=>m("div",{key:w,class:"hover:bg-slate-100 text-gray-400",onClick:()=>c.value.form.fitting+=w},L(w),9,Xs)),64))]),_:1})]),_:1})]),m("div",Ys,[n(s,{class:"font-medium text-neutral-400 self-center"},{default:r(()=>[U(" Диммер: "+L(c.value.form.dimmer?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.dimmer,"onUpdate:checked":p[16]||(p[16]=w=>c.value.form.dimmer=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500 justify-self-start","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])]),m("div",Qs,[n(s,{class:"font-medium text-neutral-400 self-center"},{default:r(()=>[U(" Выключатель: "+L(c.value.form.switch?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.switch,"onUpdate:checked":p[17]||(p[17]=w=>c.value.form.switch=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500 justify-self-start","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])]),m("div",Js,[n(s,{class:"font-medium text-neutral-400 self-center"},{default:r(()=>[U(" Подарок: "+L(c.value.form.gift?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.gift,"onUpdate:checked":p[18]||(p[18]=w=>c.value.form.gift=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500 justify-self-start","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])]),m("div",Zs,[n(s,{class:"font-medium text-neutral-400 self-center"},{default:r(()=>[U(" Подставка: "+L(c.value.form.stand?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.stand,"onUpdate:checked":p[19]||(p[19]=w=>c.value.form.stand=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500 justify-self-start","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])]),m("div",er,[n(s,{class:"font-medium text-neutral-400 self-center"},{default:r(()=>[U(" Подарочная упаковка: "+L(c.value.form.giftPack?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.giftPack,"onUpdate:checked":p[20]||(p[20]=w=>c.value.form.giftPack=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500 justify-self-start","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])]),m("div",tr,[n(s,{class:"font-medium text-neutral-400 self-center"},{default:r(()=>[U(" Документы: "+L(c.value.form.docs?"Да":"Нет"),1)]),_:1}),n(ye,{checked:c.value.form.docs,"onUpdate:checked":p[21]||(p[21]=w=>c.value.form.docs=w),class:"scale-75 data-[state=checked]:bg-lime-900 data-[state=unchecked]:bg-neutral-500 justify-self-start","thumb-class":"bg-neutral-400 data-[state=checked]:bg-neutral-300"},null,8,["checked"])])]),m("div",ar,[n(s,{class:"font-medium text-neutral-400 self-start"},{default:r(()=>p[47]||(p[47]=[U(" Дополнительная информация: ",-1)])),_:1,__:[47]}),n(ke,{modelValue:c.value.form.description,"onUpdate:modelValue":p[22]||(p[22]=w=>c.value.form.description=w),class:"min-h-34 bg-neutral-800 text-neutral-300 placeholder:text-neutral-600 border-neutral-500/20",placeholder:"Описание"},null,8,["modelValue"])]),n(f,{size:"sm",class:"text-red-200 bg-red-700 hover:bg-red-700/80 mb-6",disabled:C.value,onClick:p[23]||(p[23]=()=>$e(S.value))},{default:r(()=>p[48]||(p[48]=[U(" Удалить вывеску ",-1)])),_:1,__:[48]},8,["disabled"]),A.value?(d(),k("div",lr,L(A.value),1)):N.value?(d(),k("div",nr,L(N.value),1)):W("",!0)])}}}),sr={},rr={id:"Layer_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512","xml:space":"preserve",fill:"currentColor",stroke:"currentColor"};function ir(o,a){return d(),k("svg",rr,a[0]||(a[0]=[wt('<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path style="fill:#f15642;" d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z"></path><path style="fill:#f15642;" d="M384,128h96L352,0v96C352,113.6,366.4,128,384,128z"></path><polygon style="fill:#f15642;" points="480,224 384,128 480,128 "></polygon><path style="fill:#f15642;" d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16 V416z"></path><g><path style="fill:#ffffff;" d="M101.744,303.152c0-4.224,3.328-8.832,8.688-8.832h29.552c16.64,0,31.616,11.136,31.616,32.48 c0,20.224-14.976,31.488-31.616,31.488h-21.36v16.896c0,5.632-3.584,8.816-8.192,8.816c-4.224,0-8.688-3.184-8.688-8.816V303.152z M118.624,310.432v31.872h21.36c8.576,0,15.36-7.568,15.36-15.504c0-8.944-6.784-16.368-15.36-16.368H118.624z"></path><path style="fill:#ffffff;" d="M196.656,384c-4.224,0-8.832-2.304-8.832-7.92v-72.672c0-4.592,4.608-7.936,8.832-7.936h29.296 c58.464,0,57.184,88.528,1.152,88.528H196.656z M204.72,311.088V368.4h21.232c34.544,0,36.08-57.312,0-57.312H204.72z"></path><path style="fill:#ffffff;" d="M303.872,312.112v20.336h32.624c4.608,0,9.216,4.608,9.216,9.072c0,4.224-4.608,7.68-9.216,7.68 h-32.624v26.864c0,4.48-3.184,7.92-7.664,7.92c-5.632,0-9.072-3.44-9.072-7.92v-72.672c0-4.592,3.456-7.936,9.072-7.936h44.912 c5.632,0,8.96,3.344,8.96,7.936c0,4.096-3.328,8.704-8.96,8.704h-37.248V312.112z"></path></g><path style="fill:#f15642;" d="M400,432H96v16h304c8.8,0,16-7.2,16-16v-16C416,424.8,408.8,432,400,432z"></path></g>',3)]))}const ur=pt(sr,[["render",ir]]),dr={},cr={id:"Layer_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512","xml:space":"preserve",fill:"currentColor",stroke:"currentColor"};function pr(o,a){return d(),k("svg",cr,a[0]||(a[0]=[wt('<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path style="fill:#50bee8;" d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z"></path><path style="fill:#50bee8;" d="M384,128h96L352,0v96C352,113.6,366.4,128,384,128z"></path><polygon style="fill:#50bee8;" points="480,224 384,128 480,128 "></polygon><path style="fill:#50bee8;" d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16 V416z"></path><g><path style="fill:#ffffff;" d="M92.576,384c-4.224,0-8.832-2.32-8.832-7.936v-72.656c0-4.608,4.608-7.936,8.832-7.936h29.296 c58.464,0,57.168,88.528,1.136,88.528H92.576z M100.64,311.072v57.312h21.232c34.544,0,36.064-57.312,0-57.312H100.64z"></path><path style="fill:#ffffff;" d="M228,385.28c-23.664,1.024-48.24-14.72-48.24-46.064c0-31.472,24.56-46.944,48.24-46.944 c22.384,1.136,45.792,16.624,45.792,46.944C273.792,369.552,250.384,385.28,228,385.28z M226.592,308.912 c-14.336,0-29.936,10.112-29.936,30.32c0,20.096,15.616,30.336,29.936,30.336c14.72,0,30.448-10.24,30.448-30.336 C257.04,319.008,241.312,308.912,226.592,308.912z"></path><path style="fill:#ffffff;" d="M288.848,339.088c0-24.688,15.488-45.92,44.912-45.92c11.136,0,19.968,3.328,29.296,11.392 c3.456,3.184,3.84,8.816,0.384,12.4c-3.456,3.056-8.704,2.688-11.776-0.384c-5.232-5.504-10.608-7.024-17.904-7.024 c-19.696,0-29.152,13.952-29.152,29.552c0,15.872,9.328,30.448,29.152,30.448c7.296,0,14.08-2.96,19.968-8.192 c3.952-3.072,9.456-1.552,11.76,1.536c2.048,2.816,3.056,7.552-1.408,12.016c-8.96,8.336-19.696,10-30.336,10 C302.8,384.912,288.848,363.776,288.848,339.088z"></path></g><path style="fill:#50bee8;" d="M400,432H96v16h304c8.8,0,16-7.2,16-16v-16C416,424.8,408.8,432,400,432z"></path></g>',3)]))}const fr=pt(dr,[["render",pr]]),mr={},vr={id:"Layer_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512","xml:space":"preserve",fill:"currentColor",stroke:"currentColor"};function hr(o,a){return d(),k("svg",vr,a[0]||(a[0]=[wt('<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path style="fill:#84bd5a;" d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z"></path><path style="fill:#84bd5a;" d="M384,128h96L352,0v96C352,113.6,366.4,128,384,128z"></path><polygon style="fill:#84bd5a;" points="480,224 384,128 480,128 "></polygon><path style="fill:#84bd5a;" d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16 V416z"></path><g><path style="fill:#ffffff;" d="M90.592,339.088c0-24.688,15.472-45.904,44.912-45.904c11.12,0,19.952,3.312,29.296,11.376 c3.456,3.184,3.824,8.832,0.368,12.4c-3.456,3.056-8.704,2.688-11.76-0.368c-5.248-5.504-10.624-7.024-17.904-7.024 c-19.696,0-29.168,13.936-29.168,29.536c0,15.872,9.328,30.464,29.168,30.464c7.28,0,14.064-2.96,19.952-8.192 c3.968-3.072,9.472-1.552,11.76,1.536c2.048,2.816,3.072,7.536-1.408,12.016c-8.96,8.336-19.696,9.984-30.32,9.984 C104.544,384.912,90.592,363.792,90.592,339.088z"></path><path style="fill:#ffffff;" d="M195.056,384c-4.224,0-8.832-2.304-8.832-7.92v-72.672c0-4.592,4.608-7.936,8.832-7.936h29.296 c58.464,0,57.184,88.528,1.152,88.528H195.056z M203.12,311.088V368.4h21.232c34.544,0,36.08-57.312,0-57.312H203.12z"></path><path style="fill:#ffffff;" d="M302.592,375.68c0,11.12-17.008,11.52-17.008,0.256V303.28c0-4.464,3.456-7.808,7.664-7.808h34.032 c32.496,0,39.152,43.504,12.032,54.368l17.008,20.736c6.656,9.856-6.656,19.312-14.336,9.6l-19.312-27.648h-20.096v23.152H302.592z M302.592,337.824h24.688c16.64,0,17.664-26.864,0-26.864h-24.688V337.824z"></path></g><path style="fill:#84bd5a;" d="M400,432H96v16h304c8.8,0,16-7.2,16-16v-16C416,424.8,408.8,432,400,432z"></path></g>',3)]))}const gr=pt(mr,[["render",hr]]),yr={class:"absolute inset-0 flex flex-col"},br={class:"flex items-center gap-2 p-2 text-white z-10"},_r={class:"ml-auto flex items-center gap-2"},xr={class:"absolute inset-0 grid place-items-center"},kr=["src","alt"],wr={key:1,class:"text-white/80 text-sm"},Cr={class:"p-2 text-center text-white/80 text-xs truncate"},$r={key:0,class:"mr-2"},Vr=le({__name:"ImageViewer",props:ht({path:{},items:{},index:{},name:{},size:{}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:["update:open"],setup(o){const a=Wt(o,"open"),e=o,{getPreviewSrc:l,refreshPreview:i,onImgError:u,downloadAttachment:g}=Xt(),v=T(""),h=T(e.index??0),I=T(!1),V=T(null),y=T(1),x=T(0),b=T(0);let C=!1,A=0,N=0;function j(){y.value=1,x.value=0,b.value=0}function B(D){if(D.ctrlKey)return;D.preventDefault();const se=D.deltaY>0?-.1:.1,_=Math.min(5,Math.max(.3,y.value+se));y.value=_}function pe(D){D.target.setPointerCapture?.(D.pointerId),C=!0,A=D.clientX,N=D.clientY}function R(D){if(!C)return;const se=D.clientX-A,_=D.clientY-N;x.value+=se,b.value+=_,A=D.clientX,N=D.clientY}function Y(D){C=!1}function ge(D){a.value&&(D.key==="Escape"?(D.preventDefault(),te()):D.key==="ArrowRight"?(D.preventDefault(),S()):D.key==="ArrowLeft"?(D.preventDefault(),c()):(D.key==="+"||D.key==="=")&&!D.metaKey&&!D.ctrlKey?(D.preventDefault(),y.value=Math.min(5,y.value+.1)):(D.key==="-"||D.key==="_")&&!D.metaKey&&!D.ctrlKey?(D.preventDefault(),y.value=Math.max(.3,y.value-.1)):D.key==="0"&&(D.ctrlKey||D.metaKey)&&(D.preventDefault(),j()))}function te(){a.value=!1}function G(D){const se=(e.items?.length||1)-1;return D<0?se:D>se?0:D}async function z(D){const se=G(D);se!==h.value&&(h.value=se,j(),await Z())}function S(){!e.items||e.items.length<=1||z(h.value+1)}function c(){!e.items||e.items.length<=1||z(h.value-1)}function P(D){return/^blob:|^data:|^https?:\/\//.test(D||"")}function Q(){if(Array.isArray(e.items)&&e.items.length>0){const D=Math.max(0,Math.min(h.value,e.items.length-1));return e.items[D]}return{path:e.path||"",name:e.name}}async function Z(){const D=Q();if(!D?.path){v.value="";return}I.value=!0;try{const se=D.path||"";if(P(se))v.value=se;else{let _=l(se,1920);_||(await i(se,1920),_=l(se,1920)),v.value=_||""}}finally{I.value=!1}}we(()=>a.value,async D=>{D&&(h.value=e.index??0,j(),await Z(),setTimeout(()=>V.value?.focus?.(),0))}),we(()=>e.index,D=>{D===void 0||!a.value||(h.value=Math.max(0,Math.min(D,(e.items?.length||1)-1)))}),we(()=>e.items,async()=>{a.value&&(h.value=Math.max(0,Math.min(h.value,(e.items?.length||1)-1)),await Z())},{deep:!0}),Ve(()=>{window.addEventListener("keydown",ge)}),kt(()=>{window.removeEventListener("keydown",ge)});async function X(){const D=Q();if(!D?.path)return;const se=D.path;if(P(se)){const _=document.createElement("a");_.href=se,_.download=D.name||e.name||"image",_.target="_blank",_.rel="noopener noreferrer",document.body.appendChild(_),_.click(),_.remove();return}await g(se,D.name||e.name||"image")}return(D,se)=>(d(),H(Xa,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:r(()=>[a.value?(d(),k("div",{key:0,class:"fixed inset-0 z-[100] bg-black/70",onClick:te},[m("div",yr,[m("div",br,[m("div",_r,[m("button",{class:"rounded bg-slate-200 px-2 py-1 hover:bg-slate-100 text-slate-900",onClick:xe(X,["stop"])}," Скачать ")]),m("button",{class:"rounded bg-slate-200 px-2 py-1 hover:bg-slate-100 text-slate-900",onClick:te}," Закрыть ")]),m("div",{ref_key:"viewportRef",ref:V,class:"relative flex-1 outline-none",tabindex:"0",onWheelPassive:xe(B,["prevent"]),onPointerdown:pe,onPointermove:R,onPointerup:Y,onPointercancel:Y,onLostpointercapture:Y},[(e.items?.length||0)>1?(d(),k("button",{key:0,class:"text-5xl z-20 absolute cursor-pointer left-2 top-1/2 -translate-y-1/2 text-white h-9 w-9 grid place-items-center",title:"Предыдущее",onClick:xe(c,["stop"])}," ‹ ")):W("",!0),(e.items?.length||0)>1?(d(),k("button",{key:1,class:"text-5xl z-20 absolute cursor-pointer right-2 top-1/2 -translate-y-1/2 text-white h-9 w-9 grid place-items-center",title:"Следующее",onClick:xe(S,["stop"])}," › ")):W("",!0),m("div",xr,[m("div",{class:"max-w-full max-h-full",style:gt({transform:`translate(${x.value}px, ${b.value}px) scale(${y.value})`,transformOrigin:"center center",transition:t(C)?"none":"transform 60ms linear"})},[v.value?(d(),k("img",{key:0,src:v.value,alt:e.items&&e.items[h.value]?.name||e.name||"",class:"block max-w-[85vw] max-h-[75vh] md:max-w-[92vw] md:max-h-[85vh] object-contain rounded shadow",loading:"eager",referrerpolicy:"no-referrer",onClick:xe(S,["stop"]),onError:se[0]||(se[0]=()=>{const _=e.items&&e.items[h.value]?.path||e.path||"";P(_)||t(u)(_,1920)})},null,40,kr)):(d(),k("div",wr,"Загрузка…"))],4)])],544),m("div",Cr,[(e.items?.length||0)>1?(d(),k("span",$r,L(h.value+1+"/"+e.items.length),1)):W("",!0),U(" "+L(e.items&&e.items[h.value]?.name||e.name||"Изображение"),1)])])])):W("",!0)]),_:1}))}});function Ut(o,a="Europe/Moscow"){const e=o instanceof Date?o:new Date(o);return Number.isNaN(e.getTime())?"":new Intl.DateTimeFormat("ru-RU",{timeZone:a,day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).format(e)}function ra(o){return o instanceof HTMLTextAreaElement?o:o.querySelector?.("textarea")||null}function rt(o){const a=ra(o);a&&(a.style.height="auto",a.style.overflow="hidden",a.style.height=`${a.scrollHeight}px`)}const bt={mounted(o){const a=ra(o);if(!a)return;const e=()=>rt(o);a.addEventListener("input",e);const l=()=>rt(o);o.addEventListener("autoresize:resize",l),requestAnimationFrame(()=>rt(o)),o._autoResizeCleanup=()=>{a.removeEventListener("input",e),o.removeEventListener("autoresize:resize",l)}},updated(o){rt(o)},unmounted(o){o._autoResizeCleanup?.()}},Ir={class:"h-full bg-neutral-700"},Sr={key:0,class:"flex flex-wrap gap-2 px-2"},Tr=["src","onClick"],Ar=["src"],Br={key:2,class:"h-20 w-20 rounded-md bg-neutral-200 text-neutral-600 text-xs flex items-center justify-center px-1 text-center"},Er=["onClick"],qr={class:"flex items-center justify-between gap-3 px-2"},Ur={class:"flex items-center gap-2"},Dr={class:"text-xs text-neutral-500"},Fr=["disabled"],Mr={key:0,class:"text-sm text-neutral-500"},Lr={key:1,class:"text-sm text-red-500"},Or={class:"space-y-3 p-2 bg-neutral-800 h-full pb-5"},Pr=["disabled","onClick"],Rr=["title","disabled","onClick"],zr={class:"mb-1 flex items-center gap-2 text-xs text-neutral-500 justify-between"},Nr={class:"text-neutral-400"},Kr={key:0,class:"mt-1 flex items-start gap-2"},jr=["title","aria-label","disabled"],Hr={key:1,class:"mx-auto h-4 w-4 animate-spin text-neutral-200",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Wr={key:1,class:"whitespace-pre-wrap text-[15px] text-neutral-300"},Gr={key:2,class:"mt-3 flex flex-col gap-2"},Xr={key:0,class:"flex gap-2 items-start relative overflow-hidden rounded-md border border-neutral-500 bg-neutral-700/40 p-1"},Yr=["src","srcset","onClick","onError"],Qr={class:"min-w-0 flex flex-col grow h-full"},Jr={class:"flex gap-1"},Zr=["title"],ei={class:"text-[11px] text-neutral-400 whitespace-nowrap"},ti={class:"flex flex-col mt-5 gap-1"},ai={key:0,class:"text-xs text-emerald-400"},li=["onClick"],ni=["onClick"],oi=["title"],si=["src"],ri=["title","onClick"],ii={class:"flex-1 min-w-0"},ui=["title"],di={class:"text-[11px] text-neutral-400 whitespace-nowrap"},ci=["title","onClick"],pi={class:"flex-1 min-w-0 flex items-center gap-2"},fi={class:"text-xs text-neutral-300 truncate"},mi={class:"text-[11px] text-neutral-400 ml-auto whitespace-nowrap"},vi=["title","onClick"],hi={class:"flex-1 min-w-0 flex items-center gap-2"},gi={class:"text-xs text-neutral-300 truncate"},yi={class:"text-[11px] text-neutral-400 ml-auto whitespace-nowrap"},bi=["title","onClick"],_i={class:"flex-1 min-w-0 flex items-center gap-2"},xi={class:"text-xs text-neutral-300 truncate"},ki={class:"text-[11px] text-neutral-400 ml-auto whitespace-nowrap"},wi=["title","onClick"],Ci={class:"h-6 w-10 flex items-center justify-center bg-neutral-600 text-neutral-200 text-[11px] rounded"},$i={class:"flex-1 min-w-0 flex items-center gap-2"},Vi={class:"text-xs text-neutral-300 truncate"},Ii={class:"text-[11px] text-neutral-400 ml-auto whitespace-nowrap"},Si={key:0,class:"text-sm text-neutral-500"},ze=10,Ti=le({__name:"TaskComments",props:{taskId:{},cover:{}},emits:["cover-set"],setup(o,{emit:a}){const{getPreviewSrc:e,getPreviewSrcset:l,onImgError:i,downloadAttachment:u,getDownloadSrc:g}=Xt(),v=et({open:!1,path:"",name:"",items:[],index:0}),h=T(new Set),I=T(null),V=T(""),y=T(null),x=T(!1),b=T(null),C=$=>{b.value=$ instanceof HTMLTextAreaElement?$:null};async function A($,O){const{path:J,mimeType:ie,name:ke}=$;if(J){if(["image/jpeg","image/png","image/webp","image/gif"].includes(ie)){if(O){const w=(O.files||[]).filter(ce=>(ce.mimeType||"").startsWith("image/"));v.items=w.map(ce=>({path:ce.path,name:ce.name})),v.index=Math.max(0,w.findIndex(ce=>ce.path===J))}else v.items=[{path:J,name:ke}],v.index=0;v.path=J,v.name=ke,v.open=!0;return}if((ie||"").startsWith("video/")){const w=g(J);w&&window.open(w,"_blank","noopener,noreferrer");return}if((ie||"")==="application/pdf"){await M(J,ke);return}if((ie||"")==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"||(ke||"").toLowerCase().endsWith(".docx")){await p(J,ke);return}await u(J,ke)}}const{$useApi:N}=Pe(),j=o,B=a,pe=sa(()=>j.taskId),R=T([]),Y=T(!1),ge=T(null),te=T(""),G=T(!1),z=et({}),S=T([]),c=T([]);T(null);const P=T(null),Q=T(!1);function Z($){const O=($.mimeType||"").toLowerCase(),J=($.name||"").toLowerCase();return O.includes("pdf")||J.endsWith(".pdf")}function X($){const O=($.mimeType||"").toLowerCase();return($.name||"").toLowerCase().endsWith(".cdr")||O.includes("corel")||O.includes("cdr")||O.includes("vnd.corel")}function D($){const O=($.mimeType||"").toLowerCase();return($.name||"").toLowerCase().endsWith(".docx")||O.includes("application/vnd.openxmlformats-officedocument.wordprocessingml.document")}function se($){if(!$&&$!==0)return"";if($===0)return"0 B";const O=1024,J=["B","KB","MB","GB","TB"],ie=Math.floor(Math.log($)/Math.log(O));return parseFloat(($/Math.pow(O,ie)).toFixed(2))+" "+J[ie]}const _=T(j.cover??null);we(()=>j.cover,$=>{_.value=$??null});const F=T({});function ne($){return!!F.value[$]}function ue($){return _.value===$}async function ve($){if(!(!$?.path||ne($.path)||ue($.path))){F.value[$.path]=!0;try{await pe.setCover($.path),_.value=$.path,B("cover-set",$.path)}catch(O){console.error("set cover from comment failed",O)}finally{F.value[$.path]=!1}}}async function Ie(){try{Y.value=!0,ge.value=null;const $=await N.get(`tasks/${j.taskId}/comments`);R.value=Array.isArray($.data)?$.data:$.data?.data??[]}catch($){ge.value=$?.message||"Не удалось загрузить комментарии",R.value=[]}finally{Y.value=!1}}function $e($){if(P.value=null,!$?.length)return;const O=ze-S.value.length;if(O<=0){P.value=`Можно прикрепить не более ${ze} файлов`;return}const J=$.slice(0,O);J.length<$.length&&(P.value=`Добавлены только ${J.length} из ${$.length}. Лимит ${ze}.`);for(const ie of J)S.value.push(ie),c.value.push(URL.createObjectURL(ie))}async function M($,O){try{const J=g($),ie=await N.get(J,{responseType:"blob"}),ke=new Blob([ie.data],{type:"application/pdf"}),w=URL.createObjectURL(ke),ce=window.open("","_blank");if(!ce){window.open(w,"_blank");return}ce.document.title=O||"PDF",ce.document.body.style.margin="0";const re=ce.document.createElement("iframe");re.style.border="0",re.style.width="100%",re.style.height="100vh",re.src=`${w}#toolbar=1&navpanes=1&view=FitH`,ce.document.body.appendChild(re)}catch(J){console.error("openPdfInline failed",J);const ie=g($);ie&&window.open(ie,"_blank","noopener,noreferrer")}}async function p($,O){try{const J=g($),ie=await N.get(J,{responseType:"blob"}),ke=new Blob([ie.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),w=URL.createObjectURL(ke);if(!window.open(w,"_blank","noopener,noreferrer")){const re=document.createElement("a");re.href=w,re.download=O||"document.docx",document.body.appendChild(re),re.click(),re.remove()}setTimeout(()=>URL.revokeObjectURL(w),1e4)}catch(J){console.error("openDocxInline failed",J);const ie=g($);ie&&window.open(ie,"_blank","noopener,noreferrer")}}function f($){const O=$.target,J=Array.from(O.files||[]);$e(J),O.value=""}function s($){$.preventDefault(),Q.value=!1;const O=Array.from($.dataTransfer?.files||[]);$e(O)}function E($){URL.revokeObjectURL(c.value[$]),c.value.splice($,1),S.value.splice($,1)}function q($){const O=S.value[$],J=c.value[$];!O||!J||O.type?.startsWith("image/")&&(v.path=J,v.name=O.name||"image",v.open=!0)}function ae(){c.value.forEach($=>URL.revokeObjectURL($)),c.value=[],S.value=[],te.value=""}async function me(){if(!(!te.value.trim()&&S.value.length===0)){G.value=!0;try{const $=await N.post(`tasks/${j.taskId}/comments`,{text:te.value.trim()}),O=$?.data?.id??$?.id;if(!O)throw new Error("Не удалось создать комментарий");S.value.length&&await Promise.all(S.value.map(J=>{const ie=new FormData;return ie.append("file",J),N.post(`tasks/comments/${O}/files`,ie)})),ae(),await Ie()}catch($){console.error($)}finally{G.value=!1}}}function ye($){P.value=null;const O=$.clipboardData?.items;if(!O)return;const J=ze-S.value.length;if(J<=0){P.value=`Можно прикрепить не более ${ze} файлов`;return}const ie=[];for(const w of O)if(w.kind==="file"&&w.type.startsWith("image/")){const ce=w.getAsFile();ce&&ie.push(ce)}if(!ie.length)return;const ke=ie.slice(0,J);ke.length<ie.length&&(P.value=`Добавлены только ${ke.length} из ${ie.length}. Лимит ${ze}.`);for(const w of ke)S.value.push(w),c.value.push(URL.createObjectURL(w));$.preventDefault()}function Fe($){$.key==="Enter"&&!$.shiftKey&&!$.altKey&&!$.ctrlKey&&!$.metaKey&&!$.isComposing&&($.preventDefault(),G.value||me())}function Me($){$&&(y.value=null,I.value=$.id,V.value=$.text,Ce(()=>{if(b.value){b.value.focus();const O=V.value.length;b.value.setSelectionRange(O,O)}}))}function Ee(){I.value=null,V.value="",y.value=null,b.value=null}async function Le(){const $=I.value;if(!$)return;const O=V.value.trim();if(!O){y.value="Текст комментария не может быть пустым";return}x.value=!0,y.value=null;try{const J={text:O},ie=await N.patch(`comments/${$}`,J),ke=ie?.data??ie;R.value=R.value.map(w=>w.id===$?{...w,text:ke?.text??O,updatedAt:ke?.updatedAt??w.updatedAt}:w),Ee()}catch(J){console.error(J),y.value=J?.message||"Не удалось сохранить комментарий"}finally{x.value=!1}}function qe($){if($.key==="Enter"&&!$.shiftKey&&!$.altKey&&!$.ctrlKey&&!$.metaKey){$.preventDefault(),x.value||Le();return}$.key==="Escape"&&($.preventDefault(),x.value||Ee())}async function Re($){if($)try{h.value.add($),await N.delete(`comments/${$}`),R.value=R.value.filter(O=>O.id!==$),I.value===$&&Ee()}catch(O){console.error(O)}finally{h.value.delete($)}}return Ve(Ie),kt(()=>{c.value.forEach($=>URL.revokeObjectURL($))}),($,O)=>{const J=yl,ie=$t,ke=ur,w=fr,ce=gr,re=Vr;return d(),k("section",Ir,[m("form",{class:Be(["space-y-1 border-b-1 border-b-neutral-500 pb-2",t(Q)?"ring-2 ring-indigo-500 ring-offset-0":""]),onDragenter:O[1]||(O[1]=xe(de=>Q.value=!0,["prevent"])),onDragover:O[2]||(O[2]=xe(()=>{},["prevent"])),onDragleave:O[3]||(O[3]=xe(de=>Q.value=!1,["prevent"])),onDrop:s,onSubmit:xe(me,["prevent"])},[yt(m("textarea",{"onUpdate:modelValue":O[0]||(O[0]=de=>Ke(te)?te.value=de:null),rows:"3",class:"w-full bg-neutral-600/50 text-neutral-300 border-neutral-300 h-[100px] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-neutral-500",placeholder:"Напишите комментарий… Перетащите файлы сюда, или Ctrl+V для изображения",onPaste:ye,onKeydown:Fe},null,544),[[Lt,t(te)],[t(bt)]]),t(S).length?(d(),k("div",Sr,[(d(!0),k(he,null,be(t(c),(de,K)=>(d(),k("div",{key:de,class:"relative"},[t(S)[K]&&t(S)[K].type.startsWith("image/")?(d(),k("img",{key:0,src:de,class:"h-20 w-20 rounded-md object-cover cursor-zoom-in",alt:"",title:"Открыть предпросмотр",onClick:Ae=>q(K)},null,8,Tr)):t(S)[K]&&t(S)[K].type.startsWith("video/")?(d(),k("video",{key:1,src:de,class:"h-20 w-28 rounded-md object-cover",muted:"",controls:"",playsinline:""},null,8,Ar)):(d(),k("div",Br,L(t(S)[K]?.name.split(".").pop()),1)),m("button",{type:"button",class:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-white border shadow text-xs","aria-label":"Удалить файл",title:"Удалить файл",onClick:Ae=>E(K)}," ✕ ",8,Er)]))),128))])):W("",!0),m("div",qr,[m("div",Ur,[m("input",{id:"comment-file-input",type:"file",class:"hidden",multiple:"",accept:"image/*,video/*,application/pdf,.cdr,application/x-coreldraw,application/vnd.corel-draw,image/x-cdr,application/vnd.openxmlformats-officedocument.wordprocessingml.document,.docx",onChange:f},null,32),m("label",{for:"comment-file-input",class:Be(["cursor-pointer rounded-lg px-3 py-1.5 text-sm text-neutral-300 bg-green-900 hover:bg-neutral-600/50",t(S).length>=ze?"pointer-events-none opacity-50":""]),title:"Прикрепить файлы"}," Прикрепить ",2),m("span",Dr,L(t(S).length)+"/"+L(ze),1)]),m("button",{type:"submit",class:"rounded-lg bg-neutral-600 px-4 py-2 text-neutral-300 cursor-pointer text-sm disabled:opacity-50",disabled:t(G)||!t(te).trim()&&t(S).length===0},L(t(G)?"Отправляем…":"Отправить"),9,Fr)])],34),t(Y)?(d(),k("div",Mr,"Загрузка…")):t(ge)?(d(),k("div",Lr,L(t(ge)),1)):W("",!0),m("div",Or,[(d(!0),k(he,null,be(t(R),de=>(d(),k("div",{key:de.id,class:"group relative rounded-md border-1 border-neutral-500/20 bg-neutral-600 p-2"},[m("div",{class:Be(["absolute top-[-8px] right-[-8px] gap-1",t(I)===de.id?"flex":"hidden group-hover:flex group-focus-within:flex"])},[m("button",{type:"button",class:"cursor-pointer text-xs h-5 w-5 rounded-full border border-neutral-400/40 bg-neutral-700/70 text-neutral-200 hover:bg-neutral-700 focus:outline-none disabled:opacity-50",title:"Редактировать комментарий",disabled:t(x)&&t(I)===de.id,"aria-label":"Редактировать комментарий",onClick:xe(K=>Me(de),["stop"])},[n(J,{name:"lucide:pencil",class:"h-3 w-3"})],8,Pr),m("button",{type:"button",class:"cursor-pointer text-xs h-5 w-5 rounded-full border border-neutral-400/40 bg-neutral-700/70 text-neutral-200 hover:bg-neutral-700 focus:outline-none disabled:opacity-50",title:t(h).has(de.id)?"Удаляем…":"Удалить комментарий",disabled:t(h).has(de.id),"aria-label":"Удалить комментарий",onClick:xe(K=>Re(de.id),["stop"])}," ✕ ",8,Rr)],2),m("div",zr,[(d(),H(ie,{key:de.author.id,"full-name":de.author.fullName,"avatar-url":de.author.avatarUrl,dark:!0,tg:de.author.tg,size:"sm"},null,8,["full-name","avatar-url","tg"])),m("span",Nr,L(("formatRuDateTime"in $?$.formatRuDateTime:t(Ut))(de.createdAt)),1)]),t(I)===de.id?(d(),k("div",Kr,[yt(m("textarea",{ref_for:!0,ref:C,"onUpdate:modelValue":O[4]||(O[4]=K=>Ke(V)?V.value=K:null),rows:"3",class:"w-full rounded-md bg-neutral-500/60 px-3 py-2 text-[15px] text-neutral-100 focus:outline-none focus:ring-2 focus:ring-neutral-300",placeholder:"Измените комментарий",onKeydown:qe},null,544),[[Lt,t(V)],[t(bt)]]),m("button",{type:"button",class:"mt-1 h-9 w-9 shrink-0 rounded-full border border-neutral-400/40 bg-neutral-700/70 text-neutral-100 hover:bg-neutral-700 focus:outline-none disabled:opacity-50",title:t(x)?"Сохраняем…":"Сохранить","aria-label":t(x)?"Сохраняем":"Сохранить комментарий",disabled:t(x)||!t(V).trim(),onClick:O[5]||(O[5]=xe(K=>Le(),["stop"]))},[t(x)?(d(),k("svg",Hr,O[7]||(O[7]=[m("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),m("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"},null,-1)]))):(d(),H(J,{key:0,name:"lucide:save",class:"mx-auto h-4 w-4"}))],8,jr)])):(d(),k("div",Wr,L(de.text),1)),de.files?.length?(d(),k("div",Gr,[(d(!0),k(he,null,be(de.files,K=>(d(),k(he,{key:K.id},[(K.mimeType||"").startsWith("image/")?(d(),k("div",Xr,[m("img",{src:t(e)(K.path,160),srcset:t(l)(K.path,160),alt:"",class:"h-24 w-40 object-cover rounded bg-neutral-800 cursor-zoom-in",loading:"lazy",referrerpolicy:"no-referrer",onClick:Ae=>A(K,de),onError:()=>t(i)(K.path,160)},null,40,Yr),m("div",Qr,[m("div",Jr,[m("div",{class:"text-xs text-neutral-300 truncate",title:K.name},L(K.name),9,Zr),m("div",ei," ("+L(se(K.size))+") ",1)]),m("div",ti,[ue(K.path)?(d(),k("span",ai," Обложка ")):(d(),k("span",{key:1,class:Be(["text-xs text-neutral-400 underline cursor-pointer",ne(K.path)?"opacity-60 pointer-events-none":""]),title:"Поставить на обложку",onClick:xe(Ae=>ve(K),["stop"])},L(ne(K.path)?"Устанавливаем…":"Поставить на обложку"),11,li)),m("span",{class:"text-xs text-neutral-400 underline cursor-pointer",title:"Скачать изображение",onClick:xe(Ae=>t(u)(K.path,K.name),["stop"])}," Скачать изображение ",8,ni)])])])):(K.mimeType||"").startsWith("video/")?(d(),k("div",{key:1,class:"flex gap-2 items-center relative overflow-hidden rounded-md border border-neutral-500 bg-neutral-700/40 p-1",title:K.name},[t(z)[K.id]?(d(),k("video",{key:0,src:t(g)(K.path),class:"h-24 w-40 object-cover rounded",controls:"",autoplay:"",playsinline:""},null,8,si)):(d(),k("button",{key:1,type:"button",class:"h-24 w-40 rounded bg-neutral-800/70 hover:bg-neutral-700/70 flex items-center justify-center text-neutral-200",title:`Воспроизвести: ${K.name}`,onClick:Ae=>t(z)[K.id]=!0}," ▶ ",8,ri)),m("div",ii,[m("div",{class:"text-xs text-neutral-300 truncate",title:K.name},L(K.name),9,ui),m("div",di,L(se(K.size)),1)])],8,oi)):Z(K)?(d(),k("button",{key:2,type:"button",class:"flex gap-2 items-center relative overflow-hidden rounded-md border border-neutral-500 hover:bg-neutral-500/30 cursor-pointer px-2 py-1",title:K.name,onClick:Ae=>A(K)},[n(ke,{class:"w-10 h-10"}),m("div",pi,[m("span",fi,L(K.name),1),m("span",mi,L(se(K.size)),1)])],8,ci)):D(K)?(d(),k("button",{key:3,type:"button",class:"flex gap-2 items-center relative overflow-hidden rounded-md border border-neutral-500 hover:bg-neutral-500/30 cursor-pointer px-2 py-1",title:K.name,onClick:Ae=>A(K)},[n(w,{class:"w-10 h-10"}),m("div",hi,[m("span",gi,L(K.name),1),m("span",yi,L(se(K.size)),1)])],8,vi)):X(K)?(d(),k("button",{key:4,type:"button",class:"flex gap-2 items-center relative overflow-hidden rounded-md border border-neutral-500 hover:bg-neutral-500/30 cursor-pointer px-2 py-1",title:K.name,onClick:Ae=>A(K)},[n(ce,{class:"w-10 h-10"}),m("div",_i,[m("span",xi,L(K.name),1),m("span",ki,L(se(K.size)),1)])],8,bi)):(d(),k("button",{key:5,type:"button",class:"flex gap-2 items-center relative overflow-hidden rounded-md border border-neutral-500 hover:bg-neutral-500/30 cursor-pointer px-2 py-1",title:K.name,onClick:Ae=>A(K)},[m("div",Ci,L(K.name.split(".").pop()),1),m("div",$i,[m("span",Vi,L(K.name),1),m("span",Ii,L(se(K.size)),1)])],8,wi))],64))),128))])):W("",!0)]))),128)),t(R).length?W("",!0):(d(),k("div",Si," Пока нет комментариев "))]),n(re,{open:t(v).open,"onUpdate:open":O[6]||(O[6]=de=>t(v).open=de),path:t(v).path,name:t(v).name,items:t(v).items,index:t(v).index},null,8,["open","path","name","items","index"])])}}}),Ai=pt(Ti,[["__scopeId","data-v-3ae3c54f"]]),Bi={class:"space-y-2"},Ei={key:0,class:"text-xs text-neutral-500"},qi={key:1,class:"text-xs text-red-500"},Ui={key:2,class:"text-xs text-neutral-500"},Di={key:3,class:"divide-y"},Fi={class:"flex items-center justify-between"},Mi={class:"mr-3"},Li={class:"shrink-0 text-[11px] text-neutral-400"},Oi={key:0,class:"mt-1 ml-10 list-disc text-[12px] text-neutral-700"},Pi={class:"font-medium"},Ri={key:0,class:"text-neutral-500 line-through mr-1"},zi={class:"text-neutral-400"},Ni=le({__name:"AuditPanel",props:{taskId:{},refreshable:{type:Boolean}},setup(o){const a=o,{$useApi:e}=Pe(),l=T([]),i=T(!1),u=T(null);async function g(){if(a.taskId){i.value=!0,u.value=null;try{const{data:I}=await e.get(`tasks/${a.taskId}/audit`);l.value=Array.isArray(I)?I:[]}catch(I){u.value=I?.message||"Не удалось загрузить историю",l.value=[]}finally{i.value=!1}}}function v(I){switch(I){case"title":return"Название";case"description":return"Описание";case"chatLink":return"Ссылка";case"columnId":return"Колонка";default:return I}}function h(I){return I==null?"":String(I)}return Ve(g),(I,V)=>{const y=We,x=$t;return d(),k("div",Bi,[t(i)?(d(),k("div",Ei,"Загрузка…")):t(u)?(d(),k("div",qi,L(t(u)),1)):t(l).length?(d(),k("div",Di,[(d(!0),k(he,null,be(t(l),b=>(d(),k("div",{key:b.id,class:"py-2"},[m("div",Fi,[m("div",Mi,[n(x,{"full-name":b.user.fullName,"avatar-url":b.user.avatarUrl,size:"md",dark:!0},null,8,["full-name","avatar-url"])]),m("div",Li,L(("formatRuDateTime"in I?I.formatRuDateTime:t(Ut))(b.createdAt)),1)]),b.payload?(d(),k("div",Oi,[m("span",Pi,L(v(b.payload.field))+" - ",1),h(b.payload.from)!==""?(d(),k("span",Ri,L(h(b.payload.from)),1)):W("",!0),m("span",zi,L(b.description),1)])):W("",!0)]))),128))])):(d(),k("div",Ui,[V[1]||(V[1]=U(" История пуста ",-1)),I.refreshable?(d(),H(y,{key:0,size:"sm",variant:"ghost",class:"ml-2",onClick:g},{default:r(()=>V[0]||(V[0]=[U(" Обновить ",-1)])),_:1,__:[0]})):W("",!0)]))])}}}),Ki={key:0,class:"fixed inset-0 z-[11]"},ji={class:"relative z-10 flex min-h-full items-center justify-center p-0 sm:p-2"},Hi={key:0,class:"relative w-full max-w-6xl h-[100dvh] sm:h-[calc(100vh-0.5rem)] sm:mt-1 bg-neutral-800 border border-neutral-700 flex flex-col gap-0 overflow-hidden p-0 sm:rounded-lg"},Wi={class:"sticky top-0 z-10 flex gap-1 sm:flex-nowrap items-center justify-between border-b bg-neutral-700 px-4 sm:px-5 py-3 sm:py-4 border-b-neutral-500"},Gi={class:"flex items-center gap-2 w-full"},Xi={key:0,class:"whitespace-nowrap text-neutral-300 text-xl border-1 border-neutral-600 p-1 rounded-md bg-red-700/50"},Yi=["title","onClick"],Qi={class:"relative flex-1 min-h-0 overflow-hidden"},Ji={class:"min-h-full grid grid-cols-1 md:grid-cols-7 pr-2 bg-neutral-800"},Zi={class:"sm:col-span-4 bg-neutral-800 mb-3"},eu={class:"mb-4 space-y-1"},tu={class:"text-sm text-neutral-300"},au={class:"text-xs text-neutral-400"},lu={class:"my-4 relative"},nu={class:"relative flex gap-2 items-center mt-4"},ou={class:"relative flex items-center gap-2"},su=["href"],ru={class:"relative flex items-center gap-2 text-neutral-300 mt-4"},iu={class:"relative mt-5"},uu={class:"sm:col-span-3 min-h-full h-fit border-l-1 border-neutral-500"},du={class:"px-1"},Ku=le({__name:"TaskModal",props:{open:{type:Boolean},taskId:{}},emits:["update:open","delete","move"],setup(o,{emit:a}){const e=Zt(),{toast:l}=Ya(),i=Qa(),u=Gt(),g=oe(()=>Number(u.params.id)),v=T(null),h=sa(()=>v.value??N.taskId),I=oe(()=>e.user),V=oe(()=>I.value?.boards??[]),y=T(!1),x=T(!1),b=T(!1),C=T(!1),A=T(!1),N=o,j=a,B=T(null),pe=T("main"),R=T(!1);async function Y(){if(v.value??N.taskId){y.value=!0;try{const s=await h.getTask();B.value=s,B.value.avaliableDeals=B.value.avaliableDeals??[],B.value.deliveries=B.value.deliveries??[],ge.title=void 0,ge.description=void 0,ge.chatLink=void 0,Ce(()=>p.value?.dispatchEvent(new Event("autoresize:resize")))}catch(s){console.error("fetchFullTask failed",s),i.push({path:`/boards/${g.value}`})}finally{y.value=!1}}}const ge=et({});function te(f){if(!B.value)return;const s=B.value[f]??"";ge[f]=String(s)}async function G(f){if(!B.value)return;const s=String(B.value[f]??""),E=String(ge[f]??"");if(s===E)return;const q={};f==="description"||f==="chatLink"?q[f]=s||null:q[f]=s;try{x.value=!0,await h.updateTask(q),ge[f]=s}catch(ae){console.error("save field failed",f,ae)}finally{x.value=!1,await Y()}}Ve(()=>{we(()=>N.taskId,f=>{f&&(v.value=Number(f),Y().catch(console.error))},{immediate:!0}),we(()=>N.open,f=>{if(f){const s=N.taskId;s&&(v.value=Number(s),Y().catch(console.error))}else v.value=null})});function z(){j("update:open",!1),v.value=null}async function S(){if(B.value){b.value=!0;try{await h.deleteTask(),j("update:open",!1),j("delete",B.value.id)}catch(f){console.error("deleteTask failed",f)}finally{b.value=!1}}}const c=oe({get(){return(B.value?.tags??[]).map(s=>({id:Number(s.id??0),name:s.name}))},set(f){if(!B.value)return;const s=new Map((B.value.tags??[]).map(E=>[E.name,E]));B.value.tags=f.map(E=>({...s.get(E.name),id:typeof E.id=="number"?E.id:void 0,name:E.name}))}});async function P(f){try{const s={toColumnId:Number(f.toColumnId)};await h.moveTask(s)}catch(s){return console.log(s)}}const Q=T(!1),Z=oe(()=>{const f=(B.value?.chatLink||"").trim();return f?/^https?:\/\//i.test(f)?f:`https://${f}`:""}),X=oe(()=>{const f=B.value?.deal?.id;if(typeof f!="number")return"";const s=Number(f);return!Number.isFinite(s)||s<=0?"":`/deals/${s}`});async function D(f){if(!Q.value){Q.value=!0;try{const s=await h.copyToBoard(f),E=Number(s?.id);if(Number.isFinite(E)){v.value=E;const q=Number(s?.boardId??f);q&&window.history.pushState({},"",`/boards/${q}/task/${E}`),await Y()}else await Y()}catch(s){console.error("copyToBoard error",s)}finally{Q.value=!1}}}async function se(f){if(!Q.value){Q.value=!0;try{const s=await h.moveToBoard(f),E=Number(s?.id);if(Number.isFinite(E)){v.value=E;const q=Number(s?.boardId??f);q&&window.history.pushState({},"",`/boards/${q}/task/${E}`),await Y()}else await Y()}catch(s){console.error("moveToBoard error",s)}finally{Q.value=!1}}}async function _(f){if(!(!B.value||C.value)){C.value=!0;try{await h.setArchived(!!f),B.value.archived=!!f,l({title:f?"Перемещено в архив":"Возвращено из архива"})}catch(s){console.error("setArchived failed",s),l({title:"Ошибка",description:"Не удалось изменить архивный статус"})}finally{C.value=!1}}}const F=Sl(),ne=oe(()=>`${F.protocol}//${F.host}`),ue=oe(()=>{if(!B.value)return"";const f=B.value.board?.id||g.value;return`${ne.value}/boards/${f}/task/${B.value.id}`});async function ve(){try{if(!ue.value)return;await navigator.clipboard.writeText(ue.value),l({title:"Ссылка скопирована",description:ue.value})}catch(f){console.error("copyTaskLink failed",f),l({title:"Не удалось скопировать",description:"Попробуйте ещё раз"})}}async function Ie(f){const s=String(f??"").trim();if(s)try{await navigator.clipboard.writeText(s),l({title:"Трек скопирован",description:s})}catch(E){console.error("copyTrack failed",E),l({title:"Не удалось скопировать трек",description:"Попробуйте ещё раз",variant:"destructive"})}}function $e(f){B.value&&(B.value.cover=f)}async function M(f){if(!f||!B.value||A.value)return;const s=Number(f);if(Number.isFinite(s))try{A.value=!0,await h.updateTask({dealId:s}),await Y(),l({title:"Сделка привязана",description:"Карточка обновлена"})}catch(E){console.error("linkDealToTask failed",E),l({title:"Не удалось привязать сделку",description:"Попробуйте ещё раз",variant:"destructive"})}finally{A.value=!1}}const p=T(null);return we(pe,f=>{f==="main"&&Ce(()=>p.value?.dispatchEvent(new Event("autoresize:resize")))}),(f,s)=>{const E=ct,q=We,ae=Fa,me=La,ye=jn,Fe=Hn,Me=Kn,Ee=Ma,Le=Da,qe=tl,Re=el,$=ll,O=Ct,J=no,ie=Yn,ke=St,w=It,ce=At,re=Bt,de=Tt,K=Vt,Ae=cl,ia=Co,ua=Et,mt=al,da=Ro,ca=or,pa=Za,fa=Ai,Dt=Qt,ma=_l,va=wl,ha=Cl,ga=kl,ya=Ni,ba=$l,_a=xl,xa=bl;return d(),k("div",null,[f.open?(d(),k("div",Ki,[m("div",{class:"absolute inset-0 bg-black/80",onClick:s[0]||(s[0]=ee=>z())}),m("div",ji,[t(B)?(d(),k("div",Hi,[m("div",Wi,[m("div",Gi,[t(B).archived?(d(),k("div",Xi," В архиве ")):W("",!0),n(E,{modelValue:t(B).title,"onUpdate:modelValue":s[1]||(s[1]=ee=>t(B).title=ee),class:"w-full rounded-lg border border-neutral-500/50 px-3 py-2 text-base font-semibold outline-none focus:ring-2 focus:ring-neutral-500 bg-neutral-700 text-neutral-300",placeholder:"Название карточки",onFocus:s[2]||(s[2]=ee=>te("title")),onBlur:s[3]||(s[3]=ee=>G("title"))},null,8,["modelValue"]),(d(!0),k(he,null,be(t(B).tracks||[],ee=>(d(),k("span",{key:ee,class:"text-neutral-300/70 border-1 rounded-sm px-2 border-neutral-500 h-10 flex items-center cursor-pointer",title:`Скопировать трек ${ee}`,onClick:Ft=>Ie(ee)},L(ee),9,Yi))),128))]),n(Le,null,{default:r(()=>[n(ae,null,{default:r(()=>[n(q,{class:"size-9 p-0 border-1 border-neutral-500/50 bg-neutral-700 text-neutral-300 hover:text-neutral-100 hover:bg-neutral-700 cursor-pointer",title:"Действия"},{default:r(()=>[n(t(Vl))]),_:1})]),_:1}),n(Ee,{class:"bg-neutral-700 text-neutral-300 z-[1111]"},{default:r(()=>[n(me,{class:Be(["cursor-pointer"]),onClick:s[4]||(s[4]=ee=>ve())},{default:r(()=>s[19]||(s[19]=[U("Скопировать ссылку на карточку",-1)])),_:1,__:[19]}),n(Me,null,{default:r(()=>[n(ye,{class:"cursor-pointer"},{default:r(()=>s[20]||(s[20]=[U(" Скопировать в ... ",-1)])),_:1,__:[20]}),n(Fe,{class:"bg-neutral-700 text-neutral-300"},{default:r(()=>[(d(!0),k(he,null,be(t(V),ee=>(d(),H(me,{key:ee.id,class:"cursor-pointer",onClick:Ft=>D(ee.id)},{default:r(()=>[U(L(ee.title),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),n(Me,null,{default:r(()=>[n(ye,{class:"cursor-pointer"},{default:r(()=>s[21]||(s[21]=[U(" Переместить в ... ",-1)])),_:1,__:[21]}),n(Fe,{class:"bg-neutral-700 text-neutral-300"},{default:r(()=>[(d(!0),k(he,null,be(t(V),ee=>(d(),H(me,{key:ee.id,class:"cursor-pointer",onClick:Ft=>se(ee.id)},{default:r(()=>[U(L(ee.title),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),n(me,{class:"cursor-pointer",onClick:s[5]||(s[5]=ee=>R.value=!0)},{default:r(()=>s[22]||(s[22]=[U("История изменений",-1)])),_:1,__:[22]}),n(me,{class:Be(["cursor-pointer"]),disabled:t(C),onClick:s[6]||(s[6]=ee=>_(!t(B).archived))},{default:r(()=>[U(L(t(B).archived?"Вернуть из архива":"Переместить в архив"),1)]),_:1},8,["disabled"]),n(me,{class:"cursor-pointer"},{default:r(()=>s[23]||(s[23]=[U("Дублировать карточку",-1)])),_:1,__:[23]}),n(me,{class:"cursor-pointer",onClick:s[7]||(s[7]=ee=>S())},{default:r(()=>s[24]||(s[24]=[U("Удалить карточку",-1)])),_:1,__:[24]})]),_:1})]),_:1}),n(q,{class:"p-0 size-9 border-1 border-neutral-500/50 bg-neutral-700 text-neutral-300 hover:text-neutral-100 hover:bg-neutral-700 cursor-pointer",title:"Закрыть",onClick:s[8]||(s[8]=ee=>z())},{default:r(()=>[n(t(ut))]),_:1})]),m("div",Qi,[n(Dt,{class:"h-full pb-[calc(env(safe-area-inset-bottom)+0.75rem)]"},{default:r(()=>[m("div",Ji,[m("div",Zi,[n(pa,{modelValue:t(pe),"onUpdate:modelValue":s[16]||(s[16]=ee=>Ke(pe)?pe.value=ee:null),"default-value":"main",class:""},{default:r(()=>[n(Re,{class:"ml-2 mt-2 bg-neutral-600 text-neutral-300"},{default:r(()=>[n(qe,{value:"main",class:"",onClick:Y},{default:r(()=>s[25]||(s[25]=[U(" Основное ",-1)])),_:1,__:[25]}),n(qe,{value:"prod"},{default:r(()=>s[26]||(s[26]=[U(" ТЗ ",-1)])),_:1,__:[26]}),n(qe,{value:"delivery"},{default:r(()=>s[27]||(s[27]=[U(" Доставка ",-1)])),_:1,__:[27]})]),_:1}),n($,{class:"my-2 bg-neutral-500"}),n(mt,{value:"main",class:"p-3"},{default:r(()=>[m("div",eu,[m("div",tu,[s[28]||(s[28]=m("span",{class:"font-medium"},"Создатель:",-1)),U(" "+L(t(B).creator?.fullName||t(B).creator?.email||"—"),1)]),m("div",au,[s[29]||(s[29]=m("span",{class:"font-medium"},"Создана:",-1)),U(" "+L(("formatRuDateTime"in f?f.formatRuDateTime:t(Ut))(t(B).createdAt)||"—"),1)]),m("div",lu,[n(O,{class:"font-light text-neutral-400 absolute left-2 top-[-8px] bg-neutral-700 rounded-sm px-1"},{default:r(()=>s[30]||(s[30]=[U("Участники",-1)])),_:1,__:[30]}),n(J,{"task-id":t(B).id,actions:!0},null,8,["task-id"])]),m("div",nu,[n(O,{class:"font-light text-neutral-400 absolute left-2 top-[-8px] bg-neutral-700 rounded-sm px-1"},{default:r(()=>[U("Расположение("+L(t(B).board.title)+")",1)]),_:1}),n(ie,{"task-id":f.taskId,"column-id":t(B).columnId,label:t(B).column.title,onUpdateTaskColumn:P},null,8,["task-id","column-id","label"])])]),m("div",ou,[t(B).chatLink?(d(),H(O,{key:0,class:"font-light text-neutral-400 absolute left-2 top-[-8px] bg-neutral-700 rounded-sm px-1"},{default:r(()=>s[31]||(s[31]=[U("Ссылка на сделку",-1)])),_:1,__:[31]})):W("",!0),n(E,{modelValue:t(B).chatLink,"onUpdate:modelValue":s[9]||(s[9]=ee=>t(B).chatLink=ee),placeholder:"Ссылка на сделку",class:Be(["bg-neutral-700 text-neutral-300 placeholder:text-neutral-500 border-neutral-500/50"]),onFocus:s[10]||(s[10]=ee=>te("chatLink")),onBlur:s[11]||(s[11]=ee=>G("chatLink"))},null,8,["modelValue"]),t(B).chatLink?(d(),k("a",{key:1,href:t(Z),target:"_blank",rel:"noopener",class:"inline-flex h-10 w-10 items-center justify-center rounded-md border border-neutral-500/50 bg-neutral-700 text-neutral-300 transition-colors hover:bg-neutral-600 hover:text-neutral-100",title:"Открыть ссылку в новой вкладке"},[n(t(Ot),{class:"h-4 w-4"})],8,su)):W("",!0)]),m("div",ru,[n(O,{class:Be([t(B).deal?" text-neutral-400":"text-red-500","absolute left-2 top-[-8px] font-light bg-neutral-700 rounded-sm px-1 z-1"])},{default:r(()=>s[32]||(s[32]=[U("Сделка в системе",-1)])),_:1,__:[32]},8,["class"]),n(K,{"model-value":t(B).deal?.id?.toString(),disabled:t(A),"onUpdate:modelValue":M},{default:r(()=>[n(w,{class:Be(["cursor-pointer bg-neutral-700 placeholder:text-neutral-500 border-neutral-500/50",t(A)?"opacity-60 cursor-progress":""])},{default:r(()=>[n(ke,{class:"placeholder:text-red-500",placeholder:"Связать со сделкой"})]),_:1},8,["class"]),n(de,{class:"bg-neutral-700 text-neutral-300 placeholder:text-neutral-500 border-neutral-500/50"},{default:r(()=>[n(re,null,{default:r(()=>[(d(!0),k(he,null,be(t(B).avaliableDeals,ee=>(d(),H(ce,{key:ee.id,value:ee.id.toString()},{default:r(()=>[U(' "'+L(ee.title)+'" от '+L(ee.saleDate.split("-").reverse().join(".")),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["model-value","disabled"]),t(X)?(d(),H(Ae,{key:0,to:t(X),target:"_blank",rel:"noopener",class:"inline-flex h-10 w-10 items-center justify-center rounded-md border border-neutral-500/50 bg-neutral-700 text-neutral-300 transition-colors hover:bg-neutral-600 hover:text-neutral-100",title:"Открыть сделку"},{default:r(()=>[n(t(Ot),{class:"h-4 w-4"})]),_:1},8,["to"])):W("",!0)]),m("div",iu,[n(O,{class:"font-light text-neutral-400 absolute left-2 top-[-8px] bg-neutral-700 rounded-sm px-1"},{default:r(()=>s[33]||(s[33]=[U("Метки",-1)])),_:1,__:[33]}),n(ia,{modelValue:t(c),"onUpdate:modelValue":s[12]||(s[12]=ee=>Ke(c)?c.value=ee:null),"board-id":t(B).board.id,"task-id":f.taskId,"initial-selected":t(B).tags.map(ee=>ee.name),warnings:t(B).warnings},null,8,["modelValue","board-id","task-id","initial-selected","warnings"])]),m("div",{ref_key:"descWrap",ref:p,class:"relative mt-5"},[t(B).description?(d(),H(O,{key:0,class:"font-light text-neutral-400 absolute left-2 top-[-8px] bg-neutral-700 rounded-sm px-1"},{default:r(()=>s[34]||(s[34]=[U("Описание",-1)])),_:1,__:[34]})):W("",!0),yt(n(ua,{modelValue:t(B).description,"onUpdate:modelValue":s[13]||(s[13]=ee=>t(B).description=ee),rows:"1",class:"resize-none overflow-hidden mt-1 min-h-[200px] w-full rounded-sm border bg-neutral-700 text-neutral-300 placeholder:text-neutral-500 border-neutral-500/50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Опишите задачу",onFocus:s[14]||(s[14]=ee=>te("description")),onBlur:s[15]||(s[15]=ee=>G("description"))},null,8,["modelValue"]),[[t(bt)]])],512)]),_:1}),n(mt,{value:"delivery",class:"h-full px-3 pt-3"},{default:r(()=>[n(da,{"task-id":f.taskId,"initial-deliveries":t(B).deliveries,onChanged:Y},null,8,["task-id","initial-deliveries"])]),_:1}),n(mt,{value:"prod",class:"h-full px-3 pt-3"},{default:r(()=>[n(ca,{"task-id":f.taskId},null,8,["task-id"])]),_:1})]),_:1},8,["modelValue"])]),m("aside",uu,[(d(),H(fa,{key:t(B).id,"task-id":t(B).id,cover:t(B).cover,onCoverSet:$e},null,8,["task-id","cover"]))])])]),_:1})])])):W("",!0),n(xa,{open:t(R),"onUpdate:open":s[18]||(s[18]=ee=>Ke(R)?R.value=ee:null)},{default:r(()=>[n(ma,{class:"hidden"}),n(_a,{"z-index":70,class:"max-w-3xl bg-neutral-800 border-neutral-700",onOpenAutoFocus:s[17]||(s[17]=ee=>ee.preventDefault())},{default:r(()=>[n(ga,null,{default:r(()=>[n(va,{class:"text-neutral-300"},{default:r(()=>s[35]||(s[35]=[U("История изменений",-1)])),_:1,__:[35]}),n(ha)]),_:1}),n(Dt,{class:"h-[calc(100vh-300px)]"},{default:r(()=>[m("div",du,[n(ya,{"task-id":t(B)?.id||0,refreshable:""},null,8,["task-id"])])]),_:1}),n(ba)]),_:1})]),_:1},8,["open"])])])):W("",!0)])}}});export{Yn as _,sa as a,Sl as b,Ku as c,zt as u};
