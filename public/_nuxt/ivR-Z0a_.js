import{_ as J}from"./Bye7C16d.js";import{_ as K}from"./D0zfKHPR.js";import{_ as Q,a as W}from"./l1eRtAXP.js";import{_ as X}from"./BhleEUCu.js";import{_ as Y,a as Z,s as tt,b as et}from"./CJuSa-E2.js";import{_ as ot,a as st,b as at}from"./BF3m7Vf0.js";import{_ as it}from"./CprHmdOe.js";import{_ as lt,a as nt,b as pt,c as mt,d as ut}from"./cStEOrWd.js";import{_ as rt}from"./BHuR11Jx.js";import{_ as _t}from"./DiZ4QL0M.js";import{e as dt,g as ct,u as ft,r as l,B as V,i as vt,c as C,a as n,b as e,w as o,m as M,l as yt,o as f,d as m,t as gt,D as B}from"./BbheI0mw.js";import{u as F}from"./Dt19OLxm.js";import"./CDst0A0O.js";import"./B9M8ggfK.js";import"./D0Fd2yXn.js";import"./oLxPQbNe.js";import"./D2GZmoDz.js";import"./CaPtdwNj.js";import"./DVdymwQ5.js";import"./KSX9JOtw.js";import"./ZTyVILcU.js";import"./s39mgViW.js";import"./CJOOd8Dx.js";import"./BR3DQNok.js";import"./odSmgr3d.js";import"./DzJc7hp_.js";import"./CCknexPU.js";import"./C30fSUvl.js";import"./C-JUEUN9.js";import"./DAmwS8V7.js";import"./DAy9nm00.js";import"./_14b2CUj.js";import"./JYeLPbKT.js";import"./DLLw9AXE.js";import"./CHKwxJtM.js";import"./BWn7SjA7.js";import"./DFFUo3JN.js";import"./DImM_Wqr.js";import"./C6vK2VYI.js";import"./lvbecDJM.js";import"./Boz4PYjF.js";import"./CssJESp-.js";const wt={class:"relative h-screen hidden-scrollbar"},xt={class:"w-full fixed z-10"},St={class:"h-full flex flex-col p-4 gap-2 mx-[auto] max-w-[2048px] pt-16 min-w-[1024px]"},Dt={class:"w-full flex gap-2"},Ut={class:"flex flex-col w-full gap-2"},$t={class:"flex gap-2"},bt={class:"flex items-center gap-2"},Vt={class:"flex items-center"},Ct={key:0,class:"ml-2"},Tt={key:1,class:"ml-2"},ge=dt({__name:"index",setup(kt){const{$useApi:w}=ct();ft({title:"Закупки | Easy CRM"});const u=l(!1),i=l(new Date().toISOString().slice(0,7)),p=l("this_month"),x=l(F(0)+"₽"),S=l(['ООО "ТДВ ГРУПП"',"ИП Королёв"]),D=l([]),r=l([]),U={date:new Date().toISOString().slice(0,10),shipmentDate:"",supplier:"",paymentMethod:"Счет",orderStatus:"Оформлен заказ",paymentStatus:"Не оплачен",deliveryMethod:"Доставка от поставщика",invoice:"",track:"",positions:[{name:"",quantity:1,priceForItem:1,category:""}]},v=l(U),T=async()=>{const{data:s}=await w.get("supplies/suppliers");S.value=s.map(d=>d.name)||[];const{data:t}=await w.get("supplies/positions");D.value=t||[]},_=async()=>{const{data:s}=await w.get("supplies",{params:{period:i.value}});r.value=s||[],x.value=k(r.value.filter(t=>!!t.id).map(t=>t.id))},k=s=>{const d=r.value.filter(c=>s.includes(c.id)).reduce((c,$)=>c+$.positions.reduce((b,y)=>b+y.quantity*y.priceForItem,0),0);return F(+d.toFixed(2))+"₽"},N=s=>{u.value=!0,v.value=r.value.find(t=>t.id===s)||U};return V(p,()=>{if(p.value==="this_month"&&(i.value=new Date().toISOString().slice(0,7)),p.value==="yesterday"){const s=new Date,t=new Date(s);t.setDate(s.getDate()-1),i.value=t.toISOString().split("T")[0]}}),V(i,async()=>{await _()},{deep:!0}),V(u,async()=>{u.value||await _()}),vt(async()=>{await T(),await _()}),(s,t)=>{const d=J,c=X,$=W,b=Q,y=K,O=Y,g=at,h=st,I=it,E=ot,H=Z,L=nt,q=ut,A=rt,P=mt,j=et,z=_t,R=pt,G=lt;return f(),C("div",wt,[n("div",xt,[e(d)]),n("div",St,[n("div",Dt,[n("div",Ut,[e(y,null,{default:o(()=>[e(b,{class:"p-3 pb-2"},{default:o(()=>[e(c,null,{default:o(()=>t[8]||(t[8]=[m("Приобретено на сумму",-1)])),_:1,__:[8]}),e($,{class:"text-3xl font-semibold whitespace-nowrap"},{default:o(()=>[m(gt(x.value),1)]),_:1})]),_:1})]),_:1}),n("div",$t,[e(O,{suppliers:S.value,"positions-list":D.value,onSupplieCreated:t[0]||(t[0]=async()=>{await _(),await T()})},null,8,["suppliers","positions-list"]),e(E,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=a=>p.value=a),"default-value":"month"},{default:o(()=>[n("div",bt,[n("div",Vt,[e(h,null,{default:o(()=>[e(g,{value:"this_month"},{default:o(()=>t[9]||(t[9]=[m(" Этот месяц ",-1)])),_:1,__:[9]}),e(g,{value:"yesterday"},{default:o(()=>t[10]||(t[10]=[m(" Вчера ",-1)])),_:1,__:[10]}),e(g,{value:"month"},{default:o(()=>t[11]||(t[11]=[m(" Выбрать месяц ",-1)])),_:1,__:[11]}),e(g,{value:"day"},{default:o(()=>t[12]||(t[12]=[m(" Выбрать день ",-1)])),_:1,__:[12]})]),_:1}),p.value==="month"?(f(),C("div",Ct,[e(I,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=a=>i.value=a),type:"month"},null,8,["modelValue"])])):B("",!0),p.value==="day"?(f(),C("div",Tt,[e(I,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=a=>i.value=a),type:"date"},null,8,["modelValue"])])):B("",!0)])])]),_:1},8,["modelValue"])]),n("div",null,[(f(),M(H,{key:r.value.length,data:r.value,columns:yt(tt),onTableSorted:t[4]||(t[4]=a=>x.value=k(a)),onItemClicked:t[5]||(t[5]=a=>N(a))},null,8,["data","columns"]))])])]),e(G,{open:u.value,"onUpdate:open":t[7]||(t[7]=a=>u.value=a)},{default:o(()=>[e(L),e(R,{class:"max-w-[1200px] flex flex-col"},{default:o(()=>[e(P,null,{default:o(()=>[e(q,null,{default:o(()=>t[13]||(t[13]=[m("Редактировать статью",-1)])),_:1,__:[13]}),e(A)]),_:1}),(f(),M(j,{key:v.value.id,suppliers:S.value,supplie:v.value,"positions-list":D.value,onSupplieUpdated:t[6]||(t[6]=async()=>{u.value=!1,v.value=U,await _()})},null,8,["suppliers","supplie","positions-list"])),e(z)]),_:1})]),_:1},8,["open"])])])}}});export{ge as default};
